<!DOCTYPE html>
<!--*************************************************************************
    ADOBE CONFIDENTIAL
    ___________________
    *
    Copyright 2015 Adobe Systems Incorporated
    All Rights Reserved.
    *
    NOTICE: All information contained herein is, and remains
    the property of Adobe Systems Incorporated and its suppliers,
    if any. The intellectual and technical concepts contained
    herein are proprietary to Adobe Systems Incorporated and its
    suppliers and are protected by all applicable intellectual property laws, including trade secret and copyright laws.
    Dissemination of this information or reproduction of this material
    is strictly forbidden unless prior written permission is obtained
    from Adobe Systems Incorporated.
**************************************************************************-->

<html lang="en">
<head>
    <meta charset="utf-8"/>
    <title>Primetime Reference Client</title>
    <meta name="description" content="" />

    <link rel="stylesheet" href="../reference/css/style.css">
    <link rel="stylesheet" href="../reference/css/cea608.css" type="text/css">
    <link rel="stylesheet" href="../reference/css/error_dialog.css">
	<!-- For chromecast -->
	<link rel="stylesheet" href="css/chromecast.css">	
    <!-- TVSDK libs -->
    <script src= "../../frameworks/player/dash.min.js"></script>
    <script src= "../../frameworks/player/primetimemain.min.js"></script>
    <script src= "../../frameworks/player/swfobject.js"></script>
    <script src= "../../frameworks/player/primetimeei.min.js"></script>
	
	<!-- TVSDK VHL Integration Libs -->
    <script src= "../reference/libs/AppMeasurement.js"></script>
    <script src= "../reference/libs/VisitorAPI.js"></script>
	<script src= "../../frameworks/player/primetimeva.min.js"></script>

    <!-- Reference player libs -->
    <script src="../reference/ReferencePlayer.js"></script>
    <script src="../reference/ReferencePlayerHelpers.js"></script>
    
    <!-- custom generators and resolvers -->    
    <script src="../reference/Generators/ServerMapOpportunityGenerator.js"></script>
    <script src="../reference/Generators/ExtCueOutOpportunityGenerator.js"></script>
    <script src="../reference/Generators/ExtCueOutContentFactory.js"></script>

    <!-- Add Ons -->
    <script src="../reference/FeatureAddOns/MediaSourceList.js"></script>
    <script src="../reference/FeatureAddOns/PlayerControls.js"></script>
    <script src="../reference/FeatureAddOns/Ads.js"></script>
    <script src="../reference/FeatureAddOns/Captions.js"></script>
    <script src="../reference/FeatureAddOns/LBA.js"></script>
    <script src="../reference/FeatureAddOns/TrickPlay.js"></script>
    <script src="../reference/FeatureAddOns/BufferingOverlay.js"></script>
    <script src="../reference/FeatureAddOns/DRM.js"></script>
    <script src="../reference/FeatureAddOns/ID3.js"></script>
    <script src="../reference/FeatureAddOns/TimelineMarker.js"></script>
    <script src="../reference/FeatureAddOns/ErrorDialog.js"></script>
    <script src="../reference/FeatureAddOns/ClickableAds.js"></script>
    <script src="../reference/FeatureAddOns/CompanionAds.js"></script>

    <script src="../reference/DebuggingAddOns/LogPlayerEvents.js"></script>
    <script src="../reference/DebuggingAddOns/AdditionalParams.js"></script>
	<script src="../reference/DebuggingAddOns/CustomAdPolicySelector.js"></script>
    <script src="../reference/DebuggingAddOns/ConsoleLogs.js"></script>
    <script src="../reference/DebuggingAddOns/QoS.js"></script>

    <script src="//ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js" type="text/javascript"></script>

    <script>
        var swfPath = "../../frameworks/player/",
        authorizationTokenPath = "../../frameworks/player/token/",
		authorizationTokenFilename = "ESPN05132015.swf",
        authorizationTokenType = "SWF";
        drmMetadataPath = "../../frameworks/player/drmMetadata/";
        sourcesFilePath = "../reference/input/sources.json";

        var playerWrapper; // the reference playerWrapper

        // seek to live button used if media is live.
        var liveLink = document.createElement("BUTTON");
        liveLink.type = "button";
        liveLink.value = "seek to live";
        liveLink.classList.add("link");
        liveLink.innerHTML = "LIVE";
        liveLink.addEventListener("click", function () { playerWrapper.seekToLive(); });

        // check if MSE is supported by this browser or not.
        window.MediaSource = window.MediaSource || window.WebKitMediaSource;
        if (!window.MediaSource) {
            //alert('MediaSource API is not available. it won\'t work on this browser');
        }

        function getUrlVars() {
            var vars = {};
            var parts = window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi, function(m,key,value) {
                vars[key] = value;
            });
            return vars;
        }

		function adManagerLoaded (clientData) {
			var url = clientData.url;
			var adurl = clientData.adurl;
			var forceFlash = clientData.forceFlash;
			loadInner (url, adurl, forceFlash);
		}

        function load (url, adurl, forceFlash) {
        	var clientData = {url: url, adurl: adurl, forceFlash: forceFlash};
			loadInner (url, adurl, forceFlash);
        }

        /**
         * Load media resource for playback. Resets various playerWrapper controls.
         * @param url - manifest url to load
           @param adurl - ad server url
         */
        function loadInner (url, adurl, forceFlash)
        {
            playerWrapper.dispatchEventWrapper(ReferencePlayer.Events.LoadInitiatedEvent, {target: this});

            var resourceType = null;
            if (adurl == undefined)
            	adurl = null ;
            if (forceFlash == undefined)
                forceFlash = false;
			if ((url=="" && (isAdsParamChecked() )) || (url=="" && adurl!="" ))
				resourceType = AdobePSDK.MediaResourceType.CUSTOM;
            playerWrapper.loadMediaResource(url, adurl, resourceType, forceFlash);
        }

        function reset ()
        {
            playerWrapper.reset();
        }
        function CheckonFlashLive()
        {
            try {
                console.log(AdobePSDK.checkIfFlashIsAlive());
            }
            catch (error) {
                console.log(error);
            }

        }
        var tempVar;
        function setRepeatedCheckonFlashLive() {
            tempVar= window.setInterval(CheckonFlashLive, 2000);
        }
        function unSetRepeatedCheckonFlashLive() {
            window.clearInterval(tempVar);
        }


        function startVideo() {
            var vars = getUrlVars();

            // See JSDocs for AdobePSDK for API description
            // Set relative or http path to directory containing SWF.
            // Defaults to current directory for the html page.
            AdobePSDK.setSWFPath(swfPath);

            // Set the relative or http path to directory containing token file(s).
            // Defaults to SWFPath + "token/".
            AdobePSDK.setAuthorizationTokenPath(authorizationTokenPath);

            // Set the name of the token file, do not include any path in this string.
            AdobePSDK.setAuthorizationTokenFilename(authorizationTokenFilename);

            //Set the token type, "DAT" or "SWF". Defaults to "DAT"
            AdobePSDK.setAuthorizationTokenType(authorizationTokenType);

            // Set the path to the pre-baked drm metadata used for initializing the drm system.
            AdobePSDK.setDRMMetadataPath(drmMetadataPath);

            // initialize TVSDK Reference Player.
            playerWrapper = new ReferencePlayer("videoDiv", "mainVideoDiv");
            // Optional Add-ons
            playerWrapper.loadAddOns ();


           // load media resource on click of load button
           var onLoadSource = function(event) {

               var endsWith = function (str, suffix) {
                   return str.toUpperCase().indexOf(suffix.toUpperCase(), str.length - suffix.length) !== -1;
               };

               var url = document.getElementById("media-source-textbox").value;

               //load JSON file and populate source list
               trimmedUrl = url.trim();
               if (endsWith(trimmedUrl, ".json")) {
                    playerWrapper.loadSourceJSON(url);
                    return;
               }

               var adurl = document.getElementById("ad-url-textbox").value;
               var forceFlash = document.getElementById("forceflash-textbox").value;
                // Checking for DRM
               if (isAdditionalParamsAvail())
                   loadResource_HandleDRM();
               load (url, adurl, forceFlash);
           };

           var loadSourceButton = document.getElementById("load-source");
           loadSourceButton.onclick = onLoadSource;
        }

        function onSkinChange() {
            // background color
            var bgColor = document.getElementById("bgcolor").value;
            var hoverColor = document.getElementById("hovercolor").value;
            var skinnableElements = document.getElementsByClassName("vid-skin-bgcolor");
            var count = skinnableElements.length;
            for (var index = 0; index < count; index++) {
                skinnableElements[index].style.backgroundColor = bgColor;

                skinnableElements[index].addEventListener('mouseover', function(event){
                    var target = event.target || event.srcElement;
                    target.style.backgroundColor = hoverColor;
                });
                skinnableElements[index].addEventListener('mouseout', function(event){
                    var target = event.target || event.srcElement;
                    target.style.backgroundColor = bgColor;
                });
            }

            // foreground color
            skinnableElements = document.getElementsByClassName("vid-skin-fgcolor");
            var count = skinnableElements.length;
            for (var index = 0; index < count; index++) {
                skinnableElements[index].style.color = bgColor;
            }

            // Play head
            var shape = document.getElementById("playhead_shape").value;
            var playhead = document.getElementById("playhead");
            playhead.classList.remove ("round");
            playhead.classList.remove ("square");
            playhead.classList.add (shape);

            // Buffering overlay
            var buffer_overlay = document.getElementById("buff_overlay").value;
            var overlay = document.getElementById("buffering-overlay");
            overlay.classList.remove ("spinner");
            overlay.classList.remove ("overlay-text");
            overlay.classList.remove ("signal");
            overlay.classList.remove ("vertical");
            overlay.classList.add (buffer_overlay);
            if (buffer_overlay === "vertical") {
                // create children divs
                var div1 = document.createElement("div");
                div1.classList.add("vertical-bar");
                var div2 = document.createElement("div");
                div2.classList.add("vertical-bar");
                var div3 = document.createElement("div");
                div3.classList.add("vertical-bar");
                var div4 = document.createElement("div");
                div4.classList.add("vertical-bar");
                overlay.appendChild (div1);
                overlay.appendChild (div2);
                overlay.appendChild (div3);
                overlay.appendChild (div4);
            } else {
                // delete the child divs
                var barDivs = overlay.getElementsByTagName ("div");
                for (var index = barDivs.length - 1; index >= 0; index--) {
                    overlay.removeChild(barDivs[index]);
                }
            }
            // set the colors
            if (buffer_overlay === "signal") {
                document.getElementsByClassName("signal")[0].style.borderColor = bgColor;
            }
        }
    </script>
	<!-- For chromecast -->
	<script src="//www.gstatic.com/cast/sdk/libs/receiver/2.0.0/cast_receiver.js"></script>
	<script src="ChromecastConstants.js"></script>
	<script src="Receiver.js"></script>	
</head>

<body onload="startVideo()">
<div>
    <div id="column1">
        <div>
            <div class="col" id="div_basicPlayer">
                <div id="source-list" hidden="true"></div>
                <div id="source-select-group" hidden="true">
                            <span id="source-select-container">
                                <button type="button" id="select-media-button" class="media-button" hidden="true">Media</button>
                                <input type="text" id="media-source-textbox" list="menu-overlay" placeholder="manifest" cols="30">
                                <div id="div-ad" hidden="true"><input type="text" id="ad-url-textbox" value="{}"></div>
                                <div id="div-forceflash" hidden="true"><input type="text" id="forceflash-textbox"></div>
                                <button type="button" id="load-source" class="load-button">Load</button>
                                <button type="button" onclick="reset()" class="reset-button">Reset</button>
                                <label class="panel-title" id="player-tech-type"></label>
                            </span>
                </div>
                <!--
                 Feature Add-On Attributes: featureAddOnVideoControls featureAddOnsourceList featureAddOnAdEvents featureAddOnCaptions featureAddOnTrickPlay featureAddOnLateBoundAudio featureAddOnBufferingOverlay featureAddOnDRMEvents
                 Debug Add-On Attributes: debugAddOnConsoleLogs debugAddOnAdditionalParams debugAddOnqosMetrics debugAddOnlogEvents
                 Important Note: If you want to use featureAddOnVideoControls attribute, then do specify the video-controls div.
                -->
                <!-- Placeholder for Custom video controls Add On. Need to remove controls from video tag above. -->
                <div id="video-controls" class="video-controls-style" hidden="true"></div>
                <div id="mainVideoDiv" class="main-video-div-style">
                <div id="videoDiv" class="video-div-style background-style"
                     featureAddOnVideoControls="video-controls" featureAddOnsourceList featureAddOnAdEvents featureAddOnDRMEvents featureAddOnCaptions featureAddOnBufferingOverlay
                     featureAddOnTrickPlay featureAddOnLateBoundAudio featureAddOnID3Events featureAddOnTimelineMarkerEvents featureClickableAds="adClickButton"
                     debugAddOnAdditionalParams debugAddOnqosMetrics
                     featureCompanions="companionDiv">
                    <div id="buffering-overlay" hidden="true"></div>
                </div>
                <button id="adClickButton" type="button" class="clickableAd-button" hidden="true">Ad Click</button>
				<!-- For chromecast -->
				<div id="video-title">Primetime Browser TVSDK</div>
                </div>
                <div id="playerLookAndFeel" hidden="true">
                    <br>
                    Color
                    <select id="bgcolor">
                        <option value="#428bca">Blue</option>
                        <option value="#ff1828">Red</option>
                        <option value="#26A65B">Green</option>
                        <option value="#E87E04">Gold</option>
                    </select>
                    <!--
                    <input type="text" id="bgcolor" style="width:10%" value="#428bca">
                    -->
                    Hover Color
                    <select id="hovercolor">
                        <option value="#428bca">Blue</option>
                        <option value="#ff1828">Red</option>
                        <option value="#26A65B">Green</option>
                        <option value="#E87E04">Gold</option>
                    </select>
                    <!--
                    <input type="text" id="hovercolor" style="width:10%" value="#428bca">
                    -->
                    Playhead
                    <select id="playhead_shape">
                        <option value="round">Round</option>
                        <option value="square">Square</option>
                    </select>
                    <!-- Buffering Overlay -->
                    Buffering Overlay
                    <select id="buff_overlay">
                        <option value="overlay-text">Text</option>
                        <option value="spinner">Spinner</option>
                        <option value="signal">Signal</option>
                        <option value="vertical">Bars</option>
                    </select>
                    <button id="skincolor" onclick="onSkinChange()">Apply</button>
                </div>
            </div>
        </div>
        <div id="companionDiv" hidden="true"></div>
		<div class="main-video-div-style" hidden="true">
			<!-- Add On Qos Metrics Chart-->
			<div class="col div-logs" id="div_qos_metrics_chart"></div>
			<!-- Add On Console Logs -->
			<div class="col div-logs" id="div_console_logs" style="visibility:hidden"></div>
			<!-- Add On Performance Logs -->
			<!--div class="col div-logs" id="div_performanceLogs" style="visibility:hidden"></div-->
		</div>
    </div>
    <div id="column2" hidden="true">
        <!-- Add On Qos Metrics -->
        <div class="col" id="div_qos_metrics"></div>
        <!-- Add On Parameters -->
        <div class="col" id="div_addon_options"></div>
    </div>
</div>
<!-- For chromecast -->

</body>
</html>
