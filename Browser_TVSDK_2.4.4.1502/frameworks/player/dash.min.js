(function(b){var c={VERSION:"0.5.3",System:function(){this._mappings={};this._outlets={};this._handlers={};this.strictInjections=!0;this.autoMapOutlets=!1;this.postInjectionHook="setup"}};c.System.prototype={_createAndSetupInstance:function(b,c){var g=new c;this.injectInto(g,b);return g},_retrieveFromCacheOrCreate:function(b,c){"undefined"===typeof c&&(c=!1);var g;if(this._mappings.hasOwnProperty(b))g=this._mappings[b],!c&&g.isSingleton?(null==g.object&&(g.object=this._createAndSetupInstance(b,g.clazz)),
g=g.object):g=g.clazz?this._createAndSetupInstance(b,g.clazz):g.object;else throw Error(1E3);return g},mapOutlet:function(b,c,g){if("undefined"===typeof b)throw Error(1010);c=c||"global";g=g||b;this._outlets.hasOwnProperty(c)||(this._outlets[c]={});this._outlets[c][g]=b;return this},getObject:function(b){if("undefined"===typeof b)throw Error(1020);return this._retrieveFromCacheOrCreate(b)},mapValue:function(b,c){if("undefined"===typeof b)throw Error(1030);this._mappings[b]={clazz:null,object:c,isSingleton:!0};
this.autoMapOutlets&&this.mapOutlet(b);this.hasMapping(b)&&this.injectInto(c,b);return this},hasMapping:function(b){if("undefined"===typeof b)throw Error(1040);return this._mappings.hasOwnProperty(b)},mapClass:function(b,c){if("undefined"===typeof b)throw Error(1050);if("undefined"===typeof c)throw Error(1051);this._mappings[b]={clazz:c,object:null,isSingleton:!1};this.autoMapOutlets&&this.mapOutlet(b);return this},mapSingleton:function(b,c){if("undefined"===typeof b)throw Error(1060);if("undefined"===
typeof c)throw Error(1061);this._mappings[b]={clazz:c,object:null,isSingleton:!0};this.autoMapOutlets&&this.mapOutlet(b);return this},instantiate:function(b){if("undefined"===typeof b)throw Error(1070);return this._retrieveFromCacheOrCreate(b,!0)},injectInto:function(b,c){if("undefined"===typeof b)throw Error(1080);if("object"===typeof b){var g=[];this._outlets.hasOwnProperty("global")&&g.push(this._outlets.global);"undefined"!==typeof c&&this._outlets.hasOwnProperty(c)&&g.push(this._outlets[c]);
for(var k in g)if(g.hasOwnProperty(k)){var l=g[k],m;for(m in l){var h=l[m];if(!this.strictInjections||m in b)b[m]=this.getObject(h)}}"setup"in b&&b.setup.call(b)}return this},unmap:function(b){if("undefined"===typeof b)throw Error(1090);delete this._mappings[b];return this},unmapOutlet:function(b,c){if("undefined"===typeof b)throw Error(1100);if("undefined"===typeof c)throw Error(1101);delete this._outlets[b][c];return this},mapHandler:function(b,c,g,k,l){if("undefined"===typeof b)throw Error(1110);
c=c||"global";g=g||b;"undefined"===typeof k&&(k=!1);"undefined"===typeof l&&(l=!1);this._handlers.hasOwnProperty(b)||(this._handlers[b]={});this._handlers[b].hasOwnProperty(c)||(this._handlers[b][c]=[]);this._handlers[b][c].push({handler:g,oneShot:k,passEvent:l});return this},unmapHandler:function(b,c,g){if("undefined"===typeof b)throw Error(1120);c=c||"global";g=g||b;if(this._handlers.hasOwnProperty(b)&&this._handlers[b].hasOwnProperty(c)){b=this._handlers[b][c];for(var k in b)if(b[k].handler===
g){b.splice(k,1);break}}return this},notify:function(b){if("undefined"===typeof b)throw Error(1130);var c=Array.prototype.slice.call(arguments),g=c.slice(1);if(this._handlers.hasOwnProperty(b)){var k=this._handlers[b],l;for(l in k){var m=k[l],h;"global"!==l&&(h=this.getObject(l));var f=[],n,q;n=0;for(q=m.length;n<q;n++){var t,r=m[n];null!==r&&void 0!==r&&(t=h&&"string"===typeof r.handler?h[r.handler]:r.handler,r.oneShot&&f.unshift(n),r.passEvent?t.apply(h,c):t.apply(h,g))}n=0;for(q=f.length;n<q;n++)m.splice(f[n],
1)}}return this}};b.dijon=c})(this);var UTF8={encode:function(b){for(var c=[],d=0;d<b.length;++d){var e=b.charCodeAt(d);128>e?c.push(e):(2048>e?c.push(192|e>>6):(65536>e?c.push(224|e>>12):(c.push(240|e>>18),c.push(128|63&e>>12)),c.push(128|63&e>>6)),c.push(128|63&e))}return c},decode:function(b){for(var c=[],d=0;d<b.length;){var e=b[d++];128>e||(224>e?e=(31&e)<<6:(240>e?e=(15&e)<<12:(e=(7&e)<<18,e|=(63&b[d++])<<12),e|=(63&b[d++])<<6),e|=63&b[d++]);c.push(String.fromCharCode(e))}return c.join("")}},BASE64={};
(function(b){var c=function(c){for(var d=0,e=[],h=0|c.length/3;0<h--;){var f=(c[d]<<16)+(c[d+1]<<8)+c[d+2],d=d+3;e.push(b.charAt(63&f>>18));e.push(b.charAt(63&f>>12));e.push(b.charAt(63&f>>6));e.push(b.charAt(63&f))}2==c.length-d?(f=(c[d]<<16)+(c[d+1]<<8),e.push(b.charAt(63&f>>18)),e.push(b.charAt(63&f>>12)),e.push(b.charAt(63&f>>6)),e.push("=")):1==c.length-d&&(f=c[d]<<16,e.push(b.charAt(63&f>>18)),e.push(b.charAt(63&f>>12)),e.push("=="));return e.join("")},d=function(){for(var c=[],d=0;d<b.length;++d)c[b.charCodeAt(d)]=
d;c[61]=0;return c}(),e=function(b){for(var c=0,e=[],h=0|b.length/4;0<h--;){var f=(d[b.charCodeAt(c)]<<18)+(d[b.charCodeAt(c+1)]<<12)+(d[b.charCodeAt(c+2)]<<6)+d[b.charCodeAt(c+3)];e.push(255&f>>16);e.push(255&f>>8);e.push(255&f);c+=4}e&&("="==b.charAt(c-2)?(e.pop(),e.pop()):"="==b.charAt(c-1)&&e.pop());return e},g={encode:function(b){for(var c=[],d=0;d<b.length;++d)c.push(b.charCodeAt(d));return c},decode:function(b){for(b=0;b<s.length;++b)a[b]=String.fromCharCode(a[b]);return a.join("")}};BASE64.decodeArray=
function(b){b=e(b);return new Uint8Array(b)};BASE64.encodeASCII=function(b){b=g.encode(b);return c(b)};BASE64.decodeASCII=function(b){b=e(b);return g.decode(b)};BASE64.encode=function(b){b=UTF8.encode(b);return c(b)};BASE64.decode=function(b){b=e(b);return UTF8.decode(b)}})("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/");if(void 0===btoa)var btoa=BASE64.encode;if(void 0===atob)var atob=BASE64.decode;function X2JS(b,c,d){function e(b){var c=b.localName;null==c&&(c=b.baseName);if(null==c||""==c)c=b.nodeName;return c}function g(b){return"string"==typeof b?b.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;"):b}function k(f){if(f.nodeType==p.DOCUMENT_NODE){var h,n=f.firstChild,l;h=0;for(l=f.childNodes.length;h<l;h+=1)if(f.childNodes[h].nodeType!==p.COMMENT_NODE){n=f.childNodes[h];break}d?h=k(n):(h={},l=e(n),h[l]=k(n));
return h}if(f.nodeType==p.ELEMENT_NODE){h={__cnt:0};for(var g=[],m=f.childNodes,q=0;q<m.length;q++)if(n=m.item(q),l=e(n),h.__cnt++,null==h[l]){n=k(n);if("#text"!=l||/[^\s]/.test(n)){var t={};t[l]=n;g.push(t)}h[l]=n;h[l+"_asArray"]=Array(1);h[l+"_asArray"][0]=h[l]}else{if(null!=h[l]&&!(h[l]instanceof Array)){var A=h[l];h[l]=[];h[l][0]=A;h[l+"_asArray"]=h[l]}for(A=0;null!=h[l][A];)A++;n=k(n);if("#text"!=l||/[^\s]/.test(n))t={},t[l]=n,g.push(t);h[l][A]=n}h.__children=g;for(n=0;n<f.attributes.length;n++){l=
f.attributes.item(n);h.__cnt++;g=l.value;m=0;for(q=b.length;m<q;m++)A=b[m],A.test.call(this,l)&&(g=A.converter.call(this,l.value));h[c+l.name]=g}f=f.prefix;null!=f&&""!=f&&(h.__cnt++,h.__prefix=f);1==h.__cnt&&null!=h["#text"]&&(h=h["#text"]);null!=h["#text"]&&(h.__text=h["#text"],r&&(h.__text=h.__text.replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&#x27;/g,"'").replace(/&#x2F;/g,"/")),delete h["#text"],delete h["#text_asArray"]);null!=h["#cdata-section"]&&
(h.__cdata=h["#cdata-section"],delete h["#cdata-section"],delete h["#cdata-section_asArray"]);if(null!=h.__text||null!=h.__cdata)h.toString=function(){return(null!=this.__text?this.__text:"")+(null!=this.__cdata?this.__cdata:"")};return h}if(f.nodeType==p.TEXT_NODE||f.nodeType==p.CDATA_SECTION_NODE)return f.nodeValue;if(f.nodeType==p.COMMENT_NODE)return null}function l(b,c,f,d){c="<"+(null!=b&&null!=b.__prefix?b.__prefix+":":"")+c;if(null!=f)for(var h=0;h<f.length;h++){var e=f[h],n=b[e];c+=" "+e.substr(1)+
"='"+n+"'"}return d?c+"/>":c+">"}function m(b,c){return"</"+(null!=b.__prefix?b.__prefix+":":"")+c+">"}function h(b,c){var f=c.toString();return-1!==f.indexOf("_asArray",f.length-8)||0==c.toString().indexOf("_")||b[c]instanceof Function?!0:!1}function f(b){var c=0;if(b instanceof Object)for(var f in b)h(b,f)||c++;return c}function n(b){var c=[];if(b instanceof Object)for(var f in b)-1==f.toString().indexOf("__")&&0==f.toString().indexOf("_")&&c.push(f);return c}function q(b){var c="";if(b instanceof
Object){var f="";null!=b.__cdata&&(f+="<![CDATA["+b.__cdata+"]]\x3e");null!=b.__text&&(f=r?f+g(b.__text):f+b.__text);c+=f}else null!=b&&(c=r?c+g(b):c+b);return c}function t(b){var c="";if(0<f(b))for(var d in b)if(!h(b,d)){var e=b[d],g=n(e);if(null==e||void 0==e)c+=l(e,d,g,!0);else if(e instanceof Object)if(e instanceof Array){var k=d,p="";if(0==e.length)p+=l(e,k,g,!0);else for(g=0;g<e.length;g++)p+=l(e[g],k,n(e[g]),!1),p+=t(e[g]),p+=m(e[g],k);c+=p}else 0<f(e)||null!=e.__text||null!=e.__cdata?(c+=
l(e,d,g,!1),c+=t(e),c+=m(e,d)):c+=l(e,d,g,!0);else c+=l(e,d,g,!1),c+=q(e),c+=m(e,d)}return c+=q(b)}if(null===c||void 0===c)c="_";if(null===d||void 0===d)d=!1;var r=!1,p={ELEMENT_NODE:1,TEXT_NODE:3,CDATA_SECTION_NODE:4,COMMENT_NODE:8,DOCUMENT_NODE:9};this.parseXmlString=function(b){var c,f,d;if(window.DOMParser){f=new window.DOMParser;try{d=f.parseFromString("<","text/xml").getElementsByTagName("parsererror")[0].namespaceURI}catch(h){}try{c=f.parseFromString(b,"text/xml"),d&&c.getElementsByTagNameNS(d,
"parsererror").length&&(c=void 0)}catch(e){}}else 0==b.indexOf("<?")&&(b=b.substr(b.indexOf("?>")+2)),c=new ActiveXObject("Microsoft.XMLDOM"),c.async="false",c.loadXML(b);return c};this.xml2json=function(b){return k(b)};this.xml_str2json=function(b){return(b=this.parseXmlString(b))?this.xml2json(b):void 0};this.json2xml_str=function(b){return t(b)};this.json2xml=function(b){b=this.json2xml_str(b);return this.parseXmlString(b)};this.getVersion=function(){return"1.0.11"};this.escapeMode=function(b){r=
b}};function ObjectIron(b){var c;c=[];i=0;for(len=b.length;i<len;i+=1)b[i].isRoot?c.push("root"):c.push(b[i].name);var d=function(b,c,d){var h,f,e,g,t;if(null!==b&&0!==b.length)for(h=0,f=b.length;h<f;h+=1)if(e=b[h],c.hasOwnProperty(e.name))if(d.hasOwnProperty(e.name)){if(e.merge)if(g=c[e.name],t=d[e.name],"object"===typeof g&&"object"===typeof t){if(e=g,g=void 0,null!==e&&null!==t)for(g in e)e.hasOwnProperty(g)&&(t.hasOwnProperty(g)||(t[g]=e[g]))}else d[e.name]=null!=e.mergeFunction?e.mergeFunction(g,
t):g+t}else d[e.name]=c[e.name]},e=function(b,c){var g,h,f,n,q,t,r;if(null!==b.children&&0!==b.children.length)for(g=0,h=b.children.length;g<h;g+=1)if(t=b.children[g],c.hasOwnProperty(t.name))if(t.isArray)for(q=c[t.name+"_asArray"],f=0,n=q.length;f<n;f+=1)r=q[f],d(b.properties,c,r),e(t,r);else r=c[t.name],d(b.properties,c,r),e(t,r)},g=function(d){var l,m,h,f,n,q;if(null===d||"object"!==typeof d)return d;l=0;for(m=c.length;l<m;l+=1)"root"===c[l]&&(f=b[l],n=d,e(f,n));for(h in d)if(d.hasOwnProperty(h)&&
"__children"!=h){l=c.indexOf(h);if(-1!==l)if(f=b[l],f.isArray)for(q=d[h+"_asArray"],l=0,m=q.length;l<m;l+=1)n=q[l],e(f,n);else n=d[h],e(f,n);g(d[h])}return d};return{run:g}};var ISOBoxer=ISOBoxer||{};ISOBoxer.Cursor=function(b){this.offset="undefined"==typeof b?0:b};var ISOBox=function(){this._cursor=new ISOBoxer.Cursor};ISOBox.parse=function(b){var c=new ISOBox;return c._offset=b._cursor.offset,c._root=b._root?b._root:b,c._raw=b._raw,c._parent=b,c._parseBox(),b._cursor.offset=c._raw.byteOffset+c._raw.byteLength,c};
ISOBox.prototype._readInt=function(b){var c=null;switch(b){case 8:c=this._raw.getInt8(this._cursor.offset-this._raw.byteOffset);break;case 16:c=this._raw.getInt16(this._cursor.offset-this._raw.byteOffset);break;case 32:c=this._raw.getInt32(this._cursor.offset-this._raw.byteOffset)}return this._cursor.offset+=b>>3,c};
ISOBox.prototype._readUint=function(b){var c=null;switch(b){case 8:c=this._raw.getUint8(this._cursor.offset-this._raw.byteOffset);break;case 16:c=this._raw.getUint16(this._cursor.offset-this._raw.byteOffset);break;case 24:var c=this._raw.getUint16(this._cursor.offset-this._raw.byteOffset),d=this._raw.getUint8(this._cursor.offset-this._raw.byteOffset+2),c=(c<<8)+d;break;case 32:c=this._raw.getUint32(this._cursor.offset-this._raw.byteOffset);break;case 64:c=this._raw.getUint32(this._cursor.offset-this._raw.byteOffset),
d=this._raw.getUint32(this._cursor.offset-this._raw.byteOffset+4),c=c*Math.pow(2,32)+d}return this._cursor.offset+=b>>3,c};ISOBox.prototype._readString=function(b){for(var c="",d=0;b>d;d++)var e=this._readUint(8),c=c+String.fromCharCode(e);return c};ISOBox.prototype._readTerminatedString=function(){for(var b="";;){var c=this._readUint(8);if(0==c)break;b+=String.fromCharCode(c)}return b};
ISOBox.prototype._readTemplate=function(b){var c=this._readUint(b/2),d=this._readUint(b/2);return c+d/Math.pow(2,b/2)};
ISOBox.prototype._parseBox=function(){if(this._cursor.offset=this._offset,this._offset+8>this._raw.buffer.byteLength)return void(this._root._incomplete=!0);switch(this.size=this._readUint(32),this.type=this._readString(4),1==this.size&&(this.largesize=this._readUint(64)),"uuid"==this.type&&(this.usertype=this._readString(16)),this.size){case 0:this._raw=new DataView(this._raw.buffer,this._offset,this._raw.byteLength-this._cursor.offset);break;case 1:this._offset+this.size>this._raw.buffer.byteLength?
(this._incomplete=!0,this._root._incomplete=!0):this._raw=new DataView(this._raw.buffer,this._offset,this.largesize);break;default:this._offset+this.size>this._raw.buffer.byteLength?(this._incomplete=!0,this._root._incomplete=!0):this._raw=new DataView(this._raw.buffer,this._offset,this.size)}!this._incomplete&&this._boxParsers[this.type]&&this._boxParsers[this.type].call(this)};ISOBox.prototype._parseFullBox=function(){this.version=this._readUint(8);this.flags=this._readUint(24)};
ISOBox.prototype._boxParsers={};"moov trak tref mdia minf stbl edts dinf mvex moof traf mfra udta meco strk".split(" ").forEach(function(b){ISOBox.prototype._boxParsers[b]=function(){for(this.boxes=[];this._cursor.offset-this._raw.byteOffset<this._raw.byteLength;)this.boxes.push(ISOBox.parse(this))}});
ISOBox.prototype._boxParsers.emsg=function(){this._parseFullBox();this.scheme_id_uri=this._readTerminatedString();this.value=this._readTerminatedString();this.timescale=this._readUint(32);this.presentation_time_delta=this._readUint(32);this.event_duration=this._readUint(32);this.id=this._readUint(32);this.message_data=new DataView(this._raw.buffer,this._cursor.offset,this._raw.byteLength-(this._cursor.offset-this._offset))};
ISOBox.prototype._boxParsers.free=ISOBox.prototype._boxParsers.skip=function(){this.data=new DataView(this._raw.buffer,this._cursor.offset,this._raw.byteLength-(this._cursor.offset-this._offset))};ISOBox.prototype._boxParsers.ftyp=ISOBox.prototype._boxParsers.styp=function(){this.major_brand=this._readString(4);this.minor_versions=this._readUint(32);for(this.compatible_brands=[];this._cursor.offset-this._raw.byteOffset<this._raw.byteLength;)this.compatible_brands.push(this._readString(4))};
ISOBox.prototype._boxParsers.mdat=function(){this.data=new DataView(this._raw.buffer,this._cursor.offset,this._raw.byteLength-(this._cursor.offset-this._offset))};
ISOBox.prototype._boxParsers.mdhd=function(){this._parseFullBox();1==this.version?(this.creation_time=this._readUint(64),this.modification_time=this._readUint(64),this.timescale=this._readUint(32),this.duration=this._readUint(64)):(this.creation_time=this._readUint(32),this.modification_time=this._readUint(32),this.timescale=this._readUint(32),this.duration=this._readUint(32));var b=this._readUint(16);this.pad=b>>15;this.language=String.fromCharCode((b>>10&31)+96,(b>>5&31)+96,(31&b)+96);this.pre_defined=
this._readUint(16)};ISOBox.prototype._boxParsers.mfhd=function(){this._parseFullBox();this.sequence_number=this._readUint(32)};
ISOBox.prototype._boxParsers.mvhd=function(){this._parseFullBox();1==this.version?(this.creation_time=this._readUint(64),this.modification_time=this._readUint(64),this.timescale=this._readUint(32),this.duration=this._readUint(64)):(this.creation_time=this._readUint(32),this.modification_time=this._readUint(32),this.timescale=this._readUint(32),this.duration=this._readUint(32));this.rate=this._readTemplate(32);this.volume=this._readTemplate(16);this.reserved1=this._readUint(16);this.reserved2=[this._readUint(32),
this._readUint(32)];this.matrix=[];for(var b=0;9>b;b++)this.matrix.push(this._readTemplate(32));this.pre_defined=[];for(b=0;6>b;b++)this.pre_defined.push(this._readUint(32));this.next_track_ID=this._readUint(32)};
ISOBox.prototype._boxParsers.sidx=function(){this._parseFullBox();this.reference_ID=this._readUint(32);this.timescale=this._readUint(32);0==this.version?(this.earliest_presentation_time=this._readUint(32),this.first_offset=this._readUint(32)):(this.earliest_presentation_time=this._readUint(64),this.first_offset=this._readUint(64));this.reserved=this._readUint(16);this.reference_count=this._readUint(16);this.references=[];for(var b=0;b<this.reference_count;b++){var c={},d=this._readUint(32);c.reference_type=
d>>31&1;c.referenced_size=2147483647&d;c.subsegment_duration=this._readUint(32);d=this._readUint(32);c.starts_with_SAP=d>>31&1;c.SAP_type=d>>28&7;c.SAP_delta_time=268435455&d;this.references.push(c)}};
ISOBox.prototype._boxParsers.ssix=function(){this._parseFullBox();this.subsegment_count=this._readUint(32);this.subsegments=[];for(var b=0;b<this.subsegment_count;b++){var c={};c.ranges_count=this._readUint(32);c.ranges=[];for(var d=0;d<c.ranges_count;d++){var e={};e.level=this._readUint(8);e.range_size=this._readUint(24);c.ranges.push(e)}this.subsegments.push(c)}};
ISOBox.prototype._boxParsers.tkhd=function(){this._parseFullBox();1==this.version?(this.creation_time=this._readUint(64),this.modification_time=this._readUint(64),this.track_ID=this._readUint(32),this.reserved1=this._readUint(32),this.duration=this._readUint(64)):(this.creation_time=this._readUint(32),this.modification_time=this._readUint(32),this.track_ID=this._readUint(32),this.reserved1=this._readUint(32),this.duration=this._readUint(32));this.reserved2=[this._readUint(32),this._readUint(32)];
this.layer=this._readUint(16);this.alternate_group=this._readUint(16);this.volume=this._readTemplate(16);this.reserved3=this._readUint(16);this.matrix=[];for(var b=0;9>b;b++)this.matrix.push(this._readTemplate(32));this.width=this._readUint(32);this.height=this._readUint(32)};ISOBox.prototype._boxParsers.tfdt=function(){this._parseFullBox();this.baseMediaDecodeTime=this._readUint(1==this.version?64:32)};
ISOBox.prototype._boxParsers.tfhd=function(){this._parseFullBox();this.track_ID=this._readUint(32);1&this.flags&&(this.base_data_offset=this._readUint(64));2&this.flags&&(this.sample_description_offset=this._readUint(32));8&this.flags&&(this.default_sample_duration=this._readUint(32));16&this.flags&&(this.default_sample_size=this._readUint(32));32&this.flags&&(this.default_sample_flags=this._readUint(32))};
ISOBox.prototype._boxParsers.trun=function(){this._parseFullBox();this.sample_count=this._readUint(32);1&this.flags&&(this.data_offset=this._readInt(32));4&this.flags&&(this.first_sample_flags=this._readUint(32));this.samples=[];for(var b=0;b<this.sample_count;b++){var c={};256&this.flags&&(c.sample_duration=this._readUint(32));512&this.flags&&(c.sample_size=this._readUint(32));1024&this.flags&&(c.sample_flags=this._readUint(32));2048&this.flags&&(c.sample_composition_time_offset=0==this.version?
this._readUint(32):this._readInt(32));this.samples.push(c)}};ISOBoxer=ISOBoxer||{};ISOBoxer.parseBuffer=function(b){return(new ISOFile(b)).parse()};ISOBoxer.Utils={};ISOBoxer.Utils.dataViewToString=function(b,c){if("undefined"!=typeof TextDecoder)return(new TextDecoder(c||"utf-8")).decode(b);for(var d="",e=0;e<b.byteLength;e++)d+=String.fromCharCode(b.getUint8(e));return d};"undefined"!=typeof exports&&(exports.parseBuffer=ISOBoxer.parseBuffer,exports.Utils=ISOBoxer.Utils);
var ISOFile=function(b){this._raw=new DataView(b);this._cursor=new ISOBoxer.Cursor;this.boxes=[]};ISOFile.prototype.fetch=function(b){b=this.fetchAll(b,!0);return b.length?b[0]:null};ISOFile.prototype.fetchAll=function(b,c){var d=[];return ISOFile._sweep.call(this,b,d,c),d};ISOFile.prototype.parse=function(){this._cursor.offset=0;for(this.boxes=[];this._cursor.offset<this._raw.byteLength;){var b=ISOBox.parse(this);if("undefined"==typeof b.type)break;this.boxes.push(b)}return this};
ISOFile._sweep=function(b,c,d){this.type&&this.type==b&&c.push(this);for(var e in this.boxes){if(c.length&&d)break;ISOFile._sweep.call(this.boxes[e],b,c,d)}};MediaPlayer=function(b){var c=0,d,e,g,k,l,m=null,h=null,f,n,q,t,r,p,u,w,v=!1,x=!1,y=!1,E=!0,z=!1,D=!0,A=[],F=4,H=!1,B=!0,G=function(){return!!k&&!!l&&!x},C=function(){if(!v)throw"MediaPlayer not initialized!";if(this.capabilities.supportsMediaSource()){if(!k||!l)throw"Missing view or source.";y=!0;this.debug.log("Playback initiated!");f=d.getObject("streamController");q.subscribe(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_SEEKING,f);q.subscribe(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_TIME_UPDATED,
f);q.subscribe(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_CAN_PLAY,f);q.subscribe(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_ERROR,f);q.setLiveDelayAttributes(F,H);d.mapValue("liveDelayFragmentCount",F);d.mapOutlet("liveDelayFragmentCount","trackController");f.initialize(E,m,h);f.setScheduleControllerStartEnabled(B);w.checkInitialBitrate();"string"===typeof l?f.load(l):f.loadWithManifest(l);f.setUTCTimingSources(A,D);d.mapValue("scheduleWhilePaused",z);d.mapOutlet("scheduleWhilePaused",
"stream");d.mapOutlet("scheduleWhilePaused","scheduleController");d.mapValue("numOfParallelRequestAllowed",c);d.mapOutlet("numOfParallelRequestAllowed","scheduleController");n.initialize()}else this.errHandler.capabilityError("mediasource")},I=function(){G()&&C.call(this)},J=function(){var b=r.getReadOnlyMetricsFor("video")||r.getReadOnlyMetricsFor("audio")||r.getReadOnlyMetricsFor("muxed");return t.getCurrentDVRInfo(b)},M=function(b){var c=J.call(this),f;if(null===c)return 0;f=c.manifestInfo.availableFrom.getTime()/
1E3;return b+(f+c.range.start)},K=function(b,c,f){c&&void 0!==b&&null!==b&&(f?n.setRules(b,c):n.addRules(b,c))},L=function(){void 0!=this.adapter&&this.adapter.reset();if(y&&f){if(!x){x=!0;q.unsubscribe(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_SEEKING,f);q.unsubscribe(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_TIME_UPDATED,f);q.unsubscribe(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_CAN_PLAY,f);q.unsubscribe(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_ERROR,
f);var b={},c=this;b[MediaPlayer.dependencies.StreamController.eventList.ENAME_TEARDOWN_COMPLETE]=function(){e.reset();n.reset();q.reset();g.reset();f=null;x=y=!1;G.call(c)&&I.call(c)};f.subscribe(MediaPlayer.dependencies.StreamController.eventList.ENAME_TEARDOWN_COMPLETE,b,void 0,!0);f.reset()}}else G.call(this)&&I.call(this)},O=dijon.System.prototype.getObject;dijon.System.prototype.getObject=function(b){var c=O.call(this,b);"object"!==typeof c||c.getName||(c.getName=function(){return b},c.setMediaType=
function(b){c.mediaType=b},c.getMediaType=function(){return c.mediaType});return c};d=new dijon.System;d.mapValue("system",d);d.mapOutlet("system");d.mapValue("eventBus",new MediaPlayer.utils.EventBus);d.mapOutlet("eventBus");var N=new MediaPlayer.utils.Debug;d.mapValue("debug",N);d.mapOutlet("debug");d.injectInto(N);N.setup();d.injectInto(b);return{notifier:void 0,debug:void 0,eventBus:void 0,capabilities:void 0,adapter:void 0,errHandler:void 0,uriQueryFragModel:void 0,videoElementExt:void 0,setup:function(){t=
d.getObject("metricsExt");e=d.getObject("abrController");n=d.getObject("rulesController");r=d.getObject("metricsModel");w=d.getObject("DOMStorage");q=d.getObject("playbackController");g=d.getObject("mediaController");this.restoreDefaultUTCTimingSources();this.debug.log("new MediaPlayer instance has been created")},addEventListener:function(b,c,f){b=b.toLowerCase();this.eventBus.addEventListener(b,c,f)},removeEventListener:function(b,c,f){b=b.toLowerCase();this.eventBus.removeEventListener(b,c,f)},
getVersion:function(){return"1.5.0"},getObjectByContextName:function(b){return d.getObject(b)},startup:function(){v||(d.injectInto(this),v=!0)},getDebug:function(){return this.debug},getVideoModel:function(){return p},getVideoContainer:function(){return p?p.getVideoContainer():null},setLiveDelayFragmentCount:function(b){F=b},useSuggestedPresentationDelay:function(b){H=b},enableLastBitrateCaching:function(b,c){w.enableLastBitrateCaching(b,c)},enableLastMediaSettingsCaching:function(b,c){w.enableLastMediaSettingsCaching(b,
c)},setNumOfParallelRequestAllowed:function(b){c=b},setMaxAllowedBitrateFor:function(b,c){e.setMaxAllowedBitrateFor(b,c)},getMaxAllowedBitrateFor:function(b){return e.getMaxAllowedBitrateFor(b)},setAutoPlay:function(b){E=b},getAutoPlay:function(){return E},setScheduleWhilePaused:function(b){z=b},getScheduleWhilePaused:function(){return z},getMetricsExt:function(){return t},getMetricsFor:function(b){return r.getReadOnlyMetricsFor(b)},getQualityFor:function(b){return e.getQualityFor(b,f.getActiveStreamInfo())},
setQualityFor:function(b,c){e.setPlaybackQuality(b,f.getActiveStreamInfo(),c)},setTextTrack:function(b){void 0===u&&(u=d.getObject("textSourceBuffer"));for(var c=k.textTracks,f=c.length,h=0;h<f;h++){var e=c[h],n=b===h?"showing":"hidden";e.mode!==n&&(e.mode=n)}u.setTextTrack()},getBitrateInfoListFor:function(b){var c;return(c=(c=f.getActiveStreamInfo())?f.getStreamById(c.id):null)?c.getBitrateListFor(b):[]},setInitialBitrateFor:function(b,c){e.setInitialBitrateFor(b,c)},getInitialBitrateFor:function(b){return e.getInitialBitrateFor(b)},
getStreamsFromManifest:function(b){return this.adapter.getStreamsInfo(b)},getTracksFor:function(b){var c=f?f.getActiveStreamInfo():null;return c?g.getTracksFor(b,c):[]},getTracksForTypeFromManifest:function(b,c,f){return(f=f||this.adapter.getStreamsInfo(c)[0])?this.adapter.getAllMediaInfoForType(c,f,b):[]},getCurrentTrackFor:function(b){var c=f?f.getActiveStreamInfo():null;return c?g.getCurrentTrackFor(b,c):null},setInitialMediaSettingsFor:function(b,c){g.setInitialSettings(b,c)},getInitialMediaSettingsFor:function(b){return g.getInitialSettings(b)},
setCurrentTrack:function(b){g.setTrack(b,!0)},getTrackSwitchModeFor:function(b){return g.getSwitchMode(b)},setTrackSwitchModeFor:function(b,c){g.setSwitchMode(b,c)},setSelectionModeForInitialTrack:function(b){g.setSelectionModeForInitialTrack(b)},getSelectionModeForInitialTrack:function(){return g.getSelectionModeForInitialTrack()},getAutoSwitchQuality:function(){return e.getAutoSwitchBitrate()},setAutoSwitchQuality:function(b){e.setAutoSwitchBitrate(b)},setSchedulingRules:function(b){K.call(this,
n.SCHEDULING_RULE,b,!0)},addSchedulingRules:function(b){K.call(this,n.SCHEDULING_RULE,b,!1)},setABRRules:function(b){K.call(this,n.ABR_RULE,b,!0)},addABRRules:function(b){K.call(this,n.ABR_RULE,b,!1)},createProtection:function(){return d.getObject("protectionController")},retrieveManifest:function(b,c){(function(b){try{var f=d.getObject("manifestLoader"),h=d.getObject("uriQueryFragModel"),e={};e[MediaPlayer.dependencies.ManifestLoader.eventList.ENAME_MANIFEST_LOADED]=function(b){b.error?c(null,b.error):
c(b.data.manifest);f.unsubscribe(MediaPlayer.dependencies.ManifestLoader.eventList.ENAME_MANIFEST_LOADED,e);f.reset()};f.subscribe(MediaPlayer.dependencies.ManifestLoader.eventList.ENAME_MANIFEST_LOADED,e);f.load(h.parseURI(b))}catch(n){c(null,n.message)}})(b)},addUTCTimingSource:function(b,c){this.removeUTCTimingSource(b,c);var f=new Dash.vo.UTCTiming;f.schemeIdUri=b;f.value=c;A.push(f)},removeUTCTimingSource:function(b,c){A.forEach(function(f,d){f.schemeIdUri===b&&f.value===c&&A.splice(d,1)})},
clearDefaultUTCTimingSources:function(){A=[]},restoreDefaultUTCTimingSources:function(){"https:"!=window.location.protocol?this.addUTCTimingSource(MediaPlayer.UTCTimingSources.default.scheme,MediaPlayer.UTCTimingSources.default.value):this.addUTCTimingSource(MediaPlayer.UTCTimingSources.https.scheme,MediaPlayer.UTCTimingSources.https.value)},enableManifestDateHeaderTimeSource:function(b){D=b},displayCaptionsOnTop:function(b){d.getObject("textTrackExtensions").displayCConTop(b)},attachVideoContainer:function(b){if(!p)throw"Must call attachView with video element before you attach container element";
p.setVideoContainer(b)},attachView:function(b){if(!v)throw"MediaPlayer not initialized!";k=b;p=null;k&&(p=d.getObject("videoModel"),p.setElement(k),k.preload="auto");L.call(this)},attachTTMLRenderingDiv:function(b){if(!p)throw"Must call attachView with video element before you attach TTML Rendering Div";p.setTTMLRenderingDiv(b)},attachSource:function(b,c,f){if(!v)throw"MediaPlayer not initialized!";"string"===typeof b?(this.uriQueryFragModel.reset(),l=this.uriQueryFragModel.parseURI(b)):l=b;m=c;h=
f;L.call(this)},reset:function(){this.attachSource(null);this.attachView(null);h=m=null;B=!0},play:C,isReady:G,seek:function(b){var c=J.call(this);b=c&&c.manifestInfo&&c.manifestInfo.isDynamic?this.getDVRSeekOffset(b):b;q.notifyExplicitSeek(b);this.getVideoModel().setCurrentTime(b)},time:function(){var b=p.getCurrentTime(),c=J.call(this);c&&c.manifestInfo&&c.manifestInfo.isDynamic&&(b=null===c?0:this.duration()-(c.range.end-c.time));return b},duration:function(){var b=p.getElement().duration,c=J.call(this);
c&&c.manifestInfo&&c.manifestInfo.isDynamic&&(b=c.range.end-c.range.start,b=b<c.manifestInfo.DVRWindowSize?b:c.manifestInfo.DVRWindowSize);return b},timeAsUTC:function(){return M.call(this,this.time())},durationAsUTC:function(){return M.call(this,this.duration())},getDVRWindowSize:function(){var b=J.call(this);return b?b.manifestInfo.DVRWindowSize:0},getDVRSeekOffset:function(b){var c=J.call(this);b=c.range.start+b;b>c.range.end&&(b=c.range.end);return b},formatUTC:function(b,c,f){b=new Date(1E3*
b);var d=b.toLocaleDateString(c);return b.toLocaleTimeString(c,{hour12:f})+" "+d},convertToTimeCode:function(b){b=Math.max(b,0);var c=Math.floor(b/3600),f=Math.floor(b%3600/60);b=Math.floor(b%3600%60);return(0===c?"":10>c?"0"+c.toString()+":":c.toString()+":")+(10>f?"0"+f.toString():f.toString())+":"+(10>b?"0"+b.toString():b.toString())},setScheduleControllerStartEnabled:function(b){B=b;f&&f.setScheduleControllerStartEnabled(b)}}};MediaPlayer.prototype={constructor:MediaPlayer};
MediaPlayer.dependencies={};MediaPlayer.dependencies.protection={};MediaPlayer.dependencies.protection.servers={};MediaPlayer.utils={};MediaPlayer.models={};MediaPlayer.vo={};MediaPlayer.vo.metrics={};MediaPlayer.vo.protection={};MediaPlayer.rules={};MediaPlayer.di={};MediaPlayer.UTCTimingSources={default:{scheme:"urn:mpeg:dash:utc:http-xsdate:2014",value:"http://time.akamai.com/?iso"},https:{scheme:"urn:mpeg:dash:utc:http-xsdate:2014",value:"https://time.akamai.com/?iso"}};
MediaPlayer.events={RESET_COMPLETE:"resetComplete",METRICS_CHANGED:"metricschanged",METRIC_CHANGED:"metricchanged",METRIC_UPDATED:"metricupdated",METRIC_ADDED:"metricadded",MANIFEST_LOADED:"manifestloaded",PROTECTION_CREATED:"protectioncreated",PROTECTION_DESTROYED:"protectiondestroyed",STREAM_SWITCH_STARTED:"streamswitchstarted",STREAM_SWITCH_COMPLETED:"streamswitchcompleted",STREAM_INITIALIZED:"streaminitialized",TEXT_TRACK_ADDED:"texttrackadded",TEXT_TRACKS_ADDED:"alltexttracksadded",BUFFER_LOADED:"bufferloaded",
BUFFER_EMPTY:"bufferstalled",ERROR:"error",LOG:"log"};MediaPlayer.di.Context=function(){return{system:void 0,setup:function(){this.system.autoMapOutlets=!0;this.system.mapClass("eventBusCl",MediaPlayer.utils.EventBus);this.system.mapSingleton("capabilities",MediaPlayer.utils.Capabilities);this.system.mapSingleton("DOMStorage",MediaPlayer.utils.DOMStorage);this.system.mapClass("customTimeRanges",MediaPlayer.utils.CustomTimeRanges);this.system.mapSingleton("virtualBuffer",MediaPlayer.utils.VirtualBuffer);this.system.mapClass("isoFile",MediaPlayer.utils.IsoFile);
this.system.mapSingleton("textTrackExtensions",MediaPlayer.utils.TextTrackExtensions);this.system.mapSingleton("vttParser",MediaPlayer.utils.VTTParser);this.system.mapSingleton("ttmlParser",MediaPlayer.utils.TTMLParser);this.system.mapSingleton("boxParser",MediaPlayer.utils.BoxParser);this.system.mapSingleton("videoModel",MediaPlayer.models.VideoModel);this.system.mapSingleton("manifestModel",MediaPlayer.models.ManifestModel);this.system.mapSingleton("metricsModel",MediaPlayer.models.MetricsModel);
this.system.mapSingleton("uriQueryFragModel",MediaPlayer.models.URIQueryAndFragmentModel);this.system.mapSingleton("ksPlayReady",MediaPlayer.dependencies.protection.KeySystem_PlayReady);this.system.mapSingleton("ksWidevine",MediaPlayer.dependencies.protection.KeySystem_Widevine);this.system.mapSingleton("ksClearKey",MediaPlayer.dependencies.protection.KeySystem_ClearKey);this.system.mapSingleton("ksAccess",MediaPlayer.dependencies.protection.KeySystem_Access);this.system.mapSingleton("serverPlayReady",
MediaPlayer.dependencies.protection.servers.PlayReady);this.system.mapSingleton("serverWidevine",MediaPlayer.dependencies.protection.servers.Widevine);this.system.mapSingleton("serverClearKey",MediaPlayer.dependencies.protection.servers.ClearKey);this.system.mapSingleton("serverDRMToday",MediaPlayer.dependencies.protection.servers.DRMToday);this.system.mapSingleton("serverAccess",MediaPlayer.dependencies.protection.servers.Access);this.system.mapSingleton("requestModifierExt",MediaPlayer.dependencies.RequestModifierExtensions);
this.system.mapSingleton("textSourceBuffer",MediaPlayer.dependencies.TextSourceBuffer);this.system.mapSingleton("mediaSourceExt",MediaPlayer.dependencies.MediaSourceExtensions);this.system.mapSingleton("sourceBufferExt",MediaPlayer.dependencies.SourceBufferExtensions);this.system.mapSingleton("abrController",MediaPlayer.dependencies.AbrController);this.system.mapSingleton("errHandler",MediaPlayer.dependencies.ErrorHandler);this.system.mapSingleton("videoExt",MediaPlayer.dependencies.VideoModelExtensions);
this.system.mapSingleton("protectionExt",MediaPlayer.dependencies.ProtectionExtensions);this.system.mapClass("protectionController",MediaPlayer.dependencies.ProtectionController);this.system.mapSingleton("playbackController",MediaPlayer.dependencies.PlaybackController);var b=document.createElement("video");MediaPlayer.models.ProtectionModel_21Jan2015.detect(b)?this.system.mapClass("protectionModel",MediaPlayer.models.ProtectionModel_21Jan2015):MediaPlayer.models.ProtectionModel_3Feb2014.detect(b)?
this.system.mapClass("protectionModel",MediaPlayer.models.ProtectionModel_3Feb2014):MediaPlayer.models.ProtectionModel_01b.detect(b)?this.system.mapClass("protectionModel",MediaPlayer.models.ProtectionModel_01b):(this.debug.log("No supported version of EME detected on this user agent!"),this.debug.log("Attempts to play encrypted content will fail!"));this.system.mapSingleton("liveEdgeFinder",MediaPlayer.dependencies.LiveEdgeFinder);this.system.mapClass("metrics",MediaPlayer.models.MetricsList);this.system.mapClass("insufficientBufferRule",
MediaPlayer.rules.InsufficientBufferRule);this.system.mapClass("bufferOccupancyRule",MediaPlayer.rules.BufferOccupancyRule);this.system.mapClass("throughputRule",MediaPlayer.rules.ThroughputRule);this.system.mapClass("abandonRequestRule",MediaPlayer.rules.AbandonRequestsRule);this.system.mapSingleton("abrRulesCollection",MediaPlayer.rules.ABRRulesCollection);this.system.mapSingleton("rulesController",MediaPlayer.rules.RulesController);this.system.mapClass("bufferLevelRule",MediaPlayer.rules.BufferLevelRule);
this.system.mapClass("playbackTimeRule",MediaPlayer.rules.PlaybackTimeRule);this.system.mapSingleton("scheduleRulesCollection",MediaPlayer.rules.ScheduleRulesCollection);this.system.mapClass("liveEdgeBinarySearchRule",MediaPlayer.rules.LiveEdgeBinarySearchRule);this.system.mapClass("liveEdgeWithTimeSynchronizationRule",MediaPlayer.rules.LiveEdgeWithTimeSynchronizationRule);this.system.mapSingleton("synchronizationRulesCollection",MediaPlayer.rules.SynchronizationRulesCollection);this.system.mapClass("xlinkController",
MediaPlayer.dependencies.XlinkController);this.system.mapClass("xlinkLoader",MediaPlayer.dependencies.XlinkLoader);this.system.mapClass("streamProcessor",MediaPlayer.dependencies.StreamProcessor);this.system.mapClass("eventController",MediaPlayer.dependencies.EventController);this.system.mapClass("textController",MediaPlayer.dependencies.TextController);this.system.mapClass("bufferController",MediaPlayer.dependencies.BufferController);this.system.mapClass("manifestLoader",MediaPlayer.dependencies.ManifestLoader);
this.system.mapSingleton("manifestUpdater",MediaPlayer.dependencies.ManifestUpdater);this.system.mapClass("fragmentController",MediaPlayer.dependencies.FragmentController);this.system.mapClass("fragmentLoader",MediaPlayer.dependencies.FragmentLoader);this.system.mapClass("fragmentModel",MediaPlayer.dependencies.FragmentModel);this.system.mapSingleton("streamController",MediaPlayer.dependencies.StreamController);this.system.mapSingleton("mediaController",MediaPlayer.dependencies.MediaController);this.system.mapClass("stream",
MediaPlayer.dependencies.Stream);this.system.mapClass("scheduleController",MediaPlayer.dependencies.ScheduleController);this.system.mapSingleton("timeSyncController",MediaPlayer.dependencies.TimeSyncController);this.system.mapSingleton("notifier",MediaPlayer.dependencies.Notifier)}}};MediaPlayer.dependencies.ErrorHandler=function(){var b=MediaPlayer.events.ERROR;return{eventBus:void 0,capabilityError:function(c){this.eventBus.dispatchEvent({type:b,error:"capability",event:c})},downloadError:function(c,d,e){this.eventBus.dispatchEvent({type:b,error:"download",event:{id:c,url:d,request:e}})},contentTypeError:function(c,d){this.eventBus.dispatchEvent({type:b,error:"contentTypeError",event:{message:c,id:d}})},manifestError:function(c,d,e){this.eventBus.dispatchEvent({type:b,error:"manifestError",
event:{message:c,id:d,manifest:e}})},closedCaptionsError:function(c,d,e){this.eventBus.dispatchEvent({type:b,error:"cc",event:{message:c,id:d,cc:e}})},mediaSourceError:function(c){this.eventBus.dispatchEvent({type:b,error:"mediasource",event:c})},mediaKeySessionError:function(c){this.eventBus.dispatchEvent({type:b,error:"key_session",event:c})},mediaKeyMessageError:function(c){this.eventBus.dispatchEvent({type:b,error:"key_message",event:c})},mediaKeySystemSelectionError:function(c){this.eventBus.dispatchEvent({type:b,
error:"key_system_selection",event:c})}}};MediaPlayer.dependencies.ErrorHandler.prototype={constructor:MediaPlayer.dependencies.ErrorHandler};MediaPlayer.utils.Capabilities=function(){};
MediaPlayer.utils.Capabilities.prototype={constructor:MediaPlayer.utils.Capabilities,system:void 0,log:void 0,supportsMediaSource:function(){var b="MediaSource"in window;return"WebKitMediaSource"in window||b},supportsEncryptedMedia:function(){return this.system.hasMapping("protectionModel")},supportsCodec:function(b,c){if(!(b instanceof HTMLMediaElement))throw"element must be of type HTMLMediaElement.";var d=b.canPlayType(c);return"probably"===d||"maybe"===d}};MediaPlayer.utils.EventBus=function(){var b,c=function(c,e){var g=(e?"1":"0")+c;g in b||(b[g]=[]);return b[g]};b={};return{addEventListener:function(b,e,g){b=c(b,g);-1===b.indexOf(e)&&b.push(e)},removeEventListener:function(b,e,g){b=c(b,g);e=b.indexOf(e);-1!==e&&b.splice(e,1)},dispatchEvent:function(b){for(var e=c(b.type,!1).slice(),g=0;g<e.length;g++)e[g].call(this,b);return!b.defaultPrevented}}};MediaPlayer.utils.Debug=function(){var b,c,d,e,g,k;b=!0;d=c=!1;e="INFO";g=(new Date).getTime();return{system:void 0,eventBus:void 0,setup:function(){this.system.mapValue("log",this.log);this.system.mapOutlet("log");k=this.eventBus},setLogTimestampVisible:function(b){c=b},showCalleeName:function(b){d=b},setLogToBrowserConsole:function(c){b=c},getLogToBrowserConsole:function(){return b},setLogLevel:function(b){e=b},getLogLevel:function(){return e},log:function(b,m){var h="",f=null;void 0===m&&(m="dash.js");
c&&(f=(new Date).getTime(),h+="["+(f-g)+"]");d&&this.getName&&(h+="["+this.getName()+"]");this.getMediaType&&this.getMediaType()&&(h+="["+this.getMediaType()+"]");0<h.length&&(h+=" ");h+=b;switch(m){case "DEBUG":switch(e){case "DEBUG":console.debug(h)}break;case "dash.js":case "INFO":switch(e){case "DEBUG":case "INFO":console.log(h)}break;case "WARN":switch(e){case "DEBUG":case "INFO":case "WARN":console.warn(h)}break;case "ERROR":switch(e){case "DEBUG":case "INFO":case "WARN":case "ERROR":console.error(h)}}k.dispatchEvent({type:"log",
message:h})}}};MediaPlayer.utils.CustomTimeRanges=function(){return{customTimeRangeArray:[],length:0,add:function(b,c){for(var d=0,d=0;d<this.customTimeRangeArray.length&&b>this.customTimeRangeArray[d].start;d++);this.customTimeRangeArray.splice(d,0,{start:b,end:c});for(d=0;d<this.customTimeRangeArray.length-1;d++)this.mergeRanges(d,d+1)&&d--;this.length=this.customTimeRangeArray.length},clear:function(){this.customTimeRangeArray=[];this.length=0},remove:function(b,c){for(var d=0;d<this.customTimeRangeArray.length;d++)if(b<=
this.customTimeRangeArray[d].start&&c>=this.customTimeRangeArray[d].end)this.customTimeRangeArray.splice(d,1),d--;else if(b>this.customTimeRangeArray[d].start&&c<this.customTimeRangeArray[d].end){this.customTimeRangeArray.splice(d+1,0,{start:c,end:this.customTimeRangeArray[d].end});this.customTimeRangeArray[d].end=b;break}else b>this.customTimeRangeArray[d].start&&b<this.customTimeRangeArray[d].end?this.customTimeRangeArray[d].end=b:c>this.customTimeRangeArray[d].start&&c<this.customTimeRangeArray[d].end&&
(this.customTimeRangeArray[d].start=c);this.length=this.customTimeRangeArray.length},mergeRanges:function(b,c){var d=this.customTimeRangeArray[b],e=this.customTimeRangeArray[c];return d.start<=e.start&&e.start<=d.end&&d.end<=e.end?(d.end=e.end,this.customTimeRangeArray.splice(c,1),!0):e.start<=d.start&&d.start<=e.end&&e.end<=d.end?(d.start=e.start,this.customTimeRangeArray.splice(c,1),!0):e.start<=d.start&&d.start<=e.end&&d.end<=e.end?(this.customTimeRangeArray.splice(b,1),!0):d.start<=e.start&&e.start<=
d.end&&e.end<=d.end?(this.customTimeRangeArray.splice(c,1),!0):!1},start:function(b){return this.customTimeRangeArray[b].start},end:function(b){return this.customTimeRangeArray[b].end}}};MediaPlayer.utils.CustomTimeRanges.prototype={constructor:MediaPlayer.utils.CustomTimeRanges};MediaPlayer.utils.DOMStorage=function(){var b,c=!0,d=!0,e=function(b,c){void 0===c||isNaN(c)||"number"!==typeof c||(MediaPlayer.utils.DOMStorage[b]=c)};return{system:void 0,log:void 0,abrController:void 0,checkInitialBitrate:function(){["video","audio"].forEach(function(b){if(void 0===this.abrController.getInitialBitrateFor(b)){if(this.isSupported(MediaPlayer.utils.DOMStorage.STORAGE_TYPE_LOCAL)&&c){var d=MediaPlayer.utils.DOMStorage["LOCAL_STORAGE_"+b.toUpperCase()+"_BITRATE_KEY"],e=JSON.parse(localStorage.getItem(d))||
{},m=(new Date).getTime()-parseInt(e.timestamp)>=MediaPlayer.utils.DOMStorage.LOCAL_STORAGE_BITRATE_EXPIRATION||!1,e=parseInt(e.bitrate);isNaN(e)||m?m&&localStorage.removeItem(d):(this.abrController.setInitialBitrateFor(b,e),this.log("Last bitrate played for "+b+" was "+e))}void 0===this.abrController.getInitialBitrateFor(b)&&this.abrController.setInitialBitrateFor(b,MediaPlayer.dependencies.AbrController["DEFAULT_"+b.toUpperCase()+"_BITRATE"])}},this)},getSavedMediaSettings:function(b){if(!this.isSupported(MediaPlayer.utils.DOMStorage.STORAGE_TYPE_LOCAL)||
!d)return null;b=MediaPlayer.utils.DOMStorage["LOCAL_STORAGE_"+b.toUpperCase()+"_SETTINGS_KEY"];var c=JSON.parse(localStorage.getItem(b))||{},e=(new Date).getTime()-parseInt(c.timestamp)>=MediaPlayer.utils.DOMStorage.LOCAL_STORAGE_MEDIA_SETTINGS_EXPIRATION||!1,c=c.settings;e&&(localStorage.removeItem(b),c=null);return c},enableLastBitrateCaching:function(b,d){c=b;e.call(this,"LOCAL_STORAGE_BITRATE_EXPIRATION",d)},enableLastMediaSettingsCaching:function(b,c){d=b;e.call(this,"LOCAL_STORAGE_MEDIA_SETTINGS_EXPIRATION",
c)},isSupported:function(c){if(void 0!==b)return b;b=!1;var d;try{d=window[c]}catch(e){return this.log("Warning: DOMStorage access denied: "+e.message),b}if(!d||c!==MediaPlayer.utils.DOMStorage.STORAGE_TYPE_LOCAL&&c!==MediaPlayer.utils.DOMStorage.STORAGE_TYPE_SESSION)return b;try{d.setItem("1","1"),d.removeItem("1"),b=!0}catch(m){this.log("Warning: DOMStorage is supported, but cannot be used: "+m.message)}return b}}};MediaPlayer.utils.DOMStorage.LOCAL_STORAGE_VIDEO_BITRATE_KEY="dashjs_vbitrate";
MediaPlayer.utils.DOMStorage.LOCAL_STORAGE_AUDIO_BITRATE_KEY="dashjs_abitrate";MediaPlayer.utils.DOMStorage.LOCAL_STORAGE_AUDIO_SETTINGS_KEY="dashjs_asettings";MediaPlayer.utils.DOMStorage.LOCAL_STORAGE_VIDEO_SETTINGS_KEY="dashjs_vsettings";MediaPlayer.utils.DOMStorage.LOCAL_STORAGE_BITRATE_EXPIRATION=36E4;MediaPlayer.utils.DOMStorage.LOCAL_STORAGE_MEDIA_SETTINGS_EXPIRATION=36E4;MediaPlayer.utils.DOMStorage.STORAGE_TYPE_LOCAL="localStorage";MediaPlayer.utils.DOMStorage.STORAGE_TYPE_SESSION="sessionStorage";
MediaPlayer.utils.DOMStorage.prototype={constructor:MediaPlayer.utils.DOMStorage};MediaPlayer.utils.VirtualBuffer=function(){var b={},c=!1,d=function(b,c,d){b.sort(function(b,e){return b[c]<e[c]?d?1:-1:b[c]>e[c]?d?-1:1:0})},e=function(c){var d=c.streamId;return b[d]?b[d][c.mediaType]:null},g=function(b,c,d,f,e){var g=[],k=c.start,r=c.end,p,u,w,v,x=f?f*(r-k)/100:0;b.forEach(function(b){p=b.bufferedRange.start;u=b.bufferedRange.end;w=p>=k-x&&p<r;v=u>k&&u<=r+x;if(!e&&(w||v)||e&&w&&v)g.push(b),d&&(b.bufferedRange.start=w?p:k,b.bufferedRange.end=v?u:r)});return g},k=function(c,d,h){var f=
b[d][h].appended.filter(function(b){return c===b?!0:c.bufferedRange.start<=b.bufferedRange.start&&c.bufferedRange.end>=b.bufferedRange.end?!1:!0});f.forEach(function(b){b!==c&&b.bufferedRange.start<c.bufferedRange.start&&b.bufferedRange.end>c.bufferedRange.start&&(b.bufferedRange.end=c.bufferedRange.start);b!==c&&b.bufferedRange.start<c.bufferedRange.end&&b.bufferedRange.end>c.bufferedRange.start&&(b.bufferedRange.start=c.bufferedRange.end)});b[d][h].appended=f};return{system:void 0,sourceBufferExt:void 0,
notify:void 0,subscribe:void 0,unsubscribe:void 0,append:function(e){var g=e.streamId,h=e.mediaInfo.type,f=e.segmentType,n=e.start,q=e.end,k=b,r;(r=b[g])||(r={},r.audio={calculatedBufferedRanges:new MediaPlayer.utils.CustomTimeRanges,actualBufferedRanges:new MediaPlayer.utils.CustomTimeRanges,appended:[]},r.audio[MediaPlayer.vo.metrics.HTTPRequest.MEDIA_SEGMENT_TYPE]=[],r.audio[MediaPlayer.vo.metrics.HTTPRequest.INIT_SEGMENT_TYPE]=[],r.video={calculatedBufferedRanges:new MediaPlayer.utils.CustomTimeRanges,
actualBufferedRanges:new MediaPlayer.utils.CustomTimeRanges,appended:[]},r.video[MediaPlayer.vo.metrics.HTTPRequest.MEDIA_SEGMENT_TYPE]=[],r.video[MediaPlayer.vo.metrics.HTTPRequest.INIT_SEGMENT_TYPE]=[],r.fragmentedText={calculatedBufferedRanges:new MediaPlayer.utils.CustomTimeRanges,actualBufferedRanges:new MediaPlayer.utils.CustomTimeRanges,appended:[]},r.fragmentedText[MediaPlayer.vo.metrics.HTTPRequest.MEDIA_SEGMENT_TYPE]=[],r.fragmentedText[MediaPlayer.vo.metrics.HTTPRequest.INIT_SEGMENT_TYPE]=
[],r.muxed={calculatedBufferedRanges:new MediaPlayer.utils.CustomTimeRanges,actualBufferedRanges:new MediaPlayer.utils.CustomTimeRanges,appended:[]},r.muxed[MediaPlayer.vo.metrics.HTTPRequest.MEDIA_SEGMENT_TYPE]=[],r.muxed[MediaPlayer.vo.metrics.HTTPRequest.INIT_SEGMENT_TYPE]=[]);k[g]=r;b[g][h][f].push(e);d(b[g][h][f],"index",c);isNaN(n)||isNaN(q)||(b[g][h].calculatedBufferedRanges.add(n,q),this.notify(MediaPlayer.utils.VirtualBuffer.eventList.CHUNK_APPENDED,{chunk:e}))},storeAppendedChunk:function(c,
e){if(c&&e){var h=c.streamId,f=c.mediaInfo.type,n=b[h][f].actualBufferedRanges,q=this.getChunks({streamId:h,mediaType:f,appended:!0,start:c.start})[0],t;t={streamId:h,mediaType:f,appended:!0};q||(q=this.getChunks(t),q=g(q,{start:c.start,end:c.end},!1,2,!0)[0]);q?(t=b[h][f].appended.indexOf(q),b[h][f].appended[t]=c):b[h][f].appended.push(c);d(b[h][f].appended,"start");(t=this.sourceBufferExt.getRangeDifference(n,e))?(c.bufferedRange=t,n.add(t.start,t.end),q&&(c.bufferedRange.start=Math.min(q.bufferedRange.start,
t.start),c.bufferedRange.end=Math.max(q.bufferedRange.end,t.end))):c.bufferedRange=q?q.bufferedRange:{start:c.start,end:c.end};k.call(this,c,h,f)}},updateBufferedRanges:function(c,d){if(c){var h=c.streamId,f=c.mediaType,e=this.getChunks({streamId:h,mediaType:f,appended:!0}),q=[],k,r;if(b[h])if(b[h][f].actualBufferedRanges=new MediaPlayer.utils.CustomTimeRanges,d&&0!==d.length){for(var p=0,u=d.length;p<u;p+=1)k=d.start(p),r=d.end(p),b[h][f].actualBufferedRanges.add(k,r),q=q.concat(g.call(this,e,{start:k,
end:r},!0));b[h][f].appended=q}else b[h][f].appended=[]}},getChunks:function(b){var c=e.call(this,b),d=b.segmentType,f=b.appended,n=b.removeOrigin,q=b.limit||Number.POSITIVE_INFINITY,k=this.system.getObject("mediaController"),r=0,p=[];if(!c)return p;delete b.streamId;delete b.mediaType;delete b.segmentType;delete b.removeOrigin;delete b.limit;delete b.appended;p=(f?c.appended:d?c[d]:[]).filter(function(f,d,h){if(r>=q)return!1;for(var e in b)if("mediaInfo"===e){if(f[e]&&b[e]&&!k.isTracksEqual(f[e],
b[e]))return!1}else if(b.hasOwnProperty(e)&&f[e]!=b[e])return!1;n&&(c.calculatedBufferedRanges.remove(f.start,f.end),h.splice(d,1));r+=1;return!0});b.forRange&&(p=g.call(this,p,b.forRange,!1));return p},extract:function(b){b.removeOrigin=!0;return this.getChunks(b)},getTotalBufferLevel:function(c){c=c.type;var d=0,h;for(h in b)b.hasOwnProperty(h)&&(d+=this.sourceBufferExt.getTotalBufferedTime({buffered:b[h][c].calculatedBufferedRanges}));return d},setReverseTrickPlay:function(b){c=b},getReverseTrickPlay:function(){return c},
reset:function(){b={}}}};MediaPlayer.utils.VirtualBuffer.prototype={constructor:MediaPlayer.utils.VirtualBuffer};MediaPlayer.utils.VirtualBuffer.eventList={CHUNK_APPENDED:"chunkAppended"};MediaPlayer.utils.BoxParser=function(){return{system:void 0,log:void 0,parse:function(b){if(!b)return null;void 0===b.fileStart&&(b.fileStart=0);b=ISOBoxer.parseBuffer(b);var c=this.system.getObject("isoFile");c.setData(b);return c}}};MediaPlayer.utils.BoxParser.prototype={constructor:MediaPlayer.utils.BoxParser};MediaPlayer.utils.IsoFile=function(){var b,c={offset:"_offset",size:"size",type:"type"},d={references:"references",timescale:"timescale",earliest_presentation_time:"earliest_presentation_time",first_offset:"first_offset"},e={reference_type:"reference_type",referenced_size:"referenced_size",subsegment_duration:"subsegment_duration"},g={id:"id",value:"value",timescale:"timescale",scheme_id_uri:"scheme_id_uri",presentation_time_delta:"presentation_time_delta",event_duration:"event_duration",message_data:"message_data"},
k={timescale:"timescale"},l={base_data_offset:"base_data_offset",sample_description_index:"sample_description_index",default_sample_duration:"default_sample_duration",default_sample_size:"default_sample_size",default_sample_flags:"default_sample_flags",flags:"flags"},m={version:"version",baseMediaDecodeTime:"baseMediaDecodeTime",flags:"flags"},h={sample_count:"sample_count",first_sample_flags:"first_sample_flags",data_offset:"data_offset",flags:"flags",samples:"samples"},f={sample_size:"sample_size",
sample_duration:"sample_duration",sample_composition_time_offset:"sample_composition_time_offset"},n=function(b,c,f){for(var d in f)c[d]=b[f[d]]},q=function(b){if(!b)return null;var p=new MediaPlayer.vo.IsoBox,q,t;n(b,p,c);b.hasOwnProperty("_incomplete")&&(p.isComplete=!b._incomplete);switch(p.type){case "sidx":n(b,p,d);if(p.references)for(q=0,t=p.references.length;q<t;q+=1)n(b.references[q],p.references[q],e);break;case "emsg":n(b,p,g);break;case "mdhd":n(b,p,k);break;case "tfhd":n(b,p,l);break;
case "tfdt":n(b,p,m);break;case "trun":if(n(b,p,h),p.samples)for(q=0,t=p.samples.length;q<t;q+=1)n(b.samples[q],p.samples[q],f)}return p},t=function(c){c=b.fetchAll(c);for(var f=[],d,h=0,e=c.length;h<e;h+=1)(d=q.call(this,c[h]))&&f.push(d);return f};return{getBox:function(c){return c&&b&&b.boxes&&0!==b.boxes.length?"mdat"===c?b.fetch(c):q.call(this,b.fetch(c)):null},getBoxes:t,setData:function(c){b=c},getLastBox:function(){if(!b||!b.boxes||!b.boxes.length)return null;var c=t.call(this,b.boxes[b.boxes.length-
1].type);return c[c.length-1]},getOffset:function(){return b._cursor.offset}}};MediaPlayer.utils.IsoFile.prototype={constructor:MediaPlayer.utils.IsoFile};MediaPlayer.dependencies.RequestModifierExtensions=function(){return{modifyRequestURL:function(b){return b},modifyRequestHeader:function(b){return b}}};MediaPlayer.models.VideoModel=function(){var b,c,d,e=[],g,k=!1,l=function(c){k&&(b.playbackRate=g,k=!1)},m=function(c,f){!b||2>b.readyState?0<c&&(k=!0,g=c):(f&&0!==b.playbackRate&&0===c||0<c&&(g=c),b.playbackRate=c)};return{system:void 0,play:function(){return b.play()},pause:function(){b.pause()},isPaused:function(){return b.paused},getPlaybackRate:function(){return b.playbackRate},setPlaybackRate:function(b){m.call(this,b,!1)},getCurrentTime:function(){return b.currentTime},setCurrentTime:function(c){if(b.currentTime!=
c)try{b.currentTime=c}catch(f){if(0===b.readyState&&f.code===f.INVALID_STATE_ERR){var d=function(){1!==b.readyState?setTimeout(d,400):b.currentTime=c};d()}}},setStallState:function(c,f){if(f)null===c||b.seeking||(m.call(this,0,!0),!0!==e[c]&&(e.push(c),e[c]=!0));else if(null!==c){e[c]=!1;var d=e.indexOf(c);-1!==d&&e.splice(d,1);!1===0<e.length&&(g?this.setPlaybackRate(g):this.setPlaybackRate(1))}},listen:function(c,f){b.addEventListener(c,f,!1)},unlisten:function(c,f){b.removeEventListener(c,f,!1)},
getElement:function(){return b},setElement:function(c){b=c;"function"===typeof b.addEventListener&&this.listen("canplay",l)},getVideoContainer:function(){return d},setVideoContainer:function(b){d=b},getTTMLRenderingDiv:function(){return c},setTTMLRenderingDiv:function(b){c=b;c.style.position="absolute";c.style.display="flex";c.style.overflow="hidden";c.style.pointerEvents="none";c.style.top=0;c.style.left=0},setSource:function(c){b.src=c},resetPrevRate:function(){g=null}}};
MediaPlayer.models.VideoModel.prototype={constructor:MediaPlayer.models.VideoModel};MediaPlayer.vo.FragmentRequest=function(){this.action="download";this.startTime=NaN;this.type=this.mediaInfo=this.mediaType=null;this.timescale=this.duration=NaN;this.requestEndDate=this.firstByteDate=this.requestStartDate=this.url=this.range=null;this.index=this.quality=NaN;this.wallStartTime=this.availabilityEndTime=this.availabilityStartTime=null;this.delayLoadingTime=this.bytesTotal=this.bytesLoaded=NaN};
MediaPlayer.vo.FragmentRequest.prototype={constructor:MediaPlayer.vo.FragmentRequest,ACTION_DOWNLOAD:"download",ACTION_COMPLETE:"complete"};MediaPlayer.vo.TrackInfo=function(){this.MSETimeOffset=this.mediaInfo=this.fragmentDuration=this.DVRWindow=this.quality=this.id=null};MediaPlayer.vo.TrackInfo.prototype={constructor:MediaPlayer.vo.TrackInfo};MediaPlayer.vo.MediaInfo=function(){this.streamInfo=this.type=this.index=this.id=null;this.representationCount=0;this.contentProtection=this.mimeType=this.codec=this.roles=this.audioChannelConfiguration=this.accessibility=this.viewpoint=this.lang=null;this.isText=!1;this.bitrateList=this.KID=null;this.name="";this.isTrickPlayTrack=!1;this.codecStr=""};MediaPlayer.vo.MediaInfo.prototype={constructor:MediaPlayer.vo.MediaInfo};MediaPlayer.vo.StreamInfo=function(){this.index=this.id=null;this.duration=this.start=NaN;this.manifestInfo=null;this.isLast=!0};MediaPlayer.vo.StreamInfo.prototype={constructor:MediaPlayer.vo.StreamInfo};MediaPlayer.vo.ManifestInfo=function(){this.DVRWindowSize=NaN;this.availableFrom=this.loadedTime=null;this.duration=this.minBufferTime=NaN;this.isDynamic=!1;this.maxFragmentDuration=null;this.hasDiscontinuity=this.isHls=!1};MediaPlayer.vo.ManifestInfo.prototype={constructor:MediaPlayer.vo.ManifestInfo};MediaPlayer.vo.Event=function(){this.error=this.data=this.sender=this.type=null;this.timestamp=NaN};MediaPlayer.vo.Event.prototype={constructor:MediaPlayer.vo.Event};MediaPlayer.vo.Error=function(b,c,d){this.code=b||null;this.message=c||null;this.data=d||null};MediaPlayer.vo.Error.prototype={constructor:MediaPlayer.vo.Error};MediaPlayer.vo.BitrateInfo=function(){this.bitrate=this.mediaType=null;this.qualityIndex=NaN};MediaPlayer.vo.BitrateInfo.prototype={constructor:MediaPlayer.vo.BitrateInfo};MediaPlayer.vo.IsoBox=function(){this.offset=NaN;this.type=null;this.size=NaN;this.isComplete=!0};MediaPlayer.vo.IsoBox.prototype={constructor:MediaPlayer.vo.IsoBox};MediaPlayer.dependencies.ManifestLoader=function(){var b=null,c=null,d=function(b){var c="";-1!==b.indexOf("/")&&(-1!==b.indexOf("?")&&(b=b.substring(0,b.indexOf("?"))),c=b.substring(0,b.lastIndexOf("/")+1));return c},e=function(d){if(d.error)d="Failed loading manifest: "+url+", parsing failed",this.notify(MediaPlayer.dependencies.ManifestLoader.eventList.ENAME_MANIFEST_LOADED,{manifest:null},new MediaPlayer.vo.Error(MediaPlayer.dependencies.ManifestLoader.PARSERERROR_ERROR_CODE,d,null)),this.log(d);
else{var e=d.data.manifest;e?(e.url=d.data.url,e.loadedTime=b,this.metricsModel.addManifestUpdate("stream",e.type,c,b,e.availabilityStartTime),e.isHls?this.notify(MediaPlayer.dependencies.ManifestLoader.eventList.ENAME_MANIFEST_LOADED,{manifest:e}):this.xlinkController.resolveManifestOnLoad(e)):this.notify(MediaPlayer.dependencies.ManifestLoader.eventList.ENAME_MANIFEST_LOADED,{manifest:null},new MediaPlayer.vo.Error(null,"Failed loading manifest: "+d.data.url,null))}},g=function(l,m){var h=d(l),
f=new XMLHttpRequest,n=!0,q=!0,k,r,p,u=this;c=new Date;k=function(){n&&(n=!1,u.metricsModel.addHttpRequest("stream",null,MediaPlayer.vo.metrics.HTTPRequest.MPD_TYPE,l,f.responseURL||null,null,c,f.firstByteDate||null,new Date,f.status,null,f.getAllResponseHeaders()),0<m?(u.log("Failed loading manifest: "+l+", retry in 500ms attempts: "+m),m--,setTimeout(function(){g.call(u,l,m)},500)):q?(u.log("Failed loading manifest: "+l+" no retry attempts left"),u.errHandler.downloadError("manifest",l,f),u.notify(MediaPlayer.dependencies.ManifestLoader.eventList.ENAME_MANIFEST_LOADED,
null,Error("Failed loading manifest: "+l+" no retry attempts left"))):(u.log("Incorrect content type received for manifest: "+l),u.errHandler.contentTypeError(null,"manifest"),u.notify(MediaPlayer.dependencies.ManifestLoader.eventList.ENAME_MANIFEST_LOADED,null,Error("Incorrect content type received for manifest: "+l))))};r=function(b){p&&(p=!1,!b.lengthComputable||b.lengthComputable&&b.total!=b.loaded)&&(f.firstByteDate=new Date)};try{f.onload=function(){var g=null,p=u.system.getObject("mediaPlayer");
if(!(200>f.status||299<f.status)){var k=f.responseURL?f.responseURL:l,r;r=p._resourceType===AdobePSDK.MediaResourceType.HLS?[Primetime.MimeTypeUtils.Extension.M3U8]:[Primetime.MimeTypeUtils.Extension.MPD];-1===Primetime.MimeTypeUtils.validateResponse(k,f.getResponseHeader("Content-Type"),r)?(q=!1,m=0):(q=!0,n=!1,b=new Date,p&&p._config&&p._config.networkConfiguration&&p._config.networkConfiguration.useRedirectedUrl&&f.responseURL&&f.responseURL!==l&&(h=d(f.responseURL),g=f.responseURL,u.system.getObject("urlUtils").flattenUrl(l)!==
f.responseURL&&u.log("[302 redirect optimisation]: Mapped baseURL "+d(l)+" to "+h)),u.metricsModel.addHttpRequest("stream",null,MediaPlayer.vo.metrics.HTTPRequest.MPD_TYPE,l,g,null,c,f.firstByteDate||null,b,f.status,null,f.getAllResponseHeaders()),g=g||l,k=u.timeline.isFirstLoad(g),k=u.parser.parse(f.responseText,g,h,u.xlinkController,k),p&&"function"===typeof p.notifyLoadInfo&&(r={},r.type=AdobePSDK.LoadInformationType.MANIFEST,r.url=g,p.notifyLoadInfo(r)),"function"!=typeof u.parser.subscribe&&
(p=new MediaPlayer.vo.Event,p.data={},p.data.manifest=k,p.data.url=g,e.call(u,p)))}};f.onloadend=k;f.onerror=k;f.onprogress=r;f.open("GET",u.requestModifierExt.modifyRequestURL(l),!0);var w=this.system.getObject("mediaPlayer"),v=w.getNetworkConfig(),x=w.getCORSConfig();w&&v&&x&&x.enableEncryptionRequest&&v.useCookieHeaderForAllRequests&&(f.withCredentials=!0);f.send()}catch(y){f.onerror()}},k=function(b){this.notify(MediaPlayer.dependencies.ManifestLoader.eventList.ENAME_MANIFEST_LOADED,{manifest:b.data.manifest})};
return{log:void 0,parser:void 0,errHandler:void 0,metricsModel:void 0,requestModifierExt:void 0,notify:void 0,subscribe:void 0,unsubscribe:void 0,system:void 0,timeline:void 0,subscribed:!1,setup:function(){k=k.bind(this);this.xlinkController=this.system.getObject("xlinkController");this.xlinkController.subscribe(MediaPlayer.dependencies.XlinkController.eventList.ENAME_XLINK_READY,this,k);this[MediaPlayer.dependencies.ManifestLoader.eventList.ENAME_PARSING_COMPLETE]=e},load:function(b){"function"!==
typeof this.parser.subscribe||this.subscribed||(this.parser.subscribe(MediaPlayer.dependencies.ManifestLoader.eventList.ENAME_PARSING_COMPLETE,this),this.subscribed=!0);g.call(this,b,3)},reset:function(){this.subscribed&&"function"===typeof this.parser.subscribe&&(this.parser.unsubscribe(MediaPlayer.dependencies.ManifestLoader.eventList.ENAME_PARSING_COMPLETE,this),this.subscribed=!1)},subscribeParser:function(){"function"!==typeof this.parser.subscribe||this.subscribed||(this.parser.subscribe(MediaPlayer.dependencies.ManifestLoader.eventList.ENAME_PARSING_COMPLETE,
this),this.subscribed=!0)},unsubscribeParser:function(){this.subscribed&&"function"===typeof this.parser.subscribe&&(this.parser.unsubscribe(MediaPlayer.dependencies.ManifestLoader.eventList.ENAME_PARSING_COMPLETE,this),this.subscribed=!1)}}};MediaPlayer.dependencies.ManifestLoader.prototype={constructor:MediaPlayer.dependencies.ManifestLoader};MediaPlayer.dependencies.ManifestLoader.PARSERERROR_ERROR_CODE=1;
MediaPlayer.dependencies.ManifestLoader.eventList={ENAME_MANIFEST_LOADED:"manifestLoaded",ENAME_PARSING_COMPLETE:"parseCompleted"};MediaPlayer.dependencies.ManifestUpdater=function(){var b=NaN,c=null,d=!0,e=!1,g=!1,k=!1,l,m=!1,h=null,f=NaN,n=function(){null!=h&&(clearInterval(h),h=null)},q=function(){null!==c&&(clearInterval(c),c=null)},t=function(){n.call(this);isNaN(f)||(this.log("Refresh stream level manifest in "+f+" seconds."),h=setTimeout(u.bind(this),Math.min(1E3*f,Math.pow(2,31)-1),this))},r=function(){q.call(this);isNaN(b)||(this.log("Refresh manifest in "+b+" seconds."),c=setTimeout(w.bind(this),Math.min(1E3*b,Math.pow(2,
31)-1),this));t.call(this)},p=function(c){var e,h,n;e=new Date;this.manifestModel.setValue(c);this.log("Manifest has been refreshed at "+e+"["+e.getTime()+"] ");c.isHls?(h=this.system.getObject("mediaPlayer"),e=Math.pow(2,31)-1,h&&this.manifestExt.getIsDynamic(c)&&(e=h._config.networkConfiguration.masterUpdateInterval,e*=60,e=0<=e?e:Math.pow(2,31)-1),h=this.manifestExt.getRefreshDelay(c)):e=this.manifestExt.getRefreshDelay(c);n=((new Date).getTime()-c.loadedTime.getTime())/1E3;b=Math.max(e-n,0);f=
Math.max(h-n,0);this.notify(MediaPlayer.dependencies.ManifestUpdater.eventList.ENAME_MANIFEST_UPDATED,{manifest:c});d||r.call(this)},u=function(){var b;d||(e||g?m=!0:(m=!1,e=!0,b=this.manifestModel.getValue(),this.notify(MediaPlayer.dependencies.ManifestUpdater.eventList.ENAME_MANIFEST_UPDATED,{manifest:b}),d||(b=this.manifestExt.getRefreshDelay(b),f=Math.max(b,0),t.call(this))))},w=function(){var b,c;d||(e||g?k=!0:(k=!1,e=!0,b=this.manifestModel.getValue(),c=b.url,b.hasOwnProperty("Location")&&(c=
b.Location),l.load(c)))},v=function(b){b.error||p.call(this,b.data.manifest)},x=function(){d=!1;r.call(this)},y=function(){d=!0;q.call(this);n.call(this)},E=function(){e=!1;k&&w.call(this);m&&u.call(this)};return{log:void 0,system:void 0,subscribe:void 0,unsubscribe:void 0,notify:void 0,manifestModel:void 0,manifestExt:void 0,setup:function(){this[MediaPlayer.dependencies.StreamController.eventList.ENAME_STREAMS_COMPOSED]=E;this[MediaPlayer.dependencies.ManifestLoader.eventList.ENAME_MANIFEST_LOADED]=
v;this[MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_STARTED]=x;this[MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_PAUSED]=y},initialize:function(b){e=!1;d=!0;l=b;l.subscribe(MediaPlayer.dependencies.ManifestLoader.eventList.ENAME_MANIFEST_LOADED,this);l.subscribeParser()},setManifest:function(b){p.call(this,b)},getManifestLoader:function(){return l},onStreamSwitch:function(b){d=!1;b=b.data.toStreamInfo;var c=b.manifestInfo.isDynamic;b.periodManifestInfo&&
(c=b.periodManifestInfo.isDynamic);c&&(e=!1,w.call(this))},onPlaybackStopped:function(){d=!0;q.call(this);n.call(this)},pauseRefresh:function(b){g=b;g||(k&&w.call(this),m&&u.call(this))},reset:function(){d=!0;g=e=!1;q.call(this);n.call(this);l&&(l.unsubscribe(MediaPlayer.dependencies.ManifestLoader.eventList.ENAME_MANIFEST_LOADED,this),l.unsubscribeParser());f=b=NaN;m=k=!1}}};MediaPlayer.dependencies.ManifestUpdater.prototype={constructor:MediaPlayer.dependencies.ManifestUpdater};
MediaPlayer.dependencies.ManifestUpdater.eventList={ENAME_MANIFEST_UPDATED:"manifestUpdated"};MediaPlayer.models.ManifestModel=function(){var b;return{system:void 0,eventBus:void 0,notify:void 0,subscribe:void 0,unsubscribe:void 0,getValue:function(){return b},setValue:function(c){b=c;this.eventBus.dispatchEvent({type:MediaPlayer.events.MANIFEST_LOADED,data:c});this.notify(MediaPlayer.models.ManifestModel.eventList.ENAME_MANIFEST_UPDATED,{manifest:c})}}};MediaPlayer.models.ManifestModel.prototype={constructor:MediaPlayer.models.ManifestModel};MediaPlayer.models.ManifestModel.eventList={ENAME_MANIFEST_UPDATED:"manifestUpdated"};MediaPlayer.dependencies.MediaSourceExtensions=function(){};
MediaPlayer.dependencies.MediaSourceExtensions.prototype={constructor:MediaPlayer.dependencies.MediaSourceExtensions,subscribe:void 0,unsubscribe:void 0,notify:void 0,createMediaSource:function(){var b="WebKitMediaSource"in window;return"MediaSource"in window?new MediaSource:b?new WebKitMediaSource:null},attachMediaSource:function(b,c){var d=window.URL.createObjectURL(b);c.setSource(d);return d},detachMediaSource:function(b){var c=function(){try{b.setSource("")}catch(d){setTimeout(c,500)}};c()},setDuration:function(b,
c){var d=Math.min(Number.MAX_VALUE,c);b.duration!=d&&(b.duration=d);return b.duration},signalEndOfStream:function(b){var c=b.sourceBuffers,d=c.length,e=0;if("open"!==b.readyState)return!1;for(e;e<d;e+=1)if(c[e].updating)return!1;console.log("Signalling end of stream");b.endOfStream();this.notify(MediaPlayer.dependencies.MediaSourceExtensions.eventList.ENAME_SOURCE_ENDED);return!0}};MediaPlayer.dependencies.MediaSourceExtensions.eventList={ENAME_SOURCE_ENDED:"sourceEnded"};MediaPlayer.dependencies.SourceBufferExtensions=function(){this.manifestExt=this.unsubscribe=this.subscribe=this.notify=this.system=void 0};
MediaPlayer.dependencies.SourceBufferExtensions.prototype={constructor:MediaPlayer.dependencies.SourceBufferExtensions,createSourceBuffer:function(b,c){var d=c.codec,e=null;try{if(d.match(/application\/mp4;\s*codecs="stpp"/i))throw Error("not really supported");e=b.addSourceBuffer(d)}catch(g){if(c.isText||-1!==d.indexOf('codecs="stpp"'))e=this.system.getObject("textSourceBuffer");else throw g;}return e},removeSourceBuffer:function(b,c){try{b.removeSourceBuffer(c)}catch(d){}},getBufferRange:function(b,
c,d){var e=null,g=0,k=0,l=null,m=null,h=0;d=d||.15;var f;try{e=b.buffered}catch(n){return null}if(null!==e&&void 0!==e){f=0;for(b=e.length;f<b;f+=1)if(g=e.start(f),k=e.end(f),null===l)h=Math.abs(g-c),c>=g&&c<k?(l=g,m=k):h<=d&&(l=g,m=k);else if(h=g-m,h<=d)m=k;else break;if(null!==l)return{start:l,end:m}}return null},getAllRanges:function(b){var c=null;try{return c=b.buffered}catch(d){return null}},getTotalBufferedTime:function(b){b=this.getAllRanges(b);var c=0,d,e;if(!b)return c;e=0;for(d=b.length;e<
d;e+=1)c+=b.end(e)-b.start(e);return c},getBufferLength:function(b,c,d,e){b=this.getBufferRange(b,c,d);return null===b?0:e?c-b.start:b.end-c},getRangeDifference:function(b,c){if(!c)return null;var d=this.getAllRanges(c),e,g,k,l,m;if(!d)return null;for(var h=0,f=d.length;h<f;h+=1){m=(e=b.length>h)?{start:b.start(h),end:b.end(h)}:null;e=d.start(h);g=d.end(h);if(!m)return g={start:e,end:g};k=m.start===e;l=m.end===g;if(!k||!l){if(k)g={start:m.end,end:g};else if(l)g={start:e,end:m.start};else return g=
{start:e,end:g};e=b.length>h+1?{start:b.start(h+1),end:b.end(h+1)}:null;d=h+1<f?{start:d.start(h+1),end:d.end(h+1)}:null;!e||d&&d.start===e.start&&d.end===e.end||(g.end=e.start);return g}}return null},waitForUpdateEnd:function(b,c){var d,e=function(){b.updating||(clearInterval(d),c())},g=function(){b.updating||(b.removeEventListener("updateend",g,!1),c())};if(b.updating)if("function"===typeof b.addEventListener)try{b.addEventListener("updateend",g,!1)}catch(k){d=setInterval(e,50)}else d=setInterval(e,
50);else c()},append:function(b,c){var d=this,e=c.bytes,g="append"in b?"append":"appendBuffer"in b?"appendBuffer":null,k="Object"===Object.prototype.toString.call(b).slice(8,-1);if(g)try{d.waitForUpdateEnd(b,function(){if(k)b[g](e,c);else b[g](e);d.waitForUpdateEnd(b,function(){d.notify(MediaPlayer.dependencies.SourceBufferExtensions.eventList.ENAME_SOURCEBUFFER_APPEND_COMPLETED,{buffer:b,bytes:e})})})}catch(l){d.notify(MediaPlayer.dependencies.SourceBufferExtensions.eventList.ENAME_SOURCEBUFFER_APPEND_COMPLETED,
{buffer:b,bytes:e},new MediaPlayer.vo.Error(l.code,l.message,null))}},remove:function(b,c,d,e){var g=this;try{g.waitForUpdateEnd(b,function(){0<=c&&d>c&&"ended"!==e.readyState&&b.remove(c,d);g.waitForUpdateEnd(b,function(){g.notify(MediaPlayer.dependencies.SourceBufferExtensions.eventList.ENAME_SOURCEBUFFER_REMOVE_COMPLETED,{buffer:b,from:c,to:d})})})}catch(k){g.notify(MediaPlayer.dependencies.SourceBufferExtensions.eventList.ENAME_SOURCEBUFFER_REMOVE_COMPLETED,{buffer:b,from:c,to:d},new MediaPlayer.vo.Error(k.code,
k.message,null))}},abort:function(b,c){try{"open"===b.readyState&&c.abort()}catch(d){}}};MediaPlayer.dependencies.SourceBufferExtensions.QUOTA_EXCEEDED_ERROR_CODE=22;MediaPlayer.dependencies.SourceBufferExtensions.eventList={ENAME_SOURCEBUFFER_REMOVE_COMPLETED:"sourceBufferRemoveCompleted",ENAME_SOURCEBUFFER_APPEND_COMPLETED:"sourceBufferAppendCompleted"};MediaPlayer.dependencies.VideoModelExtensions=function(){return{getPlaybackQuality:function(b){var c="webkitDroppedFrameCount"in b,d=null;"getVideoPlaybackQuality"in b?d=b.getVideoPlaybackQuality():c&&(d={droppedVideoFrames:b.webkitDroppedFrameCount,creationTime:new Date});return d}}};MediaPlayer.dependencies.VideoModelExtensions.prototype={constructor:MediaPlayer.dependencies.VideoModelExtensions};MediaPlayer.dependencies.PlaybackController=function(){var b=0,c=NaN,d=null,e={},g={},k,l,m,h=NaN,f,n=function(b){var f,d=parseInt(this.uriQueryFragModel.getURIFragmentData().s),h=m;b.periodManifestInfo&&(h=b.periodManifestInfo.isDynamic);h?(b.manifestInfo.isHls?f=isNaN(c)||c<b.start?b.start:null:!isNaN(d)&&1262304E3<d&&(f=d-b.manifestInfo.availableFrom.getTime()/1E3,f>c||f<c-b.manifestInfo.DVRWindowSize)&&(f=null),f=f||c):!isNaN(d)&&d<b.duration&&0<=d?f=d:(f=e[b.id],void 0===f&&(f=this.system.getObject("streamController").getActiveStreamCommonEarliestTime()),
f=Math.max(f,b.start));return f},q=function(){if(null===d){var b=this;d=setInterval(function(){I.call(b)},50)}},t=function(){if(!g[k.id]&&!this.isSeeking()){var b=n.call(this,k);this.log("Starting playback at offset: "+b);b!=this.getTime()&&this.notify(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_SEEKING,{seekTime:b})}},r=function(){if(!this.isPaused()&&m&&0!==l.getElement().readyState){var b=this.getTime(),c;c=this.metricsModel.getReadOnlyMetricsFor("video")||this.metricsModel.getReadOnlyMetricsFor("audio")||
this.metricsModel.getReadOnlyMetricsFor("muxed");(c=(c=this.metricsExt.getCurrentDVRInfo(c))?c.range:null)?b>=c.start&&b<=c.end||k.manifestInfo.isDynamic&&(b<=c.end+.5&&b>=c.start||0==b)?c=b:(c=Math.max(c.end-2*k.manifestInfo.minBufferTime,c.start),c=0>c||c<b?b:c):c=NaN;isNaN(c)||c===b||this.seek(c)}},p=function(b){b.error||(b=this.adapter.convertDataToTrack(this.manifestModel.getValue(),b.data.currentRepresentation),k.id===b.mediaInfo.streamInfo.id&&(k=b.mediaInfo.streamInfo,r.call(this)))},u=function(b){b.error||
0===l.getElement().readyState||t.call(this)},w=function(){l&&(l.unlisten("canplay",v),l.unlisten("play",x),l.unlisten("playing",y),l.unlisten("pause",E),l.unlisten("error",C),l.unlisten("seeking",z),l.unlisten("seeked",D),l.unlisten("timeupdate",A),l.unlisten("progress",F),l.unlisten("ratechange",H),l.unlisten("loadedmetadata",B),l.unlisten("ended",G))},v=function(){this.notify(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_CAN_PLAY)},x=function(){this.log("Native video element event: play");
if(k.manifestInfo.isDynamic&&!k.manifestInfo.isHls){var b=this.system.getObject("streamController");b&&b.addDVRMetric()}r.call(this);q.call(this);this.notify(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_STARTED,{startTime:this.getTime()})},y=function(){this.log("Native video element event: playing");this.notify(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_PLAYING,{playingTime:this.getTime()})},E=function(){this.log("Native video element event: pause");
this.notify(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_PAUSED)},z=function(){q.call(this);this.notify(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_SEEKING,{seekTime:this.getTime()})},D=function(){this.log("Native video element event: seeked");this.notify(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_SEEKED)},A=function(){var c=this.getTime();c!==b&&(b=c,this.notify(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_TIME_UPDATED,
{timeToEnd:this.getTimeToStreamEnd()}))},F=function(){var b=l.getElement().buffered,c;b.length&&(c=b.length-1,b=b.end(c),c=k.start+k.duration-b);this.notify(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_PROGRESS,{bufferedRanges:l.getElement().buffered,remainingUnbufferedDuration:c})},H=function(){this.log("Native video element event: ratechange: ",this.getPlaybackRate());this.notify(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_RATE_CHANGED)},B=function(){this.log("Native video element event: loadedmetadata");
m&&!this.timelineConverter.isTimeSyncCompleted()||t.call(this);this.notify(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_METADATA_LOADED);q.call(this)},G=function(){this.log("Native video element event: ended");clearInterval(d);d=null;this.notify(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_ENDED)},C=function(b){this.notify(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_ERROR,{error:(b.target||b.srcElement).error})},I=function(){this.notify(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_WALLCLOCK_TIME_UPDATED,
{isDynamic:m,time:new Date})},J=function(b){if(!k.isAd&&b.data.ranges&&b.data.ranges.length){var c=this.system.getObject("streamController").getStreamById(k.id);b.data.ranges.end(b.data.ranges.length-1)-k.start<k.duration&&(c.getStreamInfo().duration=k.duration=b.data.ranges.end(b.data.ranges.length-1)-k.start)}},M=function(b){var c=b.data.bufferedRanges,f=k.id,d=this.getTime(),h=b.sender.streamProcessor,l=h.getType(),p=this.system.getObject("streamController").getStreamById(k.id),q=n.call(this,k),
m=this.adapter.getFragmentRequestForTime(h,h.getCurrentRepresentationInfo(),q,{ignoreIsFinished:!0,keepIdx:!0}),h=e[f];b.data.index===(m?m.index:null)&&(g[f]=g[f]||{},g[f][l]=!0,g[f].ready=!(p.hasMedia("audio")&&!g[f].audio||p.hasMedia("video")&&!g[f].video));!c||!c.length||g[f]&&g[f].seekCompleted||(b=Math.max(c.start(0),k.start),e[f]=void 0===e[f]?b:Math.max(e[f],b),h===e[f]&&d===h||!g[f]||!g[f].ready||d>e[f]||(this.isSeeking()?e={}:(e[f]>=q?console.log("Seeking to common earliest time: "+e[f]):
console.log("Seeking to streamStart: "+q),this.seek(Math.max(e[f],q)),g[f].seekCompleted=!0)))},K=function(b){var c=b.sender.streamProcessor.getType();b.sender.streamProcessor.getStreamInfo().id===k.id&&l.setStallState(c,!b.data.hasSufficientBuffer)},L=function(){l.listen("canplay",v);l.listen("play",x);l.listen("playing",y);l.listen("pause",E);l.listen("error",C);l.listen("seeking",z);l.listen("seeked",D);l.listen("timeupdate",A);l.listen("progress",F);l.listen("ratechange",H);l.listen("loadedmetadata",
B);l.listen("ended",G)};return{system:void 0,log:void 0,timelineConverter:void 0,uriQueryFragModel:void 0,metricsModel:void 0,metricsExt:void 0,manifestModel:void 0,manifestExt:void 0,videoModel:void 0,notify:void 0,subscribe:void 0,unsubscribe:void 0,adapter:void 0,setup:function(){this[Dash.dependencies.RepresentationController.eventList.ENAME_DATA_UPDATE_COMPLETED]=p;this[MediaPlayer.dependencies.LiveEdgeFinder.eventList.ENAME_LIVE_EDGE_SEARCH_COMPLETED]=u;this[MediaPlayer.dependencies.BufferController.eventList.ENAME_BYTES_APPENDED]=
M;this[MediaPlayer.dependencies.BufferController.eventList.ENAME_BUFFERING_COMPLETED]=J;this[MediaPlayer.dependencies.BufferController.eventList.ENAME_BUFFER_LEVEL_STATE_CHANGED]=K;v=v.bind(this);x=x.bind(this);y=y.bind(this);E=E.bind(this);C=C.bind(this);z=z.bind(this);D=D.bind(this);A=A.bind(this);F=F.bind(this);H=H.bind(this);B=B.bind(this);G=G.bind(this)},initialize:function(b){l=this.videoModel;k=b;e={};w.call(this);L.call(this);this.resetSeekCompleteStatus();m=k.manifestInfo.isDynamic;k.periodManifestInfo&&
(m=k.periodManifestInfo.isDynamic)},resetSeekCompleteStatus:function(){g[k.id]&&(g[k.id].seekCompleted=!1)},getStreamStartTime:n,getTimeToStreamEnd:function(){var b=l.getCurrentTime();return k.start+k.duration-b},getStreamId:function(){return k.id},getStreamDuration:function(){return k.duration},getTime:function(){return l.getCurrentTime()},getPlaybackRate:function(){return l.getPlaybackRate()},getPlayedRanges:function(){return l.getElement().played},getIsDynamic:function(){return m},setLiveStartTime:function(b){c=
b;this.system.getObject("mediaPlayer").setLiveStartTime(c)},getLiveStartTime:function(){return c},setLiveDelayAttributes:function(b,c){h=b;f=c},getLiveDelay:function(b,c){var d;d=null;"function"===typeof this.manifestExt.getMpd&&(d=this.manifestExt.getMpd(this.manifestModel.getValue()));d=f&&void 0!=d&&null!=d&&d.hasOwnProperty("suggestedPresentationDelay")?d.suggestedPresentationDelay:isNaN(b)?2*k.manifestInfo.minBufferTime:b*h;var e=Math.max(c-10,c/2);return Math.min(d,e)},start:function(){var b=
this,c=l.play();c&&"undefined"!==typeof Promise&&c instanceof Promise&&c.catch(function(c){b.log("Caught pending play exception - continuing. "+c)})},isPaused:function(){return l.isPaused()},pause:function(){l&&l.pause()},isSeeking:function(){return l.getElement().seeking},seek:function(b){l&&b!==this.getTime()&&(this.log("Do seek: "+b),l.setCurrentTime(b))},reset:function(){clearInterval(d);d=null;w.call(this);l&&l.setPlaybackRate(1);k=l=null;b=0;c=NaN;e={};g={};f=m=void 0;h=NaN},stopListening:w,
startListening:function(){l&&(w.call(this),L.call(this))},notifyExplicitSeek:function(b){this.notify(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_EXPLICIT_SEEKING,{seekTime:b})}}};MediaPlayer.dependencies.PlaybackController.prototype={constructor:MediaPlayer.dependencies.PlaybackController};
MediaPlayer.dependencies.PlaybackController.eventList={ENAME_CAN_PLAY:"canPlay",ENAME_PLAYBACK_STARTED:"playbackStarted",ENAME_PLAYBACK_PLAYING:"playbackPlaying",ENAME_PLAYBACK_STOPPED:"playbackStopped",ENAME_PLAYBACK_PAUSED:"playbackPaused",ENAME_PLAYBACK_ENDED:"playbackEnded",ENAME_PLAYBACK_SEEKING:"playbackSeeking",ENAME_PLAYBACK_SEEKED:"playbackSeeked",ENAME_PLAYBACK_TIME_UPDATED:"playbackTimeUpdated",ENAME_PLAYBACK_PROGRESS:"playbackProgress",ENAME_PLAYBACK_RATE_CHANGED:"playbackRateChanged",
ENAME_PLAYBACK_METADATA_LOADED:"playbackMetaDataLoaded",ENAME_PLAYBACK_ERROR:"playbackError",ENAME_WALLCLOCK_TIME_UPDATED:"wallclockTimeUpdated",ENAME_PLAYBACK_EXPLICIT_SEEKING:"playbackExplicitSeeking"};MediaPlayer.dependencies.FragmentController=function(){var b=[],c=function(b){var c=b.data.request;this.isInitializationRequest(c)?this.notify(MediaPlayer.dependencies.FragmentController.eventList.ENAME_INIT_FRAGMENT_LOADING_START,{request:c,fragmentModel:b.sender}):this.notify(MediaPlayer.dependencies.FragmentController.eventList.ENAME_MEDIA_FRAGMENT_LOADING_START,{request:c,fragmentModel:b.sender})},d=function(b){var c=b.data.request,d=b.data.response,e=b.sender.getContext().streamProcessor.getStreamInfo().id,
h=this.isInitializationRequest(c)?MediaPlayer.dependencies.FragmentController.eventList.ENAME_INIT_FRAGMENT_LOADED:MediaPlayer.dependencies.FragmentController.eventList.ENAME_MEDIA_FRAGMENT_LOADED;if(d){var f=new MediaPlayer.vo.DataChunk;f.streamId=e;f.mediaInfo=c.mediaInfo;f.segmentType=c.type;f.start=c.startTime;f.duration=c.duration;f.end=f.start+f.duration;f.bytes=d;f.index=c.index;f.quality=c.quality;f.sequenceNumber=c.sequenceNumber;f.isEncrypted=c.isEncrypted;f.encryptionMethod=c.encryptionMethod;
f.isEncrypted&&(f.keyUri=c.keyUri,f.IV=c.IV);f.baseUrl=c.url;f.discontinuityEncountered=c.discontinuityEncountered;f.MSETimeOffset=c.MSETimeOffset;f.vidBaseDecodeTime=c.vidBaseDecodeTime;f.audBaseDecodeTime=c.audBaseDecodeTime;this.notify(h,{chunk:f,fragmentModel:b.sender})}else this.log("No "+c.mediaType+" bytes to push.")},e=function(b){this.notify(MediaPlayer.dependencies.FragmentController.eventList.ENAME_STREAM_COMPLETED,{request:b.data.request,fragmentModel:b.sender})};return{system:void 0,
log:void 0,scheduleRulesCollection:void 0,rulesController:void 0,notify:void 0,subscribe:void 0,unsubscribe:void 0,setup:function(){this[MediaPlayer.dependencies.FragmentModel.eventList.ENAME_FRAGMENT_LOADING_STARTED]=c;this[MediaPlayer.dependencies.FragmentModel.eventList.ENAME_FRAGMENT_LOADING_COMPLETED]=d;this[MediaPlayer.dependencies.FragmentModel.eventList.ENAME_STREAM_COMPLETED]=e},process:function(b){var c=null;null!==b&&void 0!==b&&0<b.byteLength&&(c=new Uint8Array(b));return c},getModel:function(c){if(!c)return null;
var d;a:{d=b.length;for(var e=0;e<d;e++)if(b[e].getContext()==c){d=b[e];break a}d=null}d||(d=this.system.getObject("fragmentModel"),d.setContext(c),b.push(d));return d},detachModel:function(c){c=b.indexOf(c);-1<c&&b.splice(c,1)},isInitializationRequest:function(b){return b&&b.type&&b.type===MediaPlayer.vo.metrics.HTTPRequest.INIT_SEGMENT_TYPE},reset:function(){b=[]}}};MediaPlayer.dependencies.FragmentController.prototype={constructor:MediaPlayer.dependencies.FragmentController};
MediaPlayer.dependencies.FragmentController.eventList={ENAME_STREAM_COMPLETED:"streamCompleted",ENAME_INIT_FRAGMENT_LOADING_START:"initFragmentLoadingStart",ENAME_MEDIA_FRAGMENT_LOADING_START:"mediaFragmentLoadingStart",ENAME_INIT_FRAGMENT_LOADED:"initFragmentLoaded",ENAME_MEDIA_FRAGMENT_LOADED:"mediaFragmentLoaded"};MediaPlayer.dependencies.AbrController=function(){var b=!0,c={},d={},e={},g={},k={},l={},m={},h,f=function(b,c){d[c]=d[c]||{};d[c].hasOwnProperty(b)||(d[c][b]=0);return d[c][b]},n=function(b,c){e[c]=e[c]||{};e[c].hasOwnProperty(b)||(e[c][b]=0);return e[c][b]},q=function(b){return g.hasOwnProperty("max")&&g.max.hasOwnProperty(b)?g.max[b]:NaN},t=function(b,f){var d;c[f]=c[f]||{};c[f].hasOwnProperty(b)||(c[f][b]=0);d=c[f][b];var e=q(b);isNaN(e)||(e=this.getQualityForBitrate(l[b].getMediaInfo(),e),d=
Math.min(d,e));return d},r=function(c){if(0===MediaPlayer.dependencies.ScheduleController.LOADING_REQUEST_THRESHOLD&&b){var f=this,d=c.data.request.mediaType,e=f.abrRulesCollection.getRules(MediaPlayer.rules.ABRRulesCollection.prototype.ABANDON_FRAGMENT_RULES),n=l[d].getScheduleController(),g=n.getFragmentModel();f.rulesController.applyRules(e,l[d],function(b){function c(b){h=setTimeout(function(){f.setAbandonmentStateFor(b,MediaPlayer.dependencies.AbrController.ALLOW_LOAD)},MediaPlayer.dependencies.AbrController.ABANDON_TIMEOUT)}
if(b.confidence===MediaPlayer.rules.SwitchRequest.prototype.STRONG){var e=g.getRequests({state:MediaPlayer.dependencies.FragmentModel.states.LOADING});b=b.value;var l=f.getQualityFor(d,f.streamController.getActiveStreamInfo());b<l&&(g.abortRequests(),f.setAbandonmentStateFor(d,MediaPlayer.dependencies.AbrController.ABANDON_LOAD),f.setPlaybackQuality(d,f.streamController.getActiveStreamInfo(),b),n.replaceCanceledRequests(e),c(d))}},c,function(b,c){return c})}};return{log:void 0,abrRulesCollection:void 0,
rulesController:void 0,notify:void 0,subscribe:void 0,unsubscribe:void 0,streamController:void 0,setup:function(){this[MediaPlayer.dependencies.FragmentLoader.eventList.ENAME_LOADING_PROGRESS]=r},initialize:function(b,c){l[b]=c;m[b]=m[b]||{};m[b].state=MediaPlayer.dependencies.AbrController.ALLOW_LOAD},getAutoSwitchBitrate:function(){return b},setAutoSwitchBitrate:function(c){b=c},getPlaybackQuality:function(c,h){var g=this,l=c.getType(),q=c.getStreamInfo().id,m,k,r,D=function(b){var f=t.call(g,l,
q);m=b.value;r=b.confidence;0>m&&(m=0);m>f&&(m=f);void 0!==m&&(b=m,d[q]=d[q]||{},d[q][l]=b,b=r,e[q]=e[q]||{},e[q][l]=b,g.notify(MediaPlayer.dependencies.AbrController.eventList.ENAME_QUALITY_CHANGED,{mediaType:l,streamInfo:c.getStreamInfo(),oldQuality:void 0,newQuality:m}));void 0!==h&&h()};m=f(l,q);r=n(l,q);b?(k=g.abrRulesCollection.getRules(MediaPlayer.rules.ABRRulesCollection.prototype.QUALITY_SWITCH_RULES),g.rulesController.applyRules(k,c,D.bind(g),m,function(b,c){b=b===MediaPlayer.rules.SwitchRequest.prototype.NO_CHANGE?
0:b;return Math.max(b,c)})):void 0!==h&&h()},setPlaybackQuality:function(b,c,e){var h=c.id,n=f(b,h);if(null===e||isNaN(e)||0!==e%1)throw"argument is not an integer";e!==n&&0<=e&&e<=t.call(this,b,h)&&(h=c.id,d[h]=d[h]||{},d[h][b]=e,this.notify(MediaPlayer.dependencies.AbrController.eventList.ENAME_QUALITY_CHANGED,{mediaType:b,streamInfo:c,oldQuality:n,newQuality:e}))},setAbandonmentStateFor:function(b,c){m[b].state=c},getAbandonmentStateFor:function(b){return m[b].state},getQualityFor:function(b,c){return f(b,
c.id)},getConfidenceFor:function(b,c){return n(b,c.id)},setInitialBitrateFor:function(b,c){g[b]=c},getInitialBitrateFor:function(b){return g[b]},setMaxAllowedBitrateFor:function(b,c){g.max=g.max||{};g.max[b]=c},getMaxAllowedBitrateFor:function(b){return q(b)},getQualityForBitrate:function(b,c){for(var f=this.getBitrateList(b),d=f.length,e,h=0;h<d;h+=1)if(e=f[h],1E3*c<=e.bitrate)return Math.max(h-1,0);return d-1},getIndexForBitrate:function(b,c){this.getQualityForBitrate(b,c)},getBitrateList:function(b){if(!b||
!b.bitrateList)return null;var c=b.bitrateList;b=b.type;for(var f=[],d,e=0,h=c.length;e<h;e+=1)d=new MediaPlayer.vo.BitrateInfo,d.mediaType=b,d.qualityIndex=e,d.bitrate=c[e],f.push(d);return f},setAverageThroughput:function(b,c){k[b]=c},getAverageThroughput:function(b){return k[b]},updateTopQualityIndex:function(b){var f=b.type,d=b.streamInfo.id;b=b.representationCount-1;c[d]=c[d]||{};return c[d][f]=b},isPlayingAtTopQuality:function(b){var c=b.id,f=this.getQualityFor("audio",b);b=this.getQualityFor("video",
b);return f===t.call(this,"audio",c)&&b===t.call(this,"video",c)},getTopQualityIndexFor:t,reset:function(){b=!0;c={};d={};e={};l={};m={};k={};clearTimeout(h);h=null}}};MediaPlayer.dependencies.AbrController.prototype={constructor:MediaPlayer.dependencies.AbrController};MediaPlayer.dependencies.AbrController.eventList={ENAME_QUALITY_CHANGED:"qualityChanged"};MediaPlayer.dependencies.AbrController.DEFAULT_VIDEO_BITRATE=1E3;MediaPlayer.dependencies.AbrController.DEFAULT_AUDIO_BITRATE=100;
MediaPlayer.dependencies.AbrController.ABANDON_LOAD="abandonload";MediaPlayer.dependencies.AbrController.ALLOW_LOAD="allowload";MediaPlayer.dependencies.AbrController.ABANDON_TIMEOUT=1E4;MediaPlayer.dependencies.AbrController.BANDWIDTH_SAFETY=.9;MediaPlayer.dependencies.XlinkController=function(){var b,c,d,e,g=function(b,c,d){var e={};e.elements=b;e.type=c;e.resolveType=d;0===e.elements.length&&l.call(this,e);for(d=0;d<e.elements.length;d+=1)b=e.elements[d],c=-1!==b.url.indexOf("http://")?b.url:b.originalContent.BaseURL+b.url,this.xlinkLoader.load(c,b,e)},k=function(b){var c,d;d="";c=b.data.element;b=b.data.resolveObject;c.resolvedContent&&(d=c.resolvedContent.indexOf(">")+1,d=c.resolvedContent.substr(0,d)+"<response>"+c.resolvedContent.substr(d)+
"</response>",c.resolvedContent=e.xml_str2json(d));a:{for(c=0;c<b.elements.length;c++)if(d=b.elements[c],!1===d.resolved){c=!1;break a}c=!0}c&&l.call(this,b)},l=function(b){var f=[],e,l,k=[],r,p,u;for(p=b.elements.length-1;0<=p;p--){e=b.elements[p];l=e.type+"_asArray";if(!e.resolvedContent)delete e.originalContent["xlink:actuate"],delete e.originalContent["xlink:href"],k.push(e.originalContent);else if(e.resolvedContent)for(u=0;u<e.resolvedContent[l].length;u++)r=e.resolvedContent[l][u],k.push(r);
e.parentElement[l].splice(e.index,1);for(r=0;r<k.length;r++)e.parentElement[l].splice(e.index+r,0,k[r]);k=[]}0<b.elements.length&&c.run(d);"onActuate"===b.resolveType&&this.notify(MediaPlayer.dependencies.XlinkController.eventList.ENAME_XLINK_READY,{manifest:d});if("onLoad"===b.resolveType)switch(b.type){case "Period":for(b=0;b<d.Period_asArray.length;b++)e=d.Period_asArray[b],e.hasOwnProperty("AdaptationSet_asArray")&&(f=f.concat(m.call(this,e.AdaptationSet_asArray,e,"AdaptationSet","onLoad"))),
e.hasOwnProperty("EventStream_asArray")&&(f=f.concat(m.call(this,e.EventStream_asArray,e,"EventStream","onLoad")));g.call(this,f,"AdaptationSet","onLoad");break;case "AdaptationSet":this.notify(MediaPlayer.dependencies.XlinkController.eventList.ENAME_XLINK_READY,{manifest:d})}},m=function(b,c,d,e){var g=[],l,m;for(m=b.length-1;0<=m;--m)l=b[m],l.hasOwnProperty("xlink:href")&&"urn:mpeg:dash:resolve-to-zero:2013"===l["xlink:href"]&&b.splice(m,1);for(m=0;m<b.length;m++)l=b[m],l.hasOwnProperty("xlink:href")&&
l.hasOwnProperty("xlink:actuate")&&l["xlink:actuate"]===e&&(l={url:l["xlink:href"],parentElement:c,type:d,index:m,resolveType:e,originalContent:l,resolvedContent:null,resolved:!1},g.push(l));return g};return{xlinkLoader:void 0,notify:void 0,subscribe:void 0,unsubscribe:void 0,setup:function(){k=k.bind(this);this.xlinkLoader.subscribe(MediaPlayer.dependencies.XlinkLoader.eventList.ENAME_XLINKELEMENT_LOADED,this,k)},resolveManifestOnLoad:function(c){e=new X2JS(b,"",!0);d=c;c=m(d.Period_asArray,d,"Period",
"onLoad");g.call(this,c,"Period","onLoad")},setMatchers:function(c){b=c},setIron:function(b){c=b}}};MediaPlayer.dependencies.XlinkController.prototype={constructor:MediaPlayer.dependencies.XlinkController};MediaPlayer.dependencies.XlinkController.eventList={ENAME_XLINK_ALLELEMENTSLOADED:"xlinkAllElementsLoaded",ENAME_XLINK_READY:"xlinkReady"};MediaPlayer.dependencies.MediaController=function(){var b={},c,d,e,g=function(b,c){var f=!b.lang||b.lang===c.lang,d=!b.viewpoint||b.viewpoint===c.viewpoint,e=!b.role||!!c.roles.filter(function(c){return c===b.role})[0],g=!b.accessibility||!!c.accessibility.filter(function(c){return c===b.accessibility})[0],l=!b.audioChannelConfiguration||!!c.audioChannelConfiguration.filter(function(c){return c===b.audioChannelConfiguration})[0];return f&&d&&e&&g&&l},k=function(){e={audio:MediaPlayer.dependencies.MediaController.trackSwitchModes.ALWAYS_REPLACE,
video:MediaPlayer.dependencies.MediaController.trackSwitchModes.NEVER_REPLACE,muxed:MediaPlayer.dependencies.MediaController.trackSwitchModes.ALWAYS_REPLACE}},l=function(b){var c=this.getSelectionModeForInitialTrack(),f=[],d=function(b){var c=0,f=[],d;b.forEach(function(b){b.isTrickPlayTrack||(d=Math.max.apply(Math,b.bitrateList),d>c?(c=d,f=[b]):d===c&&f.push(b))});return f},e=function(b){var c=0,f=[],d;b.forEach(function(b){b.isTrickPlayTrack||(d=b.representationCount,d>c?(c=d,f=[b]):d===c&&f.push(b))});
return f};switch(c){case MediaPlayer.dependencies.MediaController.trackSelectionModes.HIGHEST_BITRATE:f=d(b);1<f.length&&(f=e(f));break;case MediaPlayer.dependencies.MediaController.trackSelectionModes.WIDEST_RANGE:f=e(b);1<f.length&&(f=d(b));break;default:this.log("track selection mode is not supported: "+c)}return f[0]};return{log:void 0,system:void 0,errHandler:void 0,notify:void 0,subscribe:void 0,unsubscribe:void 0,DOMStorage:void 0,setup:function(){c={audio:null,video:null};k.call(this)},checkInitialMediaSettings:function(b){var c=
this;"audio video text fragmentedText muxed 608".split(" ").forEach(function(f){var d=c.getInitialSettings(f),e=c.getTracksFor(f,b),k=!1;d||(d=c.DOMStorage.getSavedMediaSettings(f),c.setInitialSettings(f,d));e&&e.length&&e[0].type!=f&&(e=[]);e&&0!==e.length&&(d&&e.forEach(function(b){k||!g.call(c,d,b)||b.isTrickPlayTrack||(c.setTrack(b,!1),k=!0)}),k||(1<e.length?c.setTrack(l.call(c,e),!1):c.setTrack(e[0],!1)))})},addTrack:function(c){var d=c?c.type:null,f=c?c.streamInfo.id:null,e=this.getInitialSettings(d);
if(!c||!this.isMultiTrackSupportedByType(d))return!1;b[f]=b[f]||{audio:{list:[],storeLastSettings:!0,current:null},video:{list:[],storeLastSettings:!0,current:null},text:{list:[],storeLastSettings:!0,current:null},fragmentedText:{list:[],storeLastSettings:!0,current:null},muxed:{list:[],storeLastSettings:!0,current:null},608:{list:[],storeLastSettings:!0,current:null}};if(0<=b[f][d].list.indexOf(c))return!1;b[f][d].list.push(c);e&&g.call(this,e,c)&&!this.getCurrentTrackFor(d,c.streamInfo)&&!c.isTrickPlayTrack&&
this.setTrack(c,!1);return!0},getTracksFor:function(c,d){if(!c||!d)return[];var f=d.id;return b[f]&&b[f][c]?b[f][c].list:[]},getCurrentTrackFor:function(c,d){if(!c||!d)return null;if(b[d.id]&&b[d.id][c])return b[d.id][c].current},isCurrentTrack:function(c){var d=c.type,f=c.streamInfo.id;return b[f]&&b[f][d]&&this.isTracksEqual(b[f][d].current,c)},setTrack:function(d,h){if(d){var f=d.type,n=d.streamInfo,g=n.id,n=this.getCurrentTrackFor(f,n);!b[g]||!b[g][f]||n&&this.isTracksEqual(d,n)||(b[g][f].current=
d,n&&this.notify(MediaPlayer.dependencies.MediaController.eventList.CURRENT_TRACK_CHANGED,{oldMediaInfo:n,newMediaInfo:d,switchMode:e[f]}),n={lang:d.lang,viewpoint:d.viewpoint,roles:d.roles,accessibility:d.accessibility,audioChannelConfiguration:d.audioChannelConfiguration,name:d.name},(n=n.lang||n.viewpoint||n.role&&0<n.role.length||n.accessibility&&0<n.accessibility.length||n.audioChannelConfiguration&&0<n.audioChannelConfiguration.length?n:null)&&b[g][f].storeLastSettings&&(n.roles&&(n.role=n.roles[0],
delete n.roles),n.accessibility&&(n.accessibility=n.accessibility[0]),n.audioChannelConfiguration&&(n.audioChannelConfiguration=n.audioChannelConfiguration[0]),h&&(!this.DOMStorage.isSupported(MediaPlayer.utils.DOMStorage.STORAGE_TYPE_LOCAL)||"video"!==f&&"audio"!==f&&"text"!==f||localStorage.setItem(MediaPlayer.utils.DOMStorage["LOCAL_STORAGE_"+f.toUpperCase()+"_SETTINGS_KEY"],JSON.stringify({settings:n,timestamp:(new Date).getTime()}))),c[f]=null))}},setInitialSettings:function(b,d){b&&d&&(c[b]=
d)},getInitialSettings:function(b){return b?c[b]:null},getDOMSettings:function(b){return b?this.DOMStorage.getSavedMediaSettings(b):null},setSwitchMode:function(b,c){MediaPlayer.dependencies.MediaController.trackSwitchModes[c]?e[b]=c:this.log("track switch mode is not supported: "+c)},getSwitchMode:function(b){return e[b]},setSelectionModeForInitialTrack:function(b){MediaPlayer.dependencies.MediaController.trackSelectionModes[b]?d=b:this.log("track selection mode is not supported: "+b)},getSelectionModeForInitialTrack:function(){return d||
MediaPlayer.dependencies.MediaController.DEFAULT_INIT_TRACK_SELECTION_MODE},isMultiTrackSupportedByType:function(b){return"audio"===b||"video"===b||"text"===b||"fragmentedText"===b||"608"===b},isTracksEqual:function(b,c){var d=b.viewpoint===c.viewpoint,e=b.lang===c.lang,g=void 0!=b.roles&&void 0!=c.roles?b.roles.toString()==c.roles.toString():!0,l=void 0!=b.accessibility&&void 0!=c.accessibility?b.accessibility.toString()==c.accessibility.toString():!0,k=void 0!=b.audioChannelConfiguration&&void 0!=
c.audioChannelConfiguration?b.audioChannelConfiguration.toString()==c.audioChannelConfiguration.toString():!0;return b.id===c.id&&d&&e&&g&&l&&k},reset:function(){k.call(this);b={};c={audio:null,video:null}}}};MediaPlayer.dependencies.MediaController.prototype={constructor:MediaPlayer.dependencies.MediaController};MediaPlayer.dependencies.MediaController.eventList={CURRENT_TRACK_CHANGED:"currenttrackchanged"};
MediaPlayer.dependencies.MediaController.trackSwitchModes={NEVER_REPLACE:"NEVER_REPLACE",ALWAYS_REPLACE:"ALWAYS_REPLACE"};MediaPlayer.dependencies.MediaController.trackSelectionModes={HIGHEST_BITRATE:"HIGHEST_BITRATE",WIDEST_RANGE:"WIDEST_RANGE"};MediaPlayer.dependencies.MediaController.DEFAULT_INIT_TRACK_SELECTION_MODE=MediaPlayer.dependencies.MediaController.trackSelectionModes.HIGHEST_BITRATE;MediaPlayer.dependencies.FragmentLoader=function(){var b=MediaPlayer.dependencies.FragmentLoader.RETRY_ATTEMPTS,c=MediaPlayer.dependencies.FragmentLoader.RETRY_INTERVAL,d=[],e=[Primetime.MimeTypeUtils.Extension.AAC,Primetime.MimeTypeUtils.Extension.TS,Primetime.MimeTypeUtils.Extension.DASH,Primetime.MimeTypeUtils.Extension.VTT,Primetime.MimeTypeUtils.Extension.WEBVTT,Primetime.MimeTypeUtils.Extension.M4S,Primetime.MimeTypeUtils.Extension.MP4,Primetime.MimeTypeUtils.Extension.M4A,Primetime.MimeTypeUtils.Extension.M4F,
Primetime.MimeTypeUtils.Extension.M4V,Primetime.MimeTypeUtils.Extension.XML,Primetime.MimeTypeUtils.Extension.TTML,Primetime.MimeTypeUtils.Extension.M3U8],g=function(b,k){var h=new XMLHttpRequest,f=[],n=!0,q=!0,t=!0,r=null,p=this,u=function(c,d){q=!1;var e=new Date,n=h.response,g,k=null;f.push({s:e,d:e.getTime()-r.getTime(),b:[n?n.byteLength:0]});c.firstByteDate||(c.firstByteDate=c.requestStartDate);c.requestEndDate=e;e=c.firstByteDate.getTime()-c.requestStartDate.getTime();g=c.requestEndDate.getTime()-
c.firstByteDate.getTime();p.log((d?"loaded ":"failed ")+c.mediaType+":"+c.type+":"+c.startTime+" ("+h.status+", "+e+"ms, "+g+"ms)");k=p.metricsModel.addHttpRequest(b.mediaType,null,b.type,b.url,h.responseURL||null,b.range,b.requestStartDate,c.firstByteDate,c.requestEndDate,h.status,b.duration,h.getAllResponseHeaders());d&&f.forEach(function(b){p.metricsModel.appendHttpTrace(k,b.s,b.d,b.b)});if((e=p.system.getObject("mediaPlayer"))&&"function"===typeof e.notifyLoadInfo){var m={};m.type=AdobePSDK.LoadInformationType.FRAGMENT;
m.url=b.url;m.periodIndex=b.mediaInfo.streamInfo.index;m.sizeBytes=n?n.byteLength:0;m.downloadTime=g;isNaN(b.duration)?m.mediaDuration=0:m.mediaDuration=1E3*b.duration;"audio"===b.mediaType&&(n=b.mediaInfo.index,g=b.mediaInfo.name,m.type=AdobePSDK.LoadInformationType.TRACK,m.trackType="audio",m.trackName=g,m.trackIndex=n);e.notifyLoadInfo(m)}};d.push(h);b.requestStartDate=new Date;f.push({s:b.requestStartDate,d:0,b:[0]});r=b.requestStartDate;h.open("GET",p.requestModifierExt.modifyRequestURL(b.url),
!0);h.responseType="arraybuffer";var h=p.requestModifierExt.modifyRequestHeader(h),w=this.system.getObject("mediaPlayer"),v=w.getNetworkConfig(),x=w.getCORSConfig();w&&v&&x&&x.enableEncryptionRequest&&v.useCookieHeaderForAllRequests&&(h.withCredentials=!0);b.range&&h.setRequestHeader("Range","bytes="+b.range);h.onprogress=function(c){var d=new Date;n&&(n=!1,!c.lengthComputable||c.lengthComputable&&c.total!=c.loaded)&&(b.firstByteDate=d);c.lengthComputable&&(b.bytesLoaded=c.loaded,b.bytesTotal=c.total);
f.push({s:d,d:d.getTime()-r.getTime(),b:[h.response?h.response.byteLength:0]});r=d;p.notify(MediaPlayer.dependencies.FragmentLoader.eventList.ENAME_LOADING_PROGRESS,{request:b})};h.onload=function(){if(!(200>h.status||299<h.status)){var c=Primetime.MimeTypeUtils.validateResponse(h.responseURL?h.responseURL:b.url,h.getResponseHeader("Content-Type"),e);-1===c?(t=!1,k=0):(t=!0,b.extension=e[c],u(b,!0),p.notify(MediaPlayer.dependencies.FragmentLoader.eventList.ENAME_LOADING_COMPLETED,{request:b,response:h.response}))}};
h.onloadend=h.onerror=function(){-1!==d.indexOf(h)&&(d.splice(d.indexOf(h),1),q&&(u(b,!1),0<k?(p.log("Failed loading fragment: "+b.mediaType+":"+b.type+":"+b.startTime+", retry in "+c+"ms attempts: "+k),k--,setTimeout(function(){g.call(p,b,k)},c)):t?(p.log("Failed loading fragment: "+b.mediaType+":"+b.type+":"+b.startTime+" no retry attempts left"),p.notify(MediaPlayer.dependencies.FragmentLoader.eventList.ENAME_LOADING_COMPLETED,{request:b,bytes:null,xhrRequest:h},new MediaPlayer.vo.Error(null,"failed loading fragment",
null))):(p.log("Incorrect content type received for segment: "+b.url),p.notify(MediaPlayer.dependencies.FragmentLoader.eventList.ENAME_LOADING_COMPLETED,{request:b,bytes:null,xhrRequest:h},new MediaPlayer.vo.Error(null,"contentMismatch",null)))))};h.send()},k=function(b){var c=this,d=new XMLHttpRequest,f=!1;d.open("HEAD",b.url,!0);d.onload=function(){200>d.status||299<d.status||(f=!0,c.notify(MediaPlayer.dependencies.FragmentLoader.eventList.ENAME_CHECK_FOR_EXISTENCE_COMPLETED,{request:b,exists:!0}))};
d.onloadend=d.onerror=function(){f||c.notify(MediaPlayer.dependencies.FragmentLoader.eventList.ENAME_CHECK_FOR_EXISTENCE_COMPLETED,{request:b,exists:!1})};var e=this.system.getObject("mediaPlayer"),g=e.getNetworkConfig(),k=e.getCORSConfig();e&&g&&k&&k.enableEncryptionRequest&&g.useCookieHeaderForAllRequests&&(d.withCredentials=!0);d.send()};return{metricsModel:void 0,errHandler:void 0,log:void 0,requestModifierExt:void 0,notify:void 0,subscribe:void 0,unsubscribe:void 0,system:void 0,load:function(c){c?
g.call(this,c,b):this.notify(MediaPlayer.dependencies.FragmentLoader.eventList.ENAME_LOADING_COMPLETED,{request:c,bytes:null},new MediaPlayer.vo.Error(null,"request is null",null))},checkForExistence:function(b){b?k.call(this,b):this.notify(MediaPlayer.dependencies.FragmentLoader.eventList.ENAME_CHECK_FOR_EXISTENCE_COMPLETED,{request:b,exists:!1})},abort:function(){var b,c,e=d.length;for(b=0;b<e;b+=1)c=d[b],d[b]=null,c.abort();d=[]}}};MediaPlayer.dependencies.FragmentLoader.RETRY_ATTEMPTS=3;
MediaPlayer.dependencies.FragmentLoader.RETRY_INTERVAL=500;MediaPlayer.dependencies.FragmentLoader.prototype={constructor:MediaPlayer.dependencies.FragmentLoader};MediaPlayer.dependencies.FragmentLoader.eventList={ENAME_LOADING_COMPLETED:"loadingCompleted",ENAME_LOADING_PROGRESS:"loadingProgress",ENAME_CHECK_FOR_EXISTENCE_COMPLETED:"checkForExistenceCompleted"};MediaPlayer.dependencies.FragmentModel=function(){var b=null,c=[],d=[],e,g=function(b){this.notify(MediaPlayer.dependencies.FragmentModel.eventList.ENAME_FRAGMENT_LOADING_STARTED,{request:b});this.fragmentLoader.load(b)},k=function(b,c,d){var f=b.length-1,e=NaN,h=NaN,g=null;for(d=d||0;0<=f;--f)if(g=b[f],e=g.startTime,h=e+g.duration,!isNaN(e)&&!isNaN(h)&&c+d>=e&&c-d<h||isNaN(e)&&isNaN(c))return g;return null},l=function(b,c){return c?c.hasOwnProperty("time")?[k.call(this,b,c.time,c.threshold)]:b.filter(function(b){for(var d in c)if("state"!==
d&&c.hasOwnProperty(d)&&b[d]!=c[d])return!1;return!0}):b},m=function(b,f){if(b){var e=b.mediaType;this.metricsModel.addSchedulingInfo(e,new Date,b.type,b.startTime,b.availabilityStartTime,b.duration,b.quality,b.range,f);this.metricsModel.addRequestsQueue(e,d,c)}},h=function(b){var f=b.data.request,e=b.data.response,h=b.data.xhrRequest;b=b.error;d.splice(d.indexOf(f),1);e&&!b&&c.push(f);m.call(this,f,b?MediaPlayer.dependencies.FragmentModel.states.FAILED:MediaPlayer.dependencies.FragmentModel.states.EXECUTED);
this.notify(MediaPlayer.dependencies.FragmentModel.eventList.ENAME_FRAGMENT_LOADING_COMPLETED,{request:f,response:e,xhrRequest:h},b)},f=function(){void 0!==e&&clearTimeout(e)};return{system:void 0,log:void 0,metricsModel:void 0,notify:void 0,subscribe:void 0,unsubscribe:void 0,manifestExt:void 0,setup:function(){this[MediaPlayer.dependencies.FragmentLoader.eventList.ENAME_LOADING_COMPLETED]=h;this[MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_SEEKING]=f},setLoader:function(b){this.fragmentLoader=
b},setContext:function(c){b=c},getContext:function(){return b},isFragmentLoaded:function(b){var f=function(c){var d,f=!1,e=c.length,h;for(h=0;h<e;h+=1){d=c[h];var g;if(!(g=b.url===d.url&&b.startTime===d.startTime)){g=b;var l=d;g=isNaN(g.index)&&isNaN(l.index)&&g.quality===l.quality}if(g||"complete"===b.action&&b.action===d.action){f=!0;break}}return f};return f(d)||f(c)},getRequests:function(b){var f=[],e=[],h,g=1;if(!b||!b.state)return f;b.state instanceof Array?(g=b.state.length,h=b.state):h=[b.state];
for(var k=0;k<g;k+=1){f=void 0;switch(h[k]){case MediaPlayer.dependencies.FragmentModel.states.LOADING:f=d;break;case MediaPlayer.dependencies.FragmentModel.states.EXECUTED:f=c;break;default:f=[]}e=e.concat(l.call(this,f,b))}return e},removeExecutedRequestsBeforeTime:function(b){var d=NaN,f=null,e;for(e=c.length-1;0<=e;--e)f=c[e],d=f.startTime,!isNaN(d)&&d<b&&(d=c,f=d.indexOf(f),-1!==f&&d.splice(f,1))},abortRequests:function(){var b=[];for(this.fragmentLoader.abort();0<d.length;){b.push(d[0]);var c=
d,f=c.indexOf(d[0]);-1!==f&&c.splice(f,1)}d=[];return b},executeRequest:function(b){var f=this,h=(new Date).getTime();if(b)if(h<b.delayLoadingTime)e=setTimeout(function(){f.executeRequest(b)},b.delayLoadingTime-h);else switch(b.action){case "complete":c.push(b);m.call(f,b,MediaPlayer.dependencies.FragmentModel.states.EXECUTED);f.notify(MediaPlayer.dependencies.FragmentModel.eventList.ENAME_STREAM_COMPLETED,{request:b});break;case "download":d.push(b);m.call(f,b,MediaPlayer.dependencies.FragmentModel.states.LOADING);
g.call(f,b);break;default:this.log("Unknown request action.")}},reset:function(){this.abortRequests();b=null;c=[];d=[]}}};MediaPlayer.dependencies.FragmentModel.prototype={constructor:MediaPlayer.dependencies.FragmentModel};MediaPlayer.dependencies.FragmentModel.eventList={ENAME_STREAM_COMPLETED:"streamCompleted",ENAME_FRAGMENT_LOADING_STARTED:"fragmentLoadingStarted",ENAME_FRAGMENT_LOADING_COMPLETED:"fragmentLoadingCompleted"};
MediaPlayer.dependencies.FragmentModel.states={PENDING:"pending",LOADING:"loading",EXECUTED:"executed",REJECTED:"rejected",CANCELED:"canceled",FAILED:"failed"};MediaPlayer.dependencies.StreamController=function(){var b=[],c,d,e=!1,g,k=.5,l=!0,m=!1,h=!1,f=!1,n=!1,q=!0,t,r,p=!1,u=!0,w=!1,v=!1,x=!0,y=!0,E=function(b){this.system.getObject("mediaController").subscribe(MediaPlayer.dependencies.MediaController.eventList.CURRENT_TRACK_CHANGED,b);b.subscribe(MediaPlayer.dependencies.Stream.eventList.ENAME_STREAM_UPDATED,this.liveEdgeFinder);b.subscribe(MediaPlayer.dependencies.Stream.eventList.ENAME_STREAM_BUFFERING_COMPLETED,this)},z=function(b){b.unsubscribe(MediaPlayer.dependencies.Stream.eventList.ENAME_STREAM_UPDATED,
this.liveEdgeFinder);b.unsubscribe(MediaPlayer.dependencies.Stream.eventList.ENAME_STREAM_BUFFERING_COMPLETED,this)},D=function(b,c,d){this.eventBus.dispatchEvent({type:b,data:{fromStreamInfo:c?c.getStreamInfo():null,toStreamInfo:d.getStreamInfo()}})},A=function(){c.isActivated()&&m&&0===c.getStreamInfo().index&&(c.startEventController(),l&&this.playbackController.start())},F=function(){m=!0;A.call(this)},H=function(b){var d=b.data.error?b.data.error.code:0,f="";if(-1!==d){switch(d){case 1:f="MEDIA_ERR_ABORTED";
break;case 2:f="MEDIA_ERR_NETWORK";break;case 3:case 4:f=3===d?"MEDIA_ERR_DECODE":"MEDIA_ERR_SRC_NOT_SUPPORTED";if(J()){this.log(f+" trying with next stream");b.error&&this.log(b.error);K.call(this,c,J());return}break;case 5:f="MEDIA_ERR_ENCRYPTED";break;default:f="UNKNOWN"}n=!0;this.log("Video Element Error: "+f);b.error&&this.log(b.error);this.errHandler.mediaSourceError(f);this.reset()}},B=function(b){var d=c.hasMedia("muxed"),f=this.videoExt.getPlaybackQuality(this.videoModel.getElement());f&&
(d?this.metricsModel.addDroppedFrames("muxed",f):c.hasMedia("video")&&this.metricsModel.addDroppedFrames("video",f));!this.playbackController.isSeeking()&&b.data.timeToEnd<k&&!w&&!v&&(d=this.manifestModel.getValue(),b=J(),d&&this.manifestExt.getIsDynamic(d)&&!b&&!c.getStreamInfo().stopUpdates?(v=!0,console.log("There no next stream to switch.")):this.mediaSourceExt.signalEndOfStream(t)&&(w=!0))},G=function(){if(this.getActiveStreamInfo().isLast)this.system.getObject("mediaPlayer").notify(Primetime.MediaPlayerImpl.Events.ENAME_VIRTUAL_TIMELINE_ITEM_COMPLETED_PLAYING);
else if(null!==c){var d=J();d&&(console.log("SSAI: switching stream on ended: "+d.getStreamInfo().id+" last stream id: "+b[b.length-1].getStreamInfo().id),void 0!=d.getStreamInfo().seekTimeBeforePlay&&0!=d.getStreamInfo().seekTimeBeforePlay?(K.call(this,c,d,d.getStreamInfo().start+d.getStreamInfo().seekTimeBeforePlay),d.getStreamInfo().seekTimeBeforePlay=void 0):K.call(this,c,d))}},C=function(b){var d=M(b.data.seekTime+.1);d&&d.getId()!==c.getId()&&(this.getActiveStreamInfo().isLast?(K.call(this,
c,d,b.data.seekTime),this.system.getObject("mediaPlayer").notify(Primetime.MediaPlayerImpl.Events.ENAME_VIRTUAL_TIMELINE_ITEM_ON_SEEKING,1E3*b.data.seekTime)):K.call(this,c,d,b.data.seekTime))},I=function(b){var c=J();b=b.data.streamInfo.isLast;t&&b&&this.playbackController.getTimeToStreamEnd()<k&&this.mediaSourceExt.signalEndOfStream(t);c&&!this.getActiveStreamInfo().isLast&&(c.getStreamInfo().manifestInfo.isDynamic&&c.getStreamInfo().manifestInfo.hasDiscontinuity||x&&c.activate(t,!1))},J=function(){if(c){for(var d=
c.getId(),f=0,e=0;e<b.length;e++)if(b[e].getStreamInfo().id===d){f=e;break}return b[f+1]}return null},M=function(c){var d=0,f=null,e=b.length;0<e&&(d+=b[0].getStartTime());c=Number(c.toFixed(4));for(var h=0;h<e;h++)if(f=b[h],d+=f.getDuration(),d=Number(d.toFixed(4)),c<d)return f;return c<=d+2&&f.getStreamInfo().manifestInfo.isDynamic?f:null},K=function(b,d,f,e){void 0===e&&(e=!0);if(!h&&b&&d&&b!==d){h=!0;D.call(this,MediaPlayer.events.STREAM_SWITCH_STARTED,b,d);var g=this,n=function(){void 0!==f&&
g.playbackController.seek(f);e&&g.playbackController.start();c.startEventController();w=h=!1;D.call(g,MediaPlayer.events.STREAM_SWITCH_COMPLETED,b,d)};setTimeout(function(){z.call(g,b);b.deactivate();c=d;E.call(g,d);g.playbackController.initialize(c.getStreamInfo());L.call(g,n)},0)}},L=function(b){var d=this,f,e=function(h){d.log("MediaSource is open!");d.log(h);window.URL.revokeObjectURL(f);t.removeEventListener("sourceopen",e);t.removeEventListener("webkitsourceopen",e);O.call(d);c.activate(t,!0);
b&&b()},h=function(){t.removeEventListener("sourceclose",h,!1);t.removeEventListener("webkitsourceclose",h,!1);t.addEventListener("sourceopen",e,!1);t.addEventListener("webkitsourceopen",e,!1);f=d.mediaSourceExt.attachMediaSource(t,d.videoModel)};t?(t.addEventListener("sourceclose",h,!1),t.addEventListener("webkitsourceclose",h,!1),d.videoModel.getCurrentTime(),d.mediaSourceExt.detachMediaSource(d.videoModel)):(t=d.mediaSourceExt.createMediaSource(),h())},O=function(){var b;b=c.getStreamInfo().manifestInfo.duration;
b=this.mediaSourceExt.setDuration(t,b);this.log("Duration successfully set to: "+b)},N=function(){var h=this,n=h.manifestModel.getValue(),l=h.metricsModel.getMetricsFor("stream"),l=h.metricsExt.getCurrentManifestUpdate(l),m,p,r,B,G,C,x=[],I;if(n){C=h.adapter.getStreamsInfo(n);this.capabilities.supportsEncryptedMedia()&&(d||(d=this.system.getObject("protectionController"),this.eventBus.dispatchEvent({type:MediaPlayer.events.PROTECTION_CREATED,data:{controller:d,manifest:n}}),e=!0),d.setMediaElement(this.videoModel.getElement()),
g&&d.setProtectionData(g));try{if(0===C.length)throw Error("There are no streams");h.metricsModel.updateManifestUpdateInfo(l,{currentTime:h.videoModel.getCurrentTime(),buffered:h.videoModel.getElement().buffered,presentationStartTime:C[0].start,clientTimeOffset:h.timelineConverter.getClientTimeOffset()});f=!0;B=0;for(p=C.length;B<p;B+=1){m=C[B];G=0;for(r=b.length;G<r;G+=1)b[G].getId()===m.id&&(I=b[G],x.push(I),I.updateData(m));I||(I=h.system.getObject("stream"),I.initialize(m,d,g),I.setScheduleControllerStartEnabled(u),
I.subscribe(MediaPlayer.dependencies.Stream.eventList.ENAME_STREAM_UPDATED,h),x.push(I),c&&I.updateData(m));h.metricsModel.addManifestUpdateStreamInfo(l,m.id,m.index,m.start,m.duration);I=null}b=x;if(q){if(c){if(!h.manifestExt.getIsDynamic(n)){var N=h.playbackController.getTime(),Q=M(N);y&&0===Q.getStreamIndex()&&Q!=c&&(y=!1,K.call(this,c,Q,N,!1))}h.manifestExt.getIsDynamic(n)&&v&&(J()||c.getStreamInfo().stopUpdates)&&(console.log("New stream is avalable to switch."),v=!1,h.playbackController.getTimeToStreamEnd()<
k&&!w?(console.log("Calling end of stream for current stream. Index: "+c.getStreamInfo().index),h.mediaSourceExt.signalEndOfStream(t)&&(console.log("Signalled end of stream."),w=!0)):console.log("But current stream is still not over. Index: "+c.getStreamInfo().index))}else c=b[0],c.getStreamInfo().manifestInfo.isDynamic&&1<b.length&&(c=b[b.length-1]),D.call(h,MediaPlayer.events.STREAM_SWITCH_STARTED,null,c),h.playbackController.initialize(c.getStreamInfo()),E.call(h,c),L.call(this,function(){D.call(h,
MediaPlayer.events.STREAM_SWITCH_COMPLETED,null,c)});f=!1;P.call(h)}}catch(z){h.errHandler.manifestError(z.message,"nostreamscomposed",n),h.reset()}}},P=function(){if(!f){var c=b.length,d=0;A.call(this);for(d;d<c;d+=1)if(!b[d].isInitialized())return;this.notify(MediaPlayer.dependencies.StreamController.eventList.ENAME_STREAMS_COMPOSED)}},R=function(){P.call(this)},Q=function(){N.call(this)},T=function(b){var c=this;if(b.error)c.reset();else{var d=b.data.manifest,f=!1;if(d.isHls)f=!0;else{var e=this.adapter.getStreamsInfo(d)[0];
if(e=this.adapter.getMediaInfoForType(d,e,"video")||this.adapter.getMediaInfoForType(d,e,"audio"))f=c.adapter.getDataForMedia(e),f=c.manifestExt.getRepresentationsForAdaptation(d,f)[0].useCalculatedLiveEdgeTime}f&&(c.log("SegmentTimeline/HLS detected using calculated Live Edge Time"),p=!1);b=c.manifestExt.getUTCTimingSources(b.data.manifest);var d=!c.manifestExt.getIsDynamic(d)||f?b:b.concat(r),h=c.uriQueryFragModel.isManifestHTTPS();d.forEach(function(b){b.value.replace(/.*?:\/\//g,"")===MediaPlayer.UTCTimingSources.default.value.replace(/.*?:\/\//g,
"")&&(b.value=b.value.replace(h?new RegExp(/^(http:)?\/\//i):new RegExp(/^(https:)?\/\//i),h?"https://":"http://"),c.log("Matching default timing source protocol to manifest protocol: ",b.value))});c.timeSyncController.initialize(d,p)}};return{system:void 0,capabilities:void 0,videoModel:void 0,manifestUpdater:void 0,manifestLoader:void 0,manifestModel:void 0,manifestExt:void 0,adapter:void 0,playbackController:void 0,log:void 0,metricsModel:void 0,metricsExt:void 0,videoExt:void 0,liveEdgeFinder:void 0,
mediaSourceExt:void 0,timelineConverter:void 0,protectionExt:void 0,timeSyncController:void 0,virtualBuffer:void 0,errHandler:void 0,eventBus:void 0,notify:void 0,subscribe:void 0,unsubscribe:void 0,uriQueryFragModel:void 0,getStreamForTime:M,setup:function(){this[MediaPlayer.dependencies.ManifestUpdater.eventList.ENAME_MANIFEST_UPDATED]=T;this[MediaPlayer.dependencies.Stream.eventList.ENAME_STREAM_UPDATED]=R;this[MediaPlayer.dependencies.Stream.eventList.ENAME_STREAM_BUFFERING_COMPLETED]=I;this[MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_SEEKING]=
C;this[MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_TIME_UPDATED]=B;this[MediaPlayer.dependencies.MediaSourceExtensions.eventList.ENAME_SOURCE_ENDED]=G;this[MediaPlayer.dependencies.TimeSyncController.eventList.ENAME_TIME_SYNCHRONIZATION_COMPLETED]=Q;this[MediaPlayer.dependencies.PlaybackController.eventList.ENAME_CAN_PLAY]=F;this[MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_ERROR]=H},getAutoPlay:function(){return l},getActiveStreamInfo:function(){return c?
c.getStreamInfo():null},isStreamActive:function(b){return c.getId()===b.id},setUTCTimingSources:function(b,c){r=b;p=c},getStreamById:function(c){return b.filter(function(b){return b.getId()===c})[0]},initialize:function(b,c,f){l=b;d=c;g=f;"undefined"!==typeof Primetime&&Primetime.BrowserExtensions.isIE()?k=.5:"undefined"!==typeof Primetime&&Primetime.BrowserExtensions.isFirefox()&&(k=2);this.timeSyncController.subscribe(MediaPlayer.dependencies.TimeSyncController.eventList.ENAME_TIME_SYNCHRONIZATION_COMPLETED,
this.timelineConverter);this.timeSyncController.subscribe(MediaPlayer.dependencies.TimeSyncController.eventList.ENAME_TIME_SYNCHRONIZATION_COMPLETED,this.liveEdgeFinder);this.timeSyncController.subscribe(MediaPlayer.dependencies.TimeSyncController.eventList.ENAME_TIME_SYNCHRONIZATION_COMPLETED,this);this.playbackController.subscribe(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_STARTED,this.manifestUpdater);this.mediaSourceExt.subscribe(MediaPlayer.dependencies.MediaSourceExtensions.eventList.ENAME_SOURCE_ENDED,
this);this.subscribe(MediaPlayer.dependencies.StreamController.eventList.ENAME_STREAMS_COMPOSED,this.manifestUpdater);this.manifestUpdater.subscribe(MediaPlayer.dependencies.ManifestUpdater.eventList.ENAME_MANIFEST_UPDATED,this);this.manifestUpdater.initialize(this.manifestLoader)},load:function(b){this.manifestLoader.load(b)},loadWithManifest:function(b){this.manifestUpdater.setManifest(b)},isUpdating:function(){return f},reset:function(){c&&z.call(this,c);var l=this.system.getObject("mediaController"),
k;this.timeSyncController.unsubscribe(MediaPlayer.dependencies.TimeSyncController.eventList.ENAME_TIME_SYNCHRONIZATION_COMPLETED,this.timelineConverter);this.timeSyncController.unsubscribe(MediaPlayer.dependencies.TimeSyncController.eventList.ENAME_TIME_SYNCHRONIZATION_COMPLETED,this.liveEdgeFinder);this.timeSyncController.unsubscribe(MediaPlayer.dependencies.TimeSyncController.eventList.ENAME_TIME_SYNCHRONIZATION_COMPLETED,this);this.timeSyncController.reset();for(var p=0,r=b.length;p<r;p++)k=b[p],
k.unsubscribe(MediaPlayer.dependencies.Stream.eventList.ENAME_STREAM_UPDATED,this),l.unsubscribe(MediaPlayer.dependencies.MediaController.eventList.CURRENT_TRACK_CHANGED,k),k.reset(n);b=[];this.unsubscribe(MediaPlayer.dependencies.StreamController.eventList.ENAME_STREAMS_COMPOSED,this.manifestUpdater);this.playbackController.unsubscribe(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_STARTED,this.manifestUpdater);this.playbackController.unsubscribe(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_PAUSED,
this.manifestUpdater);this.mediaSourceExt.unsubscribe(MediaPlayer.dependencies.MediaSourceExtensions.eventList.ENAME_SOURCE_ENDED,this);this.manifestUpdater.unsubscribe(MediaPlayer.dependencies.ManifestUpdater.eventList.ENAME_MANIFEST_UPDATED,this);this.manifestUpdater.reset();this.metricsModel.clearAllCurrentMetrics();var B=this.manifestModel.getValue()?this.manifestModel.getValue().url:null;this.manifestModel.setValue(null);this.timelineConverter.reset();this.liveEdgeFinder.reset();this.adapter.reset();
this.virtualBuffer.reset();f=v=w=h=!1;c=null;n=m=!1;y=q=!0;t&&(this.mediaSourceExt.detachMediaSource(this.videoModel),t=null);if(d)if(e){var l={},G=this;l[MediaPlayer.models.ProtectionModel.eventList.ENAME_TEARDOWN_COMPLETE]=function(){e=!1;g=d=null;B&&G.eventBus.dispatchEvent({type:MediaPlayer.events.PROTECTION_DESTROYED,data:B});G.notify(MediaPlayer.dependencies.StreamController.eventList.ENAME_TEARDOWN_COMPLETE)};d.protectionModel.subscribe(MediaPlayer.models.ProtectionModel.eventList.ENAME_TEARDOWN_COMPLETE,
l,void 0,!0);d.teardown()}else d.setMediaElement(null),g=d=null,this.notify(MediaPlayer.dependencies.StreamController.eventList.ENAME_TEARDOWN_COMPLETE);else this.notify(MediaPlayer.dependencies.StreamController.eventList.ENAME_TEARDOWN_COMPLETE);u=!0},deactivateStream:function(){c&&(z.call(this,c),c.deactivate(),c=null)},playStream:function(b){},activateStream:function(b){(b=this.getStreamById(b.id))&&b.isActivated()&&b.getId()===c.getId()&&c.startBuffering()},deactivateStreamController:function(){this.deactivateStream();
t&&(this.mediaSourceExt.detachMediaSource(this.videoModel),t=null);this.playbackController&&this.playbackController.stopListening();this.liveEdgeFinder&&this.liveEdgeFinder.reset();this.manifestUpdater&&this.manifestUpdater.reset();this.manifestLoader&&this.manifestLoader.reset();v=w=q=!1},activateStreamController:function(d){var f=this;this.playbackController&&this.playbackController.startListening();this.manifestUpdater&&this.manifestUpdater.initialize(this.manifestLoader);!c&&b&&0<b.length&&(c=
d?this.getStreamById(d.id):b[0],D.call(this,MediaPlayer.events.STREAM_SWITCH_STARTED,null,c),this.playbackController.initialize(c.getStreamInfo()),E.call(this,c),L.call(f,function(){D.call(f,MediaPlayer.events.STREAM_SWITCH_COMPLETED,null,c)}));q=!0;v=w=!1},setScheduleControllerStartEnabled:function(c){u=c;for(c=0;c<b.length;++c)b[c].setScheduleControllerStartEnabled(u)},seekTo:function(b){var c={data:{}};c.data.seekTime=b;C.call(this,c)},getStreams:function(){return b},getPreBuffering:function(){return x},
setPreBuffering:function(b){x=b},getActiveStreamCommonEarliestTime:function(){for(var b=[],d=c.getStreamProcessors(),f=0;d&&f<d.length;f++){var e=d[f].getIndexHandler().getEarliestTime();b.push(isNaN(e)?0:e)}return b.length?Math.min.apply(Math,b):0}}};MediaPlayer.dependencies.StreamController.prototype={constructor:MediaPlayer.dependencies.StreamController};MediaPlayer.dependencies.StreamController.eventList={ENAME_STREAMS_COMPOSED:"streamsComposed",ENAME_TEARDOWN_COMPLETE:"streamTeardownComplete"};MediaPlayer.dependencies.StreamProcessor=function(){var b,c=null,d=null,e=null,g=null,k=[],l=!1,m=!1;return{system:void 0,videoModel:void 0,indexHandler:void 0,liveEdgeFinder:void 0,timelineConverter:void 0,abrController:void 0,playbackController:void 0,baseURLExt:void 0,adapter:void 0,manifestModel:void 0,initialize:function(d,f,n,k,m){var r=this.system.getObject("representationController"),p=this.system.getObject("scheduleController"),u=this.liveEdgeFinder,w=this.abrController,v=this.indexHandler,
x=this.baseURLExt,y=this.playbackController;this.system.getObject("mediaController");var E=this.system.getObject("fragmentLoader"),z=this.system.getObject("video"===d||"audio"===d||"fragmentedText"===d||"muxed"===d?"bufferController":"textController");l=k.getStreamInfo().manifestInfo.isHls;c=k;e=d;g=m;b=c.getStreamInfo().manifestInfo.isDynamic;c.getStreamInfo().periodManifestInfo&&(b=c.getStreamInfo().periodManifestInfo.isDynamic);console.log("StreamProcessor: isDynamic: "+b+" streamValue.getStreamInfo().id "+
k.getStreamInfo().id);this.bufferController=z;this.scheduleController=p;this.representationController=r;this.fragmentController=f;this.fragmentLoader=E;d=this.system.getObject("timeline");r.subscribe(Dash.dependencies.RepresentationController.eventList.ENAME_DATA_UPDATE_COMPLETED,d);r.subscribe(Dash.dependencies.RepresentationController.eventList.ENAME_DATA_UPDATE_COMPLETED,z);l&&f.subscribe(MediaPlayer.dependencies.FragmentController.eventList.ENAME_INIT_FRAGMENT_LOADED,r);f.subscribe(MediaPlayer.dependencies.FragmentController.eventList.ENAME_INIT_FRAGMENT_LOADED,
z);"video"!=e&&"audio"!=e&&"fragmentedText"!=e&&"muxed"!=e&&r.subscribe(Dash.dependencies.RepresentationController.eventList.ENAME_DATA_UPDATE_COMPLETED,c);"video"===e||"audio"===e||"fragmentedText"===e||"muxed"===e?(w.subscribe(MediaPlayer.dependencies.AbrController.eventList.ENAME_QUALITY_CHANGED,r),w.subscribe(MediaPlayer.dependencies.AbrController.eventList.ENAME_QUALITY_CHANGED,z),w.subscribe(MediaPlayer.dependencies.AbrController.eventList.ENAME_QUALITY_CHANGED,p),u.subscribe(MediaPlayer.dependencies.LiveEdgeFinder.eventList.ENAME_LIVE_EDGE_SEARCH_COMPLETED,
this.timelineConverter),u.subscribe(MediaPlayer.dependencies.LiveEdgeFinder.eventList.ENAME_LIVE_EDGE_SEARCH_COMPLETED,r),u.subscribe(MediaPlayer.dependencies.LiveEdgeFinder.eventList.ENAME_LIVE_EDGE_SEARCH_COMPLETED,p),r.subscribe(Dash.dependencies.RepresentationController.eventList.ENAME_DATA_UPDATE_STARTED,p),r.subscribe(Dash.dependencies.RepresentationController.eventList.ENAME_DATA_UPDATE_COMPLETED,p),r.subscribe(Dash.dependencies.RepresentationController.eventList.ENAME_DATA_UPDATE_COMPLETED,
c),c.subscribe(MediaPlayer.dependencies.Stream.eventList.ENAME_STREAM_UPDATED,p),r.subscribe(Dash.dependencies.RepresentationController.eventList.ENAME_DATA_UPDATE_COMPLETED,y),f.subscribe(MediaPlayer.dependencies.FragmentController.eventList.ENAME_MEDIA_FRAGMENT_LOADED,z),f.subscribe(MediaPlayer.dependencies.FragmentController.eventList.ENAME_STREAM_COMPLETED,p),f.subscribe(MediaPlayer.dependencies.FragmentController.eventList.ENAME_STREAM_COMPLETED,z),z.subscribe(MediaPlayer.dependencies.BufferController.eventList.ENAME_BUFFER_LEVEL_STATE_CHANGED,
y),z.subscribe(MediaPlayer.dependencies.BufferController.eventList.ENAME_BUFFER_CLEARED,p),z.subscribe(MediaPlayer.dependencies.BufferController.eventList.ENAME_BYTES_APPENDED,p),z.subscribe(MediaPlayer.dependencies.BufferController.eventList.ENAME_BUFFER_LEVEL_UPDATED,r),z.subscribe(MediaPlayer.dependencies.BufferController.eventList.ENAME_BUFFER_LEVEL_STATE_CHANGED,p),z.subscribe(MediaPlayer.dependencies.BufferController.eventList.ENAME_BUFFER_LEVEL_UPDATED,p),z.subscribe(MediaPlayer.dependencies.BufferController.eventList.ENAME_INIT_REQUESTED,
p),z.subscribe(MediaPlayer.dependencies.BufferController.eventList.ENAME_BUFFERING_COMPLETED,c),z.subscribe(MediaPlayer.dependencies.BufferController.eventList.ENAME_QUOTA_EXCEEDED,p),z.subscribe(MediaPlayer.dependencies.BufferController.eventList.ENAME_BYTES_APPENDED,y),z.subscribe(MediaPlayer.dependencies.BufferController.eventList.ENAME_BUFFERING_COMPLETED,y),y.subscribe(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_PROGRESS,z),y.subscribe(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_TIME_UPDATED,
z),y.subscribe(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_RATE_CHANGED,z),y.subscribe(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_RATE_CHANGED,p),y.subscribe(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_SEEKING,z),y.subscribe(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_SEEKING,p),y.subscribe(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_STARTED,p),y.subscribe(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_EXPLICIT_SEEKING,
z),y.subscribe(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_EXPLICIT_SEEKING,p),b&&y.subscribe(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_WALLCLOCK_TIME_UPDATED,r),y.subscribe(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_WALLCLOCK_TIME_UPDATED,z),l||(x.subscribe(Dash.dependencies.BaseURLExtensions.eventList.ENAME_INITIALIZATION_LOADED,v),x.subscribe(Dash.dependencies.BaseURLExtensions.eventList.ENAME_SEGMENTS_LOADED,v))):z.subscribe(MediaPlayer.dependencies.TextController.eventList.ENAME_CLOSED_CAPTIONING_REQUESTED,
p);v.initialize(this);v.setCurrentTime(y.getStreamStartTime(this.getStreamInfo()));z.initialize(e,n,this);p.initialize(e,this);w.initialize(e,this);n=this.getFragmentModel();n.setLoader(E);n.subscribe(MediaPlayer.dependencies.FragmentModel.eventList.ENAME_FRAGMENT_LOADING_STARTED,f);n.subscribe(MediaPlayer.dependencies.FragmentModel.eventList.ENAME_FRAGMENT_LOADING_COMPLETED,f);n.subscribe(MediaPlayer.dependencies.FragmentModel.eventList.ENAME_STREAM_COMPLETED,f);n.subscribe(MediaPlayer.dependencies.FragmentModel.eventList.ENAME_FRAGMENT_LOADING_COMPLETED,
p);E.subscribe(MediaPlayer.dependencies.FragmentLoader.eventList.ENAME_LOADING_COMPLETED,n);E.subscribe(MediaPlayer.dependencies.FragmentLoader.eventList.ENAME_LOADING_PROGRESS,w);r.initialize(this)},isUpdating:function(){return this.representationController.isUpdating()},getType:function(){return e},updateType:function(b){this.abrController.reset();this.abrController.initialize(b,this);this.indexHandler.setType(b);this.representationController.clearMetricsForType(this._type);this.bufferController.setNewType(b);
var c=this.system.getObject("mediaController");"function"==typeof c.resetForStream&&c.resetForStream(e,this.getStreamInfo());c.addTrack(d,this.getStreamInfo());c.checkInitialMediaSettings(this.getStreamInfo());this._type=e=b},getABRController:function(){return this.abrController},getFragmentLoader:function(){return this.fragmentLoader},getBuffer:function(){return this.bufferController.getBuffer()},setBuffer:function(b){this.bufferController.setBuffer(b)},getFragmentModel:function(){return this.scheduleController.getFragmentModel()},
getStreamInfo:function(){return c.getStreamInfo()},updateMediaInfo:function(b,c){c===d||c&&d&&c.type!==d.type||(d=c);-1===k.indexOf(c)&&k.push(c);this.adapter.updateData(b,this);b.isHls&&!c.codecStr&&"text"!=c.type&&(m=!0)},getMediaInfoArr:function(){return k},getMediaInfo:function(){return d},setNewMediaInfo:function(b,c,e){d=b;m=!1;this.representationController.updateRepInfo(b,c,e);this.getStream().onMediaInfoUpdated()},getMediaSource:function(){return this.bufferController.getMediaSource()},getScheduleController:function(){return this.scheduleController},
getEventController:function(){return g},start:function(){this.scheduleController.start()},stop:function(){this.scheduleController.stop()},getIndexHandlerTime:function(){return this.adapter.getIndexHandlerTime(this)},setIndexHandlerTime:function(b){this.adapter.setIndexHandlerTime(this,b)},getCurrentRepresentationInfo:function(){return this.adapter.getCurrentRepresentationInfo(this.manifestModel.getValue(),this.representationController)},getRepresentationInfoForQuality:function(b){return this.adapter.getRepresentationInfoForQuality(this.manifestModel.getValue(),
this.representationController,b,e)},isBufferingCompleted:function(){return this.bufferController.isBufferingCompleted()},isCodecInfoPending:function(){return m},createBuffer:function(){return this.bufferController.getBuffer()||this.bufferController.createBuffer(d)},enableBuffering:function(){this.bufferController&&this.bufferController.enableBuffering()},isDynamic:function(){return b},reset:function(h){var f=this.bufferController,n=this.representationController,k=this.scheduleController,t=this.liveEdgeFinder,
r=this.fragmentController,p=this.abrController,u=this.playbackController;this.system.getObject("mediaController");var w=this.indexHandler,v=this.baseURLExt,x=this.getFragmentModel(),y=this.fragmentLoader;p.unsubscribe(MediaPlayer.dependencies.AbrController.eventList.ENAME_QUALITY_CHANGED,f);p.unsubscribe(MediaPlayer.dependencies.AbrController.eventList.ENAME_QUALITY_CHANGED,n);p.unsubscribe(MediaPlayer.dependencies.AbrController.eventList.ENAME_QUALITY_CHANGED,k);t.unsubscribe(MediaPlayer.dependencies.LiveEdgeFinder.eventList.ENAME_LIVE_EDGE_SEARCH_COMPLETED,
this.timelineConverter);t.unsubscribe(MediaPlayer.dependencies.LiveEdgeFinder.eventList.ENAME_LIVE_EDGE_SEARCH_COMPLETED,k);t.unsubscribe(MediaPlayer.dependencies.LiveEdgeFinder.eventList.ENAME_LIVE_EDGE_SEARCH_COMPLETED,n);n.unsubscribe(Dash.dependencies.RepresentationController.eventList.ENAME_DATA_UPDATE_STARTED,k);n.unsubscribe(Dash.dependencies.RepresentationController.eventList.ENAME_DATA_UPDATE_COMPLETED,f);n.unsubscribe(Dash.dependencies.RepresentationController.eventList.ENAME_DATA_UPDATE_COMPLETED,
k);n.unsubscribe(Dash.dependencies.RepresentationController.eventList.ENAME_DATA_UPDATE_COMPLETED,c);n.unsubscribe(Dash.dependencies.RepresentationController.eventList.ENAME_DATA_UPDATE_COMPLETED,u);c.unsubscribe(MediaPlayer.dependencies.Stream.eventList.ENAME_STREAM_UPDATED,k);r.unsubscribe(MediaPlayer.dependencies.FragmentController.eventList.ENAME_INIT_FRAGMENT_LOADED,f);l&&r.unsubscribe(MediaPlayer.dependencies.FragmentController.eventList.ENAME_INIT_FRAGMENT_LOADED,n);r.unsubscribe(MediaPlayer.dependencies.FragmentController.eventList.ENAME_MEDIA_FRAGMENT_LOADED,
f);r.unsubscribe(MediaPlayer.dependencies.FragmentController.eventList.ENAME_MEDIA_FRAGMENT_LOADING_START,k);r.unsubscribe(MediaPlayer.dependencies.FragmentController.eventList.ENAME_STREAM_COMPLETED,k);r.unsubscribe(MediaPlayer.dependencies.FragmentController.eventList.ENAME_STREAM_COMPLETED,f);r.unsubscribe(MediaPlayer.dependencies.FragmentController.eventList.ENAME_STREAM_COMPLETED,k.scheduleRulesCollection.bufferLevelRule);f.unsubscribe(MediaPlayer.dependencies.BufferController.eventList.ENAME_BUFFER_LEVEL_STATE_CHANGED,
u);f.unsubscribe(MediaPlayer.dependencies.BufferController.eventList.ENAME_BUFFER_CLEARED,k);f.unsubscribe(MediaPlayer.dependencies.BufferController.eventList.ENAME_BYTES_APPENDED,k);f.unsubscribe(MediaPlayer.dependencies.BufferController.eventList.ENAME_BUFFER_LEVEL_UPDATED,k);f.unsubscribe(MediaPlayer.dependencies.BufferController.eventList.ENAME_BUFFER_LEVEL_UPDATED,n);f.unsubscribe(MediaPlayer.dependencies.BufferController.eventList.ENAME_BUFFER_LEVEL_STATE_CHANGED,k);f.unsubscribe(MediaPlayer.dependencies.BufferController.eventList.ENAME_INIT_REQUESTED,
k);f.unsubscribe(MediaPlayer.dependencies.BufferController.eventList.ENAME_BUFFERING_COMPLETED,c);f.unsubscribe(MediaPlayer.dependencies.BufferController.eventList.ENAME_CLOSED_CAPTIONING_REQUESTED,k);f.unsubscribe(MediaPlayer.dependencies.BufferController.eventList.ENAME_BYTES_APPENDED,u);f.unsubscribe(MediaPlayer.dependencies.BufferController.eventList.ENAME_BUFFERING_COMPLETED,u);u.unsubscribe(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_PROGRESS,f);u.unsubscribe(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_TIME_UPDATED,
f);u.unsubscribe(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_RATE_CHANGED,f);u.unsubscribe(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_RATE_CHANGED,k);u.unsubscribe(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_SEEKING,f);u.unsubscribe(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_SEEKING,k);u.unsubscribe(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_STARTED,k);u.unsubscribe(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_WALLCLOCK_TIME_UPDATED,
n);u.unsubscribe(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_WALLCLOCK_TIME_UPDATED,f);u.unsubscribe(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_EXPLICIT_SEEKING,f);u.unsubscribe(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_EXPLICIT_SEEKING,k);l||(v.unsubscribe(Dash.dependencies.BaseURLExtensions.eventList.ENAME_INITIALIZATION_LOADED,w),v.unsubscribe(Dash.dependencies.BaseURLExtensions.eventList.ENAME_SEGMENTS_LOADED,w));x.unsubscribe(MediaPlayer.dependencies.FragmentModel.eventList.ENAME_FRAGMENT_LOADING_STARTED,
r);x.unsubscribe(MediaPlayer.dependencies.FragmentModel.eventList.ENAME_FRAGMENT_LOADING_COMPLETED,r);x.unsubscribe(MediaPlayer.dependencies.FragmentModel.eventList.ENAME_STREAM_COMPLETED,r);x.unsubscribe(MediaPlayer.dependencies.FragmentModel.eventList.ENAME_FRAGMENT_LOADING_COMPLETED,k);y.unsubscribe(MediaPlayer.dependencies.FragmentLoader.eventList.ENAME_LOADING_COMPLETED,x);y.unsubscribe(MediaPlayer.dependencies.FragmentLoader.eventList.ENAME_LOADING_PROGRESS,p);x.reset();w.reset();this.bufferController.reset(h);
this.scheduleController.reset();this.fragmentController=this.videoModel=this.representationController=this.scheduleController=this.bufferController=null;b=void 0;g=e=d=c=null;m=!1}}};MediaPlayer.dependencies.StreamProcessor.prototype={constructor:MediaPlayer.dependencies.StreamProcessor};MediaPlayer.dependencies.ScheduleController=function(){var b=0,c,d,e,g,k,l=!0,m=!1,h=null,f=null,n=!0,q=!1,t=!1,r=0,p,u=NaN,w=!0,v=[],x=Number.MAX_VALUE,y,E=function(b,c){var d=0,d=null;!1===n&&(d=f.start,d=b.getTime()-d.getTime(),f.duration=d,f.stopreason=c,n=!0)},z=function(){w&&d&&(m=!1,l&&(S.call(this,MediaPlayer.vo.metrics.PlayList.INITIAL_PLAY_START_REASON),l=!1),H.call(this),this.log("ScheduleController starting for "+c))},D=function(){w&&(l&&(F.call(this,k.quality),S.call(this,MediaPlayer.vo.metrics.PlayList.INITIAL_PLAY_START_REASON)),
z.call(this))},A=function(){m||(m=!0,this.log("stop"),clearInterval(p),E(new Date,MediaPlayer.vo.metrics.PlayList.Trace.USER_REQUEST_STOP_REASON))},F=function(b,c){var d;d=this.adapter.getInitRequest(this.streamProcessor,b,c);null!==d?q&&"text/vtt"!==d.mediaType?y=d:(t=q=!0,e.executeRequest(d)):t=q=!1;return d},H=function(){m||this.playbackController.isPaused()&&!this.scheduleWhilePaused||B.call(this,G.bind(this))},B=function(c){var d=this.scheduleRulesCollection.getRules(MediaPlayer.rules.ScheduleRulesCollection.prototype.FRAGMENTS_TO_SCHEDULE_RULES);
this.rulesController.applyRules(d,this.streamProcessor,c,b,function(b,c){b=b===MediaPlayer.rules.SwitchRequest.prototype.NO_CHANGE?0:b;return Math.max(b,c)})},G=function(c){var d=this;b=c.value;0<b&&!d.bufferController.getIsAppendingInProgress()&&!t&&!q?(q=!0,this.abrController.getPlaybackQuality(this.streamProcessor,C.bind(d,I.bind(d)))):p=setTimeout(function(){H.call(d)},1E3)},C=function(b){var c=this.scheduleRulesCollection.getRules(MediaPlayer.rules.ScheduleRulesCollection.prototype.NEXT_FRAGMENT_RULES);
this.rulesController.applyRules(c,this.streamProcessor,b,null,function(b,c){return c})},I=function(b){b.value?(b.value&&(isNaN(b.value.startTime)||0>=x||b.value.startTime+b.value.duration<x)&&e.executeRequest(b.value),"complete"===b.value.action&&(q=!1)):q=!1},J=function(b){if(c===b.data.mediaType&&this.streamProcessor.getStreamInfo().id===b.data.streamInfo.id){k=this.streamProcessor.getRepresentationInfoForQuality(b.data.newQuality);if(null===k||void 0===k)throw"Unexpected error! - currentRepresentationInfo is null or undefined";
E(new Date,MediaPlayer.vo.metrics.PlayList.Trace.REPRESENTATION_SWITCH_STOP_REASON)}},M=function(b){if(!b.error){var d;void 0!=b.data.currentRepresentation[c]&&(d=b.data.currentRepresentation[c].name);k=this.adapter.convertDataToTrack(this.manifestModel.getValue(),b.data.currentRepresentation,c,d)}},K=function(b){b.error||(k=this.streamProcessor.getCurrentRepresentationInfo(),g&&null===this.liveEdgeFinder.getLiveEdge()||(d=!0),d&&D.call(this))},L=function(b){b.data.fragmentModel===this.streamProcessor.getFragmentModel()&&
(this.stop(),this.log("Stream is complete"),E(new Date,MediaPlayer.vo.metrics.PlayList.Trace.END_OF_CONTENT_STOP_REASON))},O=function(b){q=!1;isNaN(b.data.request.index)&&(t=!1,y=void 0);y&&!q?(t=q=!0,e.executeRequest(y)):b.error&&H.call(this)},N=function(){U.call(this);H.call(this)},P=function(){A.call(this)},R=function(b){F.call(this,b.data.requiredQuality,b.data.chunk)},Q=function(b){e.removeExecutedRequestsBeforeTime(b.data.to);b.data.hasEnoughSpaceToAppend&&!this.bufferController.isBufferingCompleted()&&
z.call(this)},T=function(b){b.data.hasSufficientBuffer||this.playbackController.isSeeking()||(this.log("Stalling Buffer"),E(new Date,MediaPlayer.vo.metrics.PlayList.Trace.REBUFFERING_REASON))},V=function(){A.call(this)},S=function(b){var d=new Date,f=this.playbackController.getTime();E(d,MediaPlayer.vo.metrics.PlayList.Trace.USER_REQUEST_STOP_REASON);h=this.metricsModel.addPlayList(c,d,f,b)},U=function(){var b=this.playbackController.getTime(),c=this.playbackController.getPlaybackRate(),d=new Date;
!0===n&&k&&h&&(n=!1,f=this.metricsModel.appendPlayListTrace(h,k.id,null,d,b,null,c,null))},W=function(b){F.call(this,b.data.CCIndex)},X=function(){},Y=function(){z.call(this)},Z=function(b){if(k){var c=this.metricsModel.getMetricsFor("stream"),c=this.metricsExt.getCurrentManifestUpdate(c);u=b.data.seekTime;S.call(this,MediaPlayer.vo.metrics.PlayList.SEEK_START_REASON);this.metricsModel.updateManifestUpdateInfo(c,{latency:k.DVRWindow.end-this.playbackController.getTime()});g&&H.call(this);m&&this.start()}},
aa=function(){U.call(this)},ba=function(b){if(!b.error){b=b.data.liveEdge;var c=k.mediaInfo.streamInfo,f=b-this.playbackController.getLiveDelay(k.fragmentDuration,k.mediaInfo.streamInfo.manifestInfo.DVRWindowSize),e,h=this.metricsModel.getMetricsFor("stream"),h=this.metricsExt.getCurrentManifestUpdate(h),g=this.playbackController.getLiveStartTime();0>f&&(f=b);e=this.adapter.getFragmentRequestForTime(this.streamProcessor,k,f,{ignoreIsFinished:!0});if(null!=e){if(f=e.startTime,this.playbackController.resetSeekCompleteStatus(),
isNaN(g)||f>=g)this.playbackController.setLiveStartTime(f),this.streamProcessor.indexHandler.setCurrentTime(this.playbackController.getStreamStartTime(c)),this.metricsModel.updateManifestUpdateInfo(h,{currentTime:f,presentationStartTime:b,latency:b-f,clientTimeOffset:this.timelineConverter.getClientTimeOffset()})}else this.streamController.seekTo(f),this.playbackController.setLiveStartTime(b),this.metricsModel.updateManifestUpdateInfo(h,{currentTime:f,presentationStartTime:b,latency:b-f,clientTimeOffset:this.timelineConverter.getClientTimeOffset()});
d=!0;D.call(this)}};return{log:void 0,system:void 0,metricsModel:void 0,manifestModel:void 0,metricsExt:void 0,scheduleWhilePaused:void 0,timelineConverter:void 0,abrController:void 0,playbackController:void 0,streamController:void 0,adapter:void 0,scheduleRulesCollection:void 0,rulesController:void 0,numOfParallelRequestAllowed:void 0,setup:function(){this[MediaPlayer.dependencies.LiveEdgeFinder.eventList.ENAME_LIVE_EDGE_SEARCH_COMPLETED]=ba;this[MediaPlayer.dependencies.AbrController.eventList.ENAME_QUALITY_CHANGED]=
J;this[Dash.dependencies.RepresentationController.eventList.ENAME_DATA_UPDATE_STARTED]=P;this[Dash.dependencies.RepresentationController.eventList.ENAME_DATA_UPDATE_COMPLETED]=M;this[MediaPlayer.dependencies.Stream.eventList.ENAME_STREAM_UPDATED]=K;this[MediaPlayer.dependencies.FragmentModel.eventList.ENAME_FRAGMENT_LOADING_COMPLETED]=O;this[MediaPlayer.dependencies.FragmentController.eventList.ENAME_STREAM_COMPLETED]=L;this[MediaPlayer.dependencies.BufferController.eventList.ENAME_BUFFER_CLEARED]=
Q;this[MediaPlayer.dependencies.BufferController.eventList.ENAME_BYTES_APPENDED]=N;this[MediaPlayer.dependencies.BufferController.eventList.ENAME_BUFFER_LEVEL_STATE_CHANGED]=T;this[MediaPlayer.dependencies.BufferController.eventList.ENAME_INIT_REQUESTED]=R;this[MediaPlayer.dependencies.BufferController.eventList.ENAME_QUOTA_EXCEEDED]=V;this[MediaPlayer.dependencies.TextController.eventList.ENAME_CLOSED_CAPTIONING_REQUESTED]=W;this[MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_STARTED]=
Y;this[MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_SEEKING]=Z;this[MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_EXPLICIT_SEEKING]=X;this[MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_RATE_CHANGED]=aa},initialize:function(b,d){c=b;this.setMediaType(c);this.streamProcessor=d;this.fragmentController=d.fragmentController;this.liveEdgeFinder=d.liveEdgeFinder;this.bufferController=d.bufferController;g=d.isDynamic();e=this.fragmentController.getModel(this);
MediaPlayer.dependencies.ScheduleController.LOADING_REQUEST_THRESHOLD=this.numOfParallelRequestAllowed},getSeekTarget:function(){return u},setSeekTarget:function(b){u=b},getFragmentModel:function(){return e},setTimeToLoadDelay:function(b){r=b},getTimeToLoadDelay:function(){return r},replaceCanceledRequests:function(b){var c=b.length,d,f,h;for(h=0;h<c;h+=1){var n=b[h];this.log("Cancelling request: "+n.url+" for time: "+n.startTime);f=n.startTime;(d=this.adapter.getFragmentRequestForTime(this.streamProcessor,
k,f,{ignoreIsFinished:!0}))?(this.log("Replacing request  for time: "+f+"with: "+d.url+" start: "+d.startTime+" end: "+(d.startTime+d.duration)),e.executeRequest(d),g||h+1!==c||(f=this.streamProcessor.getIndexHandlerTime(),isNaN(f)&&this.streamProcessor.setIndexHandlerTime(d.startTime+d.duration))):v.push(n)}},reset:function(){A.call(this);e.abortRequests();this.fragmentController.detachModel(e);t=q=!1;r=b=0;u=NaN;y=void 0;v=[]},start:z,stop:A,setStartEnabled:function(b){w=b},setHoldAt:function(b){},
replaceRequests:function(){this.replaceCanceledRequests.call(this,v);v=[]},startBuffering:function(){D.call(this)}}};MediaPlayer.dependencies.ScheduleController.prototype={constructor:MediaPlayer.dependencies.ScheduleController};MediaPlayer.dependencies.ScheduleController.LOADING_REQUEST_THRESHOLD=0;MediaPlayer.dependencies.TimeSyncController=function(){var b=0,c=!1,d,e=function(b){var c=Date.parse(b);if(isNaN(c)){b=/^([0-9]{4})-([0-9]{2})-([0-9]{2})T([0-9]{2}):([0-9]{2})(?::([0-9]*)(\.[0-9]*)?)?(?:([+\-])([0-9]{2})([0-9]{2}))?/.exec(b);var d,c=Date.UTC(parseInt(b[1],10),parseInt(b[2],10)-1,parseInt(b[3],10),parseInt(b[4],10),parseInt(b[5],10),b[6]&&(parseInt(b[6],10)||0),b[7]&&1E3*parseFloat(b[7])||0);b[9]&&b[10]&&(d=60*parseInt(b[9],10)+parseInt(b[10],10),c+=("+"===b[8]?-1:1)*d*6E4);c=(new Date(c)).getTime()}return c},
g=function(b){return Date.parse(b)},k=function(b){return Date.parse(b)},l=function(b,c,d){d()},m=function(b,c,d){b=e(b);isNaN(b)?d():c(b)},h=function(b,c,d,f,e){var g=!1,n=new XMLHttpRequest,l=e?"HEAD":"GET",k=c.match(/\S+/g);c=k.shift();n.open(l,c);n.timeout=5E3;n.onload=function(){var c;200===n.status&&(c=e?n.getResponseHeader("Date"):n.response,c=b(c),isNaN(c)||(d(c),g=!0))};n.onloadend=function(){g||(g=!0,k.length?h(b,k.join(" "),d,f,e):f())};n.send()},f=function(b,c,d){h.call(this,k,b,c,d,!0)},
n={"urn:mpeg:dash:utc:http-head:2014":f,"urn:mpeg:dash:utc:http-xsdate:2014":h.bind(null,e),"urn:mpeg:dash:utc:http-iso:2014":h.bind(null,g),"urn:mpeg:dash:utc:direct:2014":m,"urn:mpeg:dash:utc:http-head:2012":f,"urn:mpeg:dash:utc:http-xsdate:2012":h.bind(null,e),"urn:mpeg:dash:utc:http-iso:2012":h.bind(null,g),"urn:mpeg:dash:utc:direct:2012":m,"urn:mpeg:dash:utc:http-ntp:2014":l,"urn:mpeg:dash:utc:ntp:2014":l,"urn:mpeg:dash:utc:sntp:2014":l},q=function(){var c=this.metricsModel.getReadOnlyMetricsFor("stream"),
c=this.metricsExt.getLatestMPDRequestHeaderValueByID(c,"Date"),c=null!==c?(new Date(c)).getTime():Number.NaN;isNaN(c)?t.call(this,!0):(b=c-(new Date).getTime(),t.call(this,!1,c/1E3,b))},t=function(b,d,f){c=!1;this.notify(MediaPlayer.dependencies.TimeSyncController.eventList.ENAME_TIME_SYNCHRONIZATION_COMPLETED,{time:d,offset:f},b?new MediaPlayer.vo.Error(MediaPlayer.dependencies.TimeSyncController.TIME_SYNC_FAILED_ERROR_CODE):null)},r=function(f,e){var h=this,g=e||0,l=f[g],k=function(b,c){var f=!b||
!c;f&&d?q.call(h):t.call(h,f,b,c)};c=!0;if(l)if(n.hasOwnProperty(l.schemeIdUri))n[l.schemeIdUri](l.value,function(c){var d=(new Date).getTime(),f=c-d;b=f;h.log("Local time:      "+new Date(d));h.log("Server time:     "+new Date(c));h.log("Difference (ms): "+f);k.call(h,c,f)},function(){r.call(h,f,g+1)});else r.call(h,f,g+1);else b=0,k.call(h)};return{log:void 0,notify:void 0,subscribe:void 0,unsubscribe:void 0,metricsModel:void 0,metricsExt:void 0,getOffsetToDeviceTimeMs:function(){return b},initialize:function(b,
f){d=f;c||r.call(this,b)},reset:function(){c=!1}}};MediaPlayer.dependencies.TimeSyncController.prototype={constructor:MediaPlayer.dependencies.TimeSyncController};MediaPlayer.dependencies.TimeSyncController.eventList={ENAME_TIME_SYNCHRONIZATION_COMPLETED:"timeSynchronizationComplete"};MediaPlayer.dependencies.TimeSyncController.TIME_SYNC_FAILED_ERROR_CODE=1;MediaPlayer.dependencies.Stream=function(){var b=[],c=!1,d=!1,e=null,g={},k=!1,l=!1,m,h,f=null,n=!0,q=!0,t=!1,r=!1,p=function(b){b.error&&(this.errHandler.mediaKeySessionError(b.error),this.log(b.error),this.reset())},u=function(c){var d=A.call(this,c.data.oldMediaInfo);if(d){var f=this.playbackController.getTime(),e=d.getBuffer(),h=c.data.newMediaInfo,g=this.manifestModel.getValue(),n=b.indexOf(d),l=d.getMediaSource();"fragmentedText"!==h.type?((c=c.data.oldMediaInfo)&&c.isTrickPlayTrack&&h&&!h.isTrickPlayTrack&&
this.sourceBufferExt.removeAll(e,l),d.reset(!0),w.call(this,h,g,l,{buffer:e,replaceIdx:n,currentTime:f}),this.playbackController.seek(this.playbackController.getTime())):(d.setIndexHandlerTime(f),d.updateMediaInfo(g,h))}},w=function(c,d,h,g){var l=this.system.getObject("streamProcessor"),k=this.adapter.getAllMediaInfoForType(d,e,c.type);l.initialize("text"===c.type?c.mimeType:c.type,this.fragmentController,h,this,f);l.getScheduleController().setStartEnabled(n);this.abrController.updateTopQualityIndex(c);
g?(l.setBuffer(g.buffer),b[g.replaceIdx]=l,l.setIndexHandlerTime(g.currentTime)):b.push(l);if("text"===c.type||"fragmentedText"===c.type){var m;for(h=0;h<k.length;h++)k[h].index===c.index&&(m=h),l.updateMediaInfo(d,k[h]);"fragmentedText"===c.type&&l.updateMediaInfo(d,k[m])}else l.updateMediaInfo(d,c);this.metricsModel.addDVRInfo(l.getType(),l.playbackController.getTime(),l.getStreamInfo().manifestInfo,{start:0,end:0},l.getStreamInfo());return l},v=function(b,c){var d=this.manifestModel.getValue(),
f=this.adapter.getAllMediaInfoForType(d,e,b),h=null;if(f&&0!==f.length&&f[0].type==b){"function"==typeof this.mediaController.resetForStream&&this.mediaController.resetForStream(b,e);for(var g=0,n=f.length;g<n;g+=1){h=f[g];d.isHls&&""===h.codecStr&&(t=!0);var l;a:{l=h;var k=l.type,m=void 0,m=void 0;if("text"!==k&&"fragmentedText"!==k&&"608"!==k)if(m=l.codec,this.log(k+" codec: "+m),l.contentProtection&&!this.capabilities.supportsEncryptedMedia())this.errHandler.capabilityError("encryptedmedia");else if(!this.capabilities.supportsCodec(this.videoModel.getElement(),
m)){m=k+"Codec ("+m+") is not supported.";this.log(m);l=!1;break a}l=!0}if(l||d.isHls&&""===h.codecStr){if("video"===b||"audio"===b||"muxed"===b)q=!1;this.mediaController.isMultiTrackSupportedByType(h.type)&&this.mediaController.addTrack(h,e)}}0!==this.mediaController.getTracksFor(b,e).length&&(this.mediaController.checkInitialMediaSettings(e),f=this.mediaController.getCurrentTrackFor(b,e),"608"!==f.type&&w.call(this,f,d,c))}else this.log("No "+b+" data.")},x=function(){var f=b.length,h=g.audio||
g.video?new MediaPlayer.vo.Error(MediaPlayer.dependencies.Stream.DATA_UPDATE_FAILED_ERROR_CODE,"Data update failed",null):null,n=0;for(n;n<f;n+=1)if(b[n].isUpdating()||k)return;l=!0;this.eventBus.dispatchEvent({type:MediaPlayer.events.STREAM_INITIALIZED,data:{streamInfo:e}});this.notify(MediaPlayer.dependencies.Stream.eventList.ENAME_STREAM_UPDATED,{streamInfo:e},h);d&&!c&&(m.init(this.manifestModel.getValue(),y.call(this,"audio"),y.call(this,"video")),c=!0)},y=function(c){for(var d=b.length,f=null,
e=0;e<d;e+=1)if(f=b[e],f.getType()===c)return f.getMediaInfo();return null},E=function(){for(var c=0,d=b.length;c<d;c+=1)b[c].createBuffer();c=0;for(d=b.length;c<d;c+=1)"608"!==b[c].getType()&&b[c].enableBuffering()},z=function(){var b=F(),c=b.length,d=0;for(d;d<c;d+=1)if(!b[d].isBufferingCompleted())return;this.notify(MediaPlayer.dependencies.Stream.eventList.ENAME_STREAM_BUFFERING_COMPLETED,{streamInfo:e})},D=function(b){var c;c=void 0!==b.sender.streamProcessor&&null!==b.sender.streamProcessor?
b.sender.streamProcessor.getType():b.data.type;g[c]=b.error;x.call(this)},A=function(b){return b?F.call(this).filter(function(c){return c.getType()===b.type})[0]:!1},F=function(){var c=[],d=0,f=b.length,e,h;for(d;d<f;d+=1)h=b[d],e=h.getType(),"audio"!==e&&"video"!==e&&"muxed"!==e&&"fragmentedText"!==e||c.push(h);return c};return{system:void 0,eventBus:void 0,manifestModel:void 0,sourceBufferExt:void 0,adapter:void 0,videoModel:void 0,fragmentController:void 0,playbackController:void 0,mediaController:void 0,
capabilities:void 0,log:void 0,errHandler:void 0,liveEdgeFinder:void 0,abrController:void 0,notify:void 0,subscribe:void 0,unsubscribe:void 0,metricsModel:void 0,add608Track:function(b){v.call(this,"608",b);b=this.system.getObject("mediaPlayer");b.getCurrentItem().update(b.getTimeline())},setup:function(){this[MediaPlayer.dependencies.BufferController.eventList.ENAME_BUFFERING_COMPLETED]=z;this[Dash.dependencies.RepresentationController.eventList.ENAME_DATA_UPDATE_COMPLETED]=D;this[MediaPlayer.dependencies.MediaController.eventList.CURRENT_TRACK_CHANGED]=
u},initialize:function(b,c){e=b;m=c;h=p.bind(this);m.addEventListener(MediaPlayer.dependencies.ProtectionController.events.KEY_SYSTEM_SELECTED,h);m.addEventListener(MediaPlayer.dependencies.ProtectionController.events.SERVER_CERTIFICATE_UPDATED,h);m.addEventListener(MediaPlayer.dependencies.ProtectionController.events.KEY_ADDED,h);m.addEventListener(MediaPlayer.dependencies.ProtectionController.events.KEY_SESSION_CREATED,h);m.addEventListener(MediaPlayer.dependencies.ProtectionController.events.KEY_SYSTEM_SELECTED,
h);m.addEventListener(MediaPlayer.dependencies.ProtectionController.events.KEY_SYSTEM_SELECTED,h);m.addEventListener(MediaPlayer.dependencies.ProtectionController.events.LICENSE_REQUEST_COMPLETE,h)},activate:function(h,g){if(c)g&&!t&&E.call(this);else{var n=this.manifestModel.getValue(),l;f=this.system.getObject("eventController");l=this.adapter.getEventsFor(n,e);f.addInlineEvents(l);k=!0;d||(v.call(this,"video",h),v.call(this,"audio",h),v.call(this,"text",h),v.call(this,"fragmentedText",h),v.call(this,
"muxed",h),v.call(this,"608",h));r=g;q&&(l="Playback not possible due to unsupported media",this.errHandler.manifestError(l,"codec",n),this.log(l));if(g&&!t)E.call(this);else{l=0;for(var m=b.length;l<m;l+=1)b[l].setBuffer(null)}d=!0;k=!1;0===b.length?(l="No streams to play.",this.errHandler.manifestError(l,"nostreams",n),this.log(l)):(this.liveEdgeFinder.initialize(b[0]),this.liveEdgeFinder.subscribe(MediaPlayer.dependencies.LiveEdgeFinder.eventList.ENAME_LIVE_EDGE_SEARCH_COMPLETED,this.playbackController),
x.call(this))}},deactivate:function(){var f=b.length,e=0;for(e;e<f;e+=1)b[e].reset();b=[];d=c=!1;this.resetEventController()},reset:function(e){this.playbackController.pause();var p=b.length,w=0,u;for(w;w<p;w+=1)u=b[w],u.reset(e);f&&f.reset();b=[];l=k=!1;this.fragmentController&&this.fragmentController.reset();this.fragmentController=void 0;this.liveEdgeFinder.abortSearch();this.liveEdgeFinder.unsubscribe(MediaPlayer.dependencies.LiveEdgeFinder.eventList.ENAME_LIVE_EDGE_SEARCH_COMPLETED,this.playbackController);
m.removeEventListener(MediaPlayer.dependencies.ProtectionController.events.KEY_SYSTEM_SELECTED,h);m.removeEventListener(MediaPlayer.dependencies.ProtectionController.events.SERVER_CERTIFICATE_UPDATED,h);m.removeEventListener(MediaPlayer.dependencies.ProtectionController.events.KEY_ADDED,h);m.removeEventListener(MediaPlayer.dependencies.ProtectionController.events.KEY_SESSION_CREATED,h);m.removeEventListener(MediaPlayer.dependencies.ProtectionController.events.KEY_SYSTEM_SELECTED,h);m.removeEventListener(MediaPlayer.dependencies.ProtectionController.events.KEY_SYSTEM_SELECTED,
h);m.removeEventListener(MediaPlayer.dependencies.ProtectionController.events.LICENSE_REQUEST_COMPLETE,h);c=d=!1;g={};q=n=!0;r=t=!1},getDuration:function(){return e.duration},getStartTime:function(){return e.start},getStreamIndex:function(){return e.index},getId:function(){return e.id},getStreamInfo:function(){return e},hasMedia:function(b){return null!==y.call(this,b)},getBitrateListFor:function(b){b=y.call(this,b);return this.abrController.getBitrateList(b)},startEventController:function(){f.start()},
resetEventController:function(){f.reset()},isActivated:function(){return c},isInitialized:function(){return l},updateData:function(c){var d=b.length,h=this.manifestModel.getValue(),g=0,n;n=e.seekTimeBeforePlay;e=c;e.seekTimeBeforePlay=n;this.log("Manifest updated... set new data on buffers.");f&&(c=this.adapter.getEventsFor(h,e),f.addInlineEvents(c));k=!0;l=!1;for(g;g<d;g+=1)n=b[g],c=this.adapter.getMediaInfoForType(h,e,n.getType()),this.abrController.updateTopQualityIndex(c),e.isAd||n.updateMediaInfo(h,
c);k=!1;x.call(this)},setStreamInfo:function(b){e=b},setUpdating:function(b){k=b},setScheduleControllerStartEnabled:function(c){n=c;for(c=0;c<b.length;++c)b[c].getScheduleController().setStartEnabled(n)},setHoldAt:function(c){for(var d=0;d<b.length;++d)b[d].getScheduleController().setHoldAt(c)},getStreamProcessors:function(){return b},createStreamProcessor:w,onMediaInfoUpdated:function(){var d=b.length,f=0;for(f;f<d;f+=1)if(b[f].isCodecInfoPending())return;t&&c&&(r&&E.call(this),t=!1)}}};
MediaPlayer.dependencies.Stream.prototype={constructor:MediaPlayer.dependencies.Stream};MediaPlayer.dependencies.Stream.DATA_UPDATE_FAILED_ERROR_CODE=1;MediaPlayer.dependencies.Stream.eventList={ENAME_STREAM_UPDATED:"streamUpdated",ENAME_STREAM_BUFFERING_COMPLETED:"streamBufferingCompleted"};MediaPlayer.dependencies.XlinkLoader=function(){var b=function(c,d,e,g){var k=new XMLHttpRequest,l=this,m,h,f=!0,n,q=!0,t=new Date;m=function(){q&&(q=!1,l.metricsModel.addHttpRequest("stream",null,MediaPlayer.vo.metrics.HTTPRequest.XLINK_EXPANSION_TYPE,c,k.responseURL||null,null,t,k.firstByteDate||null,new Date,k.status,null,k.getAllResponseHeaders()),0<g?(console.log("Failed loading xLink content: "+c+", retry in 500ms attempts: "+g),g--,setTimeout(function(){b.call(l,c,d,e,g)},500)):(console.log("Failed loading Xlink content: "+
c+" no retry attempts left"),l.errHandler.downloadError("xlink",c,k),d.resolved=!0,d.resolvedContent=null,l.notify(MediaPlayer.dependencies.XlinkLoader.eventList.ENAME_XLINKELEMENT_LOADED,{element:d,resolveObject:e},Error("Failed loading xlink Element: "+c+" no retry attempts left"))))};h=function(b){f&&(f=!1,!b.lengthComputable||b.lengthComputable&&b.total!=b.loaded)&&(k.firstByteDate=new Date)};try{k.onload=function(){200>k.status||299<k.status||(q=!1,l.metricsModel.addHttpRequest("stream",null,
MediaPlayer.vo.metrics.HTTPRequest.XLINK_EXPANSION_TYPE,c,k.responseURL||null,null,t,k.firstByteDate||null,new Date,k.status,null,k.getAllResponseHeaders()),n=k.responseText,d.resolved=!0,n?(d.resolvedContent=n,l.notify(MediaPlayer.dependencies.XlinkLoader.eventList.ENAME_XLINKELEMENT_LOADED,{element:d,resolveObject:e})):(d.resolvedContent=null,l.notify(MediaPlayer.dependencies.XlinkLoader.eventList.ENAME_XLINKELEMENT_LOADED,{element:d,resolveObject:e},new MediaPlayer.vo.Error(null,"Failed loading Xlink element: "+
c,null))))},k.onloadend=m,k.onerror=m,k.onprogress=h,k.open("GET",l.requestModifierExt.modifyRequestURL(c),!0),k.send()}catch(r){console.log("Error"),k.onerror()}};return{errHandler:void 0,metricsModel:void 0,requestModifierExt:void 0,notify:void 0,subscribe:void 0,unsubscribe:void 0,load:function(c,d,e){"urn:mpeg:dash:resolve-to-zero:2013"===c?(d.resolvedContent=null,d.resolved=!0,this.notify(MediaPlayer.dependencies.XlinkLoader.eventList.ENAME_XLINKELEMENT_LOADED,{element:d,resolveObject:e})):b.call(this,
c,d,e,1)}}};MediaPlayer.dependencies.XlinkLoader.prototype={constructor:MediaPlayer.dependencies.XlinkLoader};MediaPlayer.dependencies.XlinkLoader.eventList={ENAME_XLINKELEMENT_LOADED:"xlinkElementLoaded"};MediaPlayer.dependencies.BufferController=function(){var b=0,c=-1,d=!1,e=0,g=Number.POSITIVE_INFINITY,k,l=-1,m=-1,h,f=null,n,q=null,t,r=0,p=!1,u=!1,w=!1,v=!1,x=!1,y=!1,E=!1,z=function(c){c.data.fragmentModel===this.streamProcessor.getFragmentModel()&&(this.log("Initialization finished loading"),c=c.data.chunk,this.virtualBuffer.append(c),F.call(this,this.streamProcessor.getStreamInfo().id,b,c))},D=function(b){if(b.data.fragmentModel===this.streamProcessor.getFragmentModel()){b=b.data.chunk;var c=
b.bytes,d=b.quality,f=b.index,f=this.streamProcessor.getFragmentModel().getRequests({state:MediaPlayer.dependencies.FragmentModel.states.EXECUTED,quality:d,index:f})[0],d=this.streamProcessor.getRepresentationInfoForQuality(d),e=this.manifestModel.getValue(),h=this.adapter.getEventsFor(e,d.mediaInfo,this.streamProcessor),g=this.adapter.getEventsFor(e,d,this.streamProcessor);this.log("media loaded: "+b.baseUrl);b.discontinuityEncountered&&(b.offsetUpdatePending=!0);if(0<h.length||0<g.length){d=[];
f=Math.max(isNaN(f.startTime)?0:f.startTime,0);e=[];v=!1;h=h.concat(g);for(g=0;g<h.length;g++)e[h[g].schemeIdUri]=h[g];for(var h=this.boxParser.parse(c).getBoxes("emsg"),n=0,l=h.length;n<l;n+=1)(g=this.adapter.getEvent(h[n],e,f))&&d.push(g);this.streamProcessor.getEventController().addInbandEvents(d)}if(v){for(var d=c.length,e=f=0,k,g=Math.pow(256,2),n=Math.pow(256,3),l=new Uint8Array(c.length);f<d;){k=String.fromCharCode(c[f+4],c[f+5],c[f+6],c[f+7]);h=c[f]*n+c[f+1]*g+256*c[f+2]+1*c[f+3];if("emsg"!=
k)for(k=f;k<f+h;k++)l[e]=c[k],e+=1;f+=h}c=l.subarray(0,e)}b.bytes=c;this.virtualBuffer.append(b);A.call(this)}},A=function(){u&&this.log("A segment is already appending");if(f&&!u&&this.sourceBufferExt.getTotalBufferedTime(f)<g){var b=this.streamProcessor.getStreamInfo().id,d;if(p)d=p;else{d=this.virtualBuffer.extract({streamId:b,mediaType:h,segmentType:MediaPlayer.vo.metrics.HTTPRequest.MEDIA_SEGMENT_TYPE,limit:1})[0];if(!d)return;p=d}var e=this.streamProcessor.getStreamInfo().manifestInfo.hasDiscontinuity;
d.quality!==c||d.discontinuityEncountered?e?this.notify(MediaPlayer.dependencies.BufferController.eventList.ENAME_INIT_REQUESTED,{requiredQuality:p.quality,chunk:d}):F.call(this,b,p.quality):(p=!1,H.call(this,d))}},F=function(b,c,d){var e=this.streamProcessor.getMediaInfo();b={streamId:b,mediaType:h,mediaInfo:e,segmentType:MediaPlayer.vo.metrics.HTTPRequest.INIT_SEGMENT_TYPE,quality:c};(d=d?d:this.virtualBuffer.getChunks(b)[0])?f&&H.call(this,d):this.notify(MediaPlayer.dependencies.BufferController.eventList.ENAME_INIT_REQUESTED,
{requiredQuality:c,chunk:p})},H=function(b){u=!0;t=b;b.segmentType!==MediaPlayer.vo.metrics.HTTPRequest.INIT_SEGMENT_TYPE?(this.log("Appending : "+b.baseUrl+"  "+b.MSETimeOffset+" "+b.start),b.offsetUpdatePending&&(b.offsetUpdatePending=!1,f&&this.sourceBufferExt.updateBufferTimestampOffset(f,b.MSETimeOffset))):this.log("Appending INIT: "+b.baseUrl);this.sourceBufferExt.append(f,b)},B=function(b){if(f===b.data.buffer)if(J.call(this),this.isBufferingCompleted()&&this.streamProcessor.getStreamInfo().isLast&&
this.mediaSourceExt.signalEndOfStream(k),b.error)b.error.code===MediaPlayer.dependencies.SourceBufferExtensions.QUOTA_EXCEEDED_ERROR_CODE&&(this.virtualBuffer.append(t),g=.8*this.sourceBufferExt.getTotalBufferedTime(f),this.notify(MediaPlayer.dependencies.BufferController.eventList.ENAME_QUOTA_EXCEEDED,{criticalBufferLevel:g}),P.call(this,N.call(this))),u=!1;else{this.sourceBufferExt.getTotalBufferedTime(f)<g||(this.notify(MediaPlayer.dependencies.BufferController.eventList.ENAME_QUOTA_EXCEEDED,{criticalBufferLevel:g}),
P.call(this,N.call(this)));if((b=this.sourceBufferExt.getAllRanges(f))&&0<b.length){var d,e;d=0;for(e=b.length;d<e;d+=1)this.log("Buffered Range: "+b.start(d)+" - "+b.end(d))}u=!1;isNaN(t.index)?(c=t.quality,A.call(this)):(this.virtualBuffer.storeAppendedChunk(t,f),Q.call(this),l=Math.max(t.index,l),L.call(this));E&&A.call(this);this.notify(MediaPlayer.dependencies.BufferController.eventList.ENAME_BYTES_APPENDED,{quality:t.quality,startTime:t.start,index:t.index,bufferedRanges:b})}},G=function(c){h===
c.data.mediaType&&this.streamProcessor.getStreamInfo().id===c.data.streamInfo.id&&(c=c.data.newQuality,b!==c&&(b=c))},C=function(){this.streamProcessor.getStreamInfo().manifestInfo.hasDiscontinuity&&f.buffered.length&&this.sourceBufferExt.remove(f,f.buffered.start(0),f.buffered.end(f.buffered.length-1),k)},I=function(){J.call(this)},J=function(){M.call(this);K.call(this)},M=function(){var b=this.playbackController.getTime();f&&(e=this.sourceBufferExt.getBufferLength(f,b,void 0,x),this.notify(MediaPlayer.dependencies.BufferController.eventList.ENAME_BUFFER_LEVEL_UPDATED,
{bufferLevel:e}),.5>e&&!d?O.call(this,!1):O.call(this,!0))},K=function(){var b=this.streamProcessor.getStreamInfo().id,c=this.streamController.getActiveStreamInfo().id;b===c&&(this.metricsModel.addBufferState(h,q?MediaPlayer.dependencies.BufferController.BUFFER_LOADED:MediaPlayer.dependencies.BufferController.BUFFER_EMPTY,0),this.metricsModel.addBufferLevel(h,new Date,e))},L=function(){if(l===m-1&&!d){d=!0;var b=this.sourceBufferExt.getAllRanges(f);this.notify(MediaPlayer.dependencies.BufferController.eventList.ENAME_BUFFERING_COMPLETED,
{streamInfo:this.streamProcessor.getStreamInfo(),ranges:b})}},O=function(b){if(!(q===b||"fragmentedText"===h&&this.textSourceBuffer.getAllTracksAreDisabled())){q=b;var c=(q?MediaPlayer.dependencies.BufferController.BUFFER_LOADED:MediaPlayer.dependencies.BufferController.BUFFER_EMPTY)===MediaPlayer.dependencies.BufferController.BUFFER_LOADED?MediaPlayer.events.BUFFER_LOADED:MediaPlayer.events.BUFFER_EMPTY;K.call(this);this.eventBus.dispatchEvent({type:c,data:{bufferType:h}});this.notify(MediaPlayer.dependencies.BufferController.eventList.ENAME_BUFFER_LEVEL_STATE_CHANGED,
{hasSufficientBuffer:b});this.log(q?"Got enough buffer to start.":"Waiting for more buffer before starting playback.")}},N=function(){var b,c;if(!f)return null;b=this.playbackController.getTime();c=(c=this.streamProcessor.getFragmentModel().getRequests({state:MediaPlayer.dependencies.FragmentModel.states.EXECUTED,time:b})[0])&&!isNaN(c.startTime)?c.startTime:Math.floor(b);null===this.sourceBufferExt.getBufferRange(f,b)&&0<f.buffered.length&&(c=f.buffered.end(f.buffered.length-1));return{start:f.buffered.start(0),
end:c}},P=function(b){b&&f&&this.sourceBufferExt.remove(f,b.start,b.end,k)},R=function(b){if(f===b.data.buffer){w&&(w=!1);this.virtualBuffer.updateBufferedRanges({streamId:this.streamProcessor.getStreamInfo().id,mediaType:h},this.sourceBufferExt.getAllRanges(f));M.call(this);this.notify(MediaPlayer.dependencies.BufferController.eventList.ENAME_BUFFER_CLEARED,{from:b.data.from,to:b.data.to,hasEnoughSpaceToAppend:this.sourceBufferExt.getTotalBufferedTime(f)<g});var c=this.playbackController.getTime(),
d=this.streamProcessor.getIndexHandlerTime();!x&&c<=b.data.from&&b.data.from<=d?this.streamProcessor.setIndexHandlerTime(b.data.from):x&&c>=b.data.to&&b.data.to>=d&&this.streamProcessor.setIndexHandlerTime(b.data.to);this.sourceBufferExt.getTotalBufferedTime(f)<g||setTimeout(P.bind(this,N.call(this)),1E3*n)}},Q=function(){var b=this,c=this.virtualBuffer.getChunks({streamId:this.streamProcessor.getStreamInfo().id,mediaType:h,segmentType:MediaPlayer.vo.metrics.HTTPRequest.MEDIA_SEGMENT_TYPE,appended:!0}),
d=new MediaPlayer.utils.CustomTimeRanges,f=new MediaPlayer.utils.CustomTimeRanges,e=this.playbackController.getTime(),g;c.forEach(function(c){g=b.mediaController.isCurrentTrack(c.mediaInfo)?f:d;g.add(c.bufferedRange.start,c.bufferedRange.end)});if(0!==d.length&&0!==f.length&&(c=this.sourceBufferExt.getBufferLength({buffered:f},e),!(0>=c)))for(var n=0,l=d.length;n<l;n+=1)c={start:d.start(n),end:d.end(n)},b.mediaController.getSwitchMode(h)===(MediaPlayer.dependencies.MediaController.trackSwitchModes.ALWAYS_REPLACE||
c.start>e)&&P.call(b,c)},T=function(b){b.error||(b=this.streamProcessor.getStreamInfo().manifestInfo.minBufferTime,n!==b&&(this.setMinBufferTime(b),this.notify(MediaPlayer.dependencies.BufferController.eventList.ENAME_MIN_BUFFER_TIME_UPDATED,{minBufferTime:b})))},V=function(b){E=!0;b.data.fragmentModel===this.streamProcessor.getFragmentModel()&&(m=b.data.request.index,L.call(this),A.call(this))},S=function(){K.call(this)},U=function(b){if(f){var c=b.data.newMediaInfo,d=b.data.oldMediaInfo,e=c.type;
b=b.data.switchMode;var g={start:0,end:this.playbackController.getTime()};if(h===e)switch(b){case MediaPlayer.dependencies.MediaController.trackSwitchModes.ALWAYS_REPLACE:"video"===h&&d&&d.isTrickPlayTrack&&c&&!c.isTrickPlayTrack?this.sourceBufferExt.removeAll(this.getBuffer(),this.getMediaSource()):P.call(this,g);break;case MediaPlayer.dependencies.MediaController.trackSwitchModes.NEVER_REPLACE:break;default:this.log("track switch mode is not supported: "+b)}}},W=function(){if(f&&(r+=1,0===r%MediaPlayer.dependencies.BufferController.BUFFER_PRUNING_INTERVAL&&
!u)){var b=0,b=this.playbackController.getTime(),c=this.sourceBufferExt.getBufferRange(f,b),d=0,e=0;null!==c&&(x?(b=c.end-b-MediaPlayer.dependencies.BufferController.BUFFER_TO_KEEP_REVERSE_PLAY,d=Math.round(c.end-b),e=c.end):(b=b-c.start-MediaPlayer.dependencies.BufferController.BUFFER_TO_KEEP,d=0,e=Math.round(c.start+b)),0<b&&(w=!0,this.sourceBufferExt.remove(f,d,e,k)))}},X=function(){.5>e&&!d?O.call(this,!1):O.call(this,!0)};return{sourceBufferExt:void 0,eventBus:void 0,bufferMax:void 0,manifestModel:void 0,
errHandler:void 0,mediaSourceExt:void 0,metricsModel:void 0,metricsExt:void 0,streamController:void 0,playbackController:void 0,mediaController:void 0,adapter:void 0,log:void 0,abrController:void 0,boxParser:void 0,system:void 0,notify:void 0,subscribe:void 0,unsubscribe:void 0,virtualBuffer:void 0,textSourceBuffer:void 0,setup:function(){this[Dash.dependencies.RepresentationController.eventList.ENAME_DATA_UPDATE_COMPLETED]=T;this[MediaPlayer.dependencies.FragmentController.eventList.ENAME_INIT_FRAGMENT_LOADED]=
z;this[MediaPlayer.dependencies.FragmentController.eventList.ENAME_MEDIA_FRAGMENT_LOADED]=D;this[MediaPlayer.dependencies.FragmentController.eventList.ENAME_STREAM_COMPLETED]=V;this[MediaPlayer.dependencies.AbrController.eventList.ENAME_QUALITY_CHANGED]=G;this[MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_PROGRESS]=J;this[MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_TIME_UPDATED]=J;this[MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_SEEKING]=
I;this[MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_EXPLICIT_SEEKING]=C;this[MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_RATE_CHANGED]=X;this[MediaPlayer.dependencies.PlaybackController.eventList.ENAME_WALLCLOCK_TIME_UPDATED]=W;this[MediaPlayer.dependencies.MediaController.eventList.CURRENT_TRACK_CHANGED]=U;B=B.bind(this);R=R.bind(this);S=S.bind(this);this.sourceBufferExt.subscribe(MediaPlayer.dependencies.SourceBufferExtensions.eventList.ENAME_SOURCEBUFFER_APPEND_COMPLETED,
this,B);this[MediaPlayer.dependencies.SourceBufferExtensions.eventList.ENAME_SOURCEBUFFER_REMOVE_COMPLETED]=R;this.virtualBuffer.subscribe(MediaPlayer.utils.VirtualBuffer.eventList.CHUNK_APPENDED,this,S)},initialize:function(b,c,d){h=b;this.setMediaType(h);this.setMediaSource(c);this.streamProcessor=d;this.fragmentController=d.fragmentController;this.scheduleController=d.scheduleController},createBuffer:function(c){if(!c||!k||!this.streamProcessor)return null;var d=null;try{(d=this.sourceBufferExt.createSourceBuffer(k,
c))&&d.hasOwnProperty("initialize")&&d.initialize(h,this)}catch(e){this.errHandler.mediaSourceError("Error creating "+h+" source buffer.")}this.setBuffer(d);c=this.streamProcessor.getRepresentationInfoForQuality(b).MSETimeOffset;f&&this.sourceBufferExt.updateBufferTimestampOffset(f,c);return d},getStreamProcessor:function(){return this.streamProcessor},setNewType:function(b){h=b},setStreamProcessor:function(b){this.streamProcessor=b},getBuffer:function(){return f},getBufferRange:function(b){return this.sourceBufferExt.getBufferRange(f,
b)},setBuffer:function(b){f=b},getBufferLevel:function(){return e},getMinBufferTime:function(){return n},setMinBufferTime:function(b){n=b},getCriticalBufferLevel:function(){return g},setMediaSource:function(b){k=b},getMediaSource:function(){return k},isBufferingCompleted:function(){return d},getIsAppendingInProgress:function(){return u},enableBuffering:function(){k&&this.streamProcessor&&A.call(this)},reset:function(e){g=Number.POSITIVE_INFINITY;n=q=null;l=m=c=-1;b=0;y=!1;this.sourceBufferExt.unsubscribe(MediaPlayer.dependencies.SourceBufferExtensions.eventList.ENAME_SOURCEBUFFER_APPEND_COMPLETED,
this,B);this.sourceBufferExt.unsubscribe(MediaPlayer.dependencies.SourceBufferExtensions.eventList.ENAME_SOURCEBUFFER_REMOVE_COMPLETED,this,R);t=null;this.virtualBuffer.unsubscribe(MediaPlayer.utils.VirtualBuffer.eventList.CHUNK_APPENDED,this,S);w=u=d=p=!1;e||(this.sourceBufferExt.abort(k,f),this.sourceBufferExt.removeSourceBuffer(k,f));f=null;this.metricsModel.addBufferLevel(h,new Date,0);x=!1},setInitialRequiredQuality:function(c){!1===y&&(b=c,y=!0)},setReverseTrickPlay:function(b){x=b;this.virtualBuffer.setReverseTrickPlay(b)},
resetCurrentQuality:function(){c=-1}}};MediaPlayer.dependencies.BufferController.LOW_BUFFER_THRESHOLD=4;MediaPlayer.dependencies.BufferController.DEFAULT_MIN_BUFFER_TIME=12;MediaPlayer.dependencies.BufferController.BUFFER_TIME_AT_TOP_QUALITY=30;MediaPlayer.dependencies.BufferController.RICH_BUFFER_THRESHOLD=20;MediaPlayer.dependencies.BufferController.BUFFER_LOADED="bufferLoaded";MediaPlayer.dependencies.BufferController.BUFFER_EMPTY="bufferStalled";
MediaPlayer.dependencies.BufferController.BUFFER_TO_KEEP=30;MediaPlayer.dependencies.BufferController.BUFFER_TO_KEEP_REVERSE_PLAY=10;MediaPlayer.dependencies.BufferController.BUFFER_PRUNING_INTERVAL=30;MediaPlayer.dependencies.BufferController.prototype={constructor:MediaPlayer.dependencies.BufferController};
MediaPlayer.dependencies.BufferController.eventList={ENAME_BUFFER_LEVEL_STATE_CHANGED:"bufferLevelStateChanged",ENAME_BUFFER_LEVEL_UPDATED:"bufferLevelUpdated",ENAME_QUOTA_EXCEEDED:"quotaExceeded",ENAME_BYTES_APPENDED:"bytesAppended",ENAME_BYTES_REJECTED:"bytesRejected",ENAME_BUFFERING_COMPLETED:"bufferingCompleted",ENAME_BUFFER_CLEARED:"bufferCleared",ENAME_INIT_REQUESTED:"initRequested",ENAME_BUFFER_LEVEL_OUTRUN:"bufferLevelOutrun",ENAME_BUFFER_LEVEL_BALANCED:"bufferLevelBalanced",ENAME_MIN_BUFFER_TIME_UPDATED:"minBufferTimeUpdated",
ENAME_BUFFER_TIME_OFFSET_UPDATED:"timeOffsetUpdated"};MediaPlayer.dependencies.LiveEdgeFinder=function(){var b=!1,c=NaN,d,e=null,g=MediaPlayer.rules.SynchronizationRulesCollection.prototype.BEST_GUESS_RULES,k=function(b){var d=((new Date).getTime()-c)/1E3;e=b.value;this.notify(MediaPlayer.dependencies.LiveEdgeFinder.eventList.ENAME_LIVE_EDGE_SEARCH_COMPLETED,{liveEdge:e,searchTime:d},null===e?new MediaPlayer.vo.Error(MediaPlayer.dependencies.LiveEdgeFinder.LIVE_EDGE_NOT_FOUND_ERROR_CODE,"live edge has not been found",null):null)},l=function(e){!this.streamProcessor.isDynamic()||
b||e.error||(d=this.synchronizationRulesCollection.getRules(g),b=!0,c=(new Date).getTime(),this.rulesController.applyRules(d,this.streamProcessor,k.bind(this),null,function(b,c){return c}))},m=function(b){g=b.error?MediaPlayer.rules.SynchronizationRulesCollection.prototype.BEST_GUESS_RULES:MediaPlayer.rules.SynchronizationRulesCollection.prototype.TIME_SYNCHRONIZED_RULES};return{system:void 0,synchronizationRulesCollection:void 0,rulesController:void 0,notify:void 0,subscribe:void 0,unsubscribe:void 0,
setup:function(){this[MediaPlayer.dependencies.Stream.eventList.ENAME_STREAM_UPDATED]=l;this[MediaPlayer.dependencies.TimeSyncController.eventList.ENAME_TIME_SYNCHRONIZATION_COMPLETED]=m},initialize:function(b){this.streamProcessor=b;this.fragmentLoader=b.fragmentLoader},abortSearch:function(){b=!1;c=NaN},getLiveEdge:function(){return e},reset:function(){this.abortSearch();e=null}}};MediaPlayer.dependencies.LiveEdgeFinder.prototype={constructor:MediaPlayer.dependencies.LiveEdgeFinder};
MediaPlayer.dependencies.LiveEdgeFinder.eventList={ENAME_LIVE_EDGE_SEARCH_COMPLETED:"liveEdgeFound"};MediaPlayer.dependencies.LiveEdgeFinder.LIVE_EDGE_NOT_FOUND_ERROR_CODE=1;MediaPlayer.dependencies.Notifier=function(){var b,c=0,d=function(){this.observableId||(c+=1,this.observableId="_id_"+c);return this.observableId};return{system:void 0,setup:function(){b=this.system;b.mapValue("notify",this.notify);b.mapValue("subscribe",this.subscribe);b.mapValue("unsubscribe",this.unsubscribe)},notify:function(c,g,k){var l=c+d.call(this),m=new MediaPlayer.vo.Event;m.sender=this;m.type=c;m.data=g;m.error=k;m.timestamp=(new Date).getTime();b.notify.call(b,l,m)},subscribe:function(c,
g,k,l){!k&&g[c]&&(k=g[c]=g[c].bind(g));if(!g)throw"observer object cannot be null or undefined";if(!k)throw"event handler cannot be null or undefined";c+=d.call(this);b.mapHandler(c,void 0,k,l)},unsubscribe:function(c,g,k){k=k||g[c];c+=d.call(this);b.unmapHandler(c,void 0,k)}}};MediaPlayer.dependencies.Notifier.prototype={constructor:MediaPlayer.dependencies.Notifier};MediaPlayer.dependencies.EventController=function(){var b={},c={},d={},e=null,g=function(){null!==e&&(clearInterval(e),e=null)},k=function(){l.call(this,c);l.call(this,b);if(d)for(var f=this.videoModel.getCurrentTime(),e=Object.keys(d),h=0;h<e.length;h++){var g=e[h],k=d[g];null!==k&&(k.duration+k.presentationTime)/k.eventStream.timescale<f&&(this.log("Remove Event "+g+" at time "+f),delete d[g])}},l=function(b){var c=this.videoModel.getCurrentTime(),e;if(b)for(var h=Object.keys(b),g=0;g<h.length;g++){var l=
h[g],k=b[l];void 0!==k&&(e=k.presentationTime/k.eventStream.timescale,0===e||e<=c&&e+.1>c)&&(this.log("Start Event "+l+" at "+c),0<k.duration&&(d[l]=k),"urn:mpeg:dash:event:2012"==k.eventStream.schemeIdUri&&1==k.eventStream.value&&(e=this.manifestModel.getValue(),k=e.url,e.hasOwnProperty("Location")&&(k=e.Location),this.log("Refresh manifest @ "+k),this.manifestUpdater.getManifestLoader().load(k)),delete b[l])}},m=function(b){for(var c=this.system.getObject("mediaPlayer"),d=c.getCurrentItem().getTimedMetadata(),
e=0;e<d.length;e++)if(d[e].name==b.eventStream.schemeIdUri&&d[e].id==b.id)return;e=this.system.getObject("manifestExt");if(h(e.subscribedTags,b.eventStream.schemeIdUri)||h(e.adTags,b.eventStream.schemeIdUri)||h(["urn:com:adobe:dpi:simple:2015"],b.eventStream.schemeIdUri)){var e=b.presentationTime/b.eventStream.timescale,g=new AdobePSDK.Metadata;g.setValue("id",b.id);g.setValue("duration",b.duration);g.setValue("messageData",b.messageData);g.setValue("presentationTime",b.presentationTime);g.setValue("presentationTimeDelta",
b.presentationTimeDelta);g.setValue("timescale",b.eventStream.timescale);g.setValue("value",b.eventStream.value);g.setValue("schemeIdUri",b.eventStream.schemeIdUri);b=new AdobePSDK.TimedMetadata(AdobePSDK.TimedMetadataType.TAG,1E3*e,b.id,b.eventStream.schemeIdUri,"",g);d.push(b);c.timedMetadataUpdated(b)}},h=function(b,c){if(!c||!b)return!1;for(var d=0;d<b.length;d++)if(b[d]===c)return!0;return!1};return{manifestModel:void 0,manifestUpdater:void 0,log:void 0,system:void 0,videoModel:void 0,addInlineEvents:function(c){b=
{};if(c)for(var d=0;d<c.length;d++){var e=c[d];b[e.id]=e;m.call(this,e);this.log("Add inline event with id "+e.id)}this.log("Added "+c.length+" inline events")},addInbandEvents:function(b){for(var d=0;d<b.length;d++){var e=b[d];e.id in c?this.log("Repeated event with id "+e.id):(c[e.id]=e,m.call(this,e),this.log("Add inband event with id "+e.id))}},reset:function(){g();d=c=b=null},clear:g,start:function(){this.log("Start Event Controller");isNaN(100)||(e=setInterval(k.bind(this),100))}}};
MediaPlayer.dependencies.EventController.prototype={constructor:MediaPlayer.dependencies.EventController};MediaPlayer.models.URIQueryAndFragmentModel=function(){var b=new MediaPlayer.vo.URIFragmentData,c=[],d=!1;return{parseURI:function(e){function g(b,c,d,f){b=f[0].split(/[=]/);f.push({key:b[0],value:b[1]});f.shift();return f}if(!e)return null;var k=[],l=new RegExp(/[#]/),m=new RegExp(/^(https:)?\/\//i),h=(new RegExp(/[?]/)).test(e),f=l.test(e);d=m.test(e);e.split(/[?#]/).map(function(b,d,e){0<d&&(h&&0===c.length?c=e[d].split(/[&]/):f&&(k=e[d].split(/[&]/)));return e});0<c.length&&(c=c.reduce(g,null));
0<k.length&&(k=k.reduce(g,null),k.forEach(function(c){b[c.key]=c.value}));return e},getURIFragmentData:function(){return b},getURIQueryData:function(){return c},isManifestHTTPS:function(){return d},reset:function(){b=new MediaPlayer.vo.URIFragmentData;c=[];d=!1}}};MediaPlayer.models.URIQueryAndFragmentModel.prototype={constructor:MediaPlayer.models.URIQueryAndFragmentModel};MediaPlayer.vo.URIFragmentData=function(){this.s=this.id=this.track=this.xywh=this.t=null};MediaPlayer.vo.URIFragmentData.prototype={constructor:MediaPlayer.vo.URIFragmentData};MediaPlayer.vo.DataChunk=function(){this.segmentType=this.mediaInfo=this.streamId=null;this.index=this.quality=NaN;this.bytes=null;this.duration=this.end=this.start=NaN};MediaPlayer.vo.DataChunk.prototype={constructor:MediaPlayer.vo.DataChunk};MediaPlayer.vo.TextTrackInfo=function(){this.lang=this.label=this.captionData=this.video=null;this.defaultTrack=!1;this.kind=null;this.isFragmented=!1};MediaPlayer.vo.TextTrackInfo.prototype={constructor:MediaPlayer.vo.TextTrackInfo};MediaPlayer.models.ProtectionModel=function(){};
MediaPlayer.models.ProtectionModel.eventList={ENAME_NEED_KEY:"needkey",ENAME_KEY_SYSTEM_ACCESS_COMPLETE:"keySystemAccessComplete",ENAME_KEY_SYSTEM_SELECTED:"keySystemSelected",ENAME_VIDEO_ELEMENT_SELECTED:"videoElementSelected",ENAME_SERVER_CERTIFICATE_UPDATED:"serverCertificateUpdated",ENAME_KEY_MESSAGE:"keyMessage",ENAME_KEY_ADDED:"keyAdded",ENAME_KEY_ERROR:"keyError",ENAME_KEY_SESSION_CREATED:"keySessionCreated",ENAME_KEY_SESSION_REMOVED:"keySessionRemoved",ENAME_KEY_SESSION_CLOSED:"keySessionClosed",
ENAME_KEY_STATUSES_CHANGED:"keyStatusesChanged",ENAME_TEARDOWN_COMPLETE:"protectionTeardownComplete"};MediaPlayer.models.ProtectionModel_01b=function(){var b=null,c=null,d=[],e=[],g,k=function(){var b=this;return{handleEvent:function(h){var l=null;switch(h.type){case c.needkey:h=ArrayBuffer.isView(h.initData)?h.initData.buffer:h.initData;b.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_NEED_KEY,new MediaPlayer.vo.protection.NeedKey(h,"cenc"));break;case c.keyerror:(l=m(e,h.sessionId))||(l=m(d,h.sessionId));if(l){var k="";switch(h.errorCode.code){case 1:k+="MEDIA_KEYERR_UNKNOWN - An unspecified error occurred. This value is used for errors that don't match any of the other codes.";
break;case 2:k+="MEDIA_KEYERR_CLIENT - The Key System could not be installed or updated.";break;case 3:k+="MEDIA_KEYERR_SERVICE - The message passed into update indicated an error from the license service.";break;case 4:k+="MEDIA_KEYERR_OUTPUT - There is no available output device with the required characteristics for the content protection system.";break;case 5:k+="MEDIA_KEYERR_HARDWARECHANGE - A hardware configuration change caused a content protection error.";break;case 6:k+="MEDIA_KEYERR_DOMAIN - An error occurred in a multi-device domain licensing configuration. The most common error is a failure to join the domain."}k+=
"  System Code = "+h.systemCode;b.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_ERROR,new MediaPlayer.vo.protection.KeyError(l,k))}else b.log("No session token found for key error");break;case c.keyadded:(l=m(e,h.sessionId))||(l=m(d,h.sessionId));l?b.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_ADDED,l):b.log("No session token found for key added");break;case c.keymessage:(g=null!==h.sessionId&&void 0!==h.sessionId)?(l=m(e,h.sessionId),!l&&0<d.length&&(l=d.shift(),
e.push(l),l.sessionID=h.sessionId)):0<d.length&&(l=d.shift(),e.push(l),0!==d.length&&b.errHandler.mediaKeyMessageError("Multiple key sessions were creates with a user-agent that does not support sessionIDs!! Unpredictable behavior ahead!")),l?(k=ArrayBuffer.isView(h.message)?h.message.buffer:h.message,l.keyMessage=k,b.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_MESSAGE,new MediaPlayer.vo.protection.KeyMessage(l,k,h.defaultURL))):b.log("No session token found for key message")}}}},
l=null,m=function(b,c){if(c&&b)for(var d=b.length,e=0;e<d;e++)if(b[e].sessionID==c)return b[e];return null},h=function(){b.removeEventListener(c.keyerror,l);b.removeEventListener(c.needkey,l);b.removeEventListener(c.keymessage,l);b.removeEventListener(c.keyadded,l)};return{system:void 0,log:void 0,errHandler:void 0,notify:void 0,subscribe:void 0,unsubscribe:void 0,protectionExt:void 0,keySystem:null,setup:function(){l=k.call(this)},init:function(){var b=document.createElement("video");c=MediaPlayer.models.ProtectionModel_01b.detect(b)},
teardown:function(){b&&h();this.closeKeySessions();this.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_TEARDOWN_COMPLETE)},getAllInitData:function(){var b,c=[];for(b=0;b<d.length;b++)c.push(d[b].initData);for(b=0;b<e.length;b++)c.push(e[b].initData);return c},requestKeySystemAccess:function(c){var d=b;d||(d=document.createElement("video"));for(var e=!1,h=0;h<c.length;h++)for(var g=c[h].ks.systemString,l=c[h].configs,k=null,m=0;m<l.length;m++){var v=l[m].videoCapabilities;if(v&&0!==v.length)for(var k=
[],x=0;x<v.length;x++)""!==d.canPlayType(v[x].contentType,g)&&k.push(v[x]);if(k&&(!k||0!==k.length)){e=!0;l=new MediaPlayer.vo.protection.KeySystemConfiguration(null,k);g=this.protectionExt.getKeySystemBySystemString(g);g=new MediaPlayer.vo.protection.KeySystemAccess(g,l);this.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SYSTEM_ACCESS_COMPLETE,g);break}}e||this.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SYSTEM_ACCESS_COMPLETE,null,"Key system access denied! -- No valid audio/video content configurations detected!")},
selectKeySystem:function(b){this.keySystem=b.keySystem;this.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SYSTEM_SELECTED)},setMediaElement:function(d){b!==d&&(b&&h(),b=d)&&(b.addEventListener(c.keyerror,l),b.addEventListener(c.needkey,l),b.addEventListener(c.keymessage,l),b.addEventListener(c.keyadded,l),this.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_VIDEO_ELEMENT_SELECTED))},createKeySession:function(f){if(!this.keySystem)throw Error("Can not create sessions until you have selected a key system");
if(g||0===e.length){var h={sessionID:null,initData:f,getSessionID:function(){return this.sessionID},getExpirationTime:function(){return NaN},getSessionType:function(){return"temporary"}};d.push(h);b[c.generateKeyRequest](this.keySystem.systemString,new Uint8Array(f));return h}throw Error("Multiple sessions not allowed!");},updateKeySession:function(d,e){var h=d.sessionID;if(this.protectionExt.isClearKey(this.keySystem))for(var g=0;g<e.keyPairs.length;g++)b[c.addKey](this.keySystem.systemString,e.keyPairs[g].key,
e.keyPairs[g].keyID,h);else b[c.addKey](this.keySystem.systemString,new Uint8Array(e),d.initData,h)},closeKeySession:function(d){b[c.cancelKeyRequest](this.keySystem.systemString,d.sessionID)},setServerCertificate:function(){},loadKeySession:function(){},removeKeySession:function(){},resetKeySystem:function(){this.closeKeySessions();this.keySystem=null;this.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_TEARDOWN_COMPLETE)},closeKeySessions:function(){for(;0<e.length;)this.closeKeySession(e[0]);
e=[]}}};MediaPlayer.models.ProtectionModel_01b.prototype={constructor:MediaPlayer.models.ProtectionModel_01b};
MediaPlayer.models.ProtectionModel_01b.APIs=[{generateKeyRequest:"generateKeyRequest",addKey:"addKey",cancelKeyRequest:"cancelKeyRequest",needkey:"needkey",keyerror:"keyerror",keyadded:"keyadded",keymessage:"keymessage"},{generateKeyRequest:"webkitGenerateKeyRequest",addKey:"webkitAddKey",cancelKeyRequest:"webkitCancelKeyRequest",needkey:"webkitneedkey",keyerror:"webkitkeyerror",keyadded:"webkitkeyadded",keymessage:"webkitkeymessage"}];
MediaPlayer.models.ProtectionModel_01b.detect=function(b){for(var c=MediaPlayer.models.ProtectionModel_01b.APIs,d=0;d<c.length;d++){var e=c[d];if("function"===typeof b[e.generateKeyRequest]&&"function"===typeof b[e.addKey]&&"function"===typeof b[e.cancelKeyRequest])return e}return null};MediaPlayer.models.ProtectionModel_3Feb2014=function(){var b=null,c=null,d=null,e=null,g=[],k=function(){var b=this;return{handleEvent:function(c){switch(c.type){case e.needkey:c.initData&&(c=ArrayBuffer.isView(c.initData)?c.initData.buffer:c.initData,b.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_NEED_KEY,new MediaPlayer.vo.protection.NeedKey(c,"cenc")))}}}},l=null,m=function(){var d=null,h=function(){b.removeEventListener("loadedmetadata",d);b[e.setMediaKeys](c);this.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_VIDEO_ELEMENT_SELECTED)};
1<=b.readyState?h.call(this):(d=h.bind(this),b.addEventListener("loadedmetadata",d))},h=function(b,c,d,h,g){var l=this;return{session:b,initData:c,initDataInfo:h,onLicenseMessageCallback:g,handleEvent:function(b){switch(b.type){case e.error:l.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_ERROR,new MediaPlayer.vo.protection.KeyError(this,"KeyError: "+b.target.error.systemCode+" : "+b.target.error.name));break;case e.message:var c=ArrayBuffer.isView(b.message)?b.message.buffer:b.message;
l.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_MESSAGE,new MediaPlayer.vo.protection.KeyMessage(this,c,b.destinationURL));break;case e.ready:l.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_ADDED,this);break;case e.close:l.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SESSION_CLOSED,this.getSessionID())}},getSessionID:function(){return this.session.sessionId},getExpirationTime:function(){return NaN},getSessionType:function(){return"temporary"}}};return{system:void 0,
notify:void 0,subscribe:void 0,unsubscribe:void 0,protectionExt:void 0,keySystem:null,setup:function(){l=k.call(this)},init:function(){var b=document.createElement("video");e=MediaPlayer.models.ProtectionModel_3Feb2014.detect(b)},teardown:function(){try{this.closeKeySessions(),b&&b.removeEventListener(e.needkey,l),this.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_TEARDOWN_COMPLETE)}catch(c){this.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_TEARDOWN_COMPLETE,null,"Error tearing down key sessions and MediaKeys! -- "+
c.message)}},getAllInitData:function(){for(var b=[],c=0;c<g.length;c++)b.push(g[c].initData);return b},requestKeySystemAccess:function(b){for(var c=!1,d=0;d<b.length;d++)for(var h=b[d].ks.systemString,g=b[d].configs,l=null,k=null,m=0;m<g.length;m++){var v=g[m].audioCapabilities,x=g[m].videoCapabilities;if(v&&0!==v.length)for(var l=[],y=0;y<v.length;y++)window[e.MediaKeys].isTypeSupported(h,v[y].contentType)&&l.push(v[y]);if(x&&0!==x.length)for(k=[],v=0;v<x.length;v++)window[e.MediaKeys].isTypeSupported(h,
x[v].contentType)&&k.push(x[v]);if(!(!l&&!k||l&&0===l.length||k&&0===k.length)){c=!0;g=new MediaPlayer.vo.protection.KeySystemConfiguration(l,k);h=this.protectionExt.getKeySystemBySystemString(h);h=new MediaPlayer.vo.protection.KeySystemAccess(h,g);this.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SYSTEM_ACCESS_COMPLETE,h);break}}c||this.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SYSTEM_ACCESS_COMPLETE,null,"Key system access denied! -- No valid audio/video content configurations detected!")},
selectKeySystem:function(f){try{c=f.mediaKeys=new window[e.MediaKeys](f.keySystem.systemString),this.keySystem=f.keySystem,d=f,b&&m.call(this),this.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SYSTEM_SELECTED)}catch(h){this.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SYSTEM_SELECTED,null,"Error selecting keys system ("+this.keySystem.systemString+")! Could not create MediaKeys -- TODO")}},setMediaElement:function(d){b!==d&&(b&&b.removeEventListener(e.needkey,l),
b=d)&&(b.addEventListener(e.needkey,l),c&&m.call(this))},createKeySession:function(b,l,k,m){if(!this.keySystem||!c||!d)throw Error("Can not create sessions until you have selected a key system");var r=c.createSession(d.ksConfiguration.videoCapabilities[0].contentType,new Uint8Array(b));b=h.call(this,r,b,l,k,m);r.addEventListener(e.error,b);r.addEventListener(e.message,b);r.addEventListener(e.ready,b);r.addEventListener(e.close,b);g.push(b);this.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SESSION_CREATED,
b)},updateKeySession:function(b,c){var d=b.session;this.protectionExt.isClearKey(this.keySystem)?d.update(new Uint8Array(c.toJWK())):d.update(new Uint8Array(c))},closeKeySession:function(b){var c=b.session;c.removeEventListener(e.error,b);c.removeEventListener(e.message,b);c.removeEventListener(e.ready,b);c.removeEventListener(e.close,b);for(var d=0;d<g.length;d++)if(g[d]===b){g.splice(d,1);break}c[e.release]()},setServerCertificate:function(){},loadKeySession:function(){},removeKeySession:function(){},
resetKeySystem:function(){this.closeKeySessions();c=this.keySystem=null;this.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_TEARDOWN_COMPLETE)},closeKeySessions:function(){for(;0<g.length;)this.closeKeySession(g[0]);g=[]}}};
MediaPlayer.models.ProtectionModel_3Feb2014.APIs=[{setMediaKeys:"setMediaKeys",MediaKeys:"MediaKeys",release:"close",needkey:"needkey",error:"keyerror",message:"keymessage",ready:"keyadded",close:"keyclose"},{setMediaKeys:"msSetMediaKeys",MediaKeys:"MSMediaKeys",release:"close",needkey:"msneedkey",error:"mskeyerror",message:"mskeymessage",ready:"mskeyadded",close:"mskeyclose"}];
MediaPlayer.models.ProtectionModel_3Feb2014.detect=function(b){for(var c=MediaPlayer.models.ProtectionModel_3Feb2014.APIs,d=0;d<c.length;d++){var e=c[d];if("function"===typeof b[e.setMediaKeys]&&"function"===typeof window[e.MediaKeys])return e}return null};MediaPlayer.models.ProtectionModel_3Feb2014.prototype={constructor:MediaPlayer.models.ProtectionModel_3Feb2014};MediaPlayer.models.ProtectionModel_21Jan2015=function(){var b=null,c=null,d=[],e=function(b,c){var d=this;(function(c){var h=b[c].ks,g=b[c].configs;g[0].initDataType="cenc";navigator.requestMediaKeySystemAccess(h.systemString,g).then(function(b){var c="function"===typeof b.getConfiguration?b.getConfiguration():null,c=new MediaPlayer.vo.protection.KeySystemAccess(h,c);c.mksa=b;d.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SYSTEM_ACCESS_COMPLETE,c)}).catch(function(){++c<b.length?
e.call(d,b,c):d.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SYSTEM_ACCESS_COMPLETE,null,"Key system access denied!")})})(c)},g=function(b){var c=b.session;c.removeEventListener("keystatuseschange",b);c.removeEventListener("message",b);console.log("DRM: closekeySession called: "+b.getSessionID());return c.close()},k=function(){var b=this;return{handleEvent:function(c){switch(c.type){case "encrypted":if(c.initData){var d=ArrayBuffer.isView(c.initData)?c.initData.buffer:c.initData;
b.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_NEED_KEY,new MediaPlayer.vo.protection.NeedKey(d,c.initDataType))}}}}},l=null,m=function(b){for(var c=0;c<d.length;c++)if(d[c]===b){d.splice(c,1);break}},h=function(b,c,e,h,g){var l=this,k={session:b,initData:c,initDataInfo:h,onLicenseMessageCallback:g,handleEvent:function(b){console.log("DRM: event received: "+b.type);switch(b.type){case "keystatuseschange":l.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_STATUSES_CHANGED,
this);break;case "message":var c=ArrayBuffer.isView(b.message)?b.message.buffer:b.message;l.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_MESSAGE,new MediaPlayer.vo.protection.KeyMessage(this,c,void 0,b.messageType));break;case "error":l.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_ERROR,new MediaPlayer.vo.protection.KeyError(this,"DRM Session Error! "+b.systemCode))}},getSessionID:function(){return this.session.sessionId},getExpirationTime:function(){return this.session.expiration},
getKeyStatuses:function(){return this.session.keyStatuses},getSessionType:function(){return e}};b.addEventListener("keystatuseschange",k);b.addEventListener("message",k);b.addEventListener("error",k);b.closed.then(function(){m(k);l.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SESSION_CLOSED,k.getSessionID())});d.push(k);return k};return{system:void 0,notify:void 0,subscribe:void 0,unsubscribe:void 0,protectionExt:void 0,keySystem:null,setup:function(){l=k.call(this)},init:function(){},
teardown:function(){var c=d.length,e,h=this;if(0!==c)for(var k=function(c){m(c);0===d.length&&(b?(b.removeEventListener("encrypted",l),b.setMediaKeys(null).then(function(){h.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_TEARDOWN_COMPLETE)})):h.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_TEARDOWN_COMPLETE))},r=0;r<c;r++)e=d[r],function(b){e.session.closed.then(function(){k(b)});g(e).catch(function(){k(b)})}(e);else this.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_TEARDOWN_COMPLETE)},
getAllInitData:function(){for(var b=[],c=0;c<d.length;c++)b.push(d[c].initData);return b},requestKeySystemAccess:function(b){e.call(this,b,0)},selectKeySystem:function(d){var e=this;d.mksa.createMediaKeys().then(function(h){e.keySystem=d.keySystem;c=h;b&&b.setMediaKeys(c);e.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SYSTEM_SELECTED)}).catch(function(b){e.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SYSTEM_SELECTED,null,"Error selecting keys system ("+d.keySystem.systemString+
")! Could not create MediaKeys : "+b.name+" : "+b)})},setMediaElement:function(d){b!==d&&(b&&(b.removeEventListener("encrypted",l),b.setMediaKeys(null)),b=d)&&(b.addEventListener("encrypted",l),c&&b.setMediaKeys(c))},setServerCertificate:function(b){if(!this.keySystem||!c)throw Error("Can not set server certificate until you have selected a key system");var d=this;c.setServerCertificate(b).then(function(){d.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_SERVER_CERTIFICATE_UPDATED)}).catch(function(b){d.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_SERVER_CERTIFICATE_UPDATED,
null,"Error updating server certificate -- "+b.name)})},createKeySession:function(b,d,e,g){if(!this.keySystem||!c)throw Error("Can not create sessions until you have selected a key system");var l=c.createSession(d),k=h.call(this,l,b,d,e,g),u=this;l.generateRequest("cenc",b).then(function(){u.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SESSION_CREATED,k)}).catch(function(b){m(k);u.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SESSION_CREATED,k,"Error generating key request -- "+
b.name+" : "+b)})},updateKeySession:function(b,c){var d=b.session,e=this;this.protectionExt.isClearKey(this.keySystem)&&(c=c.toJWK());d.update(c).then(function(){console.log("DRM: on updateKeySession success");e.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_ADDED,b)}).catch(function(c){console.log("DRM: on updateKeySession error");e.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_ERROR,new MediaPlayer.vo.protection.KeyError(b,"Error sending update() message! "+c.name+
" : "+c))})},loadKeySession:function(b){if(!this.keySystem||!c)throw Error("Can not load sessions until you have selected a key system");var d=c.createSession(),e=this;d.load(b).then(function(c){c?(c=h.call(this,d),e.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SESSION_CREATED,c)):e.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SESSION_CREATED,null,"Could not load session! Invalid Session ID ("+b+")")}).catch(function(c){e.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SESSION_CREATED,
null,"Could not load session ("+b+")! "+c.name)})},removeKeySession:function(b){var c=this;b.session.remove().then(function(){c.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SESSION_REMOVED,b.getSessionID())},function(d){c.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SESSION_REMOVED,b.getSessionID(),"Error removing session ("+b.getSessionID()+"). "+d.name)})},closeKeySession:function(b){var c=this;g(b).catch(function(d){c.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SESSION_CLOSED,
null,"Error closing session ("+b.getSessionID()+") "+d.name)})},resetKeySystem:function(){var b=this,e=function(e){m(e);0===d.length&&(d=[],c=b.keySystem=null,b.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_TEARDOWN_COMPLETE))},h=function(b){b.session.closed.then(function(){e(b)}).catch(function(c){e(b)});g(b).then(function(){e(b)}).catch(function(c){e(b)})};if(d&&0<d.length)for(var l=d.slice(0),k=0;k<l.length;k++)h(l[k]);else b.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_TEARDOWN_COMPLETE)}}};
MediaPlayer.models.ProtectionModel_21Jan2015.detect=function(b){return void 0===b.onencrypted||void 0===b.mediaKeys||void 0===navigator.requestMediaKeySystemAccess||"function"!==typeof navigator.requestMediaKeySystemAccess?!1:!0};MediaPlayer.models.ProtectionModel_21Jan2015.prototype={constructor:MediaPlayer.models.ProtectionModel_21Jan2015};MediaPlayer.vo.protection.ClearKeyKeySet=function(b,c){if(c&&"persistent"!==c&&"temporary"!==c)throw Error("Invalid ClearKey key set type!  Must be one of 'persistent' or 'temporary'");this.keyPairs=b;this.type=c;this.toJWK=function(){var b,c=this.keyPairs.length,g={keys:[]};for(b=0;b<c;b++)g.keys.push({kty:"oct",alg:"A128KW",kid:this.keyPairs[b].keyID,k:this.keyPairs[b].key});this.type&&(g.type=this.type);var c=JSON.stringify(g),g=c.length,k=new ArrayBuffer(g),l=new Uint8Array(k);for(b=0;b<g;b++)l[b]=
c.charCodeAt(b);return k}};MediaPlayer.vo.protection.ClearKeyKeySet.prototype={constructor:MediaPlayer.vo.protection.ClearKeyKeySet};MediaPlayer.vo.protection.KeyPair=function(b,c){this.keyID=b;this.key=c};MediaPlayer.vo.protection.KeyPair.prototype={constructor:MediaPlayer.vo.protection.KeyPair};MediaPlayer.vo.protection.SessionToken=function(){};MediaPlayer.dependencies.ProtectionController=function(){var b=[],c,d,e,g=!1,k=!1,l,m=function(b){var c=null;b=b.systemString;e&&(c=b in e?e[b]:null);return c},h=function(b,c){this.eventBus.dispatchEvent({type:MediaPlayer.dependencies.ProtectionController.events.LICENSE_REQUEST_COMPLETE,data:b,error:c})},f=function(b){if(b.error)this.log(b.error);else{var c=b.data;this.eventBus.dispatchEvent({type:MediaPlayer.dependencies.ProtectionController.events.KEY_MESSAGE,data:c});var d=c.messageType?c.messageType:
"license-request",e=c.message,f=c.sessionToken,c=m(this.keySystem),g=this.keySystem.systemString,l=this.protectionExt.getLicenseServer(this.keySystem,c,d),k=h.bind(this),n={sessionToken:f,messageType:d};if(l&&l.isMessageTypeSupported(d)){if(this.protectionExt.isClearKey(this.keySystem)){var p=this.protectionExt.processClearKeyLicenseRequest(c,e);if(p){this.log("DRM: ClearKey license request handled by application!");k(n);this.protectionModel.updateKeySession(f,p);return}}var r=new XMLHttpRequest,
q=this,p=null;c?c.serverURL?(b=c.serverURL,"string"===typeof b&&""!==b?p=b:"object"===typeof b&&b.hasOwnProperty(d)&&(p=b[d])):c.laURL&&""!==c.laURL&&(p=c.laURL):(p=this.keySystem.getLicenseServerURLFromInitData(MediaPlayer.dependencies.protection.CommonEncryption.getPSSHData(f.initData)),p||(p=b.data.laURL));(p=l.getServerURLFromMessage(p,e,d,f))?(r.open(l.getHTTPMethod(d),p,!0),r.responseType=l.getResponseType(g,d,c),r.onload=function(){if(200==this.status){var b=l.getLicenseMessage(this.response,
g,d,r.responseType);n.message=b;k(n);q.protectionModel.updateKeySession(f,b)}else k(n,"DRM: "+g+' update, XHR status is "'+this.statusText+'" ('+this.status+"), expected to be 200. readyState is "+this.readyState+".  Response is "+(this.response?l.getErrorResponse(this.response,g,d):"NONE"))},r.onabort=function(){k(n,"DRM: "+g+' update, XHR aborted. status is "'+this.statusText+'" ('+this.status+"), readyState is "+this.readyState)},r.onerror=function(){k(n,"DRM: "+g+' update, XHR error. status is "'+
this.statusText+'" ('+this.status+"), readyState is "+this.readyState)},b=function(b){var c;if(b)for(c in b)"authorization"===c.toLowerCase()&&(r.withCredentials=!0),r.setRequestHeader(c,b[c])},c&&b(c.httpRequestHeaders),b(this.keySystem.getRequestHeadersFromMessage(e)),c&&c.withCredentials&&(r.withCredentials=!0),e=f.onLicenseMessageCallback?q.licenseMessageCallback(e,f):this.keySystem.getLicenseRequestFromMessage(e,f),r.send(e)):k(n,"DRM: No license server URL specified!")}else this.log("DRM: License server request not required for this message (type = "+
b.data.messageType+").  Session ID = "+f.getSessionID()),k(n)}},n=function(b){"cenc"!==b.data.initDataType?this.log("DRM:  Only 'cenc' initData is supported!  Ignoring initData of type: "+b.data.initDataType):(b=b.data.initData,ArrayBuffer.isView(b)&&(b=b.buffer),b=this.protectionExt.getSupportedKeySystems(b),0===b.length?this.log("Received needkey event with initData, but we don't support any of the key systems!"):this.selectKeySystem(b,!1))},q=function(b){b.error?this.eventBus.dispatchEvent({type:MediaPlayer.dependencies.ProtectionController.events.SERVER_CERTIFICATE_UPDATED,
data:null,error:"DRM: Failed to update license server certificate. -- "+b.error}):(this.log("DRM: License server certificate successfully updated."),this.eventBus.dispatchEvent({type:MediaPlayer.dependencies.ProtectionController.events.SERVER_CERTIFICATE_UPDATED,data:null,error:null}))},t=function(b){b.error?this.eventBus.dispatchEvent({type:MediaPlayer.dependencies.ProtectionController.events.KEY_SESSION_CREATED,data:null,error:"DRM: Failed to create key session. -- "+b.error}):(this.log("DRM: Session created.  SessionID = "+
b.data.getSessionID()),this.eventBus.dispatchEvent({type:MediaPlayer.dependencies.ProtectionController.events.KEY_SESSION_CREATED,data:b.data,error:null}))},r=function(){this.log("DRM: Key added.");this.eventBus.dispatchEvent({type:MediaPlayer.dependencies.ProtectionController.events.KEY_ADDED,data:null,error:null})},p=function(b){this.eventBus.dispatchEvent({type:MediaPlayer.dependencies.ProtectionController.events.KEY_ADDED,data:null,error:"DRM: MediaKeyError - sessionId: "+b.data.sessionToken.getSessionID()+
".  "+b.data.error})},u=function(b){b.error?this.eventBus.dispatchEvent({type:MediaPlayer.dependencies.ProtectionController.events.KEY_SESSION_CLOSED,data:null,error:"DRM Failed to close key session. -- "+b.error}):(this.log("DRM: Session closed.  SessionID = "+b.data),this.eventBus.dispatchEvent({type:MediaPlayer.dependencies.ProtectionController.events.KEY_SESSION_CLOSED,data:b.data,error:null}))},w=function(b){b.error?this.eventBus.dispatchEvent({type:MediaPlayer.dependencies.ProtectionController.events.KEY_SESSION_REMOVED,
data:b.data,error:"DRM Failed to remove key session. -- "+b.error}):(this.log("DRM: Session removed.  SessionID = "+b.data),this.eventBus.dispatchEvent({type:MediaPlayer.dependencies.ProtectionController.events.KEY_SESSION_REMOVED,data:b.data,error:null}))},v=function(b){this.eventBus.dispatchEvent({type:MediaPlayer.dependencies.ProtectionController.events.KEY_STATUSES_CHANGED,data:b.data,error:null})},x=function(b){var c=this,d={};d[MediaPlayer.dependencies.protection.KeySystem.eventList.ENAME_INIT_REQUEST_COMPLETE]=
function(e){for(var f=0,h=!1;f<b.length;){if(e.data.requestData.schemeIdUri.toLowerCase()===b[f].ks.schemeIdURI){if(e.error){c.log("DRM: Could not download PSSH data for keysystem : "+b[f].ks.schemeIdURI);b.splice(f);continue}else b[f].initData=e.data.responseData;b[f].ks.unsubscribe(MediaPlayer.dependencies.protection.KeySystem.eventList.ENAME_INIT_REQUEST_COMPLETE,d)}else"pending"===b[f].initData&&(h=!0);f++}h||(k=!1,c.selectKeySystem(b,!0))};if(b&&0<b.length)for(var e=0,e=0;e<b.length;++e)"pending"===
b[e].initData&&(b[e].ks.subscribe(MediaPlayer.dependencies.protection.KeySystem.eventList.ENAME_INIT_REQUEST_COMPLETE,d),k=!0);k||c.selectKeySystem(b,!0)};return{system:void 0,log:void 0,protectionExt:void 0,keySystem:void 0,sessionType:"temporary",setup:function(){this[MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_MESSAGE]=f.bind(this);this[MediaPlayer.models.ProtectionModel.eventList.ENAME_NEED_KEY]=n.bind(this);this[MediaPlayer.models.ProtectionModel.eventList.ENAME_SERVER_CERTIFICATE_UPDATED]=
q.bind(this);this[MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_ADDED]=r.bind(this);this[MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_ERROR]=p.bind(this);this[MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SESSION_CREATED]=t.bind(this);this[MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SESSION_CLOSED]=u.bind(this);this[MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SESSION_REMOVED]=w.bind(this);this[MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_STATUSES_CHANGED]=
v.bind(this);this.protectionExt.getKeySystems();this.system.hasMapping("protectionModel")&&(this.protectionModel=this.system.getObject("protectionModel"),this.protectionModel.init());this.eventBus=this.system.getObject("eventBusCl")},initListeners:function(){this.protectionModel&&(this.protectionModel.subscribe(MediaPlayer.models.ProtectionModel.eventList.ENAME_SERVER_CERTIFICATE_UPDATED,this),this.protectionModel.subscribe(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_ADDED,this),this.protectionModel.subscribe(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_ERROR,
this),this.protectionModel.subscribe(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SESSION_CREATED,this),this.protectionModel.subscribe(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SESSION_CLOSED,this),this.protectionModel.subscribe(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SESSION_REMOVED,this),this.protectionModel.subscribe(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_MESSAGE,this),this.protectionModel.subscribe(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_STATUSES_CHANGED,
this))},init:function(b,e,f,h){if(!g){var k,n;e||f||h||(k=this.system.getObject("adapter"),n=k.getStreamsInfo(b)[0]);c=e||(n?k.getMediaInfoForType(b,n,"audio"):null);d=f||(n?k.getMediaInfoForType(b,n,"video"):null);l=h||(n?k.getMediaInfoForType(b,n,"muxed"):null);(b=this.protectionExt.getSupportedKeySystemsFromContentProtection((l?l:d?d:c).contentProtection))&&0<b.length&&x.call(this,b);g=!0}},addEventListener:function(b,c){this.eventBus.addEventListener(b,c)},removeEventListener:function(b,c){this.eventBus.removeEventListener(b,
c)},teardown:function(){this.setMediaElement(null);this.protectionModel.unsubscribe(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_MESSAGE,this);this.protectionModel.unsubscribe(MediaPlayer.models.ProtectionModel.eventList.ENAME_SERVER_CERTIFICATE_UPDATED,this);this.protectionModel.unsubscribe(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_ADDED,this);this.protectionModel.unsubscribe(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_ERROR,this);this.protectionModel.unsubscribe(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SESSION_CREATED,
this);this.protectionModel.unsubscribe(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SESSION_CLOSED,this);this.protectionModel.unsubscribe(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SESSION_REMOVED,this);this.protectionModel.unsubscribe(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_MESSAGE,this);this.protectionModel.unsubscribe(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_STATUSES_CHANGED,this);this.keySystem=void 0;this.protectionModel.teardown();this.protectionModel=
void 0},createKeySession:function(b,c,d){if(b=MediaPlayer.dependencies.protection.CommonEncryption.getPSSHForKeySystem(this.keySystem,b)){for(var e=this.protectionModel.getAllInitData(),f=0;f<e.length;f++)if(this.protectionExt.initDataEquals(b,e[f])){this.log("Ignoring initData because we have already seen it!");return}try{this.protectionModel.createKeySession(b,this.sessionType,c,d)}catch(h){this.eventBus.dispatchEvent({type:MediaPlayer.dependencies.ProtectionController.events.KEY_SESSION_CREATED,
data:null,error:"Error creating key session! "+h.message})}}else this.eventBus.dispatchEvent({type:MediaPlayer.dependencies.ProtectionController.events.KEY_SESSION_CREATED,data:null,error:"Selected key system is "+this.keySystem.systemString+".  needkey/encrypted event contains no initData corresponding to that key system!"})},loadKeySession:function(b){this.protectionModel.loadKeySession(b)},removeKeySession:function(b){this.protectionModel.removeKeySession(b)},closeKeySession:function(b){this.protectionModel.closeKeySession(b)},
setServerCertificate:function(b){this.protectionModel.setServerCertificate(b)},setMediaElement:function(b){this.protectionModel&&(b?(this.protectionModel.setMediaElement(b),this.protectionModel.subscribe(MediaPlayer.models.ProtectionModel.eventList.ENAME_NEED_KEY,this)):null===b&&(this.protectionModel.setMediaElement(b),this.protectionModel.unsubscribe(MediaPlayer.models.ProtectionModel.eventList.ENAME_NEED_KEY,this)))},setSessionType:function(b){this.sessionType=b},setProtectionData:function(b){e=
b},selectKeySystem:function(e,f){var h=this,g=[],l=[];d&&l.push(new MediaPlayer.vo.protection.MediaCapability(d.codec));c&&g.push(new MediaPlayer.vo.protection.MediaCapability(c.codec));var k=this.sessionType,n=[],m;if(this.keySystem)for(m=0;m<e.length;m++){if(this.keySystem===e[m].ks){k=this.getSessionType(this.keySystem);k=new MediaPlayer.vo.protection.KeySystemConfiguration(g,l,"optional","temporary"===k?"optional":"required",[k]);n.push({ks:e[m].ks,configs:[k]});g={};g[MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SYSTEM_ACCESS_COMPLETE]=
function(b){b.error?f||h.eventBus.dispatchEvent({type:MediaPlayer.dependencies.ProtectionController.events.KEY_SYSTEM_SELECTED,error:"DRM: KeySystem Access Denied! -- "+b.error}):(h.log("KeySystem Access Granted"),h.eventBus.dispatchEvent({type:MediaPlayer.dependencies.ProtectionController.events.KEY_SYSTEM_SELECTED,data:b.data}),h.createKeySession(e[m].initData))};this.protectionModel.subscribe(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SYSTEM_ACCESS_COMPLETE,g,void 0,!0);this.protectionModel.requestKeySystemAccess(n);
break}}else if(void 0===this.keySystem){this.keySystem=null;b.push(e);for(var p=0;p<e.length;p++)k=this.getSessionType(e[p].ks),k=new MediaPlayer.vo.protection.KeySystemConfiguration(g,l,"optional","temporary"===k?"optional":"required",[k]),n.push({ks:e[p].ks,configs:[k]});var r={},q;r[MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SYSTEM_ACCESS_COMPLETE]=function(b){b.error?(h.keySystem=void 0,h.protectionModel.unsubscribe(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SYSTEM_SELECTED,
r),f||h.eventBus.dispatchEvent({type:MediaPlayer.dependencies.ProtectionController.events.KEY_SYSTEM_SELECTED,error:"DRM: KeySystem Access Denied! -- "+b.error})):(q=b.data,h.log("KeySystem Access Granted ("+q.keySystem.systemString+")!  Selecting key system..."),h.protectionModel.selectKeySystem(q))};r[MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SYSTEM_SELECTED]=function(c){if(c.error)h.keySystem=void 0,f||h.eventBus.dispatchEvent({type:MediaPlayer.dependencies.ProtectionController.events.KEY_SYSTEM_SELECTED,
error:"DRM: Error selecting key system! -- "+c.error});else for(h.keySystem=h.protectionModel.keySystem,h.eventBus.dispatchEvent({type:MediaPlayer.dependencies.ProtectionController.events.KEY_SYSTEM_SELECTED,data:q}),c=0;c<b.length;c++)for(m=0;m<b[c].length;m++)if(h.keySystem===b[c][m].ks){h.createKeySession(b[c][m].initData);break}};this.protectionModel.subscribe(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SYSTEM_SELECTED,r,void 0,!0);this.protectionModel.subscribe(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SYSTEM_ACCESS_COMPLETE,
r,void 0,!0);this.protectionModel.requestKeySystemAccess(n)}else b.push(e)},getProtectionData:function(){return e},getAudioInfo:function(){return c},getVideoInfo:function(){return d},getSessionType:function(b){return b.isSessionTypeSupported(this.sessionType)?this.sessionType:"temporary"},licenseMessageCallback:function(b){return b}}};
MediaPlayer.dependencies.ProtectionController.events={KEY_SYSTEM_SELECTED:"keySystemSelected",SERVER_CERTIFICATE_UPDATED:"serverCertificateUpdated",KEY_ADDED:"keyAdded",KEY_SESSION_CREATED:"keySessionCreated",KEY_SESSION_REMOVED:"keySessionRemoved",KEY_SESSION_CLOSED:"keySessionClosed",KEY_STATUSES_CHANGED:"keyStatusesChanged",KEY_MESSAGE:"keyMessage",LICENSE_REQUEST_COMPLETE:"licenseRequestComplete"};MediaPlayer.dependencies.ProtectionController.prototype={constructor:MediaPlayer.dependencies.ProtectionController};MediaPlayer.dependencies.ProtectionExtensions=function(){this.log=this.system=void 0;this.keySystems=[];this.clearkeyKeySystem=this.unsubscribe=this.subscribe=this.notify=void 0};
MediaPlayer.dependencies.ProtectionExtensions.prototype={constructor:MediaPlayer.dependencies.ProtectionExtensions,setup:function(){var b;b=this.system.getObject("ksPlayReady");this.keySystems.push(b);b=this.system.getObject("ksWidevine");this.keySystems.push(b);b=this.system.getObject("ksAccess");this.keySystems.push(b);b=this.system.getObject("ksClearKey");this.keySystems.push(b);this.clearkeyKeySystem=b},getKeySystems:function(){return this.keySystems},getKeySystemBySystemString:function(b){for(var c=
0;c<this.keySystems.length;c++)if(this.keySystems[c].systemString===b)return this.keySystems[c];return null},isClearKey:function(b){return b===this.clearkeyKeySystem},initDataEquals:function(b,c){if(b.byteLength===c.byteLength){for(var d=new Uint8Array(b),e=new Uint8Array(c),g=0;g<d.length;g++)if(d[g]!==e[g])return!1;return!0}return!1},getSupportedKeySystemsFromContentProtection:function(b){var c,d,e,g,k=[];if(b)for(e=0;e<this.keySystems.length;++e)for(d=this.keySystems[e],g=0;g<b.length;++g)c=b[g],
c.schemeIdUri.toLowerCase()===d.schemeIdURI&&(c=d.getInitData(c))&&k.push({ks:this.keySystems[e],initData:c});return k},getSupportedKeySystems:function(b){var c=[],d=MediaPlayer.dependencies.protection.CommonEncryption.parsePSSHList(b);for(b=0;b<this.keySystems.length;++b)this.keySystems[b].uuid in d&&c.push({ks:this.keySystems[b],initData:d[this.keySystems[b].uuid]});return c},getLicenseServer:function(b,c){var d=null;c&&c.hasOwnProperty("drmtoday")?d=this.system.getObject("serverDRMToday"):"com.widevine.alpha"===
b.systemString?d=this.system.getObject("serverWidevine"):"com.microsoft.playready"===b.systemString?d=this.system.getObject("serverPlayReady"):"com.adobe.primetime"===b.systemString?d=this.system.getObject("serverAccess"):"org.w3.clearkey"===b.systemString&&(d=this.system.getObject("serverClearKey"));return d},processClearKeyLicenseRequest:function(b,c){try{return MediaPlayer.dependencies.protection.KeySystem_ClearKey.getClearKeysFromProtectionData(b,c)}catch(d){return this.log("Failed to retrieve clearkeys from ProtectionData"),
null}}};MediaPlayer.dependencies.protection.CommonEncryption={findCencContentProtection:function(b){for(var c=null,d=0;d<b.length;++d){var e=b[d];"urn:mpeg:dash:mp4protection:2011"===e.schemeIdUri.toLowerCase()&&"cenc"===e.value.toLowerCase()&&(c=e)}return c},getPSSHData:function(b){var c=8,d=new DataView(b),e=d.getUint8(c),c=c+20;0<e&&(c+=4+16*d.getUint32(c));return b.slice(c+4)},getPSSHForKeySystem:function(b,c){var d=MediaPlayer.dependencies.protection.CommonEncryption.parsePSSHList(c);return d.hasOwnProperty(b.uuid.toLowerCase())?
d[b.uuid.toLowerCase()]:null},parseInitDataFromContentProtection:function(b){return"pssh"in b?BASE64.decodeArray(b.pssh.__text).buffer:null},parsePSSHList:function(b){if(null===b)return[];b=new DataView(b);for(var c={},d=0;;){var e,g,k=d;if(d>=b.buffer.byteLength)break;e=b.getUint32(d);e=d+e;d+=4;if(1886614376===b.getUint32(d)&&(d+=4,g=b.getUint8(d),0===g||1===g)){d+=1;d+=3;g="";var l,m;for(l=0;4>l;l++)m=b.getUint8(d+l).toString(16),g+=1===m.length?"0"+m:m;d+=4;g+="-";for(l=0;2>l;l++)m=b.getUint8(d+
l).toString(16),g+=1===m.length?"0"+m:m;d+=2;g+="-";for(l=0;2>l;l++)m=b.getUint8(d+l).toString(16),g+=1===m.length?"0"+m:m;d+=2;g+="-";for(l=0;2>l;l++)m=b.getUint8(d+l).toString(16),g+=1===m.length?"0"+m:m;d+=2;g+="-";for(l=0;6>l;l++)m=b.getUint8(d+l).toString(16),g+=1===m.length?"0"+m:m;d+=6;g=g.toLowerCase();b.getUint32(d);c[g]=b.buffer.slice(k,e)}d=e}return c}};MediaPlayer.dependencies.protection.KeySystem=function(){};MediaPlayer.dependencies.protection.KeySystem.eventList={ENAME_INIT_REQUEST_COMPLETE:"initRequestComplete"};MediaPlayer.dependencies.protection.KeySystem_Access=function(){var b=function(b){var d=/^(?:(?:[a-z]+:)?\/)?\//i,e;"undefined"!==typeof b&&b.pssh&&b.pssh.uri&&(e=b.pssh.uri,!d.test(b.pssh.uri)&&b.BaseURL&&(e=b.BaseURL+b.pssh.uri));return e};return{schemeIdURI:"urn:uuid:f239e769-efa3-4850-9c16-a903c6932efb",systemString:"com.adobe.primetime",uuid:"f239e769-efa3-4850-9c16-a903c6932efb",notify:void 0,subscribe:void 0,unsubscribe:void 0,getInitData:function(c){if("pssh"in c&&c.pssh.uri&&""!==c.pssh.uri){var d=
new XMLHttpRequest,e=b(c),g=this;d.open("GET",e,!0);d.responseType="arraybuffer";d.onload=function(){if(200==this.status){var b=new MediaPlayer.vo.protection.InitRequestComplete(this.response,c,g);g.notify(MediaPlayer.dependencies.protection.KeySystem.eventList.ENAME_INIT_REQUEST_COMPLETE,b)}else g.notify(MediaPlayer.dependencies.protection.KeySystem.eventList.ENAME_INIT_REQUEST_COMPLETE,{requestData:c},Error('DRM: Access update, XHR status is "'+d.statusText+'" ('+d.status+"), expected to be 200. readyState is "+
d.readyState)+".  Response is "+(this.response?String.fromCharCode.apply(null,new Uint8Array(this.response)):"NONE"))};d.onabort=function(){g.notify(MediaPlayer.dependencies.protection.KeySystem.eventList.ENAME_INIT_REQUEST_COMPLETE,{requestData:c},Error('DRM: Access update, XHR aborted. status is "'+d.statusText+'" ('+d.status+"), readyState is "+d.readyState))};d.onerror=function(){g.notify(MediaPlayer.dependencies.protection.KeySystem.eventList.ENAME_INIT_REQUEST_COMPLETE,{requestData:c},Error('DRM: Access update, XHR error. status is "'+
d.statusText+'" ('+d.status+"), readyState is "+d.readyState))};d.send();return"pending"}return MediaPlayer.dependencies.protection.CommonEncryption.parseInitDataFromContentProtection.call(this,c)},getRequestHeadersFromMessage:function(){return null},getLicenseRequestFromMessage:function(b){return new Uint8Array(b)},getLicenseServerURLFromInitData:function(){return null},isSessionTypeSupported:function(b){return"undefined"===typeof b||null===b||"temporary"!==b&&"persistent"!==b?!1:!0}}};
MediaPlayer.dependencies.protection.KeySystem_Access.prototype={constructor:MediaPlayer.dependencies.protection.KeySystem_Access};MediaPlayer.dependencies.protection.KeySystem_ClearKey=function(){return{system:void 0,schemeIdURI:"urn:uuid:1077efec-c0b2-4d02-ace3-3c1e52e2fb4b",systemString:"org.w3.clearkey",uuid:"1077efec-c0b2-4d02-ace3-3c1e52e2fb4b",getInitData:MediaPlayer.dependencies.protection.CommonEncryption.parseInitDataFromContentProtection,getRequestHeadersFromMessage:function(){return null},getLicenseRequestFromMessage:function(b){return new Uint8Array(b)},getLicenseServerURLFromInitData:function(){return null},isSessionTypeSupported:function(b){return"undefined"!==
typeof b&&null!==b&&"temporary"===b?!0:!1}}};MediaPlayer.dependencies.protection.KeySystem_ClearKey.prototype={constructor:MediaPlayer.dependencies.protection.KeySystem_ClearKey};
MediaPlayer.dependencies.protection.KeySystem_ClearKey.getClearKeysFromProtectionData=function(b,c){var d=null;if(b){for(var d=JSON.parse(String.fromCharCode.apply(null,new Uint8Array(c))),e=[],g=0;g<d.kids.length;g++){var k=d.kids[g],l=b.clearkeys.hasOwnProperty(k)?b.clearkeys[k]:null;if(!l)throw Error("DRM: ClearKey keyID ("+k+") is not known!");e.push(new MediaPlayer.vo.protection.KeyPair(k,l))}d=new MediaPlayer.vo.protection.ClearKeyKeySet(e)}return d};MediaPlayer.dependencies.protection.KeySystem_PlayReady=function(){var b="utf16";return{schemeIdURI:"urn:uuid:9a04f079-9840-4286-ab92-e65be0885f95",systemString:"com.microsoft.playready",uuid:"9a04f079-9840-4286-ab92-e65be0885f95",getInitData:function(b){var d=0,e,g=new Uint8Array([112,115,115,104,0,0,0,0]),k=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]),l=null,m,h;if("pssh"in b)return MediaPlayer.dependencies.protection.CommonEncryption.parseInitDataFromContentProtection(b);
if("pro"in b)l=BASE64.decodeArray(b.pro.__text);else if("prheader"in b)l=BASE64.decodeArray(b.prheader.__text);else return null;b=l.length;e=4+g.length+k.length+4+b;m=new ArrayBuffer(e);h=new Uint8Array(m);m=new DataView(m);m.setUint32(d,e);d+=4;h.set(g,d);d+=g.length;h.set(k,d);d+=k.length;m.setUint32(d,b);h.set(l,d+4);return h.buffer},getRequestHeadersFromMessage:function(c){var d={},e=new DOMParser;c="utf16"===b?new Uint16Array(c):new Uint8Array(c);c=String.fromCharCode.apply(null,c);c=e.parseFromString(c,
"application/xml");e=c.getElementsByTagName("name");c=c.getElementsByTagName("value");for(var g=0;g<e.length;g++)d[e[g].childNodes[0].nodeValue]=c[g].childNodes[0].nodeValue;d.hasOwnProperty("Content")&&(d["Content-Type"]=d.Content,delete d.Content);return d},getLicenseRequestFromMessage:function(c){var d;d=new DOMParser;var e=null;c="utf16"===b?new Uint16Array(c):new Uint8Array(c);c=String.fromCharCode.apply(null,c);d=d.parseFromString(c,"application/xml");d.getElementsByTagName("Challenge")[0]&&
(d=d.getElementsByTagName("Challenge")[0].childNodes[0].nodeValue)&&(e=BASE64.decode(d));return e},getLicenseServerURLFromInitData:function(b){if(b)for(var d=new DataView(b),e=d.getUint16(4,!0),g=6,k=new DOMParser,l=0;l<e;l++){var m=d.getUint16(g,!0),g=g+2,h=d.getUint16(g,!0),g=g+2;if(1!==m)g+=h;else{m=b.slice(g,g+h);m=String.fromCharCode.apply(null,new Uint16Array(m));m=k.parseFromString(m,"application/xml");if(m.getElementsByTagName("LA_URL")[0]&&(h=m.getElementsByTagName("LA_URL")[0].childNodes[0].nodeValue))return h;
if(m.getElementsByTagName("LUI_URL")[0]&&(m=m.getElementsByTagName("LUI_URL")[0].childNodes[0].nodeValue))return m}}return null},setPlayReadyMessageFormat:function(c){if("utf8"!==c&&"utf16"!==c)throw Error("Illegal PlayReady message format! -- "+c);b=c},isSessionTypeSupported:function(b){return"undefined"!==typeof b&&null!==b&&"temporary"===b?!0:!1}}};MediaPlayer.dependencies.protection.KeySystem_PlayReady.prototype={constructor:MediaPlayer.dependencies.protection.KeySystem_PlayReady};MediaPlayer.dependencies.protection.KeySystem_Widevine=function(){return{schemeIdURI:"urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed",systemString:"com.widevine.alpha",uuid:"edef8ba9-79d6-4ace-a3c8-27dcd51d21ed",getInitData:MediaPlayer.dependencies.protection.CommonEncryption.parseInitDataFromContentProtection,getRequestHeadersFromMessage:function(){return null},getLicenseRequestFromMessage:function(b){return new Uint8Array(b)},getLicenseServerURLFromInitData:function(){return null},isSessionTypeSupported:function(b){return"undefined"!==
typeof b&&null!==b&&"temporary"===b?!0:!1}}};MediaPlayer.dependencies.protection.KeySystem_Widevine.prototype={constructor:MediaPlayer.dependencies.protection.KeySystem_Widevine};MediaPlayer.dependencies.protection.servers.ClearKey=function(){return{getServerURLFromMessage:function(b,c){var d=JSON.parse(String.fromCharCode.apply(null,new Uint8Array(c)));b+="/?";for(var e=0;e<d.kids.length;e++)b+=d.kids[e]+"&";return b=b.substring(0,b.length-1)},getHTTPMethod:function(){return"GET"},getResponseType:function(){return"json"},getLicenseMessage:function(b){if(!b.hasOwnProperty("keys"))return null;var c,d=[];for(c=0;c<b.keys.length;c++){var e=b.keys[c],g=e.kid.replace(/=/g,""),
e=e.k.replace(/=/g,"");d.push(new MediaPlayer.vo.protection.KeyPair(g,e))}return new MediaPlayer.vo.protection.ClearKeyKeySet(d)},getErrorResponse:function(b){return String.fromCharCode.apply(null,new Uint8Array(b))},isMessageTypeSupported:function(b){return"license-request"===b?!0:!1}}};MediaPlayer.dependencies.protection.servers.ClearKey.prototype={constructor:MediaPlayer.dependencies.protection.servers.ClearKey};MediaPlayer.dependencies.protection.servers.DRMToday=function(){var b={"com.widevine.alpha":{responseType:"json",getLicenseMessage:function(b){return BASE64.decodeArray(b.license)},getErrorResponse:function(b){return b}},"com.microsoft.playready":{responseType:"arraybuffer",getLicenseMessage:function(b){return b},getErrorResponse:function(b){return String.fromCharCode.apply(null,new Uint8Array(b))}}};return{getServerURLFromMessage:function(b){return b},getHTTPMethod:function(){return"POST"},getResponseType:function(c){return b[c].responseType},
getLicenseMessage:function(c,d){return b[d].getLicenseMessage(c)},getErrorResponse:function(c,d){return b[d].getErrorResponse(c)},isMessageTypeSupported:function(b){return"license-request"===b?!0:!1}}};MediaPlayer.dependencies.protection.servers.DRMToday.prototype={constructor:MediaPlayer.dependencies.protection.servers.DRMToday};MediaPlayer.dependencies.protection.servers.PlayReady=function(){return{getServerURLFromMessage:function(b){return b},getHTTPMethod:function(){return"POST"},getResponseType:function(){return"arraybuffer"},getLicenseMessage:function(b){return b},getErrorResponse:function(b){return String.fromCharCode.apply(null,new Uint8Array(b))},isMessageTypeSupported:function(b){return"license-request"===b?!0:!1}}};MediaPlayer.dependencies.protection.servers.PlayReady.prototype={constructor:MediaPlayer.dependencies.protection.servers.PlayReady};MediaPlayer.dependencies.protection.servers.Widevine=function(){return{getServerURLFromMessage:function(b){return b},getHTTPMethod:function(){return"POST"},getResponseType:function(){return"arraybuffer"},getLicenseMessage:function(b){return b},getErrorResponse:function(b){return String.fromCharCode.apply(null,new Uint8Array(b))},isMessageTypeSupported:function(b){return"license-request"===b?!0:!1}}};MediaPlayer.dependencies.protection.servers.Widevine.prototype={constructor:MediaPlayer.dependencies.protection.servers.Widevine};MediaPlayer.dependencies.protection.servers.Access=function(){return{getServerURLFromMessage:function(b){return b},getHTTPMethod:function(){return"POST"},getResponseType:function(){return"arraybuffer"},getLicenseMessage:function(b){return b},getErrorResponse:function(b){return String.fromCharCode.apply(null,new Uint8Array(b))},isMessageTypeSupported:function(b){return"license-request"===b||"individualization-request"===b||"license-release"===b?!0:!1}}};
MediaPlayer.dependencies.protection.servers.Access.prototype={constructor:MediaPlayer.dependencies.protection.servers.Access};MediaPlayer.vo.protection.KeyError=function(b,c){this.sessionToken=b;this.error=c};MediaPlayer.vo.protection.KeyError.prototype={constructor:MediaPlayer.vo.protection.KeyError};MediaPlayer.vo.protection.KeyMessage=function(b,c,d,e){this.sessionToken=b;this.message=c;this.defaultURL=d;this.messageType=e?e:"license-request"};MediaPlayer.vo.protection.KeyMessage.prototype={constructor:MediaPlayer.vo.protection.KeyMessage};MediaPlayer.vo.protection.LicenseRequestComplete=function(b,c,d){this.message=b;this.sessionToken=c;this.messageType=d?d:"license-request"};MediaPlayer.vo.protection.LicenseRequestComplete.prototype={constructor:MediaPlayer.vo.protection.LicenseRequestComplete};MediaPlayer.vo.protection.InitRequestComplete=function(b,c,d){this.responseData=b;this.keySystem=d;this.requestData=c};MediaPlayer.vo.protection.InitRequestComplete.prototype={constructor:MediaPlayer.vo.protection.InitRequestComplete};MediaPlayer.vo.protection.NeedKey=function(b,c){this.initData=b;this.initDataType=c};MediaPlayer.vo.protection.NeedKey.prototype={constructor:MediaPlayer.vo.protection.NeedKey};MediaPlayer.vo.protection.ProtectionData=function(b,c,d){this.serverURL=b;this.httpRequestHeaders=c;this.clearkeys=d};MediaPlayer.vo.protection.ProtectionData.prototype={constructor:MediaPlayer.vo.protection.ProtectionData};MediaPlayer.vo.protection.KeySystemAccess=function(b,c){this.keySystem=b;this.ksConfiguration=c};MediaPlayer.vo.protection.KeySystemAccess.prototype={constructor:MediaPlayer.vo.protection.KeySystemAccess};MediaPlayer.vo.protection.KeySystemConfiguration=function(b,c,d,e,g){this.initDataTypes=["cenc"];this.audioCapabilities=b;this.videoCapabilities=c;this.distinctiveIdentifier=d;this.persistentState=e;this.sessionTypes=g};MediaPlayer.vo.protection.KeySystemConfiguration.prototype={constructor:MediaPlayer.vo.protection.KeySystemConfiguration};MediaPlayer.vo.protection.MediaCapability=function(b,c){this.contentType=b;this.robustness=c};MediaPlayer.vo.protection.MediaCapability.prototype={constructor:MediaPlayer.vo.protection.MediaCapability};MediaPlayer.rules.SwitchRequest=function(b,c){this.value=b;this.priority=c;void 0===this.value&&(this.value=999);void 0===this.priority&&(this.priority=.5)};MediaPlayer.rules.SwitchRequest.prototype={constructor:MediaPlayer.rules.SwitchRequest,NO_CHANGE:999,DEFAULT:.5,STRONG:1,WEAK:0};MediaPlayer.rules.RulesContext=function(b,c){var d=b.getCurrentRepresentationInfo();return{getStreamInfo:function(){return d.mediaInfo.streamInfo},getMediaInfo:function(){return d.mediaInfo},getTrackInfo:function(){return d},getCurrentValue:function(){return c},getManifestInfo:function(){return d.mediaInfo.streamInfo.manifestInfo},getStreamProcessor:function(){return b}}};MediaPlayer.rules.RulesContext.prototype={constructor:MediaPlayer.rules.RulesContext};MediaPlayer.rules.RulesController=function(){var b={},c=["execute"],d=function(b){var d=c.length,e=0;for(e;e<d;e+=1)if(!b.hasOwnProperty(c[e]))return!1;return!0},e=function(b){var c=b.execute.bind(b);b.execute=function(d,e){c(d,function(c){e.call(b,new MediaPlayer.rules.SwitchRequest(c.value,c.priority))})};"function"!==typeof b.reset&&(b.reset=function(){});return b},g=function(b,c,g){var h,f,n,q,t,r;for(f in c)if(q=c[f],t=q.length)for(r=0;r<t;r+=1)h=q[r],d.call(this,h)&&(h=e.call(this,h),n=b.getRules(f),
g&&(g=!1,n.length=0),this.system.injectInto(h),n.push(h))};return{system:void 0,log:void 0,SCHEDULING_RULE:0,ABR_RULE:1,SYNC_RULE:2,initialize:function(){b[this.ABR_RULE]=this.system.getObject("abrRulesCollection");b[this.SCHEDULING_RULE]=this.system.getObject("scheduleRulesCollection");b[this.SYNC_RULE]=this.system.getObject("synchronizationRulesCollection")},setRules:function(c,d){c!==this.SCHEDULING_RULE&&c!==this.ABR_RULE||!d||g.call(this,b[c],d,!0)},addRules:function(c,d){c!==this.SCHEDULING_RULE&&
c!==this.ABR_RULE||!d||g.call(this,b[c],d,!1)},applyRules:function(b,c,e,h,f){var g=b.length,q=g,t={};c=new MediaPlayer.rules.RulesContext(c,h);var r,p,u=function(b){var c,d;b.value!==MediaPlayer.rules.SwitchRequest.prototype.NO_CHANGE&&(t[b.priority]=f(t[b.priority],b.value));--g||(t[MediaPlayer.rules.SwitchRequest.prototype.WEAK]!==MediaPlayer.rules.SwitchRequest.prototype.NO_CHANGE&&(d=MediaPlayer.rules.SwitchRequest.prototype.WEAK,c=t[MediaPlayer.rules.SwitchRequest.prototype.WEAK]),t[MediaPlayer.rules.SwitchRequest.prototype.DEFAULT]!==
MediaPlayer.rules.SwitchRequest.prototype.NO_CHANGE&&(d=MediaPlayer.rules.SwitchRequest.prototype.DEFAULT,c=t[MediaPlayer.rules.SwitchRequest.prototype.DEFAULT]),t[MediaPlayer.rules.SwitchRequest.prototype.STRONG]!==MediaPlayer.rules.SwitchRequest.prototype.NO_CHANGE&&(d=MediaPlayer.rules.SwitchRequest.prototype.STRONG,c=t[MediaPlayer.rules.SwitchRequest.prototype.STRONG]),d!=MediaPlayer.rules.SwitchRequest.prototype.STRONG&&d!=MediaPlayer.rules.SwitchRequest.prototype.WEAK&&(d=MediaPlayer.rules.SwitchRequest.prototype.DEFAULT),
e({value:void 0!==c?c:h,confidence:d}))};t[MediaPlayer.rules.SwitchRequest.prototype.STRONG]=MediaPlayer.rules.SwitchRequest.prototype.NO_CHANGE;t[MediaPlayer.rules.SwitchRequest.prototype.WEAK]=MediaPlayer.rules.SwitchRequest.prototype.NO_CHANGE;t[MediaPlayer.rules.SwitchRequest.prototype.DEFAULT]=MediaPlayer.rules.SwitchRequest.prototype.NO_CHANGE;for(p=0;p<q;p+=1)r=b[p],d.call(this,r)?r.execute(c,u):g--},reset:function(){var c=b[this.ABR_RULE],d=b[this.SCHEDULING_RULE],e=b[this.SYNC_RULE],h=[];
c&&(h=c.getRules(MediaPlayer.rules.ABRRulesCollection.prototype.QUALITY_SWITCH_RULES)||[]);d&&h.concat(d.getRules(MediaPlayer.rules.ScheduleRulesCollection.prototype.NEXT_FRAGMENT_RULES)||[]).concat(d.getRules(MediaPlayer.rules.ScheduleRulesCollection.prototype.FRAGMENTS_TO_SCHEDULE_RULES)||[]).concat(d.getRules(MediaPlayer.rules.ScheduleRulesCollection.prototype.FRAGMENTS_TO_EXECUTE_RULES)||[]);e&&h.concat(e.getRules(MediaPlayer.rules.SynchronizationRulesCollection.prototype.TIME_SYNCHRONIZED_RULES)||
[]).concat(e.getRules(MediaPlayer.rules.SynchronizationRulesCollection.prototype.BEST_GUESS_RULES)||[]);c=h.length;for(e=0;e<c;e+=1)d=h[e],"function"===typeof d.reset&&d.reset();b={}}}};MediaPlayer.rules.RulesController.prototype={constructor:MediaPlayer.rules.RulesController};MediaPlayer.rules.InsufficientBufferRule=function(){var b={},c=0,d=function(){b={}};return{log:void 0,metricsModel:void 0,playbackController:void 0,setup:function(){this[MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_SEEKING]=d},execute:function(d,g){var k=(new Date).getTime(),l=d.getMediaInfo().type,m=d.getCurrentValue(),h=this.metricsModel.getReadOnlyMetricsFor(l),h=0<h.BufferState.length?h.BufferState[h.BufferState.length-1]:null,f=new MediaPlayer.rules.SwitchRequest(MediaPlayer.rules.SwitchRequest.prototype.NO_CHANGE,
MediaPlayer.rules.SwitchRequest.prototype.WEAK);if(!(1E3>k-c||null===h)){var n=h.state;b[l]=b[l]||{};b[l].state=n;n!==MediaPlayer.dependencies.BufferController.BUFFER_LOADED||b[l].firstBufferLoadedEvent||(b[l].firstBufferLoadedEvent=!0);h.state===MediaPlayer.dependencies.BufferController.BUFFER_EMPTY&&void 0!==b[l].firstBufferLoadedEvent&&(f=new MediaPlayer.rules.SwitchRequest(0,MediaPlayer.rules.SwitchRequest.prototype.STRONG));f.value!==MediaPlayer.rules.SwitchRequest.prototype.NO_CHANGE&&f.value!==
m&&this.log("InsufficientBufferRule requesting switch to index: ",f.value,"type: ",l," Priority: ",f.priority===MediaPlayer.rules.SwitchRequest.prototype.DEFAULT?"Default":f.priority===MediaPlayer.rules.SwitchRequest.prototype.STRONG?"Strong":"Weak");c=k}g(f)},reset:function(){b={};c=0}}};MediaPlayer.rules.InsufficientBufferRule.prototype={constructor:MediaPlayer.rules.InsufficientBufferRule};MediaPlayer.rules.ABRRulesCollection=function(){var b=[],c=[];return{insufficientBufferRule:void 0,bufferOccupancyRule:void 0,throughputRule:void 0,abandonRequestRule:void 0,getRules:function(d){switch(d){case MediaPlayer.rules.ABRRulesCollection.prototype.QUALITY_SWITCH_RULES:return b;case MediaPlayer.rules.ABRRulesCollection.prototype.ABANDON_FRAGMENT_RULES:return c;default:return null}},setup:function(){b.push(this.throughputRule)}}};
MediaPlayer.rules.ABRRulesCollection.prototype={constructor:MediaPlayer.rules.ABRRulesCollection,QUALITY_SWITCH_RULES:"qualitySwitchRules",ABANDON_FRAGMENT_RULES:"abandonFragmentRules"};MediaPlayer.rules.BufferOccupancyRule=function(){var b=0;return{log:void 0,metricsModel:void 0,execute:function(c,d){var e=(new Date).getTime()/1E3,g=c.getMediaInfo(),k=c.getTrackInfo(),l=g.type,k=isNaN(k.fragmentDuration)?2:k.fragmentDuration/2,m=c.getCurrentValue(),h=c.getStreamProcessor().getABRController(),f=this.metricsModel.getReadOnlyMetricsFor(l),n=0<f.BufferLevel.length?f.BufferLevel[f.BufferLevel.length-1]:null,f=0<f.BufferState.length?f.BufferState[f.BufferState.length-1]:null,q=!1,t=g.representationCount-
1,r=new MediaPlayer.rules.SwitchRequest(MediaPlayer.rules.SwitchRequest.prototype.NO_CHANGE,MediaPlayer.rules.SwitchRequest.prototype.WEAK);e-b<k||h.getAbandonmentStateFor(l)===MediaPlayer.dependencies.AbrController.ABANDON_LOAD||(null!==n&&null!==f&&n.level>f.target&&(q=n.level-f.target>MediaPlayer.dependencies.BufferController.RICH_BUFFER_THRESHOLD)&&1<g.representationCount&&(r=new MediaPlayer.rules.SwitchRequest(t,MediaPlayer.rules.SwitchRequest.prototype.STRONG)),r.value!==MediaPlayer.rules.SwitchRequest.prototype.NO_CHANGE&&
r.value!==m&&this.log("BufferOccupancyRule requesting switch to index: ",r.value,"type: ",l," Priority: ",r.priority===MediaPlayer.rules.SwitchRequest.prototype.DEFAULT?"Default":r.priority===MediaPlayer.rules.SwitchRequest.prototype.STRONG?"Strong":"Weak"));d(r)},reset:function(){b=0}}};MediaPlayer.rules.BufferOccupancyRule.prototype={constructor:MediaPlayer.rules.BufferOccupancyRule};MediaPlayer.rules.ThroughputRule=function(){var b=[],c=0,d=function(c,d){var k=0,l=d?2:3,m=b[c],h=m.length,l=h<l?h:l;if(0<h){for(var k=0,f=h-l;f<h;f++)k+=m[f];k/=l}m.length>l&&m.shift();return k*MediaPlayer.dependencies.AbrController.BANDWIDTH_SAFETY/1E3};return{log:void 0,metricsExt:void 0,metricsModel:void 0,manifestExt:void 0,manifestModel:void 0,execute:function(e,g){var k=(new Date).getTime()/1E3,l=e.getMediaInfo(),m=l.type,h=e.getCurrentValue(),f=e.getTrackInfo(),n=this.metricsModel.getReadOnlyMetricsFor(m),
q=e.getStreamProcessor(),t=q.getABRController(),r=q.isDynamic(),p=this.metricsExt.getCurrentHttpRequest(n),u=isNaN(f.fragmentDuration)?2:f.fragmentDuration/2,f=0<n.BufferState.length?n.BufferState[n.BufferState.length-1]:null,w=0<n.BufferLevel.length?n.BufferLevel[n.BufferLevel.length-1]:null,v=new MediaPlayer.rules.SwitchRequest(MediaPlayer.rules.SwitchRequest.prototype.NO_CHANGE,MediaPlayer.rules.SwitchRequest.prototype.WEAK);if(!(k-c<u)&&n&&null!==p&&p.type===MediaPlayer.vo.metrics.HTTPRequest.MEDIA_SEGMENT_TYPE&&
null!==f&&null!==w&&(k=(p.tfinish.getTime()-p.tresponse.getTime())/1E3,p.trace.length&&(p=Math.round(8*p.trace[p.trace.length-1].b/k),b[m]=b[m]||[],Infinity!==p&&p!==b[m][b[m].length-1]&&b[m].push(p)),p=Math.round(d(m,r)),t.setAverageThroughput(m,p),t.getAbandonmentStateFor(m)!==MediaPlayer.dependencies.AbrController.ABANDON_LOAD)){if(f.state===MediaPlayer.dependencies.BufferController.BUFFER_LOADED||r)l=t.getQualityForBitrate(l,p),q.getScheduleController().setTimeToLoadDelay(0),v=new MediaPlayer.rules.SwitchRequest(l,
MediaPlayer.rules.SwitchRequest.prototype.DEFAULT);v.value!==MediaPlayer.rules.SwitchRequest.prototype.NO_CHANGE&&v.value!==h&&this.log("ThroughputRule requesting switch to index: ",v.value,"type: ",m," Priority: ",v.priority===MediaPlayer.rules.SwitchRequest.prototype.DEFAULT?"Default":v.priority===MediaPlayer.rules.SwitchRequest.prototype.STRONG?"Strong":"Weak","Average throughput",Math.round(p),"kbps")}g(v)},reset:function(){b=[];c=0}}};MediaPlayer.rules.ThroughputRule.prototype={constructor:MediaPlayer.rules.ThroughputRule};MediaPlayer.rules.AbandonRequestsRule=function(){var b={},c={},d=function(c,d){b[c]=b[c]||{};b[c][d]=b[c][d]||{}};return{metricsExt:void 0,log:void 0,execute:function(e,g){var k=(new Date).getTime(),l=e.getMediaInfo().type,m=e.getCurrentValue(),h=e.getStreamProcessor(),f=e.getTrackInfo(),n=m.data.request,m=e.getStreamProcessor().getABRController(),q,t=new MediaPlayer.rules.SwitchRequest(MediaPlayer.rules.SwitchRequest.prototype.NO_CHANGE,MediaPlayer.rules.SwitchRequest.prototype.WEAK);if(!isNaN(n.index)){d(l,
n.index);q=b[l][n.index];if(null===q||null===n.firstByteDate||c.hasOwnProperty(q.id)){g(t);return}void 0===q.firstByteTime&&(q.firstByteTime=n.firstByteDate.getTime(),q.segmentDuration=n.duration,q.bytesTotal=n.bytesTotal,q.id=n.index);q.bytesLoaded=n.bytesLoaded;q.elapsedTime=k-q.firstByteTime;if(q.bytesLoaded<q.bytesTotal&&500<=q.elapsedTime){q.measuredBandwidthInKbps=Math.round(8*q.bytesLoaded/q.elapsedTime);q.estimatedTimeOfDownload=(.008*q.bytesTotal/q.measuredBandwidthInKbps).toFixed(2);if(q.estimatedTimeOfDownload<
1.5*q.segmentDuration||0===f.quality){g(t);return}c.hasOwnProperty(q.id)||(k=function(d){var e=d.value;d=d.confidence;d==MediaPlayer.rules.SwitchRequest.prototype.STRONG&&(t=new MediaPlayer.rules.SwitchRequest(e,d),c[q.id]=q,this.log("AbandonRequestsRule ( ",l,"frag id",q.id,") is asking to abandon and switch to quality to ",e," measured bandwidth was",q.measuredBandwidthInKbps),delete b[l][q.id],g(t))},"video"!==l&&"muxed"!==l)||(n=m.abrRulesCollection.getRules(MediaPlayer.rules.ABRRulesCollection.prototype.QUALITY_SWITCH_RULES),
m.rulesController.applyRules(n,h,k.bind(this),f.quality,function(b,c){return Math.min(b,c)}))}else q.bytesLoaded===q.bytesTotal&&delete b[l][q.id]}g(t)},reset:function(){b={};c={}}}};MediaPlayer.rules.AbandonRequestsRule.prototype={constructor:MediaPlayer.rules.AbandonRequestsRule};MediaPlayer.rules.ScheduleRulesCollection=function(){var b=[],c=[];return{bufferLevelRule:void 0,playbackTimeRule:void 0,getRules:function(d){switch(d){case MediaPlayer.rules.ScheduleRulesCollection.prototype.FRAGMENTS_TO_SCHEDULE_RULES:return b;case MediaPlayer.rules.ScheduleRulesCollection.prototype.NEXT_FRAGMENT_RULES:return c;default:return null}},setup:function(){b.push(this.bufferLevelRule);c.push(this.playbackTimeRule)}}};
MediaPlayer.rules.ScheduleRulesCollection.prototype={constructor:MediaPlayer.rules.ScheduleRulesCollection,FRAGMENTS_TO_SCHEDULE_RULES:"fragmentsToScheduleRules",NEXT_FRAGMENT_RULES:"nextFragmentRules"};MediaPlayer.rules.BufferLevelRule=function(){return{mediaPlayer:void 0,metricsExt:void 0,metricsModel:void 0,abrController:void 0,playbackController:void 0,log:void 0,execute:function(b,c){var d=b.getMediaInfo().type,d=this.metricsModel.getReadOnlyMetricsFor(d),d=this.metricsExt.getCurrentBufferLevel(d)?this.metricsExt.getCurrentBufferLevel(d).level:0,e=b.getStreamProcessor(),g=b.getStreamInfo(),k=e.isDynamic(),e=NaN,e=this.mediaPlayer.isBufferingBeforeInitialPlay()?Math.max(this.mediaPlayer.getBufferControlParameters().initialBufferTime/
1E3,0):!k&&this.abrController.isPlayingAtTopQuality(g)?MediaPlayer.dependencies.BufferController.BUFFER_TIME_AT_TOP_QUALITY:k?this.playbackController.getLiveDelay(NaN,g.manifestInfo.DVRWindowSize):MediaPlayer.dependencies.BufferController.DEFAULT_MIN_BUFFER_TIME;this.mediaPlayer.isTrickPlayMode()&&(g=Math.abs(this.mediaPlayer.getRate()),e*=g);c(new MediaPlayer.rules.SwitchRequest(d<e?1:0,MediaPlayer.rules.SwitchRequest.prototype.DEFAULT))},reset:function(){}}};
MediaPlayer.rules.BufferLevelRule.prototype={constructor:MediaPlayer.rules.BufferLevelRule};MediaPlayer.rules.PlaybackTimeRule=function(){return{adapter:void 0,sourceBufferExt:void 0,virtualBuffer:void 0,playbackController:void 0,textSourceBuffer:void 0,log:void 0,execute:function(b,c){var d=b.getMediaInfo().type,e=b.getMediaInfo(),g=b.getStreamInfo().id,k=b.getStreamProcessor(),l=k.getScheduleController(),m=k.playbackController.getTime(),h=k.getCurrentRepresentationInfo(),f=l.getSeekTarget(),n=!isNaN(f),q=n?MediaPlayer.rules.SwitchRequest.prototype.STRONG:MediaPlayer.rules.SwitchRequest.prototype.DEFAULT,
f=n?f:this.adapter.getIndexHandlerTime(k),t=k.bufferController.getBuffer(),r=null;if(isNaN(f)||"fragmentedText"===d&&this.textSourceBuffer.getAllTracksAreDisabled())c(new MediaPlayer.rules.SwitchRequest(null,q));else{n&&l.setSeekTarget(NaN);t&&(r=this.sourceBufferExt.getBufferRange(k.bufferController.getBuffer(),f),null!==r&&(d=this.virtualBuffer.getChunks({streamId:g,mediaType:d,appended:!0,mediaInfo:e,forRange:r}))&&0<d.length&&(f=this.virtualBuffer.getReverseTrickPlay()?f>=d[d.length-1].bufferedRange.end?
d[d.length-1].bufferedRange.end:d[0].bufferedRange.start:d[d.length-1].bufferedRange.end));for(n=this.adapter.getFragmentRequestForTime(k,h,f,{keepIdx:!1,hasSeekTarget:n});n&&k.getFragmentModel().isFragmentLoaded(n);){if("complete"===n.action){k.setIndexHandlerTime(NaN);break}n=this.adapter.getNextFragmentRequest(k,h)}n&&"complete"!==n.action&&(this.virtualBuffer.getReverseTrickPlay()&&!isNaN(n.startTime)&&!isNaN(n.duration)&&m<n.startTime+n.duration?k.setIndexHandlerTime(Math.max(0,n.startTime-.5)):
k.setIndexHandlerTime(n.startTime+n.duration),n.delayLoadingTime=(new Date).getTime()+l.getTimeToLoadDelay());c(new MediaPlayer.rules.SwitchRequest(n,q))}}}};MediaPlayer.rules.PlaybackTimeRule.prototype={constructor:MediaPlayer.rules.PlaybackTimeRule};MediaPlayer.rules.LiveEdgeBinarySearchRule=function(){var b=NaN,c=null,d=NaN,e=null,g=!1,k=NaN,l=MediaPlayer.rules.SwitchRequest.prototype.DEFAULT,m,h,f,n=function(b,c,d,g){var l=this;if(null===g)g=l.adapter.generateFragmentRequestForTime(f,e,b),n.call(l,b,c,d,g);else{var k=function(e){h.unsubscribe(MediaPlayer.dependencies.FragmentLoader.eventList.ENAME_CHECK_FOR_EXISTENCE_COMPLETED,l,k);e.data.exists?c.call(l,e.data.request,b):d.call(l,e.data.request,b)};h.subscribe(MediaPlayer.dependencies.FragmentLoader.eventList.ENAME_CHECK_FOR_EXISTENCE_COMPLETED,
l,k);h.checkForExistence(g)}},q=function(h,k){var w,v;g?r.call(this,!1,k):(w=k-b,w=0<w?b-w:b+Math.abs(w)+d,w<c.start&&w>c.end?m(new MediaPlayer.rules.SwitchRequest(null,l)):(v=this.adapter.getFragmentRequestForTime(f,e,w,{ignoreIsFinished:!0}),n.call(this,w,t,q,v)))},t=function(h,q){var t=h.startTime,v=this,x;if(!g){if(!e.fragmentDuration){m(new MediaPlayer.rules.SwitchRequest(t,l));return}g=!0;c.end=t+2*d;if(q===b){x=q+k;t=v.adapter.getFragmentRequestForTime(f,e,x,{ignoreIsFinished:!0});n.call(v,
x,function(){r.call(v,!0,x)},function(){m(new MediaPlayer.rules.SwitchRequest(x,l))},t);return}}r.call(this,!0,q)},r=function(b,d){var h,g;b?c.start=d:c.end=d;Math.floor(c.end-c.start)<=k?m(new MediaPlayer.rules.SwitchRequest(b?d:d-k,l)):(g=(c.start+c.end)/2,h=this.adapter.getFragmentRequestForTime(f,e,g,{ignoreIsFinished:!0}),n.call(this,g,t,q,h))};return{metricsExt:void 0,adapter:void 0,timelineConverter:void 0,execute:function(g,r){var w;m=r;f=g.getStreamProcessor();h=f.getFragmentLoader();e=g.getTrackInfo();
k=e.fragmentDuration;w=e.DVRWindow;b=w.end;e.useCalculatedLiveEdgeTime?(w=this.timelineConverter.getExpectedLiveEdge(),this.timelineConverter.setExpectedLiveEdge(b),m(new MediaPlayer.rules.SwitchRequest(w,l))):(c={start:Math.max(0,b-43200),end:b+43200},d=Math.floor((w.end-w.start)/2),w=this.adapter.getFragmentRequestForTime(f,e,b,{ignoreIsFinished:!0}),n.call(this,b,t,q,w))},reset:function(){b=NaN;c=null;d=NaN;e=null;g=!1;k=NaN;h=f=null}}};MediaPlayer.rules.LiveEdgeBinarySearchRule.prototype={constructor:MediaPlayer.rules.LiveEdgeBinarySearchRule};MediaPlayer.rules.LiveEdgeWithTimeSynchronizationRule=function(){return{timelineConverter:void 0,execute:function(b,c){var d=b.getTrackInfo(),e=d.DVRWindow.end,g=MediaPlayer.rules.SwitchRequest.prototype.DEFAULT;d.useCalculatedLiveEdgeTime?(d=this.timelineConverter.getExpectedLiveEdge(),this.timelineConverter.setExpectedLiveEdge(e),c(new MediaPlayer.rules.SwitchRequest(d,g))):c(new MediaPlayer.rules.SwitchRequest(e,g))}}};MediaPlayer.rules.LiveEdgeWithTimeSynchronizationRule.prototype={constructor:MediaPlayer.rules.LiveEdgeWithTimeSynchronizationRule};MediaPlayer.rules.SynchronizationRulesCollection=function(){var b=[],c=[];return{liveEdgeBinarySearchRule:void 0,liveEdgeWithTimeSynchronizationRule:void 0,getRules:function(d){switch(d){case MediaPlayer.rules.SynchronizationRulesCollection.prototype.TIME_SYNCHRONIZED_RULES:return b;case MediaPlayer.rules.SynchronizationRulesCollection.prototype.BEST_GUESS_RULES:return c;default:return null}},setup:function(){b.push(this.liveEdgeWithTimeSynchronizationRule);c.push(this.liveEdgeBinarySearchRule)}}};
MediaPlayer.rules.SynchronizationRulesCollection.prototype={constructor:MediaPlayer.rules.SynchronizationRulesCollection,TIME_SYNCHRONIZED_RULES:"withAccurateTimeSourceRules",BEST_GUESS_RULES:"bestGuestRules"};MediaPlayer.utils.VTTParser=function(){var b=/(?:\r\n|\r|\n)/gm,c=/--\x3e/,d=/(^[\s]+|[\s]+$)/g,e=/\s\b/g,g=function(b){var c=b.split(":"),d=c.length-1;b=60*parseInt(c[d-1],10)+parseFloat(c[d]);2===d&&(b+=3600*parseInt(c[0],10));return b},k=function(b){var c={};b.forEach(function(b){if(1<b.split(/:/).length){var d=b.split(/:/)[1];d&&-1!=d.search(/%/)&&(d=parseInt(d.replace(/%/,"")));if(b.match(/align/)||b.match(/A/))c.align=d;if(b.match(/line/)||b.match(/L/))c.line=d;if(b.match(/position/)||b.match(/P/))c.position=
d;if(b.match(/size/)||b.match(/S/))c.size=d}});return c};return{log:void 0,parse:function(l){var m,h,f=[],n,q;l=l.split(b);n=l.length;q=-1;for(var t=0;t<n;t++)if(m=l[t],0<m.length&&"WEBVTT"!==m&&m.match(c)){m=m.split(c);h=m[1].split(e);h.shift();m[1]=h[0];h.shift();h=k(h);var r;r=l;for(var p=t+1,u=void 0,u=p,w="",v="";""!==r[u]&&u<r.length;)u++;u-=p;if(1<u)for(var x=0;x<u;x++)if(v=r[p+x],v.match(c)){w="";break}else w+=v,x!==u-1&&(w+="\n");else v=r[p],v.match(c)||(w=v);r=decodeURI(w);p=g(m[0].replace(d,
""));m=g(m[1].replace(d,""));!isNaN(p)&&!isNaN(m)&&p>=q&&m>p?""!==r?(q=p,f.push({start:p,end:m,data:r,styles:h})):this.log("Skipping cue due to empty/malformed cue text"):this.log("Skipping cue due to incorrect cue timing")}return f}}};MediaPlayer.utils.TTMLParser=function(){var b=/^([0-9][0-9]+):([0-5][0-9]):([0-5][0-9])|(60)(\.([0-9])+)?$/,c,d,e,g={},k={},l={},m={top:"85%;",left:"5%;",width:"90%;",height:"10%;","align-items":"flex-start;",overflow:"visible;","-ms-writing-mode":"lr-tb, horizontal-tb;;","-webkit-writing-mode":"horizontal-tb;","-moz-writing-mode":"horizontal-tb;","writing-mode":"horizontal-tb;"},h={color:"rgb(255,255,255);",direction:"ltr;","font-family":"monospace, sans-serif;","font-style":"normal;","line-height":"normal;",
"font-weight":"normal;","text-align":"start;","justify-content":"flex-start;","text-decoration":"none;","unicode-bidi":"normal;","white-space":"normal;",width:"100%;"},f={monospace:"font-family: monospace;",sansSerif:"font-family: sans-serif;",serif:"font-family: serif;",monospaceSansSerif:"font-family: monospace, sans-serif;",monospaceSerif:"font-family: monospace, serif;",proportionalSansSerif:"font-family: Arial;",proportionalSerif:"font-family: Times New Roman;","default":"font-family: monospace, sans-serif;"},
n={right:["justify-content: flex-end;","text-align: right;"],start:["justify-content: flex-start;","text-align: start;"],center:["justify-content: center;","text-align: center;"],end:["justify-content: flex-end;","text-align: end;"],left:["justify-content: flex-start;","text-align: left;"]},q={start:"text-align: start;",center:"text-align: center;",end:"text-align: end;",auto:""},t={wrap:"white-space: normal;",noWrap:"white-space: nowrap;"},r={normal:"unicode-bidi: normal;",embed:"unicode-bidi: embed;",
bidiOverride:"unicode-bidi: bidi-override;"},p={before:"align-items: flex-start;",center:"align-items: center;",after:"align-items: flex-end;"},u={lrtb:"-webkit-writing-mode: horizontal-tb;writing-mode: horizontal-tb;",rltb:"-webkit-writing-mode: horizontal-tb;writing-mode: horizontal-tb;direction: rtl;unicode-bidi: bidi-override;",tbrl:"-webkit-writing-mode: vertical-rl;writing-mode: vertical-rl;-webkit-text-orientation: upright;text-orientation: upright;",tblr:"-webkit-writing-mode: vertical-lr;writing-mode: vertical-lr;-webkit-text-orientation: upright;text-orientation: upright;",
lr:"-webkit-writing-mode: horizontal-tb;writing-mode: horizontal-tb;",rl:"-webkit-writing-mode: horizontal-tb;writing-mode: horizontal-tb;direction: rtl;",tb:"-webkit-writing-mode: vertical-rl;writing-mode: vertical-rl;-webkit-text-orientation: upright;text-orientation: upright;"},w=function(d){var e,f;if(!b.test(d))return NaN;d=d.split(":");e=3600*parseFloat(d[0])+60*parseFloat(d[1])+parseFloat(d[2]);if(d[3])if((f=c.tt.frameRate)&&!isNaN(f))e+=parseFloat(d[3])/f;else return NaN;return e},v=function(){var b=
c.hasOwnProperty("tt"),d=b?c.tt.hasOwnProperty("head"):!1,e=d?c.tt.head.hasOwnProperty("layout"):!1,f=d?c.tt.head.hasOwnProperty("styling"):!1,h=b?c.tt.hasOwnProperty("body"):!1;return b&&d&&e&&f&&h},x=function(b,c){var d=Object.keys(b).filter(function(d){return("xmlns"===d.split(":")[0]||"xmlns"===d.split(":")[1])&&b[d]===c}).map(function(b){return b.split(":")[2]||b.split(":")[1]});return 1!=d.length?null:d[0]},y=function(b,c){for(var d in b)if(b.hasOwnProperty(d)){if(("object"===typeof b[d]||b[d]instanceof
Object)&&!Array.isArray(b[d]))y(b[d],c);else if(Array.isArray(b[d]))for(var e=0;e<b[d].length;e++)y(b[d][e],c);e=d.slice(d.indexOf(c)+c.length+1);b[e]=b[d];delete b[d]}},E=function(b){return b.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()},z=function(b){b=b.slice(1).match(/.{2}/g);var c=parseFloat(parseInt(parseInt(b[3],16)/255*1E3)/1E3);return"rgba("+b.slice(0,3).map(function(b){return parseInt(b,16)}).join(",")+","+c+");"},D=function(b,c){for(var d=0;d<c.length;d++)if(-1<c[d].indexOf(b))return!0;
return!1},A=function(b,c){for(var d=0;d<c.length;d++)if(-1<c[d].indexOf(b))return c[d];return null},F=function(b,c){c.splice(c.indexOf(A(b,c)),1)},H=function(b,c){for(var d=0;d<b.length;d++)for(var e=0;e<c.length;e++)b[d]&&-1<b[d].split(":")[0].indexOf(c[e].split(":")[0])&&b.splice(d,1);return b.concat(c)},B=function(b,e){var h=[];b.match(/\S+/g).forEach(function(b){a:{for(var m=0;m<d.length;m++){var p=d[m];if(p["xml:id"]===b||p.id===b){b=p;break a}}b=null}if(b){b=JSON.parse(JSON.stringify(b));var m=
[],B;for(B in b)b.hasOwnProperty(B)&&(p=B.replace("ebutts:",""),p=p.replace("xml:",""),p=p.replace("tts:",""),p=E(p),b[p]=b[B],delete b[B]);"line-padding"in b&&(p=parseFloat(b["line-padding"].slice(b["line-padding"].indexOf(":")+1,b["line-padding"].indexOf("c"))),"id"in b&&(l[b.id]=p),p=p*e[0]+"px;",m.push("padding-left:"+p),m.push("padding-right:"+p));"font-size"in b&&(p=parseFloat(b["font-size"].slice(b["font-size"].indexOf(":")+1,b["font-size"].indexOf("%"))),"id"in b&&(g[b.id]=p),m.push("font-size:"+
(p/100*e[1]+"px;")));"line-heigt"in b&&("normal"===b["line-height"]?m.push("line-heigth: normal;"):(p=parseFloat(b["line-heigt"].slice(b["line-heigt"].indexOf(":")+1,b["line-heigt"].indexOf("%"))),"id"in b&&(k[b.id]=p),m.push(B+":"+(p/100*e[1]+"px;"))));"font-family"in b&&(b["font-family"]in f?m.push(f[b["font-family"]]):m.push("font-family:"+b["font-family"]+";"));"text-align"in b&&b["text-align"]in n&&(m.push(n[b["text-align"]][0]),m.push(n[b["text-align"]][1]));"multi-row-align"in b&&(D("text-align",
m)&&"auto"!=b["multi-row-align"]&&F("text-align",m),b["multi-row-align"]in q&&m.push(q[b["multi-row-align"]]));"background-color"in b&&(-1<b["background-color"].indexOf("#")&&8===b["background-color"].length-1?(B=z(b["background-color"]),m.push("background-color: "+B)):m.push("background-color:"+b["background-color"]+";"));"color"in b&&(-1<b.color.indexOf("#")&&8===b.color.length-1?(B=z(b.color),m.push("color: "+B)):m.push("color:"+b.color+";"));"wrap-option"in b&&(b["wrap-option"]in t?m.push(t[b["wrap-option"]]):
m.push("white-space:"+b["wrap-option"]));"unicode-bidi"in b&&(b["unicode-bidi"]in r?m.push(r[b["unicode-bidi"]]):m.push("unicode-bidi:"+b["unicode-bidi"]));"font-style"in b&&m.push("font-style:"+b["font-style"]+";");"font-weight"in b&&m.push("font-weight:"+b["font-weight"]+";");"direction"in b&&m.push("direction:"+b.direction+";");"text-decoration"in b&&m.push("text-decoration:"+b["text-decoration"]+";");c.tt.hasOwnProperty("xml:space")&&"preserve"===c.tt["xml:space"]&&m.push("white-space: pre;");
h=h.concat(m)}});return h},G=function(b,c){var d=[],e;for(e in b){var f=e.replace("tts:",""),f=f.replace("xml:",""),f=E(f);b[f]=b[e];f!==e&&delete b[e]}"extent"in b&&(e=b.extent.split(/\s/),d.push("width: "+e[0]+";"),d.push("height: "+e[1]+";"));"origin"in b&&(e=b.origin.split(/\s/),d.push("left: "+e[0]+";"),d.push("top: "+e[1]+";"));"display-align"in b&&d.push(p[b["display-align"]]);"writing-mode"in b&&d.push(u[b["writing-mode"]]);"style"in b&&(e=B(b.style,c),d=d.concat(e));"padding"in b&&d.push("padding:"+
b.padding+";");"overflow"in b&&d.push("overflow:"+b.overflow+";");"show-background"in b&&d.push("show-background:"+b["show-background"]+";");"id"in b&&d.push("regionID:"+b.id+";");return d},C=function(b,c){var d=[];b.match(/\S+/g).forEach(function(b){a:{for(var f=0;f<e.length;f++){var h=e[f];if(h["xml:id"]===b||h.id===b){b=h;break a}}b=null}b&&(b=G(JSON.parse(JSON.stringify(b)),c),d=d.concat(b))});return d},I=function(){var b=[32,15];return c.tt.hasOwnProperty("ttp:cellResolution")?c.tt["ttp:cellResolution"].split(" ").map(parseFloat):
b},J=function(b,c){for(var d=A("padding-left",c),e=A("padding-right",c),f=d.concat(" "+e),h="",g="",l="",k=Array.prototype.slice.call(b.children),d=b.getElementsByClassName("lineBreak")[0],e=k.indexOf(d),n=[];-1!=e;)n.push(e),e=k.indexOf(d,e+1);if(n.length)n.forEach(function(b,c){if(0===c){for(var d="",e=0;e<b;e++)h+=k[e].outerHTML,0===e&&(d=f.concat(k[e].style.cssText));h='<span class="spanPadding" style="-webkit-box-decoration-break: clone; '+d+'">'+h}d="";for(e=b+1;e<k.length;e++)g+=k[e].outerHTML,
e===k.length-1&&(d+=f.concat(k[e].style.cssText));g='<span class="spanPadding" style="-webkit-box-decoration-break: clone; '+d+'">'+g;h&&g&&c===n.length-1?l+=h+"</span><br>"+g+"</span>":h&&g&&c!==n.length-1?l+=h+"</span><br>"+g+"</span><br>":h&&!g?l+=h+"</span>":!h&&g&&c===n.length-1?l+=g+"</span>":!h&&g&&c!==n.length-1&&(l+=g+"</span><br>")});else{d="";for(e=0;e<k.length;e++)d+=k[e].style.cssText;l='<span class="spanPadding" style="-webkit-box-decoration-break: clone; '+f+d+'">'+b.innerHTML+"</span>"}return l},
M=function(b,c){var d=document.createElement("div");b.forEach(function(b){if(!b.hasOwnProperty("metadata"))if(b.hasOwnProperty("span")){var e=b.span.__children,f=document.createElement("span");if(b.span.hasOwnProperty("style")){var h=B(b.span.style,c);f.className="spanPadding "+b.span.style;f.style.cssText=h.join(" ")}e.forEach(function(b){e.hasOwnProperty("metadata")||(b.hasOwnProperty("#text")?(b=document.createTextNode(b["#text"]),f.appendChild(b)):"br"in b&&(f.hasChildNodes()&&d.appendChild(f),
b=document.createElement("br"),b.className="lineBreak",d.appendChild(b),b=document.createElement("span"),b.className=f.className,b.style.cssText=f.style.cssText,f=b))});d.appendChild(f)}else b.hasOwnProperty("br")?(b=document.createElement("br"),b.className="lineBreak",d.appendChild(b)):b.hasOwnProperty("#text")&&(h=document.createElement("span"),h.textContent=b["#text"],d.appendChild(h))});return d},K=function(b,c,d){var e=[];b=b.region;c=c.region;var f;c&&(f=C(c,d));b?(d=e.concat(C(b,d)),e=f?H(f,
d):d):f&&(e=f);O(e,m);return e},L=function(b,d){var e=[],f=b.style,g=c.tt.body.style,l=c.tt.body.div.style,k,n,m="";g&&(k=B(g,d),m="paragraph "+g);l&&(n=B(l,d),k?(n=H(k,n),m+=" "+l):m="paragraph "+l);f?(e=B(f,d),k&&n?(e=H(n,e),m+=" "+f):k?(e=H(k,e),m+=" "+f):n?(e=H(n,e),m+=" "+f):m="paragraph "+f):k&&!n?e=k:!k&&n&&(e=n);O(e,h);return[e,m]},O=function(b,c){for(var d in c)c.hasOwnProperty(d)&&(D(d,b)||b.push(d+":"+c[d]))};return{parse:function(b){var f;c=(new X2JS([],"",!1)).xml_str2json(b);if(!c)throw"TTML document could not be parsed";
this.videoModel.getTTMLRenderingDiv()&&(f="html");(b=x(c,"http://www.w3.org/ns/ttml"))&&y(c,b);e=c.tt.head.layout.region_asArray;d=c.tt.head.styling.style_asArray;if(!v())throw"TTML document has incorrect structure";var n=I(),m=this.videoModel.getElement().clientWidth,p=this.videoModel.getElement().clientHeight,r=[m/n[0],p/n[1]];h["font-size"]=r[1]+"px;";var q=[];for(b=0;b<e.length;b++)q.push(G(JSON.parse(JSON.stringify(e[b])),r));b=x(c.tt,"http://www.w3.org/ns/ttml#parameter");c.tt.hasOwnProperty(b+
":frameRate")&&(c.tt.frameRate=parseInt(c.tt[b+":frameRate"],10));var B=[];c.tt.body_asArray[0].__children.forEach(function(b){var d=b.div.p_asArray;if(!d||0===d.length){var e="TTML document does not contain any cues";throw e;}var h,t,v,u;d.forEach(function(d){if(d.hasOwnProperty("begin")&&d.hasOwnProperty("end"))h=w(d.begin),t=w(d.end);else if(d.span.hasOwnProperty("begin")&&d.span.hasOwnProperty("end"))v=w(d.span.begin),u=w(d.span.end);else throw e="TTML document has incorrect timing value",e;if(void 0!==
d["smpte:backgroundImage"])for(var G=c.tt.head.metadata.image_asArray,x=0;x<G.length;x+=1)"#"+G[x]["xml:id"]==d["smpte:backgroundImage"]&&B.push({start:v||h,end:u||t,id:G[x]["xml:id"],data:"data:image/"+G[x].imagetype.toLowerCase()+";base64, "+G[x].__text,type:"image"});else if("html"===f){k={};l={};g={};G="";if(d.hasOwnProperty("id")||d.hasOwnProperty("xml:id"))G=d["xml:id"]||d.id;if((isNaN(h)||isNaN(t))&&(isNaN(v)||isNaN(u)))throw e="TTML document has incorrect timing value",e;var x=K(d,b.div,r),
C=L(d,r),I=C[1],C=C[0],z=document.createElement("div");z.className=I;d=M(d.__children,r);d.className="cueDirUniWrapper";D("unicode-bidi",C)&&(d.style.cssText+=A("unicode-bidi",C),F("unicode-bidi",C));D("direction",C)&&(d.style.cssText+=A("direction",C),F("direction",C));D("padding-left",C)&&D("padding-right",C)&&(d.innerHTML=J(d,C));D("padding-left",C)&&D("padding-right",C)&&(F("padding-left",C),F("padding-right",C));I="";D("regionID",x)&&(I=A("regionID",x),I=I.slice(I.indexOf(":")+1,I.length-1));
C&&(z.style.cssText=C.join(" ")+"display:flex;");x&&(x=x.join(" "));z.appendChild(d);C=document.createElement("div");C.appendChild(z);C.id="subtitle_"+G;C.style.cssText="position: absolute; margin: 0; display: flex; box-sizing: border-box; pointer-events: none;"+x;0===Object.keys(g).length&&(g.defaultFontSize="100");B.push({start:v||h,end:u||t,type:"html",cueHTMLElement:C,regions:q,regionID:I,cueID:G,videoHeight:p,videoWidth:m,cellResolution:n,fontSize:g||{defaultFontSize:"100"},lineHeight:k,linePadding:l})}else{var y=
"",G=d.__children;G.length&&G.forEach(function(b){if(b.hasOwnProperty("span")){var c=b.span.__children;c.forEach(function(b){c.hasOwnProperty("metadata")||(b.hasOwnProperty("#text")?y+=b["#text"].replace(/[\r\n]+/gm," ").trim():"br"in b&&(y+="\n"))})}else y=b.hasOwnProperty("br")?y+"\n":y+b["#text"].replace(/[\r\n]+/gm," ").trim()});B.push({start:v||h,end:u||t,data:y,type:"text"})}})});return B},videoModel:void 0}};MediaPlayer.dependencies.TextSourceBuffer=function(){var b=!1,c=null;return{system:void 0,videoModel:void 0,errHandler:void 0,adapter:void 0,manifestExt:void 0,mediaController:void 0,streamController:void 0,initialize:function(b,c){this.sp=c.streamProcessor;this.mediaInfos=this.sp.getMediaInfoArr();this.textTrackExtensions=this.system.getObject("textTrackExtensions");if(this.isFragmented=!this.manifestExt.getIsTextTrack(b))this.fragmentModel=this.sp.getFragmentModel(),this.buffered=this.system.getObject("customTimeRanges"),
this.initializationSegmentReceived=!1,this.timescale=9E4,this.allTracks=this.mediaController.getTracksFor("fragmentedText",this.streamController.getActiveStreamInfo())},append:function(b,e){function g(b,c){var d=new MediaPlayer.vo.TextTrackInfo,e={subtitle:"subtitles",caption:"captions"};d.captionData=b;d.lang=c.lang;d.label=c.id;d.index=c.index;d.isTTML=function(){var b=!1;c.codec&&0<=c.codec.search("stpp")&&(b=!0);c.mimeType&&0<=c.mimeType.search("ttml")&&(b=!0);return b}();d.video=k.videoModel.getElement();
d.defaultTrack=k.getIsDefault(c);d.isFragmented=k.isFragmented;d.kind=function(){var b=0<c.roles.length?e[c.roles[0]]:e.caption;return b=b===e.caption||b===e.subtitle?b:e.caption}();k.textTrackExtensions.addTextTrack(d,k.mediaInfos.length)}var k=this,l,m,h,f;h=e.mediaInfo;var n=h.mimeType;if("fragmentedText"===h.type)if(f=k.system.getObject("fragmentExt"),this.initializationSegmentReceived)for(m=f.getSamplesInfo(b),h=0;h<m.length;h++){this.firstSubtitleStart||(this.firstSubtitleStart=m[0].cts-e.start*
this.timescale);m[h].cts-=this.firstSubtitleStart;this.buffered.add(m[h].cts/this.timescale,(m[h].cts+m[h].duration)/this.timescale);f=window.UTF8.decode(new Uint8Array(b.slice(m[h].offset,m[h].offset+m[h].size)));c=null!==c?c:k.getParser(n);try{l=c.parse(f),this.textTrackExtensions.addCaptions(this.firstSubtitleStart/this.timescale,l)}catch(q){}}else{this.initializationSegmentReceived=!0;for(h=0;h<this.mediaInfos.length;h++)g(null,this.mediaInfos[h]);this.timescale=f.getMediaTimescaleFromMoov(b)}else{b=
new Uint8Array(b);f=window.UTF8.decode(b);try{l=k.getParser(n).parse(f),g(l,h)}catch(t){k.errHandler.closedCaptionsError(t,"parse",f)}}},getIsDefault:function(b){return b.index===this.mediaInfos[0].index},abort:function(){this.textTrackExtensions.deleteAllTextTracks();b=!1;c=null},getParser:function(b){var c;if("text/vtt"===b)c=this.system.getObject("vttParser");else if("application/ttml+xml"===b||"application/mp4"===b)c=this.system.getObject("ttmlParser");return c},getAllTracksAreDisabled:function(){return b},
setTextTrack:function(){for(var c=this.videoModel.getElement().textTracks,e=c.length,g=0;g<e;g++){var k=c[g];b="showing"!==k.mode;if("showing"===k.mode){this.textTrackExtensions.getCurrentTrackIdx()!==g&&(this.textTrackExtensions.setCurrentTrackIdx(g),this.isFragmented&&!this.mediaController.isCurrentTrack(this.allTracks[g])&&(this.textTrackExtensions.deleteTrackCues(this.textTrackExtensions.getCurrentTextTrack()),this.fragmentModel.cancelPendingRequests(),this.fragmentModel.abortRequests(),this.buffered.clear(),
this.mediaController.setTrack(this.allTracks[g])));break}}b&&this.textTrackExtensions.setCurrentTrackIdx(-1)}}};MediaPlayer.dependencies.TextSourceBuffer.prototype={constructor:MediaPlayer.dependencies.TextSourceBuffer};MediaPlayer.utils.TextTrackExtensions=function(){var b,c,d=[],e=[],g=-1,k=0,l=0,m=0,h=0,f=null,n=null,q=!1,t=!1,r=null,p=!1,u=function(b){var e=d[b].kind,f=void 0!==d[b].label?d[b].label:d[b].lang;b=d[b].lang;var h=q?c.addTextTrack(e,f,b):document.createElement("track");q||(h.kind=e,h.label=f,h.srclang=b);return h};return{mediaController:void 0,videoModel:void 0,eventBus:void 0,setup:function(){b=window.VTTCue||window.TextTrackCue;q=!!navigator.userAgent.match(/Trident.*rv[ :]*11\./)||navigator.userAgent.match(/Edge/);
t=!!navigator.userAgent.match(/Chrome/)&&!navigator.userAgent.match(/Edge/);void 0!==document.fullscreenElement?r="fullscreenElement":void 0!==document.webkitIsFullScreen?r="webkitIsFullScreen":document.msFullscreenElement?r="msFullscreenElement":document.mozFullScreen&&(r="mozFullScreen")},displayCConTop:function(b){p=b;f&&!document[r]&&(f.style.zIndex=b?2147483647:null)},addTextTrack:function(b,h){d.push(b);void 0===c&&(c=b.video);if(d.length===h){d.sort(function(b,c){return b.index-c.index});f=
this.videoModel.getTTMLRenderingDiv();for(var l=0,k=0;k<d.length;k++){var n=u(k);g=k;e.push(n);d[k].defaultTrack&&(n.default=!0,l=k);q||c.appendChild(n);c.textTracks[k].renderingType=f&&d[k].isTTML?"html":"default";this.addCaptions(0,d[k].captionData);this.eventBus.dispatchEvent({type:MediaPlayer.events.TEXT_TRACK_ADDED})}this.setCurrentTrackIdx(l);this.eventBus.dispatchEvent({type:MediaPlayer.events.TEXT_TRACKS_ADDED,data:{index:g,tracks:d}})}},getVideoVisibleVideoSize:function(b,c,d,e){var f=0,
h=0,g=0,l=0;b/c>d/e?(l=c,g=l/e*d,f=(b-g)/2,h=0):(g=b,l=g/d*e,f=0,h=(c-l)/2);return{x:f,y:h,w:g,h:l}},checkVideoSize:function(){var b=this.getCurrentTextTrack();if(b&&"html"===b.renderingType){var d=c.clientWidth,e=c.clientHeight,g=this.getVideoVisibleVideoSize(c.clientWidth,c.clientHeight,c.videoWidth,c.videoHeight),d=g.w,e=g.h;if(d!=m||e!=h){k=g.x;l=g.y;m=d;h=e;f.style.left=k+"px";f.style.top=l+"px";f.style.width=m+"px";f.style.height=h+"px";for(d=0;d<b.activeCues.length;++d)e=b.activeCues[d],e.scaleCue(e);
f.style.zIndex=r&&document[r]||p?2147483647:null}}},scaleCue:function(b){var c,d,e,f=[m/b.cellResolution[0],h/b.cellResolution[1]];if(b.linePadding)for(c in b.linePadding)if(b.linePadding.hasOwnProperty(c)){d=(b.linePadding[c]*f[0]).toString();e=document.getElementsByClassName("spanPadding");for(var g=0;g<e.length;g++)e[g].style.cssText=e[g].style.cssText.replace(/(padding-left\s*:\s*)[\d.,]+(?=\s*px)/gi,"$1"+d),e[g].style.cssText=e[g].style.cssText.replace(/(padding-right\s*:\s*)[\d.,]+(?=\s*px)/gi,
"$1"+d)}if(b.fontSize)for(c in b.fontSize)if(b.fontSize.hasOwnProperty(c))for(d=(b.fontSize[c]/100*f[1]).toString(),e="defaultFontSize"!==c?document.getElementsByClassName(c):document.getElementsByClassName("paragraph"),g=0;g<e.length;g++)e[g].style.cssText=e[g].style.cssText.replace(/(font-size\s*:\s*)[\d.,]+(?=\s*px)/gi,"$1"+d);if(b.lineHeight)for(c in b.lineHeight)if(b.lineHeight.hasOwnProperty(c))for(d=(b.lineHeight[c]/100*f[1]).toString(),e=document.getElementsByClassName(c),g=0;g<e.length;g++)e[g].style.cssText=
e[g].style.cssText.replace(/(line-height\s*:\s*)[\d.,]+(?=\s*px)/gi,"$1"+d)},addCaptions:function(e,p){var r=this.getCurrentTextTrack();if(r){r.mode="showing";for(var q in p){var t,u=p[q];n||"html"!=u.type||(n=setInterval(this.checkVideoSize.bind(this),500));"image"==u.type?(t=new b(u.start-e,u.end-e,""),t.image=u.data,t.id=u.id,t.size=0,t.type="image",t.onenter=function(){var b=new Image;b.id="ttmlImage_"+this.id;b.src=this.image;b.className="cue-image";f?f.appendChild(b):c.parentNode.appendChild(b)},
t.onexit=function(){var b,d,e;b=f?f:c.parentNode;e=b.childNodes;for(d=0;d<e.length;d++)e[d].id=="ttmlImage_"+this.id&&b.removeChild(e[d])}):"html"===u.type?(t=new b(u.start-e,u.end-e,""),t.cueHTMLElement=u.cueHTMLElement,t.regions=u.regions,t.regionID=u.regionID,t.cueID=u.cueID,t.videoWidth=u.videoWidth,t.videoHeight=u.videoHeight,t.cellResolution=u.cellResolution,t.fontSize=u.fontSize,t.lineHeight=u.lineHeight,t.linePadding=u.linePadding,t.scaleCue=this.scaleCue,f.style.left=k+"px",f.style.top=l+
"px",f.style.width=m+"px",f.style.height=h+"px",t.onenter=function(){"showing"==r.mode&&(f.appendChild(this.cueHTMLElement),this.scaleCue(this))},t.onexit=function(){for(var b=f.childNodes,c=0;c<b.length;++c)b[c].id=="subtitle_"+this.cueID&&f.removeChild(b[c])}):(t=new b(u.start-e,u.end-e,u.data),u.styles&&(void 0!==u.styles.align&&t.hasOwnProperty("align")&&(t.align=u.styles.align),void 0!==u.styles.line&&t.hasOwnProperty("line")&&(t.line=u.styles.line),void 0!==u.styles.position&&t.hasOwnProperty("position")&&
(t.position=u.styles.position),void 0!==u.styles.size&&t.hasOwnProperty("size")&&(t.size=u.styles.size)));r.addCue(t)}d[g].isFragmented||(r.mode=d[g].defaultTrack?"showing":"hidden")}},getCurrentTextTrack:function(){return 0<=g?c.textTracks[g]:null},getCurrentTrackIdx:function(){return g},setCurrentTrackIdx:function(b){g=b;this.clearCues();0<=b?"html"===c.textTracks[b].renderingType?this.setNativeCueStyle():this.removeNativeCueStyle():this.removeNativeCueStyle()},getTextTrack:function(b){return c.textTracks[b]},
deleteTrackCues:function(b){if(b.cues){for(var c=b.cues,d=c.length-1;0<=d;d--)b.removeCue(c[d]);b.mode="disabled"}},deleteAllTextTracks:function(){for(var b=e.length,f=0;f<b;f++)q?this.deleteTrackCues(this.getTextTrack(f)):c.removeChild(e[f]);e=[];d=[];n&&(clearInterval(n),n=null);this.clearCues()},deleteTextTrack:function(b){c.removeChild(e[b]);e.splice(b,1)},setNativeCueStyle:function(){if(t){var b=document.getElementById("native-cue-style");b||(b=document.createElement("style"),b.id="native-cue-style",
document.head.appendChild(b),b=b.sheet,c.id?b.insertRule("#"+c.id+"::cue {background: transparent}",0):0!==c.classList.length?b.insertRule("."+c.className+"::cue {background: transparent}",0):b.insertRule("video::cue {background: transparent}",0))}},removeNativeCueStyle:function(){if(t){var b=document.getElementById("native-cue-style");b&&document.head.removeChild(b)}},clearCues:function(){if(f)for(;f.firstChild;)f.removeChild(f.firstChild)}}};MediaPlayer.dependencies.TextController=function(){var b=!1,c=null,d=null,e=null,g=function(){this.notify(MediaPlayer.dependencies.TextController.eventList.ENAME_CLOSED_CAPTIONING_REQUESTED,{CCIndex:0})},k=function(b){b.data.fragmentModel===this.streamProcessor.getFragmentModel()&&b.data.chunk.bytes&&this.sourceBufferExt.append(d,b.data.chunk)};return{sourceBufferExt:void 0,log:void 0,system:void 0,errHandler:void 0,videoModel:void 0,notify:void 0,subscribe:void 0,unsubscribe:void 0,setup:function(){this[Dash.dependencies.RepresentationController.eventList.ENAME_DATA_UPDATE_COMPLETED]=
g;this[MediaPlayer.dependencies.FragmentController.eventList.ENAME_INIT_FRAGMENT_LOADED]=k},initialize:function(b,c,d){e=b;this.setMediaSource(c);this.representationController=d.representationController;this.streamProcessor=d},createBuffer:function(g){try{d=this.sourceBufferExt.createSourceBuffer(c,g),b||(d.hasOwnProperty("initialize")&&d.initialize(e,this),b=!0)}catch(k){this.errHandler.mediaSourceError("Error creating "+e+" source buffer.")}return d},enableBuffering:function(){},getBuffer:function(){return d},
setBuffer:function(b){d=b},setMediaSource:function(b){c=b},reset:function(b){b||(this.sourceBufferExt.abort(c,d),this.sourceBufferExt.removeSourceBuffer(c,d))}}};MediaPlayer.dependencies.TextController.prototype={constructor:MediaPlayer.dependencies.TextController};MediaPlayer.dependencies.TextController.eventList={ENAME_CLOSED_CAPTIONING_REQUESTED:"closedCaptioningRequested"};MediaPlayer.models.MetricsModel=function(){return{system:void 0,eventBus:void 0,adapter:void 0,streamMetrics:{},metricsChanged:function(){this.eventBus.dispatchEvent({type:MediaPlayer.events.METRICS_CHANGED,data:{}})},metricChanged:function(b){this.eventBus.dispatchEvent({type:MediaPlayer.events.METRIC_CHANGED,data:{stream:b}});this.metricsChanged()},metricUpdated:function(b,c,d){this.eventBus.dispatchEvent({type:MediaPlayer.events.METRIC_UPDATED,data:{stream:b,metric:c,value:d}});this.metricChanged(b)},
metricAdded:function(b,c,d){this.eventBus.dispatchEvent({type:MediaPlayer.events.METRIC_ADDED,data:{stream:b,metric:c,value:d}});this.metricChanged(b)},clearCurrentMetricsForType:function(b){delete this.streamMetrics[b];this.metricChanged(b)},clearAllCurrentMetrics:function(){this.streamMetrics={};this.metricsChanged.call(this)},getReadOnlyMetricsFor:function(b){return this.streamMetrics.hasOwnProperty(b)?this.streamMetrics[b]:null},getMetricsFor:function(b){var c;this.streamMetrics.hasOwnProperty(b)?
c=this.streamMetrics[b]:(c=this.system.getObject("metrics"),this.streamMetrics[b]=c);return c},addTcpConnection:function(b,c,d,e,g,k){var l=new MediaPlayer.vo.metrics.TCPConnection;l.tcpid=c;l.dest=d;l.topen=e;l.tclose=g;l.tconnect=k;this.getMetricsFor(b).TcpList.push(l);this.metricAdded(b,this.adapter.metricsList.TCP_CONNECTION,l);return l},addHttpRequest:function(b,c,d,e,g,k,l,m,h,f,n,q){var t=new MediaPlayer.vo.metrics.HTTPRequest;g&&g!==e&&(this.addHttpRequest(b,null,d,e,null,k,l,null,null,null,
n,null),t.actualurl=g);t.stream=b;t.tcpid=c;t.type=d;t.url=e;t.range=k;t.trequest=l;t.tresponse=m;t.tfinish=h;t.responsecode=f;t.mediaduration=n;t.responseHeaders=q;this.getMetricsFor(b).HttpList.push(t);this.metricAdded(b,this.adapter.metricsList.HTTP_REQUEST,t);return t},appendHttpTrace:function(b,c,d,e){var g=new MediaPlayer.vo.metrics.HTTPRequest.Trace;g.s=c;g.d=d;g.b=e;b.trace.push(g);b.interval||(b.interval=0);b.interval+=d;this.metricUpdated(b.stream,this.adapter.metricsList.HTTP_REQUEST_TRACE,
b);return g},addRepresentationSwitch:function(b,c,d,e,g){var k=new MediaPlayer.vo.metrics.RepresentationSwitch;k.t=c;k.mt=d;k.to=e;k.lto=g;this.getMetricsFor(b).RepSwitchList.push(k);this.metricAdded(b,this.adapter.metricsList.TRACK_SWITCH,k);return k},addBufferLevel:function(b,c,d){var e=new MediaPlayer.vo.metrics.BufferLevel;e.t=c;e.level=d;this.getMetricsFor(b).BufferLevel.push(e);this.metricAdded(b,this.adapter.metricsList.BUFFER_LEVEL,e);return e},addBufferState:function(b,c,d){var e=new MediaPlayer.vo.metrics.BufferState;
e.target=d;e.state=c;this.getMetricsFor(b).BufferState.push(e);this.metricAdded(b,this.adapter.metricsList.BUFFER_STATE,e);return e},addDVRInfo:function(b,c,d,e,g){var k=new MediaPlayer.vo.metrics.DVRInfo;k.time=c;k.range=e;k.manifestInfo=d;k.streamInfo=g;this.getMetricsFor(b).DVRInfo.push(k);this.metricAdded(b,this.adapter.metricsList.DVR_INFO,k);return k},addDroppedFrames:function(b,c){var d=new MediaPlayer.vo.metrics.DroppedFrames,e=this.getMetricsFor(b).DroppedFrames;d.time=c.creationTime;d.droppedFrames=
c.droppedVideoFrames;if(0<e.length&&e[e.length-1]==d)return e[e.length-1];e.push(d);this.metricAdded(b,this.adapter.metricsList.DROPPED_FRAMES,d);return d},addSchedulingInfo:function(b,c,d,e,g,k,l,m,h){var f=new MediaPlayer.vo.metrics.SchedulingInfo;f.mediaType=b;f.t=c;f.type=d;f.startTime=e;f.availabilityStartTime=g;f.duration=k;f.quality=l;f.range=m;f.state=h;this.getMetricsFor(b).SchedulingInfo.push(f);this.metricAdded(b,this.adapter.metricsList.SCHEDULING_INFO,f);return f},addRequestsQueue:function(b,
c,d){var e=new MediaPlayer.vo.metrics.RequestsQueue;e.loadingRequests=c;e.executedRequests=d;this.getMetricsFor(b).RequestsQueue=e;this.metricAdded(b,this.adapter.metricsList.REQUESTS_QUEUE,e)},addManifestUpdate:function(b,c,d,e,g,k,l,m,h,f){var n=new MediaPlayer.vo.metrics.ManifestUpdate,q=this.getMetricsFor("stream");n.mediaType=b;n.type=c;n.requestTime=d;n.fetchTime=e;n.availabilityStartTime=g;n.presentationStartTime=k;n.clientTimeOffset=l;n.currentTime=m;n.buffered=h;n.latency=f;q.ManifestUpdate.push(n);
this.metricAdded(b,this.adapter.metricsList.MANIFEST_UPDATE,n);return n},updateManifestUpdateInfo:function(b,c){if(b){for(var d in c)b[d]=c[d];this.metricUpdated(b.mediaType,this.adapter.metricsList.MANIFEST_UPDATE,b)}},addManifestUpdateStreamInfo:function(b,c,d,e,g){if(b){var k=new MediaPlayer.vo.metrics.ManifestUpdate.StreamInfo;k.id=c;k.index=d;k.start=e;k.duration=g;b.streamInfo.push(k);this.metricUpdated(b.mediaType,this.adapter.metricsList.MANIFEST_UPDATE_STREAM_INFO,b);return k}return null},
addManifestUpdateRepresentationInfo:function(b,c,d,e,g,k,l,m){if(b){var h=new MediaPlayer.vo.metrics.ManifestUpdate.TrackInfo;h.id=c;h.index=d;h.streamIndex=e;h.mediaType=g;h.startNumber=l;h.fragmentInfoType=m;h.presentationTimeOffset=k;b.trackInfo.push(h);this.metricUpdated(b.mediaType,this.adapter.metricsList.MANIFEST_UPDATE_TRACK_INFO,b);return h}return null},addPlayList:function(b,c,d,e){var g=new MediaPlayer.vo.metrics.PlayList;g.stream=b;g.start=c;g.mstart=d;g.starttype=e;this.getMetricsFor(b).PlayList.push(g);
this.metricAdded(b,this.adapter.metricsList.PLAY_LIST,g);return g},appendPlayListTrace:function(b,c,d,e,g,k,l,m){var h=new MediaPlayer.vo.metrics.PlayList.Trace;h.representationid=c;h.subreplevel=d;h.start=e;h.mstart=g;h.duration=k;h.playbackspeed=l;h.stopreason=m;b.trace.push(h);this.metricUpdated(b.stream,this.adapter.metricsList.PLAY_LIST_TRACE,b);return h}}};MediaPlayer.models.MetricsModel.prototype={constructor:MediaPlayer.models.MetricsModel};MediaPlayer.models.MetricsList=function(){return{TcpList:[],HttpList:[],RepSwitchList:[],BufferLevel:[],BufferState:[],PlayList:[],DroppedFrames:[],SchedulingInfo:[],DVRInfo:[],ManifestUpdate:[],RequestsQueue:null}};MediaPlayer.models.MetricsList.prototype={constructor:MediaPlayer.models.MetricsList};MediaPlayer.vo.metrics.BufferLevel=function(){this.level=this.t=null};MediaPlayer.vo.metrics.BufferLevel.prototype={constructor:MediaPlayer.vo.metrics.BufferLevel};MediaPlayer.vo.metrics.BufferState=function(){this.target=null;this.state=MediaPlayer.dependencies.BufferController.BUFFER_EMPTY};MediaPlayer.vo.metrics.BufferState.prototype={constructor:MediaPlayer.vo.metrics.BufferState};MediaPlayer.vo.metrics.HTTPRequest=function(){this.responseHeaders=this.mediaduration=this.interval=this.responsecode=this.tfinish=this.tresponse=this.trequest=this.range=this.actualurl=this.url=this.type=this.tcpid=this.stream=null;this.trace=[]};MediaPlayer.vo.metrics.HTTPRequest.prototype={constructor:MediaPlayer.vo.metrics.HTTPRequest};MediaPlayer.vo.metrics.HTTPRequest.Trace=function(){this.d=this.s=null;this.b=[]};MediaPlayer.vo.metrics.HTTPRequest.Trace.prototype={constructor:MediaPlayer.vo.metrics.HTTPRequest.Trace};
MediaPlayer.vo.metrics.HTTPRequest.MPD_TYPE="MPD";MediaPlayer.vo.metrics.HTTPRequest.XLINK_EXPANSION_TYPE="XLink Expansion";MediaPlayer.vo.metrics.HTTPRequest.INIT_SEGMENT_TYPE="Initialization Segment";MediaPlayer.vo.metrics.HTTPRequest.INDEX_SEGMENT_TYPE="Index Segment";MediaPlayer.vo.metrics.HTTPRequest.MEDIA_SEGMENT_TYPE="Media Segment";MediaPlayer.vo.metrics.HTTPRequest.BITSTREAM_SWITCHING_SEGMENT_TYPE="Bitstream Switching Segment";MediaPlayer.vo.metrics.HTTPRequest.OTHER_TYPE="other";MediaPlayer.vo.metrics.PlayList=function(){this.starttype=this.mstart=this.start=this.stream=null;this.trace=[]};MediaPlayer.vo.metrics.PlayList.Trace=function(){this.stopreason=this.playbackspeed=this.duration=this.mstart=this.start=this.subreplevel=this.representationid=null};MediaPlayer.vo.metrics.PlayList.prototype={constructor:MediaPlayer.vo.metrics.PlayList};MediaPlayer.vo.metrics.PlayList.INITIAL_PLAY_START_REASON="initial_start";MediaPlayer.vo.metrics.PlayList.SEEK_START_REASON="seek";
MediaPlayer.vo.metrics.PlayList.Trace.prototype={constructor:MediaPlayer.vo.metrics.PlayList.Trace()};MediaPlayer.vo.metrics.PlayList.Trace.USER_REQUEST_STOP_REASON="user_request";MediaPlayer.vo.metrics.PlayList.Trace.REPRESENTATION_SWITCH_STOP_REASON="representation_switch";MediaPlayer.vo.metrics.PlayList.Trace.END_OF_CONTENT_STOP_REASON="end_of_content";MediaPlayer.vo.metrics.PlayList.Trace.REBUFFERING_REASON="rebuffering";MediaPlayer.vo.metrics.RepresentationSwitch=function(){this.lto=this.to=this.mt=this.t=null};MediaPlayer.vo.metrics.RepresentationSwitch.prototype={constructor:MediaPlayer.vo.metrics.RepresentationSwitch};MediaPlayer.vo.metrics.TCPConnection=function(){this.tconnect=this.tclose=this.topen=this.dest=this.tcpid=null};MediaPlayer.vo.metrics.TCPConnection.prototype={constructor:MediaPlayer.vo.metrics.TCPConnection};MediaPlayer.vo.metrics.DroppedFrames=function(){this.droppedFrames=this.time=null};MediaPlayer.vo.metrics.DroppedFrames.prototype={constructor:MediaPlayer.vo.metrics.DroppedFrames};MediaPlayer.vo.metrics.SchedulingInfo=function(){this.state=this.range=this.quality=this.duration=this.availabilityStartTime=this.startTime=this.type=this.t=this.mediaType=null};MediaPlayer.vo.metrics.SchedulingInfo.prototype={constructor:MediaPlayer.vo.metrics.SchedulingInfo};MediaPlayer.vo.metrics.ManifestUpdate=function(){this.availabilityStartTime=this.fetchTime=this.requestTime=this.type=this.mediaType=null;this.clientTimeOffset=this.presentationStartTime=0;this.buffered=this.currentTime=null;this.latency=0;this.streamInfo=[];this.trackInfo=[]};MediaPlayer.vo.metrics.ManifestUpdate.StreamInfo=function(){this.duration=this.start=this.index=this.id=null};
MediaPlayer.vo.metrics.ManifestUpdate.TrackInfo=function(){this.fragmentInfoType=this.startNumber=this.presentationTimeOffset=this.streamIndex=this.mediaType=this.index=this.id=null};MediaPlayer.vo.metrics.ManifestUpdate.prototype={constructor:MediaPlayer.vo.metrics.ManifestUpdate};MediaPlayer.vo.metrics.ManifestUpdate.StreamInfo.prototype={constructor:MediaPlayer.vo.metrics.ManifestUpdate.StreamInfo};MediaPlayer.vo.metrics.ManifestUpdate.TrackInfo.prototype={constructor:MediaPlayer.vo.metrics.ManifestUpdate.TrackInfo};MediaPlayer.vo.metrics.DVRInfo=function(){this.manifestInfo=this.range=this.time=null};MediaPlayer.vo.metrics.DVRInfo.prototype={constructor:MediaPlayer.vo.metrics.DVRInfo};MediaPlayer.vo.metrics.RequestsQueue=function(){this.loadingRequests=[];this.executedRequests=[]};MediaPlayer.vo.metrics.RequestsQueue.prototype={constructor:MediaPlayer.vo.metrics.RequestsQueue};Dash=function(){return{modules:{},dependencies:{},vo:{},di:{}}}();Dash.di.DashContext=function(){return{system:void 0,debug:void 0,setup:function(){Dash.di.DashContext.prototype.setup.call(this);this.system.mapClass("parser",Dash.dependencies.DashParser);this.system.mapClass("indexHandler",Dash.dependencies.DashHandler);this.system.mapSingleton("baseURLExt",Dash.dependencies.BaseURLExtensions);this.system.mapClass("fragmentExt",Dash.dependencies.FragmentExtensions);this.system.mapClass("representationController",Dash.dependencies.RepresentationController);this.system.mapSingleton("manifestExt",
Dash.dependencies.DashManifestExtensions);this.system.mapSingleton("metricsExt",Dash.dependencies.DashMetricsExtensions);this.system.mapSingleton("timelineConverter",Dash.dependencies.TimelineConverter);this.system.mapSingleton("adapter",Dash.dependencies.DashAdapter)}}};Dash.di.DashContext.prototype=new MediaPlayer.di.Context;Dash.di.DashContext.prototype.constructor=Dash.di.DashContext;Dash.vo.Mpd=function(){this.manifest=null;this.suggestedPresentationDelay=0;this.availabilityStartTime=null;this.maxSegmentDuration=this.timeShiftBufferDepth=this.availabilityEndTime=Number.POSITIVE_INFINITY;this.checkTime=NaN;this.clientServerTimeShift=0;this.isClientServerTimeSyncCompleted=!1};Dash.vo.Mpd.prototype={constructor:Dash.vo.Mpd};Dash.vo.Period=function(){this.id=null;this.index=-1;this.start=this.duration=NaN;this.mpd=null;this.isAd=!1};Dash.vo.Period.prototype={constructor:Dash.vo.Period};Dash.vo.Period.DEFAULT_ID=0;Dash.vo.AdaptationSet=function(){this.period=null;this.index=-1;this.type=null};Dash.vo.AdaptationSet.prototype={constructor:Dash.vo.AdaptationSet};Dash.vo.Representation=function(){this.id=null;this.index=-1;this.initialization=this.segmentInfoType=this.adaptation=null;this.segmentDuration=NaN;this.startNumber=this.timescale=1;this.range=this.indexRange=null;this.presentationTimeOffset=0;this.MSETimeOffset=NaN;this.segmentAvailabilityRange=null;this.availableSegmentsNumber=0;this.maxPlayoutRate=this.bandwidth=NaN;this.BaseURL=[];this.currentBaseURLIndex=0;this.blackListed=!1};Dash.vo.Representation.prototype={constructor:Dash.vo.Representation};Dash.vo.Segment=function(){this.media=this.mediaRange=this.index=this.indexRange=null;this.duration=NaN;this.replacementTime=null;this.wallStartTime=this.availabilityIdx=this.availabilityEndTime=this.availabilityStartTime=this.presentationStartTime=this.mediaStartTime=this.replacementNumber=NaN;this.representation=null};Dash.vo.Segment.prototype={constructor:Dash.vo.Segment};Dash.vo.Event=function(){this.id=this.presentationTime=this.duration=NaN;this.messageData="";this.eventStream=null;this.presentationTimeDelta=NaN};Dash.vo.Event.prototype={constructor:Dash.vo.Event};Dash.vo.EventStream=function(){this.period=this.representation=this.adaptionSet=null;this.timescale=1;this.schemeIdUri=this.value=""};Dash.vo.EventStream.prototype={constructor:Dash.vo.EventStream};Dash.vo.UTCTiming=function(){this.value=this.schemeIdUri=""};Dash.vo.UTCTiming.prototype={constructor:Dash.vo.UTCTiming};Dash.dependencies.DashParser=function(){var b=/^([-])?P(([\d.]*)Y)?(([\d.]*)M)?(([\d.]*)D)?T?(([\d.]*)H)?(([\d.]*)M)?(([\d.]*)S)?/,c=/^([0-9]{4})-([0-9]{2})-([0-9]{2})T([0-9]{2}):([0-9]{2})(?::([0-9]*)(\.[0-9]*)?)?(?:([+-])([0-9]{2})([0-9]{2}))?/,d=/^[-+]?[0-9]+[.]?[0-9]*([eE][-+]?[0-9]+)?$/,e=/^https?:\/\//i,g=[{type:"duration",test:function(c){for(var d="minBufferTime mediaPresentationDuration minimumUpdatePeriod timeShiftBufferDepth maxSegmentDuration maxSubsegmentDuration suggestedPresentationDelay start starttime duration".split(" "),
e=d.length,g=0;g<e;g++)if(c.nodeName===d[g])return b.test(c.value);return!1},converter:function(c){c=b.exec(c);var d=31536E3*parseFloat(c[2]||0)+2592E3*parseFloat(c[4]||0)+86400*parseFloat(c[6]||0)+3600*parseFloat(c[8]||0)+60*parseFloat(c[10]||0)+parseFloat(c[12]||0);void 0!==c[1]&&(d=-d);return d}},{type:"datetime",test:function(b){return c.test(b.value)},converter:function(b){b=c.exec(b);var d;d=Date.UTC(parseInt(b[1],10),parseInt(b[2],10)-1,parseInt(b[3],10),parseInt(b[4],10),parseInt(b[5],10),
b[6]&&parseInt(b[6],10)||0,b[7]&&1E3*parseFloat(b[7])||0);if(b[9]&&b[10]){var e=60*parseInt(b[9],10)+parseInt(b[10],10);d+=("+"===b[8]?-1:1)*e*6E4}return new Date(d)}},{type:"numeric",test:function(b){return d.test(b.value)},converter:function(b){return parseFloat(b)}}],k=function(){var b,c,d,e;e=[{name:"profiles",merge:!1},{name:"width",merge:!1},{name:"height",merge:!1},{name:"sar",merge:!1},{name:"frameRate",merge:!1},{name:"audioSamplingRate",merge:!1},{name:"mimeType",merge:!1},{name:"segmentProfiles",
merge:!1},{name:"codecs",merge:!1},{name:"maximumSAPPeriod",merge:!1},{name:"startsWithSap",merge:!1},{name:"maxPlayoutRate",merge:!1},{name:"codingDependency",merge:!1},{name:"scanType",merge:!1},{name:"FramePacking",merge:!0},{name:"AudioChannelConfiguration",merge:!0},{name:"ContentProtection",merge:!0}];b={name:"AdaptationSet",isRoot:!1,isArray:!0,parent:null,children:[]};b.properties=e;c={name:"Representation",isRoot:!1,isArray:!0};c.parent=b;c.children=[];c.properties=e;b.children.push(c);d=
{name:"SubRepresentation",isRoot:!1,isArray:!0};d.parent=c;d.children=[];d.properties=e;c.children.push(d);return b},l=function(){var b,c,d,e;e=[{name:"SegmentBase",merge:!0},{name:"SegmentTemplate",merge:!0},{name:"SegmentList",merge:!0}];b={name:"Period",isRoot:!1,isArray:!0,parent:null,children:[]};b.properties=e;c={name:"AdaptationSet",isRoot:!1,isArray:!0};c.parent=b;c.children=[];c.properties=e;b.children.push(c);d={name:"Representation",isRoot:!1,isArray:!0};d.parent=c;d.children=[];d.properties=
e;c.children.push(d);return b},m=function(){var b,c,d,g;g=[{name:"BaseURL",merge:!0,mergeFunction:function(b,c){"object"===typeof b&&(b=b.toString());var d=function(b,c){return e.test(c)?c:b+c},f=[];if("string"===typeof b)if("string"===typeof c)f[0]=d(b,c);else{for(var h=!0,g=0;g<c.length;g++)f[g]=d(b,c[g]),h=h&&e.test(c[g]);h&&(f[g]=b)}else for(g=h=0;g<b.length;g++)if("string"===typeof c)e.test(c)?(f[0]=c,f=f.concat(b),g=b.length):f[g]=d(b[g],c);else for(var l=0;l<c.length;l++)f[h]=d(b[g],c[l]),
h++;return f}}];b={name:"mpd",isRoot:!0,isArray:!0,parent:null,children:[]};b.properties=g;c={name:"Period",isRoot:!1,isArray:!0,parent:null,children:[]};c.properties=g;b.children.push(c);d={name:"AdaptationSet",isRoot:!1,isArray:!0};d.parent=c;d.children=[];d.properties=g;c.children.push(d);c={name:"Representation",isRoot:!1,isArray:!0};c.parent=d;c.children=[];c.properties=g;d.children.push(c);return b};return{log:void 0,errHandler:void 0,parse:function(b,c,d){var e,t=new X2JS(g,"",!0),r=[];r.push(k());
r.push(l());r.push(m());var r=new ObjectIron(r),p=new Date,u=null,w=null;try{e=t.xml_str2json(b);if(!e)throw"parser error";u=new Date;e.hasOwnProperty("BaseURL")?(e.BaseURL=e.BaseURL_asArray[0],0!==e.BaseURL.toString().indexOf("http")&&(e.BaseURL=c+e.BaseURL)):e.BaseURL=c;e.hasOwnProperty("Location")&&(e.Location=e.Location_asArray[0]);r.run(e);w=new Date;d.setMatchers(g);d.setIron(r);this.log("Parsing complete: ( xml2json: "+(u.getTime()-p.getTime())+"ms, objectiron: "+(w.getTime()-u.getTime())+
"ms, total: "+(w.getTime()-p.getTime())/1E3+"s)")}catch(v){return this.errHandler.manifestError("parsing the manifest failed","parse",b),null}return e}}};Dash.dependencies.DashParser.prototype={constructor:Dash.dependencies.DashParser};Dash.dependencies.DashHandler=function(){var b=-1,c,d,e,g=0,k,l=/^(?:(?:[a-z]+:)?\/)?\//i,m=!1,h=function(b,c){for(;b.length<c;)b="0"+b;return b},f=function(b,c,d){for(var e,f,g=c.length,l,k;;){e=b.indexOf("$"+c);if(0>e)return b;f=b.indexOf("$",e+g);if(0>f)return b;l=b.indexOf("%0",e+g);if(l>e&&l<f)switch(k=b.charAt(f-1),l=parseInt(b.substring(l+2,f-1),10),k){case "d":case "i":case "u":k=h(d.toString(),l);break;case "x":k=h(d.toString(16),l);break;case "X":k=h(d.toString(16),l).toUpperCase();break;
case "o":k=h(d.toString(8),l);break;default:return this.log("Unsupported/invalid IEEE 1003.1 format identifier string in URL"),b}else k=d;b=b.substring(0,e)+k+b.substring(f+1)}},n=function(b,c){var d;d="object"===typeof c.BaseURL?c.BaseURL[c.currentBaseURLIndex]:c.BaseURL;return b===d?b:"object"===typeof b&&-1!==b.indexOf(d)?d:l.test(b)?b:d+b},q=function(c){var e;e=c.adaptation.period;var f=!1,h,g=c.segmentInfoType;if(0>b)f=!1;else if(d||b<c.availableSegmentsNumber){if(h=z(b,c))f=this.timelineConverter.getLocalTimeOffset(c),
h=h.presentationStartTime-e.start-f,0>h&&(h=0),e=c.adaptation.period.duration,this.log(c.segmentInfoType+": "+h+" / "+e),f="SegmentTimeline"===g&&d?!1:h>=e}else f=!0;return f},t=function(b,c){var e,f,h,g;f=b.segmentDuration;isNaN(f)&&(f=b.adaptation.period.duration);h=b.adaptation.period.start+c*f;g=h+f;e=new Dash.vo.Segment;e.representation=b;e.duration=f;e.presentationStartTime=h;e.mediaStartTime=this.timelineConverter.calcMediaTimeFromPresentationTime(e.presentationStartTime,b);e.availabilityStartTime=
this.timelineConverter.calcAvailabilityStartTimeFromPresentationTime(e.presentationStartTime,b.adaptation.period.mpd,d);e.availabilityEndTime=this.timelineConverter.calcAvailabilityEndTimeFromPresentationTime(g,b.adaptation.period.mpd,d);e.wallStartTime=this.timelineConverter.calcWallTimeForSegment(e,d);e.replacementNumber=e.representation.startNumber+c;e.availabilityIdx=c;return e},r=function(b){var e=this,f=b.adaptation.period.mpd.manifest.Period_asArray[b.adaptation.period.index].AdaptationSet_asArray[b.adaptation.index].Representation_asArray[b.index].SegmentTemplate,
h=f.SegmentTimeline,g=0<b.availableSegmentsNumber,l=[],k,n,m,p,r,q=0,t=0,v=-1,x,y,z,E=!1,A,D,F,H=function(c){return w.call(e,b,q,c.d,F,f.media,c.mediaRange,v)};F=b.timescale;h=h.S_asArray;(x=u.call(e,b))?(A=x.start,D=x.end):z=e.timelineConverter.calcMediaTimeFromPresentationTime(c||0,b);n=0;for(m=h.length;n<m;n+=1)if(k=h[n],r=0,k.hasOwnProperty("r")&&(r=k.r),k.hasOwnProperty("t")&&(q=k.t,t=q/F),0>r&&((p=h[n+1])&&p.hasOwnProperty("t")?p=p.t/F:(p=b.segmentAvailabilityRange?b.segmentAvailabilityRange.end:
this.timelineConverter.calcSegmentAvailabilityRange(b,d).end,p=e.timelineConverter.calcMediaTimeFromPresentationTime(p,b),b.segmentDuration=k.d/F),r=Math.ceil((p-t)/(k.d/F))-1),y){if(g)break;v+=r+1}else for(p=0;p<=r;p+=1){v+=1;if(x){if(v>D){y=!0;if(g)break;continue}v>=A&&l.push(H.call(e,k))}else{if(10<l.length){y=!0;if(g)break;continue}E?l.push(H.call(e,k)):t>=z-k.d/F*1.5&&(E=!0,l.push(H.call(e,k)))}q+=k.d;t=q/F}g||(b.availableSegmentsNumber=v+1);return l},p=function(e){var f=e.segmentDuration,h=
e.adaptation.period.mpd.manifest.minBufferTime,g=e.segmentAvailabilityRange,g={start:this.timelineConverter.calcPeriodRelativeTimeFromMpdRelativeTime(e,g.start),end:this.timelineConverter.calcPeriodRelativeTimeFromMpdRelativeTime(e,g.end)},l=NaN,k=null,l=e.segments,n=2*f,h=Math.max(2*h,10*f);g||(g=this.timelineConverter.calcSegmentAvailabilityRange(e,d));g.start=Math.max(g.start,0);k=this.timelineConverter.getLocalTimeOffset(e);g.end+=k;if(d&&!this.timelineConverter.isTimeSyncCompleted())return e=
Math.floor(g.start/f),f=Math.floor(g.end/f),f={start:e,end:f};l=l&&0<l.length?(k=z(b,e))?this.timelineConverter.calcPeriodRelativeTimeFromMpdRelativeTime(e,k.presentationStartTime):0<b?b*f:this.timelineConverter.calcPeriodRelativeTimeFromMpdRelativeTime(e,c||l[0].presentationStartTime):0<b?b*f:d?g.end:g.start;e=Math.floor(Math.max(l-n,g.start)/f);f=Math.floor(Math.min(e+h/f,g.end/f));return f={start:e,end:f}},u=function(){var e=Number.POSITIVE_INFINITY,f;if(d&&!this.timelineConverter.isTimeSyncCompleted())return f=
{start:0,end:e};if(!d&&c||0>b)return null;f=Math.max(b-2,0);e=Math.min(b+10,e);return f={start:f,end:e}},w=function(b,c,e,h,g,l,k){var n=c/h;e=Math.min(e/h,b.adaptation.period.mpd.maxSegmentDuration);var m,p;h=this.timelineConverter.calcPresentationTimeFromMediaTime(n,b);m=h+e;p=new Dash.vo.Segment;p.representation=b;p.duration=e;p.mediaStartTime=n;p.presentationStartTime=h;p.availabilityStartTime=b.adaptation.period.mpd.manifest.loadedTime;p.availabilityEndTime=this.timelineConverter.calcAvailabilityEndTimeFromPresentationTime(m,
b.adaptation.period.mpd,d);p.wallStartTime=this.timelineConverter.calcWallTimeForSegment(p,d);p.replacementTime=c;p.replacementNumber=p.representation.startNumber+k;g=f(g,"Number",p.replacementNumber);g=f(g,"Time",p.replacementTime);p.media=g;p.mediaRange=l;p.availabilityIdx=k;return p},v=function(c){var e,h=c.segmentInfoType,g;if(g="SegmentBase"!==h&&"BaseURL"!==h){g=!1;var l=c.segments;l&&0!==l.length?(g=l[0].availabilityIdx,l=l[l.length-1].availabilityIdx,g=b<g||b>l):g=!0}if(g){if("SegmentTimeline"===
h)e=r.call(this,c);else if("SegmentTemplate"===h){e=[];l=c.adaptation.period.mpd.manifest.Period_asArray[c.adaptation.period.index].AdaptationSet_asArray[c.adaptation.index].Representation_asArray[c.index].SegmentTemplate;h=c.segmentDuration;g=c.segmentAvailabilityRange;var k,n,m=null,q,u=null;q=c.startNumber;k=isNaN(h)&&!d?{start:q,end:q}:p.call(this,c);n=k.start;for(k=k.end;n<=k;n+=1)m=t.call(this,c,n),m.replacementTime=(q+n-1)*c.segmentDuration,u=l.media,u=f(u,"Number",m.replacementNumber),u=f(u,
"Time",m.replacementTime),m.media=u,e.push(m);isNaN(h)?c.availableSegmentsNumber=1:(l=this.timelineConverter.getLocalTimeOffset(c),c.availableSegmentsNumber=Math.ceil((g.end-g.start)/h)+Math.ceil(l/h))}else if("SegmentList"===h){e=[];h=c.adaptation.period.mpd.manifest.Period_asArray[c.adaptation.period.index].AdaptationSet_asArray[c.adaptation.index].Representation_asArray[c.index].SegmentList;g=c.adaptation.period.mpd.manifest.Period_asArray[c.adaptation.period.index].AdaptationSet_asArray[c.adaptation.index].Representation_asArray[c.index].BaseURL;
l=h.SegmentURL_asArray.length;q=c.startNumber;k=p.call(this,c);n=Math.max(k.start,0);for(k=Math.min(k.end,h.SegmentURL_asArray.length-1);n<=k;n+=1)u=h.SegmentURL_asArray[n],m=t.call(this,c,n),m.replacementTime=(q+n-1)*c.segmentDuration,m.media=u.media?u.media:g,m.mediaRange=u.mediaRange,m.index=u.index,m.indexRange=u.indexRange,e.push(m);c.availableSegmentsNumber=l}x.call(this,c,e)}else e=c.segments;return e},x=function(b,c){var e,f;(b.segments=c)&&0<c.length&&(k=isNaN(k)?c[0].presentationStartTime:
Math.min(c[0].presentationStartTime,k));e=c.length-1;d&&isNaN(this.timelineConverter.getExpectedLiveEdge())&&(e=c[e],e=e.presentationStartTime,f=this.metricsModel.getMetricsFor("stream"),this.timelineConverter.setExpectedLiveEdge(e),this.metricsModel.updateManifestUpdateInfo(this.metricsExt.getCurrentManifestUpdate(f),{presentationStartTime:e}))},y=function(b){if(!b)throw Error("no representation");b.segments=null;v.call(this,b);return b},E=function(b,c,d){var e=(c=c.segments)?c.length:null,f=-1,
h,g,l,k;if(c&&0<e){var n=function(c){g=c.mediaStartTime-c.representation.presentationTimeOffset;l=c.duration;h=void 0===d||null===d?l/2:d;b+h>=g&&b-h<g+l&&(f=c.availabilityIdx);return f};if(m)for(k=e-1;0<=k&&!(-1<n(c[k]));--k);else for(k=0;k<e&&!(-1<n(c[k]));k+=1);}return f},z=function(b,c){if(!c||!c.segments)return null;var d=c.segments.length,e,f;for(f=0;f<d;f+=1)if(e=c.segments[f],e.availabilityIdx===b)return e;return null},D=function(b){if(null===b||void 0===b)return null;var c=new MediaPlayer.vo.FragmentRequest,
d=b.representation,h=d.adaptation.period.mpd.manifest.Period_asArray[d.adaptation.period.index].AdaptationSet_asArray[d.adaptation.index].Representation_asArray[d.index].bandwidth,g;g=n(b.media,d);g=f(g,"Number",b.replacementNumber);g=f(g,"Time",b.replacementTime);g=f(g,"Bandwidth",h);h=g;g=d.id;null===g||-1===h.indexOf("$RepresentationID$")?g=h:(g=g.toString(),g=h.split("$RepresentationID$").join(g));g=g.split("$$").join("$");c.mediaType=e;c.type=MediaPlayer.vo.metrics.HTTPRequest.MEDIA_SEGMENT_TYPE;
c.url=g;c.range=b.mediaRange;this.timelineConverter.getLocalTimeOffset(d);c.startTime=b.mediaStartTime+d.MSETimeOffset;c.duration=b.duration;c.timescale=d.timescale;c.availabilityStartTime=b.availabilityStartTime;c.availabilityEndTime=b.availabilityEndTime;c.wallStartTime=b.wallStartTime;c.quality=d.index;c.index=b.availabilityIdx;c.mediaInfo=this.streamProcessor.getMediaInfo();return c},A=function(d,f,h){var g=b,l=h?h.keepIdx:!1,k=h?h.timeThreshold:null;h=h&&h.ignoreIsFinished?!0:!1;if(!d)return null;
var n=this.timelineConverter.getLocalTimeOffset(d);c=f+n;var m=f-(d.adaptation.period.mpd.manifest.Period_asArray[d.adaptation.period.index].start-n);0>m&&(m=0);this.log("Getting the request for time: "+f+" Requested Time: "+m+" period Index: "+d.adaptation.period.index);this.log("GetforTime: period start Time: "+d.adaptation.period.mpd.manifest.Period_asArray[d.adaptation.period.index].start);this.log("GetForTime: period local start Time: "+n);b=E.call(this,m,d,k);v.call(this,d);0>b&&(b=E.call(this,
m,d,k));this.log("Index for time "+f+" is "+b);(h?0:q.call(this,d))?(d=new MediaPlayer.vo.FragmentRequest,d.action=d.ACTION_COMPLETE,d.index=b,d.mediaType=e,d.mediaInfo=this.streamProcessor.getMediaInfo(),this.log("Signal complete.",d)):(d=z(b,d),d=D.call(this,d));l&&0<=g&&(b=g);return d},F=function(b){b=b.data.representation;b.segments&&this.notify(Dash.dependencies.DashHandler.eventList.ENAME_REPRESENTATION_UPDATED,{representation:b})},H=function(b){if(!b.error&&e===b.data.mediaType){var c=b.data.segments;
b=b.data.representation;var d,f,h,g=[],l=0;d=0;for(f=c.length;d<f;d+=1)h=c[d],h=w.call(this,b,h.startTime,h.duration,h.timescale,h.media,h.mediaRange,l),g.push(h),l+=1;b.segmentAvailabilityRange={start:g[0].presentationStartTime,end:g[f-1].presentationStartTime};b.availableSegmentsNumber=f;x.call(this,b,g);b.initialization&&this.notify(Dash.dependencies.DashHandler.eventList.ENAME_REPRESENTATION_UPDATED,{representation:b})}};return{log:void 0,baseURLExt:void 0,timelineConverter:void 0,metricsModel:void 0,
metricsExt:void 0,notify:void 0,subscribe:void 0,unsubscribe:void 0,setup:function(){k=NaN;this[Dash.dependencies.BaseURLExtensions.eventList.ENAME_INITIALIZATION_LOADED]=F;this[Dash.dependencies.BaseURLExtensions.eventList.ENAME_SEGMENTS_LOADED]=H},initialize:function(b){this.subscribe(Dash.dependencies.DashHandler.eventList.ENAME_REPRESENTATION_UPDATED,b.representationController);e=b.getType();this.setMediaType(e);d=b.isDynamic();this.streamProcessor=b},getType:function(){return e},setType:function(b){e=
b},getIsDynamic:function(){return d},setIsDynamic:function(b){d=b},setCurrentTime:function(b){this.log("Setting current index handler time to: "+b);g=b},getCurrentTime:function(){return g},getEarliestTime:function(){return k},reset:function(){g=0;c=void 0;k=NaN;b=-1;d=void 0;this.unsubscribe(Dash.dependencies.DashHandler.eventList.ENAME_REPRESENTATION_UPDATED,this.streamProcessor.representationController)},getCurrentIndex:function(){return b},getInitRequest:function(b){if(b){var c=e,f,h=new MediaPlayer.vo.FragmentRequest;
f=b.adaptation.period;h.mediaType=c;h.type=MediaPlayer.vo.metrics.HTTPRequest.INIT_SEGMENT_TYPE;h.url=n(b.initialization,b);h.range=b.range;c=f.start;h.availabilityStartTime=this.timelineConverter.calcAvailabilityStartTimeFromPresentationTime(c,b.adaptation.period.mpd,d);h.availabilityEndTime=this.timelineConverter.calcAvailabilityEndTimeFromPresentationTime(c+f.duration,f.mpd,d);h.quality=b.index;h.mediaInfo=this.streamProcessor.getMediaInfo();b=h}else b=null;return b},getSegmentRequestForTime:A,
getNextSegmentRequest:function(d){var f;if(!d||-1===b)return null;c=null;f=b+=m?-1:1;this.log("Getting the next request at index: "+b);q.call(this,d)?(d=new MediaPlayer.vo.FragmentRequest,d.action=d.ACTION_COMPLETE,d.index=f,d.mediaType=e,d.mediaInfo=this.streamProcessor.getMediaInfo(),this.log("Signal complete.")):(v.call(this,d),f=z(f,d),d=D.call(this,f));return d},generateSegmentRequestForTime:function(b,c){var d=(b.segmentAvailabilityRange.end-b.segmentAvailabilityRange.start)/2;b.segments=null;
b.segmentAvailabilityRange={start:c-d,end:c+d};return A.call(this,b,c,{keepIdx:!1,ignoreIsFinished:!0})},updateRepresentation:function(c,f){var h=c.initialization,g="BaseURL"!==c.segmentInfoType&&"SegmentBase"!==c.segmentInfoType;c.segmentDuration||c.segments||y.call(this,c);c.segmentAvailabilityRange=null;c.segmentAvailabilityRange=this.timelineConverter.calcSegmentAvailabilityRange(c,d);c.segmentAvailabilityRange.end<c.segmentAvailabilityRange.start&&!c.useCalculatedLiveEdgeTime?(h=new MediaPlayer.vo.Error(Dash.dependencies.DashHandler.SEGMENTS_UNAVAILABLE_ERROR_CODE,
"no segments are available yet",{availabilityDelay:c.segmentAvailabilityRange.start-c.segmentAvailabilityRange.end}),this.notify(Dash.dependencies.DashHandler.eventList.ENAME_REPRESENTATION_UPDATED,{representation:c},h)):(f||(b=-1),c.segmentDuration&&y.call(this,c),h||this.baseURLExt.loadInitialization(c),g||this.baseURLExt.loadSegments(c,e,c.indexRange),h&&g&&this.notify(Dash.dependencies.DashHandler.eventList.ENAME_REPRESENTATION_UPDATED,{representation:c}))},setReverseTrickPlay:function(b){m=b}}};
Dash.dependencies.DashHandler.prototype={constructor:Dash.dependencies.DashHandler};Dash.dependencies.DashHandler.SEGMENTS_UNAVAILABLE_ERROR_CODE=1;Dash.dependencies.DashHandler.eventList={ENAME_REPRESENTATION_UPDATED:"representationUpdated"};Dash.dependencies.RepresentationController=function(){var b=null,c=-1,d=!0,e=[],g,k=function(){var b=new Date,c=this.getCurrentRepresentation(),d=this.streamProcessor.playbackController.getTime();this.metricsModel.addRepresentationSwitch(c.adaptation.type,b,d,c.id)},l=function(b){for(var c,d=0,f=e.length;d<f;d+=1)c=e[d],c.segmentAvailabilityRange=this.timelineConverter.calcSegmentAvailabilityRange(c,b)},m=function(b){var c=this;b=1E3*(b+g.segmentDuration*this.liveDelayFragmentCount);d=!1;setTimeout(function(){if(!this.isUpdating()){d=
!0;c.notify(Dash.dependencies.RepresentationController.eventList.ENAME_DATA_UPDATE_STARTED);for(var b=0;b<e.length;b+=1)c.indexHandler.updateRepresentation(e[b],!0)}}.bind(this),b)},h=function(c){if(this.isUpdating()){var f=c.data.representation,h=this.metricsModel.getMetricsFor("stream"),l=this.metricsModel.getMetricsFor(this.getCurrentRepresentation().adaptation.type),h=this.metricsExt.getCurrentManifestUpdate(h),n=!1;if(c.error&&c.error.code===Dash.dependencies.DashHandler.SEGMENTS_UNAVAILABLE_ERROR_CODE)this.addDVRMetric.call(this),
m.call(this,c.error.data.availabilityDelay),l=new MediaPlayer.vo.Error(Dash.dependencies.RepresentationController.SEGMENTS_UPDATE_FAILED_ERROR_CODE,"Segments update failed",null),this.notify(Dash.dependencies.RepresentationController.eventList.ENAME_DATA_UPDATE_COMPLETED,{data:b,currentRepresentation:g},l);else{if(h){for(var q=0;q<h.trackInfo.length;q+=1)if(c=h.trackInfo[q],c.index===f.index&&c.mediaType===this.streamProcessor.getType()){n=!0;break}n||this.metricsModel.addManifestUpdateRepresentationInfo(h,
f.id,f.index,f.adaptation.period.index,this.streamProcessor.getType(),f.presentationTimeOffset,f.startNumber,f.segmentInfoType)}a:{f=0;for(n=e.length;f<n;f+=1)if(c=e[f].segmentInfoType,null===e[f].segmentAvailabilityRange||null===e[f].initialization||("SegmentBase"===c||"BaseURL"===c)&&!e[f].segments){f=!1;break a}f=!0}f&&(d=!1,this.abrController.setPlaybackQuality(this.streamProcessor.getType(),this.streamProcessor.getStreamInfo(),e.indexOf(g)),this.metricsModel.updateManifestUpdateInfo(h,{latency:g.segmentAvailabilityRange.end-
this.streamProcessor.playbackController.getTime()}),(l=this.metricsExt.getCurrentRepresentationSwitch(l))||k.call(this),this.notify(Dash.dependencies.RepresentationController.eventList.ENAME_DATA_UPDATE_COMPLETED,{data:b,currentRepresentation:g}))}}},f=function(b){l.call(this,b.data.isDynamic)},n=function(b){if(!b.error){l.call(this,!0);this.indexHandler.updateRepresentation(g,!1);b=this.manifestModel.getValue();var c=g.adaptation.period,d=this.streamController.getActiveStreamInfo();d.isLast&&(c.mpd.checkTime=
this.manifestExt.getCheckTime(b,c),c.duration=this.manifestExt.getEndTimeForLastPeriod(this.manifestModel.getValue(),c)-c.start,d.duration=c.duration)}},q=function(){this.addDVRMetric.call(this)},t=function(b){if(b.data.mediaType===this.streamProcessor.getType()&&this.streamProcessor.getStreamInfo().id===b.data.streamInfo.id&&b.data.oldQuality!==b.data.newQuality){g=this.getRepresentationForQuality(b.data.newQuality);b=b.data.mediaType;var c=g.bandwidth;!this.DOMStorage.isSupported(MediaPlayer.utils.DOMStorage.STORAGE_TYPE_LOCAL)||
"video"!==b&&"audio"!==b||localStorage.setItem(MediaPlayer.utils.DOMStorage["LOCAL_STORAGE_"+b.toUpperCase()+"_BITRATE_KEY"],JSON.stringify({bitrate:c/1E3,timestamp:(new Date).getTime()}));k.call(this)}};return{system:void 0,log:void 0,manifestExt:void 0,manifestModel:void 0,metricsModel:void 0,metricsExt:void 0,abrController:void 0,streamController:void 0,timelineConverter:void 0,notify:void 0,subscribe:void 0,unsubscribe:void 0,DOMStorage:void 0,liveDelayFragmentCount:void 0,errHandler:void 0,addDVRMetric:function(){var b=
this.streamProcessor,c=this.timelineConverter.calcSegmentAvailabilityRange(g,b.isDynamic());this.metricsModel.addDVRInfo(b.getType(),b.playbackController.getTime(),b.getStreamInfo().manifestInfo,c,b.getStreamInfo())},setup:function(){this[MediaPlayer.dependencies.AbrController.eventList.ENAME_QUALITY_CHANGED]=t;this[Dash.dependencies.DashHandler.eventList.ENAME_REPRESENTATION_UPDATED]=h;this[MediaPlayer.dependencies.PlaybackController.eventList.ENAME_WALLCLOCK_TIME_UPDATED]=f;this[MediaPlayer.dependencies.LiveEdgeFinder.eventList.ENAME_LIVE_EDGE_SEARCH_COMPLETED]=
n;this[MediaPlayer.dependencies.BufferController.eventList.ENAME_BUFFER_LEVEL_UPDATED]=q},initialize:function(b){this.streamProcessor=b;this.indexHandler=b.indexHandler},getData:function(){return b},getDataIndex:function(){return c},isUpdating:function(){return d},updateData:function(f,h,l){var k=this.streamProcessor.getStreamInfo(),n=this.abrController.getTopQualityIndexFor(l,k.id);d=!0;this.notify(Dash.dependencies.RepresentationController.eventList.ENAME_DATA_UPDATE_STARTED);var m=this.manifestModel.getValue();
c=this.manifestExt.getIndexForAdaptation(b,m,h.period.index);e=this.manifestExt.getRepresentationsForAdaptation(m,h);h=this.abrController.getQualityFor(l,k);h>n&&(h=n);g=e[h];b=f;if("video"!==l&&"audio"!==l&&"fragmentedText"!==l&&"muxed"!==l)d=!1,this.notify(Dash.dependencies.RepresentationController.eventList.ENAME_DATA_UPDATE_COMPLETED,{data:b,currentRepresentation:g});else for(f=0;f<e.length;f+=1)this.indexHandler.updateRepresentation(e[f],!0)},getRepresentationForQuality:function(b){return e[b]},
getCurrentRepresentation:function(){return g},onSegmentFailed:function(b){var c=b.data.request,d=b.data.xhrRequest,e=this.getRepresentationForQuality(c.quality);1<e.BaseURL.length&&(void 0==e.currentBaseURLIndex||e.currentBaseURLIndex<e.BaseURL.length-1)?(this.log("[Dash Failover] Trying backup representation"),void 0==e.currentBaseURLIndex?e.currentBaseURLIndex=0:e.currentBaseURLIndex++,isNaN(c.startTime)||this.indexHandler.setCurrentTime(c.startTime)):this.manifestModel.getValue().Period_asArray[e.adaptation.period.index].AdaptationSet_asArray[e.adaptation.index].Representation_asArray[e.index].blackListed?
(this.log("[Dash Failover] No backup representation left, throwing error"),b.error&&"contentMismatch"===b.error.message?this.errHandler.contentTypeError(null,"segment"):this.errHandler.downloadError("content",c.url,d)):(this.log("[Dash Failover] No backup representation left, blacklisting"),this.manifestModel.getValue().Period_asArray[e.adaptation.period.index].AdaptationSet_asArray[e.adaptation.index].Representation_asArray[e.index].blackListed=!0,isNaN(c.startTime)||this.indexHandler.setCurrentTime(c.startTime))}}};
Dash.dependencies.RepresentationController.prototype={constructor:Dash.dependencies.RepresentationController};Dash.dependencies.RepresentationController.SEGMENTS_UPDATE_FAILED_ERROR_CODE=1;Dash.dependencies.RepresentationController.eventList={ENAME_DATA_UPDATE_COMPLETED:"dataUpdateCompleted",ENAME_DATA_UPDATE_STARTED:"dataUpdateStarted"};Dash.dependencies.BaseURLExtensions=function(){var b=function(b,c){for(var d=b.references,e=d.length,g=b.timescale,k=b.earliest_presentation_time,t=(0===c.range.start?b.offset:c.range.start)+b.first_offset+b.size,r=[],p,u,w,v,x=0;x<e;x+=1)w=d[x].subsegment_duration,v=d[x].referenced_size,p=new Dash.vo.Segment,p.duration=w,p.media=c.url,p.startTime=k,p.timescale=g,u=t+v-1,p.mediaRange=t+"-"+u,r.push(p),k+=w,t+=v;return r},c=function(b){var c=b.getBox("ftyp");b=b.getBox("moov");var d=null;this.log("Searching for initialization.");
b&&b.isComplete&&(c=c?c.offset:b.offset,b=b.offset+b.size-1,d=c+"-"+b,this.log("Found the initialization.  Range: "+d));return d},d=function(b,e){var h=new XMLHttpRequest,f=!0,k=this,q=null,t=null,r=b.adaptation.period.mpd.manifest.Period_asArray[b.adaptation.period.index].AdaptationSet_asArray[b.adaptation.index].Representation_asArray[b.index].BaseURL,p=e||{url:r,range:{start:0,end:1500},searching:!1,bytesLoaded:0,bytesToLoad:1500,request:h};k.log("Start searching for initialization.");h.onload=
function(){200>h.status||299<h.status||(f=!1,p.bytesLoaded=p.range.end,t=k.boxParser.parse(h.response),(q=c.call(k,t))?(b.range=q,b.initialization=r,k.notify(Dash.dependencies.BaseURLExtensions.eventList.ENAME_INITIALIZATION_LOADED,{representation:b})):(p.range.end=p.bytesLoaded+p.bytesToLoad,d.call(k,b,p)))};h.onloadend=h.onerror=function(){f&&(f=!1,k.errHandler.downloadError("initialization",p.url,h),k.notify(Dash.dependencies.BaseURLExtensions.eventList.ENAME_INITIALIZATION_LOADED,{representation:b}))};
g.call(k,h,p);k.log("Perform init search: "+p.url)},e=function(c,d,h,f,k){var q=this,t=null!==h,r=new XMLHttpRequest,p=!0,u=null,w=null,v={url:c.adaptation.period.mpd.manifest.Period_asArray[c.adaptation.period.index].AdaptationSet_asArray[c.adaptation.index].Representation_asArray[c.index].BaseURL,range:t?h:{start:0,end:1500},searching:!t,bytesLoaded:f?f.bytesLoaded:0,bytesToLoad:1500,request:r};r.onload=function(){if(!(200>r.status||299<r.status)){var f=v.bytesToLoad,h=r.response.byteLength;p=!1;
v.bytesLoaded=v.range.end-v.range.start;u=q.boxParser.parse(r.response);if((w=u.getBox("sidx"))&&w.isComplete){var f=w.references,g;null!==f&&void 0!==f&&0<f.length&&(g=1===f[0].reference_type);if(g){q.log("Initiate multiple SIDX load.");v.range.end=v.range.start+w.size;var t,D,A,F=[],H=0,h=(w.offset||v.range.start)+w.size,B=function(b){b?(F=F.concat(b),H+=1,H>=t&&k.call(q,F,c,d)):k.call(q,null,c,d)};g=0;for(t=f.length;g<t;g+=1)D=h,A=h+f[g].referenced_size-1,h+=f[g].referenced_size,D={start:D,end:A},
e.call(q,c,null,D,v,B)}else q.log("Parsing segments from SIDX."),f=b.call(q,w,v),k.call(q,f,c,d)}else{if(w)v.range.start=w.offset||v.range.start,v.range.end=v.range.start+(w.size||f);else{if(h<v.bytesLoaded){k.call(q,null,c,d);return}(g=u.getLastBox())&&g.size?(v.range.start=g.offset+g.size,v.range.end=v.range.start+f):v.range.end+=f}e.call(q,c,d,v.range,v,k)}}};r.onloadend=r.onerror=function(){p&&(p=!1,q.errHandler.downloadError("SIDX",v.url,r),k.call(q,null,c,d))};g.call(q,r,v);q.log("Perform SIDX load: "+
v.url)},g=function(b,c){b.open("GET",this.requestModifierExt.modifyRequestURL(c.url));b.responseType="arraybuffer";b.setRequestHeader("Range","bytes="+c.range.start+"-"+c.range.end);b=this.requestModifierExt.modifyRequestHeader(b);b.send(null)},k=function(b,c,d){b?this.notify(Dash.dependencies.BaseURLExtensions.eventList.ENAME_SEGMENTS_LOADED,{segments:b,representation:c,mediaType:d}):this.notify(Dash.dependencies.BaseURLExtensions.eventList.ENAME_SEGMENTS_LOADED,{segments:null,representation:c,mediaType:d},
new MediaPlayer.vo.Error(null,"error loading segments",null))};return{log:void 0,errHandler:void 0,requestModifierExt:void 0,boxParser:void 0,notify:void 0,subscribe:void 0,unsubscribe:void 0,loadSegments:function(b,c,d){d=(d=d?d.split("-"):null)?{start:parseFloat(d[0]),end:parseFloat(d[1])}:null;e.call(this,b,c,d,null,k.bind(this))},loadInitialization:d}};Dash.dependencies.BaseURLExtensions.prototype={constructor:Dash.dependencies.BaseURLExtensions};
Dash.dependencies.BaseURLExtensions.eventList={ENAME_INITIALIZATION_LOADED:"initializationLoaded",ENAME_SEGMENTS_LOADED:"segmentsLoaded"};Dash.dependencies.FragmentExtensions=function(){return{log:void 0,notify:void 0,subscribe:void 0,unsubscribe:void 0,boxParser:void 0,getSamplesInfo:function(b){var c=this.boxParser.parse(b);b=c.getBox("tfhd");var d=c.getBox("tfdt"),e=c.getBox("trun"),c=c.getBox("moof"),g,k,l,m,h,f,n;k=e.sample_count;m=d.baseMediaDecodeTime;n=(b.base_data_offset||0)+(e.data_offset||0);h=[];for(f=0;f<k;f++)g=e.samples[f],d=void 0!==g.sample_duration?g.sample_duration:b.default_sample_duration,l=void 0!==g.sample_size?
g.sample_size:b.default_sample_size,g=void 0!==g.sample_composition_time_offset?g.sample_composition_time_offset:0,h.push({dts:m,cts:m+g,duration:d,offset:c.offset+n,size:l}),n+=l,m+=d;return h},getMediaTimescaleFromMoov:function(b){return(b=this.boxParser.parse(b).getBox("mdhd"))?b.timescale:NaN}}};Dash.dependencies.FragmentExtensions.prototype={constructor:Dash.dependencies.FragmentExtensions};Dash.dependencies.FragmentExtensions.eventList={ENAME_FRAGMENT_LOADING_COMPLETED:"fragmentLoadingCompleted"};Dash.dependencies.DashManifestExtensions=function(){this.timelineConverter=void 0};
Dash.dependencies.DashManifestExtensions.prototype={constructor:Dash.dependencies.DashManifestExtensions,getIsTypeOf:function(b,c){var d,e;d=b.ContentComponent_asArray;var g="text"!==c?new RegExp(c):/(vtt|ttml)/,k,l=!1,m=!1;if(0<b.Representation_asArray.length&&b.Representation_asArray[0].hasOwnProperty("codecs")&&"stpp"==b.Representation_asArray[0].codecs)return"fragmentedText"==c;if(d){if(1<d.length)return"muxed"==c;d[0]&&d[0].contentType===c&&(m=l=!0)}b.hasOwnProperty("mimeType")&&(l=g.test(b.mimeType),
m=!0);if(!m)for(d=0,e=b.Representation_asArray.length;!m&&d<e;)k=b.Representation_asArray[d],k.hasOwnProperty("mimeType")&&(l=g.test(k.mimeType),m=!0),d+=1;return l},getIsAudio:function(b){return this.getIsTypeOf(b,"audio")},getIsVideo:function(b){return this.getIsTypeOf(b,"video")},getIsFragmentedText:function(b){return this.getIsTypeOf(b,"fragmentedText")},getIsText:function(b){return this.getIsTypeOf(b,"text")},getIsMuxed:function(b){return this.getIsTypeOf(b,"muxed")},getIsTextTrack:function(b){return"text/vtt"===
b||"application/ttml+xml"===b},getLanguageForAdaptation:function(b){var c="";b.hasOwnProperty("lang")&&(c=b.lang.replace(/[^A-Za-z0-9-]/g,""));return c},getViewpointForAdaptation:function(b){return b.hasOwnProperty("Viewpoint")?b.Viewpoint:null},getRolesForAdaptation:function(b){return b.hasOwnProperty("Role_asArray")?b.Role_asArray:[]},getAccessibilityForAdaptation:function(b){return b.hasOwnProperty("Accessibility_asArray")?b.Accessibility_asArray:[]},getAudioChannelConfigurationForAdaptation:function(b){return b.hasOwnProperty("AudioChannelConfiguration_asArray")?
b.AudioChannelConfiguration_asArray:[]},getIsMain:function(b){return this.getRolesForAdaptation(b).filter(function(b){return"main"===b.value})[0]},processAdaptation:function(b){void 0!==b.Representation_asArray&&null!==b.Representation_asArray&&b.Representation_asArray.sort(function(b,d){return b.bandwidth-d.bandwidth});return b},getAdaptationForId:function(b,c,d){c=c.Period_asArray[d].AdaptationSet_asArray;var e;d=0;for(e=c.length;d<e;d+=1)if(c[d].hasOwnProperty("id")&&c[d].id===b)return c[d];return null},
getAdaptationForIndex:function(b,c,d){return c.Period_asArray[d].AdaptationSet_asArray[b]},getIndexForAdaptation:function(b,c,d){c=c.Period_asArray[d].AdaptationSet_asArray;var e;d=0;for(e=c.length;d<e;d+=1)if(c[d]===b)return d;return-1},getAdaptationsForType:function(b,c,d){b=b.Period_asArray[c].AdaptationSet_asArray;var e,g=[];c=0;for(e=b.length;c<e;c+=1)this.getIsTypeOf(b[c],d)&&g.push(this.processAdaptation(b[c]));return g},getAdaptationForType:function(b,c,d){d=this.getAdaptationsForType(b,c,
d);if(!d||0===d.length)return null;b=0;for(c=d.length;b<c;b+=1)if(this.getIsMain(d[b]))return d[b];return d[0]},getCodecStr:function(b){return b.Representation_asArray[0].codecs},getCodec:function(b){b=b.Representation_asArray[0];return b.mimeType+';codecs="'+b.codecs+'"'},getMimeType:function(b){return b.Representation_asArray[0].mimeType},getKID:function(b){return b&&b.hasOwnProperty("cenc:default_KID")?b["cenc:default_KID"]:null},getContentProtectionData:function(b){return b&&b.hasOwnProperty("ContentProtection_asArray")&&
0!==b.ContentProtection_asArray.length?b.ContentProtection_asArray:null},getIsDynamic:function(b){var c=!1;b.hasOwnProperty("type")&&(c="dynamic"===b.type);return c},getIsDVR:function(b){var c=this.getIsDynamic(b);b=!isNaN(b.timeShiftBufferDepth);return c&&b},getIsOnDemand:function(b){var c=!1;b.profiles&&0<b.profiles.length&&(c=-1!==b.profiles.indexOf("urn:mpeg:dash:profile:isoff-on-demand:2011"));return c},getDuration:function(b){return b.hasOwnProperty("mediaPresentationDuration")?b.mediaPresentationDuration:
Number.MAX_VALUE},getBandwidth:function(b){return b.bandwidth},getRefreshDelay:function(b){var c=NaN;b.hasOwnProperty("minimumUpdatePeriod")&&(c=Math.max(parseFloat(b.minimumUpdatePeriod),2));return c},getRepresentationCount:function(b){return b.Representation_asArray.length},getBitrateListForAdaptation:function(b){if(!b||!b.Representation_asArray||!b.Representation_asArray.length)return null;b=this.processAdaptation(b).Representation_asArray;for(var c=b.length,d=[],e=0;e<c;e+=1)d.push(b[e].bandwidth);
return d},getRepresentationFor:function(b,c){return c.Representation_asArray[b]},getRepresentationsForAdaptation:function(b,c){for(var d=this.processAdaptation(b.Period_asArray[c.period.index].AdaptationSet_asArray[c.index]),e=[],g,k,l,m,h=0;h<d.Representation_asArray.length;h+=1){m=d.Representation_asArray[h];g=new Dash.vo.Representation;g.index=h;g.adaptation=c;m.hasOwnProperty("id")&&(g.id=m.id);m.hasOwnProperty("bandwidth")&&(g.bandwidth=m.bandwidth);m.hasOwnProperty("maxPlayoutRate")&&(g.maxPlayoutRate=
m.maxPlayoutRate);if(m.hasOwnProperty("SegmentBase"))l=m.SegmentBase,g.segmentInfoType="SegmentBase";else if(m.hasOwnProperty("SegmentList"))l=m.SegmentList,g.segmentInfoType="SegmentList",g.useCalculatedLiveEdgeTime=!0;else if(m.hasOwnProperty("SegmentTemplate")){l=m.SegmentTemplate;if(l.hasOwnProperty("SegmentTimeline")){if(g.segmentInfoType="SegmentTimeline",k=l.SegmentTimeline.S_asArray[l.SegmentTimeline.S_asArray.length-1],!k.hasOwnProperty("r")||0<=k.r)g.useCalculatedLiveEdgeTime=!0}else g.segmentInfoType=
"SegmentTemplate";l.hasOwnProperty("initialization")&&(g.initialization=l.initialization.split("$Bandwidth$").join(m.bandwidth).split("$RepresentationID$").join(m.id))}else l=m.BaseURL,g.segmentInfoType="BaseURL";m.hasOwnProperty("BaseURL")&&(g.BaseURL=m.BaseURL,g.currentBaseURLIndex=0);m.hasOwnProperty("blackListed")&&(g.blackListed=m.blackListed);l.hasOwnProperty("Initialization")?(k=l.Initialization,k.hasOwnProperty("sourceURL")?g.initialization=k.sourceURL:k.hasOwnProperty("range")&&(g.initialization=
m.BaseURL,g.range=k.range)):m.hasOwnProperty("mimeType")&&this.getIsTextTrack(m.mimeType)&&(g.initialization=m.BaseURL,g.range=0);l.hasOwnProperty("timescale")&&(g.timescale=l.timescale);l.hasOwnProperty("duration")&&(g.segmentDuration=l.duration/g.timescale);l.hasOwnProperty("startNumber")&&(g.startNumber=l.startNumber);l.hasOwnProperty("indexRange")&&(g.indexRange=l.indexRange);l.hasOwnProperty("presentationTimeOffset")&&(g.presentationTimeOffset=l.presentationTimeOffset/g.timescale);g.MSETimeOffset=
this.timelineConverter.calcMSETimeOffset(g);e.push(g)}return e},getAdaptationsForPeriod:function(b,c){for(var d=b.Period_asArray[c.index],e=[],g,k,l=0;l<d.AdaptationSet_asArray.length;l+=1)k=d.AdaptationSet_asArray[l],g=new Dash.vo.AdaptationSet,k.hasOwnProperty("id")&&(g.id=k.id),g.index=l,g.period=c,this.getIsMuxed(k)?g.type="muxed":this.getIsAudio(k)?g.type="audio":this.getIsVideo(k)?g.type="video":this.getIsFragmentedText(k)?g.type="fragmentedText":g.type="text",e.push(g);return e},getRegularPeriods:function(b,
c){var d=[],e=this.getIsDynamic(b),g,k,l=null,m=null,h=null,f=null;g=0;for(k=b.Period_asArray.length;g<k;g+=1)m=b.Period_asArray[g],m.hasOwnProperty("start")?(f=new Dash.vo.Period,f.start=m.start):null!==l&&m.hasOwnProperty("duration")&&null!==h?(f=new Dash.vo.Period,f.start=h.start+h.duration,f.duration=m.duration):0!==g||e||(f=new Dash.vo.Period,f.start=0),null!==h&&isNaN(h.duration)&&(h.duration=f.start-h.start),null!==f&&(f.id=this.getPeriodId(m)),null!==f&&m.hasOwnProperty("duration")&&(f.duration=
m.duration),null!==f&&m.hasOwnProperty("isLast")&&(f.isLast=m.isLast),null!==f&&(f.index=g,f.mpd=c,f.isAd=m.isAd,d.push(f),l=m,h=f),f=null;if(0===d.length)return d;null!==h&&isNaN(h.duration)&&(h.duration=this.getEndTimeForLastPeriod(b,h)-h.start);return d},getPeriodId:function(b){if(!b)throw Error("Period cannot be null or undefined");var c=Dash.vo.Period.DEFAULT_ID;b.hasOwnProperty("id")&&"__proto__"!==b.id&&(c=b.id);return c},getMpd:function(b){var c=new Dash.vo.Mpd;c.manifest=b;b.hasOwnProperty("availabilityStartTime")?
c.availabilityStartTime=new Date(b.availabilityStartTime.getTime()):c.availabilityStartTime=new Date(b.loadedTime.getTime());b.hasOwnProperty("availabilityEndTime")&&(c.availabilityEndTime=new Date(b.availabilityEndTime.getTime()));b.hasOwnProperty("suggestedPresentationDelay")&&(c.suggestedPresentationDelay=b.suggestedPresentationDelay);b.hasOwnProperty("timeShiftBufferDepth")&&(c.timeShiftBufferDepth=b.timeShiftBufferDepth);b.hasOwnProperty("maxSegmentDuration")&&(c.maxSegmentDuration=b.maxSegmentDuration);
return c},getFetchTime:function(b,c){return this.timelineConverter.calcPresentationTimeFromWallTime(b.loadedTime,c)},getCheckTime:function(b,c){var d=NaN;b.hasOwnProperty("minimumUpdatePeriod")&&(d=this.getFetchTime(b,c),d+=b.minimumUpdatePeriod);return d},getEndTimeForLastPeriod:function(b,c){var d;d=this.getCheckTime(b,c);if(b.mediaPresentationDuration)d=b.mediaPresentationDuration;else if(isNaN(d))throw Error("Must have @mediaPresentationDuration or @minimumUpdatePeriod on MPD or an explicit @duration on the last period.");
return d},getEventsForPeriod:function(b,c){var d=b.Period_asArray[c.index].EventStream_asArray,e=[];if(d)for(var g=0;g<d.length;g+=1){var k=new Dash.vo.EventStream;k.period=c;k.timescale=1;if(d[g].hasOwnProperty("schemeIdUri"))k.schemeIdUri=d[g].schemeIdUri;else throw"Invalid EventStream. SchemeIdUri has to be set";d[g].hasOwnProperty("timescale")&&(k.timescale=d[g].timescale);d[g].hasOwnProperty("value")&&(k.value=d[g].value);for(var l=0;l<d[g].Event_asArray.length;l+=1){var m=new Dash.vo.Event;
m.presentationTime=0;m.eventStream=k;d[g].Event_asArray[l].hasOwnProperty("presentationTime")&&(m.presentationTime=d[g].Event_asArray[l].presentationTime);d[g].Event_asArray[l].hasOwnProperty("duration")&&(m.duration=d[g].Event_asArray[l].duration);d[g].Event_asArray[l].hasOwnProperty("id")&&(m.id=d[g].Event_asArray[l].id);e.push(m)}}return e},getEventStreams:function(b,c){var d=[];if(!b)return d;for(var e=0;e<b.length;e++){var g=new Dash.vo.EventStream;g.timescale=1;g.representation=c;if(b[e].hasOwnProperty("schemeIdUri"))g.schemeIdUri=
b[e].schemeIdUri;else throw"Invalid EventStream. SchemeIdUri has to be set";b[e].hasOwnProperty("timescale")&&(g.timescale=b[e].timescale);b[e].hasOwnProperty("value")&&(g.value=b[e].value);d.push(g)}return d},getEventStreamForAdaptationSet:function(b,c){return this.getEventStreams(b.Period_asArray[c.period.index].AdaptationSet_asArray[c.index].InbandEventStream_asArray,null)},getEventStreamForRepresentation:function(b,c){return this.getEventStreams(b.Period_asArray[c.adaptation.period.index].AdaptationSet_asArray[c.adaptation.index].Representation_asArray[c.index].InbandEventStream_asArray,
c)},getUTCTimingSources:function(b){var c=this.getIsDynamic(b),d=b.hasOwnProperty("availabilityStartTime");b=b.UTCTiming_asArray;var e=[];(c||d)&&b&&b.forEach(function(b){var c=new Dash.vo.UTCTiming;b.hasOwnProperty("schemeIdUri")&&(c.schemeIdUri=b.schemeIdUri,b.hasOwnProperty("value")&&(c.value=b.value.toString(),e.push(c)))});return e}};Dash.dependencies.DashMetricsExtensions=function(){var b=function(b){if(null===b)return null;b=b.HttpList;var c,d=null;if(null===b||0>=b.length)return null;for(c=b.length-1;0<=c;){if(b[c].responsecode){d=b[c];break}--c}return d},c=function(b){return null===b?[]:b.HttpList?b.HttpList:[]},d=function(b){var c={};if(!b)return c;b=b.split("\r\n");for(var d=0,l=b.length;d<l;d++){var m=b[d],h=m.indexOf(": ");0<h&&(c[m.substring(0,h)]=m.substring(h+2))}return c};return{manifestModel:void 0,manifestExt:void 0,
system:void 0,getBandwidthForRepresentation:function(b,c){var d;a:{var l,m,h,f;d=this.manifestModel.getValue().Period_asArray[c].AdaptationSet_asArray;for(h=0;h<d.length;h+=1)for(l=d[h],m=l.Representation_asArray,f=0;f<m.length;f+=1)if(l=m[f],b===l.id){d=l;break a}d=null}return null===d?null:d.bandwidth},getIndexForRepresentation:function(b,c){var d;a:{var l,m,h,f;d=this.manifestModel.getValue().Period_asArray[c].AdaptationSet_asArray;for(h=0;h<d.length;h+=1)for(l=d[h],m=l.Representation_asArray,
f=0;f<m.length;f+=1)if(l=m[f],b===l.id){d=f;break a}d=-1}return d},getMaxIndexForBufferType:function(b,c){var d;d=this.manifestModel.getValue().Period_asArray[c];a:{var l,m,h;if(d&&b)for(l=d.AdaptationSet_asArray,h=0;h<l.length;h+=1)if(d=l[h],m=d.Representation_asArray,this.manifestExt.getIsTypeOf(d,b)){d=m.length;break a}d=-1}return d},getMaxAllowedIndexForBufferType:function(b,c){var d=this.system.getObject("abrController"),l=0;d&&(l=d.getTopQualityIndexFor(b,c));return l},getCurrentRepresentationSwitch:function(b){if(null===
b)return null;b=b.RepSwitchList;return null===b||0>=b.length?null:b[b.length-1]},getCurrentBufferLevel:function(b){if(null===b)return null;b=b.BufferLevel;return null===b||0>=b.length?null:b[b.length-1]},getCurrentPlaybackRate:function(b){if(null===b)return null;b=b.PlayList;if(null===b||0>=b.length)return null;b=b[b.length-1].trace;return null===b||0>=b.length?null:b[b.length-1].playbackspeed},getCurrentHttpRequest:b,getHttpRequests:c,getCurrentDroppedFrames:function(b){if(null===b)return null;b=
b.DroppedFrames;return null===b||0>=b.length?null:b[b.length-1]},getCurrentSchedulingInfo:function(b){if(null===b)return null;b=b.SchedulingInfo;return null===b||0>=b.length?null:b[b.length-1]},getCurrentDVRInfo:function(b){if(null===b)return null;b=b.DVRInfo;return null===b||0>=b.length?null:b[b.length-1]},getCurrentManifestUpdate:function(b){if(null===b)return null;b=b.ManifestUpdate;return null===b||0>=b.length?null:b[b.length-1]},getLatestFragmentRequestHeaderValueByID:function(c,g){if(null===
c)return null;var k=b(c);if(null===k||null===k.responseHeaders)return null;k=d(k.responseHeaders);return void 0===k[g]?null:k[g]},getLatestMPDRequestHeaderValueByID:function(b,g){var k,l,m={},h;if(null===b)return null;k=c(b);for(h=k.length-1;0<=h;--h)if(l=k[h],l.type===MediaPlayer.vo.metrics.HTTPRequest.MPD_TYPE){m=d(l.responseHeaders);break}return void 0===m[g]?null:m[g]},getRequestsQueue:function(b){return b.RequestsQueue}}};Dash.dependencies.DashMetricsExtensions.prototype={constructor:Dash.dependencies.DashMetricsExtensions};Dash.dependencies.TimelineConverter=function(){var b=0,c=!1,d=NaN,e=function(b){var c=b.adaptation.period.mpd.manifest.Period_asArray[b.adaptation.period.index].localStartTime;b=b.adaptation.period.mpd.manifest.Period_asArray[b.adaptation.period.index].segmentOffset;return c?b?c-b:c:0},g=function(c,d,e,g){var k=NaN;return k=g?e&&d.timeShiftBufferDepth!=Number.POSITIVE_INFINITY?new Date(d.availabilityStartTime.getTime()+1E3*(c+d.timeShiftBufferDepth)):d.availabilityEndTime:e?new Date(d.availabilityStartTime.getTime()+
1E3*(c-b)):d.availabilityStartTime},k=function(c,d){return(c.getTime()-d.mpd.availabilityStartTime.getTime()+1E3*b)/1E3},l=function(e){c||e.error||(b+=e.data.liveEdge-(d+e.data.searchTime),c=!0)},m=function(d){c||d.error||(b=d.data.offset/1E3,c=!0)};return{setup:function(){this[MediaPlayer.dependencies.LiveEdgeFinder.eventList.ENAME_LIVE_EDGE_SEARCH_COMPLETED]=l;this[MediaPlayer.dependencies.TimeSyncController.eventList.ENAME_TIME_SYNCHRONIZATION_COMPLETED]=m},calcAvailabilityStartTimeFromPresentationTime:function(b,
c,d){return g.call(this,b,c,d)},calcAvailabilityEndTimeFromPresentationTime:function(b,c,d){return g.call(this,b,c,d,!0)},calcPresentationTimeFromWallTime:k,calcPresentationTimeFromMediaTime:function(b,c){var d=c.adaptation.period.start,g=c.presentationTimeOffset,k=e(c);return b+(d-g-k)},calcPeriodRelativeTimeFromMpdRelativeTime:function(b,c){return c-b.adaptation.period.start},calcMpdRelativeTimeFromPeriodRelativeTime:function(b,c){return c+b.adaptation.period.start},calcMediaTimeFromPresentationTime:function(b,
c){return b-c.adaptation.period.start+c.presentationTimeOffset},calcSegmentAvailabilityRange:function(b,d){var e=b.adaptation.period.start,g=e+b.adaptation.period.duration,e={start:e,end:g},g=b.segmentDuration||(b.segments&&b.segments.length?b.segments[b.segments.length-1].duration:0),l,m;if(!d)return e;if(!c&&b.segmentAvailabilityRange)return b.segmentAvailabilityRange;l=b.adaptation.period.mpd.checkTime;m=k(new Date,b.adaptation.period);e=Math.max(m-b.adaptation.period.mpd.timeShiftBufferDepth,
b.adaptation.period.start);l=isNaN(l)?m:Math.min(l,m);m=b.adaptation.period.start+b.adaptation.period.duration;return e={start:e,end:(l>=m&&l-g<m?m:l)-g}},calcWallTimeForSegment:function(b,c){var d;c&&(d=b.representation.adaptation.period.mpd.suggestedPresentationDelay,d=b.presentationStartTime+d,d=new Date(b.availabilityStartTime.getTime()+1E3*d));return d},calcMSETimeOffset:function(b){var c=b.presentationTimeOffset,d=b.adaptation.period.start;b=e(b);return d-c-b},reset:function(){b=0;c=!1;d=NaN},
getLocalTimeOffset:e,isTimeSyncCompleted:function(){return c},setTimeSyncCompleted:function(b){c=b},getClientTimeOffset:function(){return b},getExpectedLiveEdge:function(){return d},setExpectedLiveEdge:function(b){d=b}}};Dash.dependencies.TimelineConverter.prototype={constructor:Dash.dependencies.TimelineConverter};Dash.dependencies.DashAdapter=function(){var b=[],c={},d=function(b,c){return c.getRepresentationForQuality(b.quality)},e=function(b){if(c&&c[b.streamInfo.id])return c[b.streamInfo.id][b.index]},g=function(c){var d,e=b.length,g=0;for(g;g<e;g+=1)if(d=b[g],c.id===d.id)return d;return null},k=function(b,c){var d=new MediaPlayer.vo.TrackInfo,e=this.manifestExt.getRepresentationFor(c.index,c.adaptation.period.mpd.manifest.Period_asArray[c.adaptation.period.index].AdaptationSet_asArray[c.adaptation.index]);
d.id=c.id;d.quality=c.index;d.bandwidth=this.manifestExt.getBandwidth(e);d.DVRWindow=c.segmentAvailabilityRange;d.fragmentDuration=c.segmentDuration||(c.segments&&0<c.segments.length?c.segments[0].duration:NaN);d.MSETimeOffset=c.MSETimeOffset;d.useCalculatedLiveEdgeTime=c.useCalculatedLiveEdgeTime;d.mediaInfo=this.convertDataToMedia(b,c.adaptation);d.width=this.manifestExt.getWidth(e);d.height=this.manifestExt.getHeight(e);d.blackListed=c.blackListed;return d},l=function(b,c){var d=new MediaPlayer.vo.StreamInfo;
d.id=c.id;d.index=c.index;d.start=c.start;d.duration=c.duration;d.manifestInfo=m.call(this,b,c.mpd);d.isLast=!0===c.isLast||1===b.Period_asArray.length||1>Math.abs(d.start+d.duration-d.manifestInfo.duration);c.hasOwnProperty("isAd")&&!0===c.isAd&&(d.isAd=!0);return d},m=function(b,c){var d=new MediaPlayer.vo.ManifestInfo;d.DVRWindowSize=c.timeShiftBufferDepth;d.loadedTime=c.manifest.loadedTime;d.availableFrom=c.availabilityStartTime;d.minBufferTime=c.manifest.minBufferTime;d.maxFragmentDuration=c.maxSegmentDuration;
d.duration=this.manifestExt.getDuration(b);d.isDynamic=this.manifestExt.getIsDynamic(b);return d};return{system:void 0,manifestExt:void 0,timelineConverter:void 0,metricsList:{TCP_CONNECTION:"TcpConnection",HTTP_REQUEST:"HttpRequest",HTTP_REQUEST_TRACE:"HttpRequestTrace",TRACK_SWITCH:"RepresentationSwitch",BUFFER_LEVEL:"BufferLevel",BUFFER_STATE:"BufferState",DVR_INFO:"DVRInfo",DROPPED_FRAMES:"DroppedFrames",SCHEDULING_INFO:"SchedulingInfo",REQUESTS_QUEUE:"RequestsQueue",MANIFEST_UPDATE:"ManifestUpdate",
MANIFEST_UPDATE_STREAM_INFO:"ManifestUpdatePeriodInfo",MANIFEST_UPDATE_TRACK_INFO:"ManifestUpdateRepresentationInfo",PLAY_LIST:"PlayList",PLAY_LIST_TRACE:"PlayListTrace"},convertDataToTrack:k,convertDataToMedia:function(b,c){var d=new MediaPlayer.vo.MediaInfo,e=this,g=c.period.mpd.manifest.Period_asArray[c.period.index].AdaptationSet_asArray[c.index],k;d.id=c.id;d.index=c.index;d.type=c.type;d.streamInfo=l.call(this,b,c.period);d.representationCount=this.manifestExt.getRepresentationCount(g);d.lang=
this.manifestExt.getLanguageForAdaptation(g);k=this.manifestExt.getViewpointForAdaptation(g);d.viewpoint=k?k.value:void 0;d.accessibility=this.manifestExt.getAccessibilityForAdaptation(g).map(function(b){return b.value});d.audioChannelConfiguration=this.manifestExt.getAudioChannelConfigurationForAdaptation(g).map(function(b){return b.value});d.roles=this.manifestExt.getRolesForAdaptation(g).map(function(b){return b.value});d.codec=this.manifestExt.getCodec(g);d.codecStr=this.manifestExt.getCodecStr(g);
d.mimeType=this.manifestExt.getMimeType(g);d.contentProtection=this.manifestExt.getContentProtectionData(g);d.bitrateList=this.manifestExt.getBitrateListForAdaptation(g);d.contentProtection&&d.contentProtection.forEach(function(b){b.KID=e.manifestExt.getKID(b);b.BaseURL=g.BaseURL});d.isText=this.manifestExt.getIsTextTrack(d.mimeType);return d},convertDataToStream:l,getDataForTrack:d,getDataForMedia:e,getDataForStream:g,getStreamsInfo:function(d){var e,g=[],k;if(!d)return null;e=this.manifestExt.getMpd(d);
b=this.manifestExt.getRegularPeriods(d,e);e.checkTime=this.manifestExt.getCheckTime(d,b[0]);c={};e=b.length;for(k=0;k<e;k+=1)g.push(l.call(this,d,b[k]));return g},getManifestInfo:function(b){var c=this.manifestExt.getMpd(b);return m.call(this,b,c)},getMediaInfoForType:function(b,d,e){var k=g(d),l=k.id;e=this.manifestExt.getAdaptationForType(b,d.index,e);if(!e)return null;d=this.manifestExt.getIndexForAdaptation(e,b,d.index);c[l]=c[l]||this.manifestExt.getAdaptationsForPeriod(b,k);return this.convertDataToMedia(b,
c[l][d])},getAllMediaInfoForType:function(b,d,e){var k=g(d),l=k.id;e=this.manifestExt.getAdaptationsForType(b,d.index,e);var m,p=[];if(!e)return p;c[l]=c[l]||this.manifestExt.getAdaptationsForPeriod(b,k);for(var k=0,u=e.length;k<u;k+=1)m=e[k],m=this.manifestExt.getIndexForAdaptation(m,b,d.index),(m=this.convertDataToMedia(b,c[l][m]))&&p.push(m);return p},getCurrentRepresentationInfo:function(b,c){var d=c.getCurrentRepresentation();return d?k.call(this,b,d):null},getRepresentationInfoForQuality:function(b,
c,d){return(c=c.getRepresentationForQuality(d))?k.call(this,b,c):null},updateData:function(b,c){var d=g(c.getStreamInfo()),k=c.getMediaInfo(),l=e(k),m=c.getType(),p,d=(p=k.id)?this.manifestExt.getAdaptationForId(p,b,d.index):this.manifestExt.getAdaptationForIndex(k.index,b,d.index);c.representationController.updateData(d,l,m)},getInitRequest:function(b,c){var d=b.representationController.getRepresentationForQuality(c);return b.indexHandler.getInitRequest(d)},getNextFragmentRequest:function(b,c){var e=
d(c,b.representationController);return b.indexHandler.getNextSegmentRequest(e)},getFragmentRequestForTime:function(b,c,e,g){c=d(c,b.representationController);return b.indexHandler.getSegmentRequestForTime(c,e,g)},generateFragmentRequestForTime:function(b,c,e){c=d(c,b.representationController);return b.indexHandler.generateSegmentRequestForTime(c,e)},getIndexHandlerTime:function(b){return b.indexHandler.getCurrentTime()},setIndexHandlerTime:function(b,c){return b.indexHandler.setCurrentTime(c)},getEventsFor:function(b,
c,k){var l=[];c instanceof MediaPlayer.vo.StreamInfo?l=this.manifestExt.getEventsForPeriod(b,g(c)):c instanceof MediaPlayer.vo.MediaInfo?l=this.manifestExt.getEventStreamForAdaptationSet(b,e(c)):c instanceof MediaPlayer.vo.TrackInfo&&(l=this.manifestExt.getEventStreamForRepresentation(b,d(c,k.representationController)));return l},getEvent:function(b,c,d){var e=new Dash.vo.Event,g=b.scheme_id_uri,k=b.value,l=b.timescale,m=b.presentation_time_delta,w=b.event_duration,v=b.id;b=b.message_data;if(!c[g])return null;
e.eventStream=c[g];e.eventStream.value=k;e.eventStream.timescale=l;e.duration=w;e.id=v;e.presentationTime=d*l+m;e.messageData=b;e.presentationTimeDelta=m;return e},reset:function(){b=[];c={}}}};Dash.dependencies.DashAdapter.prototype={constructor:Dash.dependencies.DashAdapter};
