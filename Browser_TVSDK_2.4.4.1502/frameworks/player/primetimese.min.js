var StreamStatusKind={KIND_MARK:"mark",KIND_WINDOW_END:"window end",KIND_CONTINUE:"continue",KIND_SYNC:"sync",KIND_ENDED:"ended"},StreamStatus={Mark:function(a,c,b,d,e,g){return{kind:StreamStatusKind.KIND_MARK,tag:a,config:c,offset:b,skip:void 0==d?0:d,windowEnd:void 0==e?Infinity:e,mediaTimestamp:g}},WindowEnd:function(a){return{kind:StreamStatusKind.KIND_WINDOW_END,windowEnd:void 0==a?Infinity:a}},Continue:function(){return{kind:StreamStatusKind.KIND_CONTINUE}},Sync:function(){return{kind:StreamStatusKind.KIND_SYNC}},
Ended:function(a){return{kind:StreamStatusKind.KIND_ENDED,error:a}}};function IStreamSource(){}IStreamSource.prototype.processStreamTimeslice=function(a,c,b,d){return StreamStatus.Ended()};IStreamSource.prototype.seek=function(a){};IStreamSource.prototype.sync=function(a){};
function StreamEngine(){this.m_mediaElement=this.m_currentTimeOffset=this.m_currentTag=this.streamSource=void 0;this.m_state=this.STATE_HALT;this.m_mediaSource=void 0;this.m_sourceBuffers=[];this.m_workIntervalID=void 0;this.m_syncing={};this.m_timestampOffset=this.m_bufferEndAtMark=0;this.m_bufferHighWaterReached={};this.m_windowEnd=this.m_objectWindowStart=this.m_windowStart=void 0;this.m_markOffset=0;this.m_markContexts=[];this.m_ended={};this.m_channelConfig=this.m_restartPlay=this.m_savedBuffer=
this.m_savedMark=this.m_endedError=void 0;this.m_instanceName="com-adobe-streamengine-"+StreamEngine._instanceCounter++;this.m_captionStyleElement=void 0;this.m_seekCorrection=0;this.m_lastCurrentTime=void 0;this.m_sentBuffering=!1;this.m_currentTimeAtSeek=0;this.textTrack=void 0}StreamEngine.verbose=!1;StreamEngine._instanceCounter=0;StreamEngine.util={};StreamEngine.prototype.STATE_HALT="halt";StreamEngine.prototype.STATE_HALT_WAIT="halt wait";StreamEngine.prototype.STATE_HALTING="halting";
StreamEngine.prototype.STATE_NEEDS_MARK="needs mark";StreamEngine.prototype.STATE_NEEDS_TIMESTAMP="needs timestamp";StreamEngine.prototype.STATE_PLAY="play";StreamEngine.prototype.seekShiftOffset=100;StreamEngine.prototype.textTrackCleanup=100;StreamEngine.prototype.textTrackCleanupBuckets=10;StreamEngine.prototype.m_bufferLowWaterMark=10;StreamEngine.prototype.m_bufferHighWaterMargin=0;StreamEngine.prototype.m_timesliceInterval=.05;StreamEngine.prototype.skipGapsFudge=.25;
StreamEngine.prototype.onmark=function(a){StreamEngine.verbose&&console.log("StreamEngine Mark tag:",a.tag)};StreamEngine.prototype.onbufferstate=function(a,c){StreamEngine.verbose&&console.log("StreamEngine buffer "+(c?"ready":"stalled"))};StreamEngine.isTypeSupported=function(a){return StreamEngine.VTTSourceBuffer.isTypeSupported(a)||StreamEngine.EventSourceBuffer.isTypeSupported(a)||MediaSource.isTypeSupported(a)};
StreamEngine.prototype._getBufferLengths=function(a){for(var c=[],b=this.m_mediaElement?this.m_mediaElement.currentTime:0,d=0;d<this.m_sourceBuffers.length;d++){var e=this.m_sourceBuffers[d];if(!e.ignoreForLeastBuffer||a)e=this._sourceBufferedThrough(e),c.push(Math.max(e-b,0))}return c};
StreamEngine.prototype._getBufferedThrough=function(a){for(var c=[],b=0;b<this.m_sourceBuffers.length;b++){var d=this.m_sourceBuffers[b];if(!d.ignoreForLeastBuffer||a)d=this._sourceBufferedThrough(d),d+=this.m_markOffset-this.m_bufferEndAtMark,this.STATE_NEEDS_MARK==this.m_state&&(d=0),c.push(Math.round(9E4*d)/9E4)}return c};
Object.defineProperties(StreamEngine.prototype,{bufferLowWaterMark:{get:function(){return this.m_bufferLowWaterMark},set:function(a){this.m_bufferLowWaterMark=Math.max(0,a)},enumerable:!0},bufferHighWaterMargin:{get:function(){return this.m_bufferHighWaterMargin},set:function(a){this.m_bufferHighWaterMargin=Math.max(0,a);this.m_bufferHighWaterReached={}},enumerable:!0},bufferLength:{get:function(){var a=this._getBufferLengths(!1);return 1>a.length?0:a.reduce(function(a,b){return Math.min(a,b)})},
enumerable:!0},bufferLengths:{get:function(){return this._getBufferLengths(!0)},enumerable:!0},bufferedThrough:{get:function(){return this._getBufferedThrough(!0)},enumerable:!0},leastBufferedThrough:{get:function(){var a=this._getBufferedThrough(!1);return 1>a.length?0:a.reduce(function(a,b){return Math.min(a,b)})},enumerable:!0},tag:{get:function(){return this.m_currentTag},enumerable:!0},currentTime:{get:function(){return this.m_mediaElement&&void 0!=this.m_currentTimeOffset?this.m_mediaElement.currentTime+
this.m_currentTimeOffset:this.m_currentTimeAtSeek},enumerable:!0},timesliceInterval:{get:function(){return this.m_timesliceInterval},set:function(a){this.m_timesliceInterval=a;void 0!=this.m_workIntervalID&&(clearInterval(this.m_workIntervalID),this.m_workIntervalID=setInterval(this.onWorkInterval.bind(this),1E3*this.m_timesliceInterval))},enumerable:!0},halted:{get:function(){return this.m_state==this.STATE_HALT},enumerable:!0}});
StreamEngine.prototype.attachMediaElement=function(a){if(void 0!=this.m_mediaElement)throw Error("already attached to a media element");this.m_mediaElement=a;a.addEventListener("ended",this.onWorkInterval.bind(this));a.classList.add(this.m_instanceName);var c=a.ownerDocument.getElementsByTagName("head")[0];c&&(this.m_captionStyleElement=a.ownerDocument.createElement("style"),c.appendChild(this.m_captionStyleElement))};
StreamEngine.prototype.close=function(){this.m_state=this.STATE_HALT;this.trimObjectTracks(-Infinity,Infinity);this.m_mediaSource&&"closed"!=this.m_mediaSource.readyState&&(this.m_mediaElement.src=window.URL.createObjectURL(new MediaSource));this.m_mediaElement&&this.m_mediaElement.removeEventListener("ended",this.onWorkInterval);this.m_captionStyleElement&&this.m_captionStyleElement.parentNode.removeChild(this.m_captionStyleElement);this.m_captionStyleElement=this.m_channelConfig=this.m_mediaElement=
void 0;this.m_sourceBuffers=[];this.m_mediaSource=void 0;this.m_markContexts=[];this.m_syncing={};this.m_currentTimeAtSeek=0};StreamEngine.prototype.kick=function(){this.onWorkInterval()};
StreamEngine.prototype.onWorkInterval=function(){var a=1;this.processMarks();this.trimObjectTracks();for(this.activateObjectBufferItems();3>a++;)switch(this.m_state){case this.STATE_HALTING:this.doHaltingState();break;case this.STATE_HALT_WAIT:0==this.m_markContexts.length&&(this.m_state=this.STATE_HALT);break;case this.STATE_HALT:clearInterval(this.m_workIntervalID);this.m_workIntervalID=void 0;return;case this.STATE_PLAY:case this.STATE_NEEDS_MARK:case this.STATE_NEEDS_TIMESTAMP:this.doPlayStates()}this.skipGaps()};
StreamEngine.prototype.doHaltingState=function(){this.m_sourceBuffers.some(function(a){return a.updating})||(this.m_endedError?(this.m_mediaSource.endOfStream(this.m_endedError),console.log("MediaSource.endOfStream(",this.m_endedError,")")):this.m_mediaSource.endOfStream(),this.m_state=this.STATE_HALT_WAIT)};
StreamEngine.prototype.doPlayStates=function(){var a=void 0,c=function(b){a=b};if(this.streamSource&&this.m_mediaElement)if(this.m_mediaElement.error)console.log("StreamEngine media element error. halt."),this.close();else{if(this.m_mediaElement.currentTime<this.seekShiftOffset&&this.m_seekCorrection>=this.seekShiftOffset)try{this.m_mediaElement.currentTime=this.m_seekCorrection,this.m_lastCurrentTime=this.m_mediaElement.currentTime}catch(b){}var d=this.m_mediaElement.currentTime;if(void 0==this.m_channelConfig&&
!this.m_savedMark){var e=this.streamSource.processStreamTimeslice(0,c,!1,0)||StreamStatus.Continue();if(e.kind==StreamStatusKind.KIND_MARK&&void 0!=e.config&&e.config.types instanceof Array&&0<e.config.types.length)this.m_savedMark=e,this.m_savedBuffer=a;else return}if(!this.m_mediaSource){this.m_mediaSource=new MediaSource;this.m_mediaElement.src=window.URL.createObjectURL(this.m_mediaSource);this.m_mediaSource.addEventListener("sourceopen",this.kick.bind(this));d=this.m_bufferEndAtMark=0;try{this.m_mediaElement.currentTime=
0}catch(g){StreamEngine.verbose&&console.log("MediaElement seek failed:",g)}this.m_state=this.STATE_NEEDS_MARK;1==this.m_restartPlay&&this.m_mediaElement.play();this.m_restartPlay=!0}if("closed"!=this.m_mediaSource.readyState){if(this.m_savedMark){if(this.m_state!=this.STATE_NEEDS_MARK&&!this.m_mediaElement.ended){this.m_mediaSource&&"open"==this.m_mediaSource.readyState&&this.m_sourceBuffers.every(function(a){return!a.updating})&&this.m_mediaSource.endOfStream();this.m_restartPlay=!0;return}if(0<
this.m_mediaSource.sourceBuffers.length)return this.m_mediaElement.src=window.URL.createObjectURL(new MediaSource),this.m_mediaSource=void 0,this.trimObjectTracks(-Infinity,Infinity),this.m_sourceBuffers=[],this.doPlayStates();try{for(m in"continue"==this.m_savedMark.mediaTimestamp&&(StreamEngine.verbose&&console.log('WARNING: "continue" timestamp specified at start of stream, will derive it instead.'),this.m_savedMark.mediaTimestamp=void 0),this.m_savedMark.config.types){var f=this.m_savedMark.config.types[m],
h;h=StreamEngine.VTTSourceBuffer.isTypeSupported(f)?new StreamEngine.VTTSourceBuffer(f,this.textTrack):StreamEngine.EventSourceBuffer.isTypeSupported(f)?new StreamEngine.EventSourceBuffer(f):this.m_mediaSource.addSourceBuffer(f);this.m_sourceBuffers.push(h);h.addEventListener("updateend",this.kick.bind(this))}}catch(k){this.m_mediaSource.endOfStream("decode");this.m_state=this.STATE_HALT;return}this.m_channelConfig=this.m_savedMark.config.types}for(var l=f=e=0;l<this.m_sourceBuffers.length&&!(0<l&&
this.m_state!=this.STATE_PLAY);l++){h=this.m_sourceBuffers[l];var m=0==h.buffered.length?this.m_bufferEndAtMark:h.buffered.end(h.buffered.length-1),n=Math.max(m-Math.max(d,this.seekShiftOffset),0);n<this.m_bufferLowWaterMark*this.m_mediaElement.playbackRate?this.m_bufferHighWaterReached[l]=!1:n>=(this.m_bufferLowWaterMark+this.m_bufferHighWaterMargin)*this.m_mediaElement.playbackRate&&(this.m_bufferHighWaterReached[l]=!0);if(this.m_syncing[l])e++;else if(this.m_ended[l])f++;else if(!h.updating){var a=
void 0,n=this.m_markOffset+m-this.m_bufferEndAtMark,q;0==l&&this.m_savedMark?(q=this.m_savedMark,a=this.m_savedBuffer,this.m_savedBuffer=this.m_savedMark=void 0,this.m_channelConfig=q.config.types):q=this.streamSource.processStreamTimeslice(l,c,!!this.m_bufferHighWaterReached[l],n)||StreamStatus.Continue();if(q.kind==StreamStatusKind.KIND_MARK){for(var p=q.skip||0,t=q.offset,m=0;m<this.m_sourceBuffers.length;m++)this.m_sourceBuffers[m].abort();this.m_bufferEndAtMark=m=Math.max(this.leastBufferedThrough+
this.m_bufferEndAtMark-this.m_markOffset,this.m_bufferEndAtMark);this.trimObjectTracks(m,Infinity);if(!(q.config instanceof Object&&q.config.types instanceof Array)||0==q.config.types.length){this.m_mediaSource.endOfStream("decode");this.m_state=this.STATE_HALT;return}if(!this._compareArrays(this.m_channelConfig,q.config.types)||q.config.reset){this.m_savedMark=Object.create(q);this.m_savedMark.config=Object.create(this.m_savedMark.config);this.m_savedMark.config.reset=!1;this.m_savedBuffer=a;"continue"==
this.m_savedMark.mediaTimestamp&&(this.m_savedMark.mediaTimestamp=0-h.timestampOffset,this.m_savedMark.skip=m,StreamEngine.verbose&&console.log("attempting to continue timestamps through a config reset"));this._removeBufferedData(m,Infinity);return}if(this.STATE_NEEDS_MARK==this.m_state){this.m_bufferEndAtMark=m=this.seekShiftOffset;this.m_seekCorrection=p+m;try{this.m_mediaElement.currentTime=this.m_seekCorrection}catch(z){}t=(t||0)-p;p=0}h.mode="sequence";this.m_windowEnd=q.windowEnd;this.m_markOffset=
void 0==t?n:t;"continue"!=q.mediaTimestamp?(this.m_windowStart=m,h.timestampOffset=m-p):q.mediaTimestamp=0;this.m_objectWindowStart=m;void 0!=q.mediaTimestamp?(this.m_state=this.STATE_PLAY,h.mode="segments",h.timestampOffset-=q.mediaTimestamp,this.m_timestampOffset=h.timestampOffset):this.m_state=this.STATE_NEEDS_TIMESTAMP;this.appendMarkContext(m,q.tag,this.m_markOffset-m);this.markObjectTracks(m,this.m_markOffset)}if(this.m_state==this.STATE_NEEDS_MARK)break;this.m_state==this.STATE_NEEDS_TIMESTAMP&&
m>this.m_bufferEndAtMark+1&&(StreamEngine.verbose&&console.log("deriving timestamp:",h.timestampOffset,"mode:",h.mode,"channel",l,"on StreamStatus",q.kind),this.m_state=this.STATE_PLAY,h.mode="segments",this.m_timestampOffset=h.timestampOffset);q.kind==StreamStatusKind.KIND_SYNC&&(this.m_syncing[l]=!0);q.kind==StreamStatusKind.KIND_WINDOW_END&&(this.m_windowEnd=q.windowEnd);void 0==this.m_windowEnd&&(this.m_windowEnd=Infinity);0!=l&&(h.mode="segments",h.timestampOffset=this.m_timestampOffset);h.appendWindowStart=
h.isObjectBuffer?this.m_objectWindowStart:this.m_windowStart;h.appendWindowEnd=Math.max(this.m_bufferEndAtMark+this.m_windowEnd-this.m_markOffset,this.m_windowStart+.001);a&&h.appendBuffer(a);q.kind==StreamStatusKind.KIND_ENDED&&(this.m_ended[l]=!0,this.m_endedError=this.m_endedError||q.error)}}f==this.m_sourceBuffers.length&&(this.m_state=this.STATE_HALTING);0<e&&this.m_syncing[0]&&e+f==this.m_sourceBuffers.length&&(this.m_syncing={},this.streamSource.sync(this))}}};
StreamEngine.prototype.seek=function(a){var c=this.m_mediaElement?this.m_mediaElement.paused:!1;this.m_currentTimeAtSeek=this.currentTime;if(this.m_mediaSource&&"closed"!=this.m_mediaSource.readyState){this.m_mediaElement.pause();for(var b=0;b<this.m_sourceBuffers.length;b++){var d=this.m_sourceBuffers[b];"open"==this.m_mediaSource.readyState&&d.abort();d.mode="segments";d.timestampOffset=0;d.isObjectBuffer&&d.reset()}this._removeBufferedData(-Infinity,Infinity);try{this.m_mediaElement.currentTime=
0}catch(e){StreamEngine.verbose&&console.log("MediaElement seek failed:",e)}c||this.m_mediaElement.play()}this.m_syncing={};this.m_markContexts=[];this.m_ended={};this.m_endedError=void 0;this.m_bufferHighWaterReached={};this.m_bufferEndAtMark=0;this.m_savedBuffer=this.m_savedMark=void 0;this.m_restartPlay=!c;this.m_state=this.STATE_NEEDS_MARK;this.m_seekCorrection=0;this.m_currentTimeOffset=void 0;void 0==this.m_workIntervalID&&(this.m_workIntervalID=setInterval(this.onWorkInterval.bind(this),1E3*
this.m_timesliceInterval));this.streamSource.seek(a)};StreamEngine.prototype._removeBufferedData=function(a,c){for(var b=0;b<this.m_sourceBuffers.length;b++){var d=this.m_sourceBuffers[b],e=d.buffered;0<e.length&&(d.isObjectBuffer||(a=Math.max(a,e.start(0)),a=Math.min(a,e.end(e.length-1)),c=Math.max(a,c)),d.remove(a,c))}};StreamEngine.prototype.appendMarkContext=function(a,c,b){a=Math.floor(256*a)/256;this.m_markContexts.push({tag:c,offset:b,timestamp:a})};
StreamEngine.prototype.markObjectTracks=function(a,c){this.m_sourceBuffers.forEach(function(b){b.isObjectBuffer&&b.mark(a,c)})};
StreamEngine.prototype.skipGaps=function(){if(this.m_mediaElement&&!this.m_mediaElement.paused){var a=this.m_mediaElement.currentTime,c=this.m_mediaElement.buffered,b=!1;if(a==this.m_lastCurrentTime&&a>=this.seekShiftOffset&&0<c.length&&a<c.end(c.length-1))for(var d=-Infinity,e=0;e<c.length;e++){if(a>=d-this.skipGapsFudge&&c.start(e)>a){this.m_mediaElement.currentTime=c.start(e);b=!0;StreamEngine.verbose&&console.log("StreamEngine skipping timeline gap from "+a+" to "+c.start(e));break}d=c.end(e)}if(!b&&
a==this.m_lastCurrentTime&&(0==c.length||a>=c.end(c.length-1)-this.skipGapsFudge)){if(!this.m_sentBuffering&&(this.m_sentBuffering=!0,this.onbufferstate))try{this.onbufferstate(this,!1)}catch(g){console.log("StreamEngine exception calling onbufferstate(..., false) : ",g)}}else if(this.m_sentBuffering&&(this.m_sentBuffering=!1,this.onbufferstate))try{this.onbufferstate(this,!0)}catch(f){console.log("StreamEngine exception calling onbufferstate(..., true) : ",f)}this.m_lastCurrentTime=this.m_mediaElement.currentTime}};
StreamEngine.prototype.processMarks=function(){if(this.m_mediaElement)for(var a=this.m_mediaElement.currentTime;0<this.m_markContexts.length;){var c=this.m_markContexts[0];if(c.timestamp>a)break;this.m_markContexts.shift();this.m_currentTag=c.tag;this.m_currentTimeOffset=c.offset;try{this.onmark(this)}catch(b){console.log("StreamEngine exception calling onmark:",b)}}};
StreamEngine.prototype.activateObjectBufferItems=function(){if(this.m_mediaElement){var a=this,c=this.m_mediaElement.currentTime;this.m_sourceBuffers.forEach(function(b){b.isObjectBuffer&&b.activateItems(c,a)})}};
StreamEngine.prototype.trimObjectTracks=function(a,c){void 0==a&&(a=-Infinity);void 0==c&&(this.m_mediaElement?(c=this.m_mediaElement.currentTime,c=Math.max(c-this.textTrackCleanup,0),c=Math.floor(c/this.textTrackCleanupBuckets)*this.textTrackCleanupBuckets):c=Infinity);this.m_sourceBuffers.forEach(function(b){b.isObjectBuffer&&b.remove(a,c)})};
StreamEngine.prototype.onCaptionStyleSheet=function(a){if(this.m_captionStyleElement){this.m_captionStyleElement.disabled=!0;this.m_captionStyleElement.textContent="";this.m_captionStyleElement.textContent=a;var c=this.m_captionStyleElement.ownerDocument.styleSheets,b;for(a=0;a<c.length;a++)if(c[a].ownerNode==this.m_captionStyleElement){b=c[a];break}if(b){for(a=b.cssRules.length-1;0<=a;a--)c=b.cssRules[a],c.type!=CSSRule.STYLE_RULE||0>c.selectorText.indexOf("::cue")?b.deleteRule(a):c.selectorText=
c.selectorText.replace(/\*?::/,"."+this.m_instanceName+"::");this.m_captionStyleElement.disabled=!1}}};StreamEngine.prototype._compareArrays=function(a,c){return a instanceof Array&&c instanceof Array&&a.length==c.length?a.every(function(a,d){return a===c[d]}):!1};StreamEngine.prototype._sourceBufferedThrough=function(a){a=a.buffered;return 0==a.length?0:a.end(a.length-1)};
(function(){function a(){this.mode="segments";this.appendWindowStart=0;this.appendWindowEnd=Infinity;this.timestampOffset=0}function c(a,b,c,d){return"0["+b.toFixed(3)+","+c.toFixed(3)+"]:"+d}function b(b,c){a.call(this);this.m_markCounter=0;this.m_type=b;this.m_textTrack=c;this.m_cuesThisClip=!1;this.m_cues=[];this.m_cuesSet={};this.m_styleSheets=[];this.m_currentStyleSheet=void 0;this.m_regions={};this.timestampMapOffset=0}function d(a,b){this.startTime=Number(a.startTime)||0;this.endTime=Number(a.endTime);
isNaN(this.endTime)&&(this.endTime=this.startTime);this.object=a;this.counter=b}function e(b){a.call(this);this.m_events=[];this.m_startedEvents=[];this.m_mode=e._typePattern.exec(b)[1];this.m_eventCounter=this.m_timestampAdjust=0}Object.defineProperties(a.prototype,{buffered:{get:function(){var a=this,b={length:1,start:function(a){return Math.min(0,b.end(0))},end:function(b){return a.bufferedEnd()}};return b},enumerable:!0}});a.prototype.isObjectBuffer=!0;a.prototype.ignoreForLeastBuffer=!0;a.prototype.updating=
!1;a.prototype.addEventListener=function(){};a.prototype.abort=function(){};a.prototype.bufferedEnd=function(){return 0};a.prototype.mark=function(a,b){};a.prototype.activateItems=function(a,b){};a.prototype.appendBuffer=function(a){};a.prototype.reset=function(){};a.prototype.remove=function(a,b){};a.prototype.close=function(){this.remove(-Infinity,Infinity)};StreamEngine.util.decodeUTF8=function(a){if("string"==typeof a)return a;var b=[];a=new Uint8Array(a);var c=0;for(3<=a.length&&239==a[0]&&187==
a[1]&&191==a[2]&&(c=3);c<a.length;){var d=a[c];128>d?(b.push(String.fromCharCode(d)),c++):192==(d&224)?(1<a.length-c&&b.push(String.fromCharCode(((d&31)<<6)+(a[c+1]&63))),c+=2):224==(d&240)?(2<a.length-c&&b.push(String.fromCharCode(((d&15)<<12)+((a[c+1]&63)<<6)+(a[c+2]&63))),c+=3):240==(d&248)?c+=4:248==(d&252)?c+=5:252==(d&254)?c+=6:c++}return b.join("")};b.prototype=Object.create(a.prototype);b.prototype.constructor=b;b.isTypeSupported=function(a){return!!/^text\/vtt(;.*)?$/.exec(a)};b.prototype.bufferedEnd=
function(){return 0==this.m_cues.length?0:this.m_cues[this.m_cues.length-1].startTime};b.prototype.mark=function(a,b){this.m_currentStyleSheet={timestamp:a,text:"",dirty:!0};this.m_styleSheets.push(this.m_currentStyleSheet);this.m_cuesThisClip=!1;this.m_regions={};this.m_markCounter++};b.prototype.activateItems=function(a,b){if(0!=this.m_styleSheets.length){for(;1<this.m_styleSheets.length;)if(this.m_styleSheets[1].timestamp<=a)this.m_styleSheets.shift();else break;var c=this.m_styleSheets[0];c.timestamp<=
a&&c.dirty&&(b.onCaptionStyleSheet(c.text),c.dirty=!1)}};b.prototype.appendBuffer=function(a){if(a=this.parseWebVTT(StreamEngine.util.decodeUTF8(a)))if(!this.m_cuesThisClip&&a.style&&(this.m_currentStyleSheet.text+=a.style+"\n",this.m_currentStyleSheet.dirty=!0),a.cues.length){var b=this;this.m_cuesThisClip=!0;a.cues.forEach(function(a){a.markCounter=b.m_markCounter;a.originalStartTime=a.startTime+b.timestampOffset+b.timestampMapOffset;a.originalEndTime=a.endTime+b.timestampOffset+b.timestampMapOffset;
var d=c(a.markCounter,a.originalStartTime,a.originalEndTime,a.text);b.m_cuesSet[d]||a.originalEndTime<=b.appendWindowStart||a.originalStartTime>=b.appendWindowEnd||(a.startTime=Math.max(a.originalStartTime,b.appendWindowStart),a.endTime=Math.min(a.originalEndTime,b.appendWindowEnd),b.m_cuesSet[d]=!0,b.m_cues.push(a),b.m_textTrack.addCue(a))})}};b.prototype.reset=function(){this.m_styleSheets=[];this.m_currentStyleSheet=void 0};b.prototype.remove=function(a,b){var d=[],e=[],l;if(!(0==this.m_cues.length||
this.m_cues[0].startTime>=b)){for(var m=0;m<this.m_cues.length;m++){var n=!0;l=this.m_cues[m];l.startTime<=a&&l.endTime<=a||l.startTime>=b||(l.startTime>=a&&l.endTime<=b?n=!1:l.startTime<a?l.endTime=a:l.startTime=b);n?d.push(l):e.push(l)}for(;0<e.length;)l=e.shift(),this.m_textTrack&&this.m_textTrack.removeCue(l),delete this.m_cuesSet[c(l.markCounter,l.originalStartTime,l.originalEndTime,l.text)];this.m_cues=d}};b.prototype.newVTTCue=function(a,b,c){try{if(b=/^([0-9]+):([0-9]+):([0-9.]+)[\t ]+--\x3e[\t ]+([0-9]+):([0-9]+):([0-9.]+)[\t ]?(.*)$/.exec(b)){var d=
new VTTCue(3600*Number(b[1])+60*Number(b[2])+Number(b[3]),3600*Number(b[4])+60*Number(b[5])+Number(b[6]),c);d.id=a;b[7].split(/[\t\n ]+/).forEach(function(a){try{var b=/^([^:]+):(.+)$/.exec(a);if(b){var c=b[1],e=b[2].split(","),g=e[0],f=Number(g.replace("%","")),h=e[1];switch(c){case "vertical":d.vertical=g;break;case "align":d.align=g;break;case "size":d.size=isFinite(f)?f:"auto";break;case "line":d.line=f;h&&(d.lineAlign=h);d.snapToLines=0>g.indexOf("%");break;case "position":d.position=f;h&&(d.positionAlign=
h);break;case "region":this.m_regions[g]&&(d.region=this.m_regions[g])}}}catch(l){}}.bind(this));return d}}catch(e){}};b.prototype.parseRegion=function(a){try{var b,c,d=a.split(/[\t\n ]+/);try{b=new VTTRegion}catch(e){b={width:100,lines:3,regionAnchorX:0,regionAnchorY:100,viewportAnchorX:0,viewportAnchorY:100,scroll:""}}d.forEach(function(a){var d=/^([^:]+):(.+)$/.exec(a);if(d){a=d[1];var d=d[2],e=Number(d.replace("%",""));try{switch(a){case "id":c=d;break;case "width":isFinite(e)&&(b.width=e);break;
case "lines":isFinite(e)&&(b.lines=e);break;case "scroll":"up"==d&&(b.scroll="up");break;case "regionanchor":case "viewportanchor":var g=d.split(",");if(2!=g.length)break;var l=Number(g[0].replace("%","")),k=Number(g[1].replace("%",""));if(!isFinite(l)||!isFinite(k))break;"regionanchor"==a?(b.regionAnchorX=l,b.regionAnchorY=k):(b.viewportAnchorX=l,b.viewportAnchorY=k)}}catch(m){}}});c&&(this.m_regions[c]=b)}catch(m){}};b.prototype.parseHeaderLine=function(a){if(/^X-TIMESTAMP-MAP=/.exec(a)){var b=
/LOCAL:[ \t]*([0-9]+):([0-9]+):([0-9.]+)/.exec(a);a=/MPEGTS:[ \t]*([0-9]+)/.exec(a);b&&a&&(b=3600*Number(b[1])+60*Number(b[2])+Number(b[3]),a=Number(a[1])/9E4,this.timestampMapOffset=a-b)}};b.prototype.parseWebVTT=function(a){a=a.replace(/\r\n/g,"\n");a=a.replace(/\r/g,"\n");a=a.split("\n");var b="",c="",d=[],e=0,m=!1,n=!1,q=/^WEBVTT([\t ].*)?$/,p=/^STYLE[\t ]*$/,t=/^NOTE[\t ].*$/,z=/^REGION[\t ]*$/,v=/--\x3e/,B=void 0,w=void 0,C="";a.push("");for(var x=0;x<a.length;x++){var u=a[x];switch(e){case 0:0!=
u.length&&(!n&&q.exec(u)?e=1:t.exec(u)?e=3:p.exec(u)?e=2:z.exec(u)?e=4:(e=5,x--));break;case 1:0!=u.length&&this.parseHeaderLine(u),n=!0;case 3:0==u.length&&(e=0);break;case 4:0==u.length?(this.parseRegion(c),c="",e=0):c+=u+"\n";break;case 2:0==u.length?e=0:m||(b+=u+"\n");break;case 5:m=!0,0==u.length?(w&&(e=this.newVTTCue(B,w,C))&&d.push(e),e=0,w=B=void 0,C=""):w?(C&&(C+="\n"),C+=u):v.exec(u)?w=u:B?e=3:B=u}}return{style:b,cues:d}};StreamEngine.VTTSourceBuffer=b;d.prototype.tryCallback=function(a){if(this.object[a])try{this.object[a]()}catch(b){console.log("exception calling "+
a+": "+b)}};d.prototype.onenter=function(){this.tryCallback("onenter")};d.prototype.onexit=function(){this.tryCallback("onexit")};d.compare=function(a,b,c){return a[c]==b[c]?a.counter-b.counter:a[c]-b[c]};e.prototype=Object.create(a.prototype);e.prototype.constructor=e;e._typePattern=/^streamengine\/event\s*;\s*time=['"]?(media|virtual|mark)['"]?$/;e.isTypeSupported=function(a){return!!e._typePattern.exec(a)};e.prototype.bufferedEnd=function(){var a=0<this.m_events.length?this.m_events[this.m_events.length-
1].startTime:0;return a=Math.max(a,0<this.m_startedEvents.length?this.m_startedEvents[this.m_startedEvents.length-1].startTime:0)};e.prototype.mark=function(a,b){"media"==this.m_mode?this.m_timestampAdjust=0:"virtual"==this.m_mode?this.m_timestampAdjust=a-b:"mark"==this.m_mode&&(this.m_timestampAdjust=a)};e.prototype.appendBuffer=function(a){var b=!1;if(a){for(var c="media"==this.m_mode?this.timestampOffset:this.m_timestampAdjust;0<a.length;){var e=new d(a.shift(),this.m_eventCounter++);e.startTime+=
c;e.endTime+=c;e.endTime<=this.appendWindowStart||e.startTime>=this.appendWindowEnd||(e.startTime=Math.max(e.startTime,this.appendWindowStart),e.endTime=Math.min(e.endTime,this.appendWindowEnd),this.m_events.length&&e.startTime<this.m_events[this.m_events.length-1].startTime&&(b=!0),this.m_events.push(e))}b&&this.m_events.sort(function(a,b){return d.compare(a,b,"startTime")})}};e.prototype.remove=function(a,b){function c(d,e,h){var n=[];if(0==d.length||d[0][e]>=b)return d;for(e=0;e<d.length;e++){var q=
!0,p=d[e];p.startTime<=a&&p.endTime<=a||p.startTime>=b||(p.startTime>=a&&p.endTime<=b?q=!1:p.startTime<a?p.endTime=a:p.startTime=b);if(q)n.push(p);else if(h)p.onexit()}return n}this.m_events=c(this.m_events,"startTime",!1);this.m_startedEvents=c(this.m_startedEvents,"endTime",!0)};e.prototype.activateItems=function(a,b){function c(b){for(;b.length;)if(e=b[0],e.endTime<=a)e.onexit(),b.shift();else break}var e,l=!1;for(c(this.m_startedEvents);this.m_events.length;)if(e=this.m_events[0],e.startTime<=
a)e.onenter(),this.m_events.shift(),this.m_startedEvents.length&&e.endTime<this.m_startedEvents[this.m_startedEvents.length-1].endTime&&(l=!0),this.m_startedEvents.push(e);else break;l&&this.m_startedEvents.sort(function(a,b){return d.compare(a,b,"endTime")});c(this.m_startedEvents)};StreamEngine.EventSourceBuffer=e})();function MetaStreamSource(){IStreamSource.call(this);this.m_state=this.STATE_HALT;this.currentSource=void 0;this.m_offset=0;this.m_sourceEnding=!1;this.m_sourceError=void 0}
MetaStreamSource.prototype=Object.create(IStreamSource.prototype);MetaStreamSource.prototype.constructor=MetaStreamSource;MetaStreamSource.prototype.STATE_SOURCE_NEEDED="source needed";MetaStreamSource.prototype.STATE_SOURCE_CONTINUE="source continue";MetaStreamSource.prototype.STATE_HALT="halt";MetaStreamSource.prototype.seek=function(a){this.m_state=this.STATE_SOURCE_NEEDED;this.m_sourceEnding=!1;this.m_sourceError=void 0;this.moveToSeekPosition(a)};
MetaStreamSource.prototype.continue=function(){this.m_state=this.STATE_SOURCE_CONTINUE};MetaStreamSource.prototype.halt=function(){this.m_state=this.STATE_HALT};MetaStreamSource.prototype.sync=function(a){this.m_sourceEnding?(this.m_sourceEnding=!1,this.m_sourceError?this.m_state=this.STATE_HALT:(this.m_state=this.STATE_SOURCE_NEEDED,this.moveToNextPosition(a.leastBufferedThrough-this.m_offset))):this.currentSource.sync(a)};
MetaStreamSource.prototype.processStreamTimeslice=function(a,c,b,d){this.STATE_SOURCE_NEEDED==this.m_state&&this.getSourceForPosition();if(this.STATE_HALT==this.m_state)return StreamStatus.Ended(this.m_sourceError);if(this.STATE_SOURCE_CONTINUE==this.m_state){a=this.currentSource.processStreamTimeslice(a,c,b,d-this.m_offset);if(!a)return a;switch(a.kind){case StreamStatusKind.KIND_ENDED:this.m_sourceEnding=!0;this.m_sourceError=this.m_sourceError||a.error;a=StreamStatus.Sync();break;case StreamStatusKind.KIND_MARK:d=
void 0==a.offset?d:a.offset;a=this.translateMarkStatus(a);void 0!=a.offset&&(this.m_offset=a.offset-d);break;case StreamStatusKind.KIND_WINDOW_END:a=StreamStatus.WindowEnd((void 0!=a.windowEnd?a.windowEnd:Infinity)+this.m_offset)}return a}};MetaStreamSource.prototype.moveToSeekPosition=function(a){throw new ReferenceError("moveToSeekPosition: implementation needed");};MetaStreamSource.prototype.moveToNextPosition=function(a){throw new ReferenceError("moveToNextPosition: implementation needed");};
MetaStreamSource.prototype.getSourceForPosition=function(){throw new ReferenceError("getSourceForPosition: implementation needed");};MetaStreamSource.prototype.translateMarkStatus=function(a){return a};function LoopStreamSource(a,c){MetaStreamSource.call(this);this.currentSource=a;this.m_loopCount=0;this.m_lastSeekTarget=void 0;this.m_maxLoops=void 0==c?Infinity:c}LoopStreamSource.prototype=Object.create(MetaStreamSource.prototype);LoopStreamSource.prototype.constructor=LoopStreamSource;
LoopStreamSource.prototype.moveToSeekPosition=function(a){this.m_loopCount=0;this.m_lastSeekTarget=a;this.currentSource.seek(a)};LoopStreamSource.prototype.moveToNextPosition=function(a){this.m_loopCount++;this.m_loopCount>=this.m_maxLoops?this.halt():this.currentSource.seek(this.m_lastSeekTarget)};LoopStreamSource.prototype.getSourceForPosition=function(){this.continue()};LoopStreamSource.prototype.translateMarkStatus=function(a){a.tag={tag:a.tag,times:this.m_loopCount,max:this.m_maxLoops};return a};
function HTTPStreamSource(){IStreamSource.call(this);this.stopTarget=Infinity;this.m_initSegmentsSent={};this.m_xhrs={};this.m_xhrErrorCounts={};this.m_xhrRetryAfter={};this.m_markNeeded=!0;this.m_endedNeeded=!1;this.m_syncActions=[];this.currentTimeAtSync=this.leastBufferedThroughAtSync=void 0;this.spliceNeeded=!1;this.errorType=void 0}HTTPStreamSource.prototype=Object.create(IStreamSource.prototype);HTTPStreamSource.prototype.constructor=HTTPStreamSource;
HTTPStreamSource.prototype.maxSegmentErrors=5;HTTPStreamSource.prototype.segmentErrorWaitInterval=1;HTTPStreamSource.prototype.stopAt=function(a){a>this.stopTarget&&(this.spliceNeeded=!0);this.stopTarget=a};HTTPStreamSource.prototype.seek=function(a){this.m_xhrRetryAfter={};this.m_initSegmentsSent={};this.m_markNeeded=!0;this.m_endedNeeded=!1;this.m_syncActions=[];this.spliceNeeded=!1;this.currentTimeAtSync=this.leastBufferedThroughAtSync=void 0;this.abortCurrentLoads();this.moveToSeekPosition(a)};
HTTPStreamSource.prototype.sync=function(a){this.leastBufferedThroughAtSync=a.leastBufferedThrough;this.currentTimeAtSync=a.currentTime;this.m_initSegmentsSent={};this.m_endedNeeded=this.m_syncActions.every(function(a){return a==this.SEGSTATUS_ENDED}.bind(this));this.m_markNeeded=!this.m_endedNeeded;this.m_syncActions=[]};
HTTPStreamSource.prototype.processStreamTimeslice=function(a,c,b,d){if(this.m_endedNeeded)return StreamStatus.Ended(this.errorType);if(this.m_markNeeded){if(0==a){if(b)return StreamStatus.Continue();if(a=this.makeMarkStatus())return this.spliceNeeded=this.m_markNeeded=!1,a}return StreamStatus.Continue()}if(this.m_xhrRetryAfter[a]&&(new Date).getTime()<this.m_xhrRetryAfter[a]||b&&!this.m_markNeeded&&!this.spliceNeeded)return StreamStatus.Continue();if(b=this.m_xhrs[a]){if(b.readyState!=XMLHttpRequest.DONE)return StreamStatus.Continue();
d=this.hasSeparateInitSegment(a)&&!this.m_initSegmentsSent[a];delete this.m_xhrs[a];if(2!=Math.floor(b.status/100))switch(this.m_xhrErrorCounts[a]=(this.m_xhrErrorCounts[a]||0)+1,this.onSegmentError(a,d,b.status,this.m_xhrErrorCounts[a])){case this.SEGERROR_WAIT:return this.m_xhrRetryAfter[a]=(new Date).getTime()+1E3*this.segmentErrorWaitInterval,StreamStatus.Continue();case this.SEGERROR_RETRY:return delete this.m_xhrRetryAfter[a],StreamStatus.Continue();default:return this.errorType=this.errorType||
"network",StreamStatus.Ended(this.errorType)}delete this.m_xhrRetryAfter[a];this.m_xhrErrorCounts[a]=0;c(b.response);d?this.m_initSegmentsSent[a]=!0:this.moveToNextSegment(a);return StreamStatus.WindowEnd(this.stopTarget)}switch(this.segmentStatus(a)){case this.SEGSTATUS_MARK_NEEDED:return this.m_syncActions.push(this.SEGSTATUS_MARK_NEEDED),StreamStatus.Sync();case this.SEGSTATUS_ENDED:return this.m_syncActions.push(this.SEGSTATUS_ENDED),StreamStatus.Sync();case this.SEGSTATUS_READY:if(c=!this.m_initSegmentsSent[a]&&
this.hasSeparateInitSegment(a),b=this.xhrForCurrentSegment(a,c))this.m_xhrs[a]=b,b.DONE!=b.readyState&&(c||this.setupMeasureLoadPerformance(b,a),b.responseType="arraybuffer",b.send())}return StreamStatus.WindowEnd(this.stopTarget)};
HTTPStreamSource.prototype.setupMeasureLoadPerformance=function(a,c){var b=this,d=(new Date).getTime()/1E3,e=void 0;a.addEventListener("progress",function(){void 0==e&&(e=(new Date).getTime()/1E3)});a.addEventListener("loadend",function(){if(2==Math.floor(a.status/100)){var g;g="arraybuffer"==a.responseType&&a.response?a.response.byteLength:a.getResponseHeader("Content-Length");if(void 0!=e&&g){var f=(new Date).getTime()/1E3;g=Number(g);b.onLoadMeasurement(c,g,e-d,f-e,f-d)}}})};
HTTPStreamSource.prototype.abortCurrentLoads=function(){for(var a in this.m_xhrs)this.m_xhrs[a].abort();this.m_xhrs={}};HTTPStreamSource.prototype.SEGSTATUS_WAIT="wait";HTTPStreamSource.prototype.SEGSTATUS_READY="ready";HTTPStreamSource.prototype.SEGSTATUS_MARK_NEEDED="mark needed";HTTPStreamSource.prototype.SEGSTATUS_ENDED="ended";HTTPStreamSource.prototype.SEGERROR_WAIT="wait";HTTPStreamSource.prototype.SEGERROR_RETRY="retry";HTTPStreamSource.prototype.SEGERROR_ENDED="ended";
HTTPStreamSource.prototype.xhrForCurrentSegment=function(a,c){var b=this.urlForCurrentSegment(a,c);if(!b)return null;var d,e=void 0;"string"==typeof b?d=b:(d=b.url,e=b.range);return this.xhrForCurrentSegmentURL(a,c,d,e)};HTTPStreamSource.prototype.xhrForCurrentSegmentURL=function(a,c,b,d){a=new XMLHttpRequest;a.open("GET",b);d&&a.setRequestHeader("Range",d);return a};HTTPStreamSource.prototype.onLoadMeasurement=function(a,c,b,d,e){};
HTTPStreamSource.prototype.onSegmentError=function(a,c,b,d){var e=d>this.maxSegmentErrors?this.SEGERROR_ENDED:this.SEGERROR_WAIT;StreamEngine.verbose&&console.log("onSegmentError channel "+a+" init: "+c+" status: "+b+" count: "+d+" action: "+e);return e};HTTPStreamSource.prototype.makeMarkStatus=function(){throw new ReferenceError("makeMarkStatus: implementation needed");};
HTTPStreamSource.prototype.moveToSeekPosition=function(a){throw new ReferenceError("moveToSeekPosition: implementation needed");};HTTPStreamSource.prototype.moveToNextSegment=function(a){throw new ReferenceError("moveToNextSegment: implementation needed");};HTTPStreamSource.prototype.segmentStatus=function(a){throw new ReferenceError("segmentStatus: implementation needed");};
HTTPStreamSource.prototype.urlForCurrentSegment=function(a,c){throw new ReferenceError("urlForCurrentSegment: implementation needed");};HTTPStreamSource.prototype.hasSeparateInitSegment=function(a){throw new ReferenceError("hasSeparateInitSegment: implementation needed");};function PrebufferStreamSource(a,c,b){IStreamSource.call(this);this.reset();this.m_source=a;this.m_workIntervalID=void 0;void 0!=c&&(this.maxSegments=c);this.m_timesliceInterval=b?1E3*b:250}PrebufferStreamSource.prototype=Object.create(IStreamSource.prototype);
PrebufferStreamSource.prototype.constructor=PrebufferStreamSource;PrebufferStreamSource.prototype.maxSegments=5;PrebufferStreamSource.prototype.reset=function(){this.m_buffers=[[]];this.m_nextAppendBuf=this.m_nextMark=void 0;this.m_channelStop={};this.m_allStop=!1;this.m_lastWindowEnd=NaN;this.m_lastOffset=0};PrebufferStreamSource.prototype.close=function(){void 0!=this.m_workIntervalID&&clearInterval(this.m_workIntervalID);this.m_workIntervalID=void 0;this.reset()};
PrebufferStreamSource.prototype.onWorkInterval=function(){for(var a,c=function(b){a=b},b,d=0;d<this.m_buffers.length;d++)if(!this.m_allStop&&!this.m_channelStop[d])if(a=void 0,b=this.m_source.processStreamTimeslice(d,c,!1,this.m_lastOffset)||StreamStatus.Continue(),b.kind==StreamStatusKind.KIND_MARK)this.m_allStop=!0,this.m_nextMark=b,this.m_nextAppendBuf=a;else{var e=StreamStatusKind.KIND_SYNC==b.kind||StreamStatusKind.KIND_ENDED==b.kind;if(a||e||StreamStatusKind.KIND_WINDOW_END==b.kind&&b.windowEnd!=
this.m_lastWindowEnd){this.m_buffers[d].push({status:b,appendBuf:a});StreamEngine.verbose&&console.log("buffer channel",d,"length",this.m_buffers[d].length);if(e||this.m_buffers[d].length>=this.maxSegments)this.m_channelStop[d]=!0;StreamStatusKind.KIND_WINDOW_END==b.kind&&(this.m_lastWindowEnd=b.windowEnd)}}};
PrebufferStreamSource.prototype.processStreamTimeslice=function(a,c,b,d){var e=void 0;this.m_allStop=!0;this.m_buffers[a].length?(a=this.m_buffers[a].shift(),e=a.status,a.appendBuf&&c(a.appendBuf)):this.m_buffers.every(function(a,b){return 0==a.length})&&(this.m_nextMark?0==a&&(e=this.m_nextMark,this.m_nextAppendBuf&&c(this.m_nextAppendBuf)):e=this.m_source.processStreamTimeslice(a,c,b,d));if(e&&StreamStatusKind.KIND_MARK==e.kind){this.reset();this.m_buffers=[];for(var g in e.config.types)this.m_buffers.push([]);
this.m_lastOffset=void 0==e.offset?d:e.offset}return e};PrebufferStreamSource.prototype.seek=function(a){this.reset();void 0==this.m_workIntervalID&&(this.m_workIntervalID=setInterval(this.onWorkInterval.bind(this),this.m_timesliceInterval));this.m_source.seek(a)};PrebufferStreamSource.prototype.sync=function(a){this.m_source.sync(a)};function TypeMapperStreamSource(a,c){IStreamSource.call(this);this.streamSource=a;this.m_maps=c||[]}TypeMapperStreamSource.prototype=Object.create(IStreamSource.prototype);
TypeMapperStreamSource.prototype.constructor=TypeMapperStreamSource;TypeMapperStreamSource.prototype.processStreamTimeslice=function(a,c,b,d){if(this.streamSource)return(a=this.streamSource.processStreamTimeslice(a,c,b,d))&&a.kind==StreamStatusKind.KIND_MARK&&(a=this.translateMarkStatus(a)),a};
TypeMapperStreamSource.prototype.translateMarkStatus=function(a){for(var c=a.config.types,b=0;b<c.length;b++)for(var d=c[b],e=0;e<this.m_maps.length;e++){var g=this.m_maps[e].match,f=this.m_maps[e].replace;if(g.exec(d)&&(g=d.replace(g,f),StreamEngine.isTypeSupported(g))){StreamEngine.verbose&&console.log("replace",d," --\x3e ",g);c[b]=g;break}}return a};TypeMapperStreamSource.prototype.seek=function(a){this.streamSource&&this.streamSource.seek(a)};
TypeMapperStreamSource.prototype.sync=function(a){this.streamSource&&this.streamSource.sync(a)};TypeMapperStreamSource.Primetime=function(a){return new TypeMapperStreamSource(a,[{match:/avc1\.(64|58|4d|42)..[01]./i,replace:"avc1.64001f"},{match:/avc1\.(64|58|4d|42).[8c][01]./i,replace:"avc1.64081f"}])};function IDynamicRateManager(){}IDynamicRateManager.prototype.setRates=function(a,c){throw new ReferenceError("setRates: Implementation needed.");};
IDynamicRateManager.prototype.onMeasurement=function(a,c,b,d){};IDynamicRateManager.prototype.recommendedRate=function(a){return 0};function DefaultDynamicRateManager(){IDynamicRateManager.call(this);this.m_rateManagers={};this.historyWeight=.875;this.upswitchHeadroom=.2;this.maxUpswitchStep=1}DefaultDynamicRateManager.prototype=Object.create(IDynamicRateManager.prototype);DefaultDynamicRateManager.prototype.constructor=DefaultDynamicRateManager;DefaultDynamicRateManager.prototype.ignoreRates=!1;
DefaultDynamicRateManager.prototype._getRateManager=function(a){var c=this.m_rateManagers[a];c||(c=new this.SimpleRateManager(this),this.m_rateManagers[a]=c);return c};DefaultDynamicRateManager.prototype.onMeasurement=function(a,c,b,d){this._getRateManager(a).onMeasurement(c,b,d)};DefaultDynamicRateManager.prototype.setRates=function(a,c){this.ignoreRates&&(c=void 0);return this._getRateManager(a).setRates(c)};DefaultDynamicRateManager.prototype.recommendedRate=function(a){return this._getRateManager(a).recommendation};
(function(){function a(a){this.m_owner=a;this.m_rates=[];this.recommendation=this.m_smoothedThroughput=NaN}a.prototype.setRates=function(a){a=a||[];if(a.length==this.m_rates.length&&this.m_rates.every(function(b){return 0<=a.indexOf(b.nominal)}))return!1;this.m_rates=a.map(function(a){return{nominal:a,measured:a}});this.m_rates.sort(function(a,c){return a.nominal-c.nominal});return!0};a.prototype.onMeasurement=function(a,b,d){isFinite(this.m_smoothedThroughput)?this.m_smoothedThroughput=this.m_smoothedThroughput*
this.m_owner.historyWeight+a*(1-this.m_owner.historyWeight):this.m_smoothedThroughput=a;var e=this.findBestNominalMatch(d);if(0>e)this.recommendation=Math.min(this.m_smoothedThroughput,a);else{var g=this.m_rates[e];g.measured=Math.max(b,g.measured);a<Math.max(b,d)?(e=Math.max(0,e-1),this.recommendation=this.m_rates[Math.min(this.findBestNominalMatch(Math.min(d,a,this.m_smoothedThroughput)),e)].nominal,this.m_smoothedThroughput=Math.min(this.m_smoothedThroughput,this.recommendation)):(a=this.findBestMeasuredMatch(this.m_smoothedThroughput/
(1+this.m_owner.upswitchHeadroom)),a=Math.min(a,e+this.m_owner.maxUpswitchStep),a=Math.max(a,e),this.recommendation=this.m_rates[a].nominal)}};a.prototype.findBestNominalMatch=function(a){return this.findBestMatch(a,this.m_rates.map(function(a){return a.nominal}))};a.prototype.findBestMeasuredMatch=function(a){return this.findBestMatch(a,this.m_rates.map(function(a){return a.measured}))};a.prototype.findBestMatch=function(a,b){var d=0;if(0==b.length||isNaN(a))return-1;for(var e=0;e<b.length;e++)if(b[e]<=
a)d=e;else break;return d};DefaultDynamicRateManager.prototype.SimpleRateManager=a})();function TrickModeController(a){this.streamEngine=a;this.m_intervalID=void 0;this.rate=0;this.m_previousTarget=this.toPosition=this.fromPosition=void 0;this.m_origin=0}TrickModeController.prototype.m_timesliceInterval=.05;Object.defineProperties(TrickModeController.prototype,{timesliceInterval:{get:function(){return this.m_timesliceInterval},set:function(a){this.m_timesliceInterval=a;this._stop()&&this._start()},enumerable:!0}});
TrickModeController.prototype._stop=function(){return void 0!=this.m_workIntervalID?(clearInterval(this.m_workIntervalID),this.m_workIntervalID=void 0,!0):!1};TrickModeController.prototype._start=function(){void 0==this.m_workIntervalID&&.005<this.m_timesliceInterval&&(this.m_workIntervalID=setInterval(this._onWorkInterval.bind(this),1E3*this.m_timesliceInterval));this._onWorkInterval()};
TrickModeController.prototype._onWorkInterval=function(){if(this.streamEngine&&(this.streamEngine.halted||void 0==this.m_previousTarget)){var a=this.fromPosition+(this._now()-this.m_origin)*this.rate,c=this.seekTargetForPosition(this.m_previousTarget,a);void 0!=c&&(this.streamEngine.seek(c),this.m_previousTarget=c);(0<=this.rate&&a>=this.toPosition||0>this.rate&&a<=this.toPosition)&&this._stop()}};TrickModeController.prototype._now=function(){return(new Date).getTime()/1E3};
TrickModeController.prototype.scrub=function(a){this.slide(a,a,0,!0)};TrickModeController.prototype.slide=function(a,c,b,d){b=Math.abs(b);c<a&&(b=-b);this.rate=b;this.fromPosition=a;this.toPosition=c;this.m_origin=this._now();d||(this.m_previousTarget=void 0);this._start()};TrickModeController.prototype.close=function(){this._stop();this.m_previousTarget=void 0};TrickModeController.prototype.seekTargetForPosition=function(a,c){};function DASHStreamSource(a){HTTPStreamSource.call(this);if("string"!=typeof a)throw new TypeError("URL is not a string");this.m_url=a;this.m_mpd=new this.MPD(a,this);this.m_selectedRepresentations=[];this.m_seekTarget=void 0;this.m_segmentTarget={};this.m_nextSegmentTarget={};this.m_segmentDurationCache={};this.m_currentPeriod=void 0;this.m_segmentFPFudge=.05;this.stopped=this.ended=!1;this.rateManager=new DefaultDynamicRateManager;this.rates={video:0,audio:0};this.onmanifestloaded=function(a){StreamEngine.verbose&&
console.log("DASHStreamSource MPD loaded: "+(a.ready?"ready":a.error?"error":"unknown"))}}DASHStreamSource.prototype=Object.create(HTTPStreamSource.prototype);DASHStreamSource.prototype.constructor=DASHStreamSource;
Object.defineProperties(DASHStreamSource.prototype,{earliestSeekableTime:{get:function(){return this.m_mpd.getEarliestSeekableTime()},enumerable:!0},latestSeekableTime:{get:function(){return this.m_mpd.getLatestSeekableTime()},enumerable:!0},videoEnabled:{get:function(){return this.m_videoEnabled},set:function(a){this.spliceNeeded|=a!=this.m_videoEnabled;this.m_videoEnabled=a},enumerable:!0},audioEnabled:{get:function(){return this.m_audioEnabled},set:function(a){this.spliceNeeded|=a!=this.m_audioEnabled;
this.m_audioEnabled=a},enumerable:!0},lang:{get:function(){return this.m_lang},set:function(a){this.spliceNeeded|=a!=this.m_lang;this.m_lang=a},enumerable:!0},textEnabled:{get:function(){return this.m_textEnabled},set:function(a){this.spliceNeeded|=a!=this.m_textEnabled;this.m_textEnabled=a},enumerable:!0},textLang:{get:function(){return this.m_textLang},set:function(a){this.spliceNeeded|=a!=this.m_textLang;this.m_textLang=a},enumerable:!0},textLangs:{get:function(){return this.m_mpd.getLangs("text")},
enumerable:!0},role:{get:function(){return this.m_role},set:function(a){this.spliceNeeded|=a!=this.m_role;this.m_role=a},enumerable:!0},isLive:{get:function(){return this.m_mpd.isLive},enumerable:!0},ready:{get:function(){return this.m_mpd.ready},enumerable:!0},error:{get:function(){return this.m_mpd.error},enumerable:!0},textAlternativeName:{get:function(){return this.textLang},set:function(a){this.textLang=a},enumerable:!0},textAlternativeNames:{get:function(){return this.textLangs},enumerable:!0}});
DASHStreamSource.prototype.m_videoEnabled=!0;DASHStreamSource.prototype.m_audioEnabled=!0;DASHStreamSource.prototype.m_textEnabled=!1;DASHStreamSource.prototype.m_lang=void 0;DASHStreamSource.prototype.m_role="main";DASHStreamSource.prototype.m_textLang=void 0;DASHStreamSource.prototype.preciseSeek=!0;DASHStreamSource.prototype.autoRateSwitch=!0;DASHStreamSource.prototype.toString=function(){return"DASHStreamSource ("+this.m_url+")"};
DASHStreamSource.prototype.onMPDLoadEnd=function(a){if(this.onmanifestloaded)try{this.onmanifestloaded(this)}catch(c){console.log("DASHStreamSource.onmanifestloaded: error "+c)}};DASHStreamSource.prototype.getSeekableTime=function(a){if(this.m_mpd.ready)return"start"==a&&(a=this.isLive?"live":0),"live"==a&&(a=this.latestSeekableTime),this.isLive||(a=Math.min(a,this.latestSeekableTime)),Math.max(a,this.earliestSeekableTime)};
DASHStreamSource.prototype.makeMarkStatus=function(){function a(a,d){var c=this.m_mpd.getAdaptationSets(b,{type:a,role:this.role,lang:d})[0];if(c){var e=this.m_selectedRepresentations.length;this.rateManager.setRates(e,this.m_mpd.getRepresentations(c.id).map(function(a){return a.bandwidth}));var f=this.autoRateSwitch?this.rateManager.recommendedRate(e):this.rates[a];if(c=this.m_mpd.getBestRepresentation(c.id,f))this.m_selectedRepresentations.push(c),g[a]=e,this.autoRateSwitch&&(this.rates[a]=c.bandwidth)}}
var c,b,d=!1,e=!1;if(this.m_mpd.ready&&(c=void 0!=this.leastBufferedThroughAtSync&&this.spliceNeeded?this.leastBufferedThroughAtSync:this.m_seekTarget,c=this.getSeekableTime(c),c<=this.earliestSeekableTime&&(d=!0),b=this.m_mpd.periodIDForTime(c),void 0!=b)){b==this.m_currentPeriod&&(e=!0);this.m_selectedRepresentations=[];var g={};this.videoEnabled&&a.call(this,"video",this.lang);this.audioEnabled&&a.call(this,"audio",this.lang);this.textEnabled&&a.call(this,"text",this.textLang);if(0!=this.m_selectedRepresentations.length){var f=
{types:this.m_selectedRepresentations.map(function(a){return a.codecString})},h=this.m_mpd.getSegment(this.m_selectedRepresentations[0].id,c);if(h&&h.state==this.m_mpd.SEGMENT_READY){if(!this.preciseSeek||d)c=h.begin,e=!1;this.m_segmentTarget={};this.m_nextSegmentTarget={};for(d=0;d<this.m_selectedRepresentations.length;d++){var k=this.m_mpd.getSegment(this.m_selectedRepresentations[d].id,c);this.m_segmentTarget[d]=k.begin;this.m_nextSegmentTarget[d]=k.begin+k.duration+this.m_segmentFPFudge}this.leastBufferedThroughAtSync=
void 0;this.m_currentPeriod=b;return StreamStatus.Mark({target:c,rates:this.m_selectedRepresentations.map(function(a){return a.bandwidth}),streamSource:this,mediaTimestamp:e?"continue":h.timestamp,channels:g},f,c,c-h.begin,this.stopTarget,e?"continue":h.timestamp)}}}};DASHStreamSource.prototype.moveToSeekPosition=function(a){this.m_seekTarget=a;this.stopped=this.ended=!1;this.m_currentPeriod=void 0};DASHStreamSource.prototype.moveToNextSegment=function(a){this.m_segmentTarget[a]=this.m_nextSegmentTarget[a]};
DASHStreamSource.prototype.segmentStatus=function(a){var c=this.m_mpd.getSegment(this.m_selectedRepresentations[a].id,this.m_segmentTarget[a]);switch(c.state){case this.m_mpd.SEGMENT_WAIT:return this.SEGSTATUS_WAIT;case this.m_mpd.SEGMENT_ENDED:if(void 0==this.m_mpd.periodIDForTime(this.m_segmentTarget[a]))return this.ended=!0,this.SEGSTATUS_ENDED;case this.m_mpd.SEGMENT_EXPIRED:return this.m_seekTarget=this.m_segmentTarget[a],this.SEGSTATUS_MARK_NEEDED;case this.m_mpd.SEGMENT_READY:return c.begin>=
this.stopTarget?(this.stopped=!0,this.SEGSTATUS_ENDED):this.spliceNeeded&&this.m_segmentTarget[a]>=this.m_segmentTarget[0]?this.SEGSTATUS_MARK_NEEDED:this.SEGSTATUS_READY}};
DASHStreamSource.prototype.urlForCurrentSegment=function(a,c){var b;b=c?this.m_mpd.getInitSegment(this.m_selectedRepresentations[a].id):this.m_mpd.getSegment(this.m_selectedRepresentations[a].id,this.m_segmentTarget[a]);if(this.m_mpd.SEGMENT_READY==b.state)return c||(this.m_nextSegmentTarget[a]=b.begin+b.duration+this.m_segmentFPFudge,this.m_segmentDurationCache[a]=b.duration),b.url};DASHStreamSource.prototype.hasSeparateInitSegment=function(a){return!!this.m_selectedRepresentations[a].segmentContext.initializationSegmentTemplate};
DASHStreamSource.prototype.onLoadMeasurement=function(a,c,b,d,e){var g=this.m_segmentDurationCache[a],f=8*c;c=this.m_selectedRepresentations[a];var h=f/e*2;if(g&&c){d=Math.max(d,.001);e=Math.max(e,b+d);var k=f/g;b=b<g?f/d*((g-b)/g):f/e;b=Math.min(b,h);this.rateManager.onMeasurement(a,b,k,c.bandwidth);a=this.autoRateSwitch?this.rateManager.recommendedRate(a):this.rates[c.adaptationSet.type];a=this.m_mpd.getBestRepresentation(c.adaptationSet.id,a);a!=c&&(StreamEngine.verbose&&console.log("splice needed for bandwidth change",
c.bandwidth," --\x3e ",a.bandwidth),this.spliceNeeded=!0)}};
(function(){function a(a,b){this.owner=b;this.m_url=a;this.m_xhr=new XMLHttpRequest;this.m_xhr.open("GET",a);this.m_xhr.responseType="document";this.m_xhr.overrideMimeType("application/dash+xml");this.m_xhr.onloadend=this.onMPDLoadEnd.bind(this);this.m_xhr.send();this.ready=this.error=!1;this.isLive=void 0;this.m_periods=[];this.m_adaptationSets=[];this.m_representations=[]}a.prototype.SEGMENT_READY="ready";a.prototype.SEGMENT_WAIT="wait";a.prototype.SEGMENT_EXPIRED="expired";a.prototype.SEGMENT_ENDED=
"ended";a.prototype.onMPDLoadEnd=function(){if(2==Math.floor(this.m_xhr.status/100)&&this.m_xhr.responseXML){var a=(new Date).getTime(),b=this.m_xhr.getResponseHeader("Date");if(b){var b=(new Date(b)).getTime(),d=this.m_xhr.getResponseHeader("Age");d&&(b+=1E3*Number(d));this.m_mpdTimeCorrection=(a-b)/1E3}else this.m_mpdTimeCorrection=0;this.m_mpdRetrieved=a/1E3;this.ready=this.parseMPD();this.isLive="dynamic"==this.m_mpdType}else this.error=!0;this.owner.onMPDLoadEnd(this)};a.prototype.getLangs=function(a){for(var b=
[],d=0;d<this.m_adaptationSets.length;d++){var e=this.m_adaptationSets[d];a==e.type&&e.lang&&0>b.indexOf(e.lang)&&b.push(e.lang)}return b};a.prototype.parseMPD=function(){try{var a=function(a,b){void 0!=a.attributes.mimeType&&(b.mimeType=a.attributes.mimeType.textContent);void 0!=a.attributes.codecs&&(b.codecs=a.attributes.codecs.textContent);void 0!=a.attributes.bitstreamSwitching&&(b.bitstreamSwitching=a.attributes.bitstreamSwitching.textContent)},b=function(a,b,d){if("BaseURL"==a.nodeName)b.baseURL=
(new URL(a.textContent,d)).toString();else if("SegmentBase"==a.nodeName)StreamEngine.verbose&&console.log("SegmentBase: not supported");else if("SegmentList"==a.nodeName)StreamEngine.verbose&&console.log("SegmentList: not supported right now");else if("SegmentTemplate"==a.nodeName)for(void 0!=a.attributes.media&&(b.mediaTemplate=a.attributes.media.textContent),void 0!=a.attributes.initialization&&(b.initializationSegmentTemplate=a.attributes.initialization.textContent),void 0!=a.attributes.timescale&&
(b.timescale=Number(a.attributes.timescale.textContent)),void 0!=a.attributes.duration&&(b.segmentDuration=Number(a.attributes.duration.textContent),l=Math.max(l,b.segmentDuration/(b.timescale?b.timescale:1))),void 0!=a.attributes.startNumber&&(b.startNumber=Number(a.attributes.startNumber.textContent)),void 0!=a.attributes.presentationTimeOffset&&(b.presentationTimeOffset=Number(a.attributes.presentationTimeOffset.textContent)),d=0;d<a.children.length;d++){var c=a.children[d];if("SegmentTimeline"==
c.nodeName){var e=0,g=void 0;b.segmentTimeline=[];for(var f=0;f<c.children.length;f++){var n=c.children[f];if("S"==n.nodeName){var h={};h.startTime=void 0!=n.attributes.t?Number(n.attributes.t.textContent):e;h.duration=Number(n.attributes.d.textContent);l=Math.max(l,h.duration/(b.timescale?b.timescale:1));h.repeatCount=void 0!=n.attributes.r?Number(n.attributes.r.textContent):0;void 0!=g&&(g.nextStart=h.startTime);b.segmentTimeline.push(h);e=h.startTime+h.duration*(h.repeatCount+1);g=h}}}}},d=this.m_xhr.responseXML.getElementsByTagName("MPD")[0],
e=0,g=0,f=0,h={baseURL:this.m_xhr.responseXML.URL},k=void 0,l=0,m=void 0;this.m_mpdType=void 0!=d.attributes.type?d.attributes.type.textContent:"static";this.m_mpdAvailabilityStartTime=void 0!=d.attributes.availabilityStartTime?this.parseDate(d.attributes.availabilityStartTime.textContent):void 0;this.m_mpdAvailabilityEndTime=void 0!=d.attributes.availabilityEndTime?this.parseDate(d.attributes.availabilityEndTime.textContent):void 0;this.m_mpdMediaPresentationDuration=void 0!=d.attributes.mediaPresentationDuration?
this.parseDuration(d.attributes.mediaPresentationDuration.textContent):void 0;this.m_mpdMinimumUpdatePeriod=void 0!=d.attributes.minimumUpdatePeriod?this.parseDuration(d.attributes.minimumUpdatePeriod.textContent):void 0;this.m_mpdTimeShiftBufferDepth=void 0!=d.attributes.timeShiftBufferDepth?this.parseDuration(d.attributes.timeShiftBufferDepth.textContent):void 0;for(var n=0;n<d.children.length;n++){var q=d.children[n];b(q,h,this.m_xhr.responseXML.URL);if("Period"==q.nodeName){var p=q,t={id:e,adaptationSets:[]},
z=Object.create(h);this.m_periods[e++]=t;a(p,z);void 0!=p.attributes.start?t.start=this.parseDuration(p.attributes.start.textContent):k&&void 0!=k.duration&&void 0!=k.start?t.start=k.start+k.duration:void 0==k&&"static"==this.m_mpdType&&(t.start=0);void 0!=p.attributes.duration?(t.duration=this.parseDuration(p.attributes.duration.textContent),m=(void 0!=m?m:0)+t.duration):k&&void 0!=k.start&&void 0!=t.start&&(t.duration=t.start-k.start,m=(void 0!=m?m:0)+t.duration);for(var v=0;v<p.children.length;v++){var B=
p.children[v];b(B,z,h.baseURL);if("AdaptationSet"==B.nodeName){var w=Object.create(z),C=B,x={id:g,representations:[],period:t,roles:[]};this.m_adaptationSets[g++]=x;t.adaptationSets.push(x);a(C,w);void 0!=C.attributes.lang&&(x.lang=C.attributes.lang.textContent);for(var u=0;u<C.children.length;u++){var A=C.children[u];b(A,w,z.baseURL);if("Representation"==A.nodeName){var y=Object.create(w),r=A,D={id:f,adaptationSet:x,segmentContext:y};this.m_representations[f++]=D;x.representations.push(D);a(r,y);
D.bandwidth=Number(r.attributes.bandwidth.textContent);void 0!=r.attributes.id&&(D.xmlid=r.attributes.id.textContent);for(var G=0;G<r.children.length;G++)b(r.children[G],y,w.baseURL);x.type=y.mimeType.split("/")[0];void 0==y.timescale&&(y.timescale=1);void 0==y.presentationTimeOffset&&(y.presentationTimeOffset=0);D.codecString=y.mimeType;y.codecs&&(D.codecString+='; codecs="'+y.codecs+'"');D.codecSupported=StreamEngine.isTypeSupported(D.codecString)}else"Role"==A.nodeName&&void 0!=A.attributes.value&&
x.roles.push(A.attributes.value.textContent)}}}k=t}}this.m_mpdMaxSegmentDuration=void 0!=d.attributes.maxSegmentDuration?this.parseDuration(d.attributes.maxSegmentDuration.textContent):l;"static"==this.m_mpdType&&(void 0==this.m_mpdMediaPresentationDuration?this.m_mpdMediaPresentationDuration=m:k&&void 0==k.duration&&(k.duration=this.m_mpdMediaPresentationDuration-(void 0!=m?m:0)))}catch(E){return console.log("parseMPD:",E),this.error=!0,!1}return!0};a.prototype.templateReplace=function(a,b){for(var d=
a.split("$"),e=[],g=/([^%]*)/,f=/[^%]*%0(\d+)d/,h=0;h<d.length;h++){var k=d[h];if(0==h%2)e.push(k);else{var l="",m=g.exec(k),n=null;if(null!=m){m=m[1];switch(m){case "":l="$";break;case "RepresentationID":l=""+b[m];break;case "Number":case "Bandwidth":case "Time":l=""+b[m],n=f.exec(k)}null!=n&&(n=Number(n[1]),l.length<n&&(l="0".repeat(n-l.length)+l));e.push(l)}}}return e.join("")};a.prototype.buildURL=function(a,b,d){if(!a)return d;a=this.templateReplace(a,b);return(new URL(a,d)).toString()};a.prototype.getSegment=
function(a,b){var d=this.m_representations[a],e=d.adaptationSet.period,g=void 0!=e.duration?e.start+e.duration:void 0;if(b<e.start||b<this.getEarliestSeekableTime()-2*this.m_mpdMaxSegmentDuration)return{state:this.SEGMENT_EXPIRED};if(void 0!=g&&b>=g)return{state:this.SEGMENT_ENDED};if(void 0==g&&b>=this.getLatestSeekableTime())return{state:this.SEGMENT_WAIT};var f=d.segmentContext,h=(b-d.adaptationSet.period.start)*f.timescale,k=void 0==f.startNumber?0:f.startNumber,l,m,n;if(void 0!=f.segmentTimeline)for(var e=
f.segmentTimeline,q=0;q<e.length;q++){var p=e[q];if(p.nextStart<=h)k=0<=p.repeatCount?k+(p.repeatCount+1):k+Math.ceil((p.nextStart-p.startTime)/p.duration);else{n=Math.max(h-p.startTime,0);m=p.duration;n=Math.floor(n/m)*m;l=n+p.startTime;k+=n/m;n=l/f.timescale;void 0!=p.nextStart&&(m=Math.min(m,p.nextStart-l));break}}else void 0==f.mediaTemplate?(m=(g-e.start)*f.timescale,l=e.start*f.timescale,k=0,n=e.start):(m=f.segmentDuration,l=Math.floor(h/m)*m,k=l/m+k,n=l/f.timescale);m/=f.timescale;void 0!=
g&&(m=Math.min(m,g-n));g=n+f.presentationTimeOffset/f.timescale;return{url:this.buildURL(f.mediaTemplate,{RepresentationID:d.xmlid,Bandwidth:d.bandwidth,Number:k,Time:l},f.baseURL),state:this.SEGMENT_READY,begin:n,timestamp:g,duration:m}};a.prototype.hasInitSegment=function(a){return!!this.m_representations[a].segmentContext.initializationSegmentTemplate};a.prototype.getInitSegment=function(a){a=this.m_representations[a];var b=a.segmentContext;return{url:this.buildURL(b.initializationSegmentTemplate,
{RepresentationID:a.xmlid,Bandwidth:a.bandwidth},b.baseURL),state:this.SEGMENT_READY}};a.prototype.getEarliestSeekableTime=function(){if(this.ready){if("dynamic"==this.m_mpdType){var a;a=void 0!=this.m_mpdTimeShiftBufferDepth?this._streamNow()+this.m_mpdMaxSegmentDuration-this.m_mpdTimeShiftBufferDepth:0;a=Math.max(a,0);return a+=this.m_periods[0].start||0}return this.m_periods[0].start||0}};a.prototype.getLatestSeekableTime=function(){if(this.ready)return"dynamic"==this.m_mpdType?this._streamNow()-
this.m_mpdMaxSegmentDuration:this.getEarliestSeekableTime()+this.m_mpdMediaPresentationDuration};a.prototype._streamNow=function(){var a=(new Date).getTime()/1E3,a=a-this.m_mpdTimeCorrection;return a-this.m_mpdAvailabilityStartTime};a.prototype.periodIDForTime=function(a){for(var b=0;b<this.m_periods.length;b++){var d=this.m_periods[b];if(void 0!=d.start&&a>=d.start&&(void 0==d.duration||a<=d.start+d.duration))return d.id}};a.prototype.getAdaptationSets=function(a,b){function d(a,b){return b.type&&
a.type&&b.type!=a.type||b.role&&a.roles&&a.roles.length&&0>a.roles.indexOf(b.role)||b.lang&&a.lang&&b.lang!=a.lang||!a.representations.some(function(a){return a.codecSupported})?!1:!0}var e=this.m_periods[a];if(e){var g=e.adaptationSets.filter(function(a){return d(a,b)});0==g.length&&b.lang&&(b=Object.create(b),b.lang=void 0,g=e.adaptationSets.filter(function(a){return d(a,b)}));return g}};a.prototype.getRepresentations=function(a){return this.m_adaptationSets[a].representations.filter(function(a){return a.codecSupported})};
a.prototype.getBestRepresentation=function(a,b){var d=this.getRepresentations(a);if(!(0>d.length)){var e=d[0],g=void 0;isFinite(b)||(b=0);for(var f=0;f<d.length;f++){var h=d[f];h.bandwidth<e.bandwidth&&(e=h);h.bandwidth<=b&&(!g||h.bandwidth>g.bandwidth)&&(g=h)}return g||e}};a.prototype.parseDuration=function(a){function b(a,b){return a?(a=Number(a.slice(0,-1)),isFinite(a)?a*b:0):0}var d=/^P([0-9.]+Y)?([0-9.]+M)?([0-9.]+D)?/.exec(a);a=/^P[^T]*T([0-9.]+H)?([0-9.]+M)?([0-9.]+S)?$/.exec(a);var e=0;d&&
(e+=b(d[1],31536E3),e+=b(d[2],2592E3),e+=b(d[3],86400));a&&(e+=b(a[1],3600),e+=b(a[2],60),e+=b(a[3],1));return e};a.prototype.parseDate=function(a){if(a)return a=(new Date(a)).getTime(),isFinite(a)?a/1E3:void 0};DASHStreamSource.prototype.MPD=a})();function ByteBuffer(a){a=a||0;this.buffer=new Uint8Array(Math.max(a,this.defaultSize));this.m_length=a}ByteBuffer.prototype.defaultSize=256;Object.defineProperties(ByteBuffer.prototype,{length:{get:function(){return this.m_length},set:function(a){this.setLength(a,!0)},enumerable:!0},byteLength:{get:function(){return this.length},set:function(a){this.length=a},enumerable:!0}});
ByteBuffer.prototype.setLength=function(a,c){if(!(a<=this.m_length))if(a>this.buffer.byteLength){var b=this.buffer;this.buffer=new Uint8Array(Math.max(a,2*b.byteLength));this.buffer.set(b.subarray(0,this.m_length))}else if(c)if(this.buffer.fill)this.buffer.fill(0,this.m_length,a);else if(32>=a-this.m_length)for(b=this.m_length;b<a;b++)this.buffer[b]=0;else this.buffer.set(new Uint8Array(a-this.m_length),this.m_length);this.m_length=a};
ByteBuffer.prototype.valueAt=function(a){return a>=this.length?0:this.buffer[a]};ByteBuffer.prototype.setValueAt=function(a,c){c>=this.length&&(this.length=c+1);"string"==typeof a&&(a=a.charCodeAt(0));return this.buffer[c]=a};ByteBuffer.prototype.shift=function(a){var c;void 0==a&&(a=1);if(!(1>a))return a>=this.length?(c=this.valueAt(this.length-1),this.length=0):(c=this.valueAt(a-1),this.buffer.set(this.buffer.subarray(a,this.length),0),this.length-=a),c};
ByteBuffer.prototype.set=function(a,c){var b=a.byteLength;c=c||0;a instanceof ByteBuffer&&(a=a.buffer.subarray(0,b));c+b>this.length&&(this.length=c+b);this.buffer.set(a,c)};ByteBuffer.prototype.setValuesAt=function(a,c){for(var b=0;b<a.length;b++)this.setValueAt(a[b],c+b)};ByteBuffer.prototype.append=function(a){this.set(a,this.length)};ByteBuffer.prototype.appendValues=function(a){this.setValuesAt(a,this.length)};ByteBuffer.prototype.copyOut=function(a,c,b,d){a.set(this.buffer.subarray(b,d),c)};
ByteBuffer.prototype.slice=function(a,c){var b=this.buffer.subarray(a,c),d=new ByteBuffer(c-a);d.set(b,0);return d};ByteBuffer.prototype.setUint16ValueAt=function(a,c){this.setValuesAt([a>>8&255,a&255],c)};ByteBuffer.prototype.setUint32ValueAt=function(a,c){this.setValuesAt([a>>24&255,a>>16&255,a>>8&255,a&255],c)};
ByteBuffer.prototype.setUint64ValueAt=function(a,c){this.setValuesAt([a/72057594037927936&255,a/281474976710656&255,a/1099511627776&255,a/4294967296&255,a/16777216&255,a/65536&255,a/256&255,a&255],c)};
(function(){function a(a,d){this.buffer=a;this.bit=d||0}function c(a,d,e,g){if(4!=a.length)throw new RangeError("invalid type");this.parent=d?d:new ByteBuffer;this.buffer=d&&d instanceof c?d.buffer:this.parent;this.start=this.buffer.length;this.appendUint32Values([0,a]);g=g||0;void 0!=e&&this.appendValues([e,g>>16&255,g>>8&255,g&255])}a.prototype.bitValueAt=function(a){var d=Math.floor(a/8);a=7-(a-8*d);if(!(d>=this.buffer.length))return this.buffer.valueAt(d)&1<<a?1:0};a.prototype.nextBit=function(){return this.bitValueAt(this.bit++)};
a.prototype.nextValue=function(){var a=0,d=0,c=0;if(void 0==this.bitValueAt(this.bit))return NaN;for(;0==this.nextBit();)c++;for(a=(1<<c)-1;c--;)d=(d<<1)+this.nextBit();return a+d};ByteBuffer.ExpGolombReader=a;c.prototype._basicUpdateLength=function(){this.buffer.setUint32ValueAt(this.buffer.length-this.start,this.start)};c.prototype.updateLengths=function(){this.parent.updateLengths&&this.parent.updateLengths();this._basicUpdateLength()};c.prototype.append=function(a,d){this.buffer.append(a);d||
this.updateLengths()};c.prototype.appendValues=function(a,d){this.buffer.appendValues(a);d||this.updateLengths()};c.prototype.appendUint16=function(a,d){this.buffer.setUint16ValueAt(a,this.buffer.length);d||this.updateLengths()};c.prototype.appendUint32=function(a,d){this.buffer.setUint32ValueAt(a,this.buffer.length);d||this.updateLengths()};c.prototype.appendUint64=function(a,d){this.buffer.setUint64ValueAt(a,this.buffer.length);d||this.updateLengths()};c.prototype.appendUint32Values=function(a,
d){for(var c=0;c<a.length;c++){var g=a[c];4==g.length?this.appendValues(g,!0):this.appendUint32(g,!0)}d||this.updateLengths()};ByteBuffer.MP4Box=c})();function M2TSDecoder(){this.reset()}M2TSDecoder.prototype.clear=function(){this.m_buffer?this.m_buffer.length=0:this.m_buffer=new ByteBuffer;this.m_packets={};this.m_pesPackets={}};M2TSDecoder.prototype.reset=function(){this.clear();this.m_types={};this.m_avcDispatcher=new M2TSDecoder.AVCDispatcher(this);this.m_aacDispatcher=new M2TSDecoder.ADTSAACDispatcher(this)};
M2TSDecoder.prototype.flush=function(){for(var a in this.m_packets)this.m_packets[a].appendBytes({length:0},!0,-1,!0,this.onPacketComplete.bind(this),this.onPacketProgress.bind(this));for(a in this.m_pesPackets)this.onPESPacketComplete(this.m_pesPackets[a],Number(a),!1);this.clear()};M2TSDecoder.prototype.appendBytes=function(a){this.m_buffer.append(new Uint8Array(a));a=0;for(var c=this.m_buffer.length;;){for(;a+187<c&&71!=this.m_buffer.valueAt(a);)a++;if(a+188>c)break;this.doOneTSPacket(a);a+=188}this.m_buffer.shift(a)};
M2TSDecoder.prototype.doOneTSPacket=function(a){var c=0!=(this.m_buffer.valueAt(a+1)&64),b=((this.m_buffer.valueAt(a+1)&31)<<8)+this.m_buffer.valueAt(a+2),d=0!=(this.m_buffer.valueAt(a+3)&32),e=0!=(this.m_buffer.valueAt(a+3)&16),g=this.m_buffer.valueAt(a+3)&15,f=4,h=!1;if(d){d=this.m_buffer.valueAt(a+4);if(183<d)return;f+=d+1;h=0!=(this.m_buffer.valueAt(a+5)&128)}e&&8191!=b&&this.doTSPayload(b,c,g,h,a+f,188-f)};
M2TSDecoder.prototype.doTSPayload=function(a,c,b,d,e,g){var f=this.m_packets[a];f||(f=new this.PacketStream(a),this.m_packets[a]=f);f.appendBytes(this.m_buffer.buffer.subarray(e,e+g),c,b,d,this.onPacketComplete.bind(this),this.onPacketProgress.bind(this))};M2TSDecoder.prototype.onPacketComplete=function(a,c){if(3<=c.length&&0==c.valueAt(0)&&0==c.valueAt(1)&&1==c.valueAt(2))this.onPESPacket(a,this.m_types[a],c)};
M2TSDecoder.prototype.onPacketProgress=function(a,c){if(3<=c.length&&(0!=c.valueAt(0)||0!=c.valueAt(1)||1!=c.valueAt(2))){var b=c.valueAt(0)+1;if(b>c.length)return!1;if(23<=c.length-b&&2==c.valueAt(b)&&176==(c.valueAt(b+1)&252))return this.onProgramMapTable(c,b)}return!1};
M2TSDecoder.prototype.onPESPacket=function(a,c,b){var d=b.valueAt(3),e=(b.valueAt(4)<<8)+b.valueAt(5);c=6;var g=-1,f=-1;switch(d){case 188:case 190:case 191:case 240:case 241:case 255:case 242:case 248:return}if(0!=e)if(b.length>e+6)b.length=e+6;else if(b.length<e+6)return;if(!(9>b.length)){b.valueAt(c++);d=(b.valueAt(c++)&192)>>6;e=b.valueAt(c++);if(d&2){if(c+5>b.length)return;g=b.valueAt(c)&14;g=128*g+b.valueAt(c+1);g*=256;g+=b.valueAt(c+2)&254;g*=128;g+=b.valueAt(c+3);g*=256;g+=b.valueAt(c+4)&
254;g/=2;if(d&1){if(c+10>b.length)return;f=b.valueAt(c+5)&14;f=128*f+b.valueAt(c+6);f*=256;f+=b.valueAt(c+7)&254;f*=128;f+=b.valueAt(c+8);f*=256;f+=b.valueAt(c+9)&254;f/=2}else f=g}c+=e;if(!(c>b.length)&&void 0!=this.m_types[a]){d=this.m_pesPackets[a];if(void 0==d){if(0>f)return;d=this._newPESPacketBuffer(g,f);this.m_pesPackets[a]=d}0<=g&&g!=d.pts&&(this.onPESPacketComplete(d,a,!1),d.pts=g,d.dts=f);d.append(b.buffer.subarray(c,b.length))}}};
M2TSDecoder.prototype.onPESPacketComplete=function(a,c,b){switch(this.m_types[c]){case 15:c=this.onAACPacket(a.pts,a.dts,a,b);break;case 27:c=this.onAVCPacket(a.pts,a.dts,a,b);break;default:c=a.length}void 0==c&&(c=a.length);a.shift(c)};
M2TSDecoder.prototype.onProgramMapTable=function(a,c){c++;var b=((a.valueAt(c)&15)<<8)+a.valueAt(c+1);c+=2;b=c+b;if(b>a.length)return!1;c+=7;var d=((a.valueAt(c)&15)<<8)+a.valueAt(c+1);c=c+2+d;if(c>a.length)return!1;this.m_types={};for(d={video:Infinity,audio:Infinity};c<b-4;){var e=a.valueAt(c++),g=((a.valueAt(c)&31)<<8)+a.valueAt(c+1);c+=2;var f=void 0;switch(e){case 15:f="audio";break;case 27:f="video";break;default:f="other"}if("other"==f||g<d[f])"other"!=f&&Infinity>d[f]&&(this.m_types[d[f]]=
-1),this.m_types[g]=e,d[f]=g;e=((a.valueAt(c)&15)<<8)+a.valueAt(c+1);c+=2+e}return!0};M2TSDecoder.prototype._newPESPacketBuffer=function(a,c){var b=new ByteBuffer;b.pts=a;b.dts=c;return b};
M2TSDecoder.prototype.onAVCPacket=function(a,c,b,d){function e(a){for(;a+3<b.length;){if(0==b.valueAt(a)&&0==b.valueAt(a+1)&&1==b.valueAt(a+2))return a;a++}return-1}function g(a){for(a+=2;a<b.length;){var d=b.valueAt(a);if(1<d)a+=3;else if(0==d){if(0==b.valueAt(a-2)&&0==b.valueAt(a-1))return a-2;a++}else if(1==d){if(0==b.valueAt(a-2)&&0==b.valueAt(a-1))return a-2;a+=3}}return-1}for(var f=0,h=e(f);0<=h;){var k=g(h+3);if(0<=k)f=k-h;else if(d)f=b.length-h;else break;this.dispatchAVCNALU(a,c,b,h,f);f=
h+f;h=e(f)}d&&this.dispatchAVCNALUFlush(a,c);return f};M2TSDecoder.prototype.dispatchAVCNALU=function(a,c,b,d,e){this.m_avcDispatcher.dispatchAVCNALU(a,c,b,d,e)};M2TSDecoder.prototype.dispatchAVCNALUFlush=function(a,c){this.m_avcDispatcher.dispatchAVCNALUFlush(a,c)};M2TSDecoder.prototype.onAACPacket=function(a,c,b,d){return this.m_aacDispatcher.dispatchAACPacket(a,c,b)};M2TSDecoder.prototype.onAppendAVCNALU=function(a,c,b){};M2TSDecoder.prototype.onAVCAccessUnitComplete=function(a,c){};
M2TSDecoder.prototype.onAppendAACAccessUnit=function(a,c,b,d){};
M2TSDecoder.basicMakeMP4InitSegment=function(a,c){function b(a,b,d){var f=new e("trak",g),n=new e("tkhd",f,0,7);n.appendUint32Values([0,0,a,0,4294967295,0,0,0,16777216,65536,0,0,0,65536,0,0,0,1073741824]);a=c.length;n.appendUint32Values([0,0]);f=new e("mdia",f);(new e("mdhd",f,0,0)).appendUint32Values([0,0,9E4,4294967295,1438908416]);n=new e("hdlr",f,0,0);"audio"==b?(n.appendUint32Values([0,"soun",0,0,0],!0),n.appendValues("audio track",!0)):"video"==b&&(n.appendUint32Values([0,"vide",0,0,0],!0),
n.appendValues("video track",!0));n.appendValues([0]);f=new e("minf",f);"audio"==b?(new e("smhd",f,0,0)).appendUint32(0):"video"==b&&(new e("vmhd",f,0,1)).appendUint32Values([0,0]);n=new e("dinf",f);n=new e("dref",n,0,0);n.appendUint32(1);new e("url ",n,0,1);f=new e("stbl",f);(new e("stts",f,0,0)).appendUint32(0);(new e("ctts",f,0,0)).appendUint32(0);(new e("stsc",f,0,0)).appendUint32(0);(new e("stsz",f,0,0)).appendUint32Values([0,0]);(new e("stco",f,0,0)).appendUint32(0);f=new e("stsd",f,0,0);f.appendUint32(1,
!0);if("audio"==b){var q=new e("mp4a",f);q.appendUint64(1,!0);q.appendUint32Values([0,0,(d.channels<<16)+16,0,d.sampleRate<<16]);q=new e("esds",q,0,0);q.appendValues([3,23+d.aacConfig.length,0,2,0,4,15+d.aacConfig.length,64,21,255,255,255,0,0,255,255,0,0,255,255,5,d.aacConfig.length],!0);q.appendValues(d.aacConfig,!0);q.appendValues([6,1,2])}else if("video"==b){b=new ByteBuffer.ExpGolombReader(d.sps,32);var p,t,z;b.nextValue();if(100==v||110==v||122==v||144==v)p=q=b.nextValue()||0,3==q&&b.nextBit()&&
(p=0),t=b.nextValue()||0,z=b.nextValue()||0,b.nextBit(),b.nextBit()&&(b.bit+=3!=q?8:12);b.nextValue();v=b.nextValue();if(0==v)b.nextValue();else if(1==v)for(b.nextBit(),b.nextValue(),b.nextValue(),v=b.nextValue()||0,n=0;n<v;n++)b.nextValue();b.nextValue();b.nextBit();var v=16*((b.nextValue()||0)+1),n=(b.nextValue()||0)+1,B=b.nextBit(),n=n*(B?16:8);0==B&&b.nextBit();b.nextBit();if(b.nextBit()){var w=b.nextValue()||0,C=b.nextValue()||0,x=b.nextValue()||0;b=b.nextValue()||0;var u=1,A=1;1==p?u=A=2:2==
p&&(u=2);B&&(A*=2);v-=(w+C)*u;n-=(x+b)*A}c.setUint32ValueAt(65536*v,a);c.setUint32ValueAt(65536*n,a+4);p=new e("avc1",f);p.appendUint64(1,!0);p.appendUint32Values([0,0,0,0],!0);p.appendUint16(v,!0);p.appendUint16(n,!0);p.appendUint32Values([4718592,4718592,0],!0);p.appendUint16(1,!0);p.appendUint32Values([0,0,0,0,0,0,0,0,1638399]);p=new e("avcC",p);var v=d.sps.valueAt(1);p.appendValues([1,v,d.sps.valueAt(2),d.sps.valueAt(3)],!0);p.appendValues([255,225],!0);p.appendUint16(d.sps.length,!0);p.append(d.sps,
!0);p.appendValues([1],!0);p.appendUint16(d.pps.length,!0);p.append(d.pps);if(100==v||110==v||122==v||144==v)p.appendValues([252+(q&3),248+(t&7),248+(z&7)],!0),d.spsExtension?(p.appendValues([1],!0),p.appendUint16(d.spsExtension.length,!0),p.append(d.spsExtension)):p.appendValues([0])}}function d(a){(new e("trex",f,0,0)).appendUint32Values([a,1,1,0,0])}var e=ByteBuffer.MP4Box;(new e("ftyp",c)).appendUint32Values(["iso6",0,"isom","iso6","msdh"]);var g=new e("moov",c);(new e("mvhd",g,0,0)).appendUint32Values([0,
0,9E4,4294967295,65536,16777216,0,0,65536,0,0,0,65536,0,0,0,1073741824,0,0,0,0,0,0,4294967295]);a.video&&b(1,"video",a.video);a.audio&&b(2,"audio",a.audio);var f=new e("mvex",g);a.video&&d(1);a.audio&&d(2)};
(function(){function a(a){this.m_buffer=new ByteBuffer;this.m_packetID=a;this.m_lastContinuity=-1}function c(a){this.m_owner=a;this.m_dts=this.m_pts=-1;this.m_vcl=this.m_accessUnitStarted=!1;this.pps=this.sps=void 0;this.seenKeyFrame=this.keyFrame=!1}function b(a){this.m_owner=a;this.m_nextTimestamp=this.m_timestamp=-1;this.m_remainder=!1;this.aacConfig=void 0;this.profile=64;this.channels=this.sampleRate=this.type=void 0}function d(a){this.trackID=a;this.mediaData=new ByteBuffer;this.accessUnitStart=
0;this.accessUnits=[];this.m_trunOffsetField=void 0}function e(a){M2TSDecoder.call(this);this.m_videoBuilder=new M2TSDecoder.TRAFBuilder(1);this.m_audioBuilder=new M2TSDecoder.TRAFBuilder(2);this.m_nextSegmentNumber=1;this.m_sentInitSegment=!1;this.m_iframesOnly=!!a}function g(){M2TSDecoder.M2TSToMP4.call(this)}function f(a,b,d){for(var c=0;0<d--;)c*=128,c+=a[b]&127,b++;return c}function h(a,b,d,c){if(b+c>a.length||c>d.length)return!1;for(var e=0;e<c;e++)if(a[b+e]!=d[e])return!1;return!0}a.prototype.appendBytes=
function(a,b,d,c,e,g){if(this.m_lastContinuity!=d||b||c){if(b)this.onPacketComplete(e);else{if(0>this.m_lastContinuity)return;if((this.m_lastContinuity+1&15)!=d&&!c){this.m_buffer.length=0;this.m_lastContinuity=-1;return}}0<a.length&&this.m_buffer.append(a);this.m_lastContinuity=d;0<a.length&&1<this.m_buffer.length&&g(this.m_packetID,this.m_buffer)&&(this.m_buffer.length=0,this.m_lastContinuity=-1)}};a.prototype.onPacketComplete=function(a){1<this.m_buffer.length&&a(this.m_packetID,this.m_buffer);
this.m_buffer.length=0};M2TSDecoder.prototype.PacketStream=a;c.prototype.setAVCPPS=function(a,b,d){this.pps=a.slice(b,b+d)};c.prototype.setAVCSPS=function(a,b,d){this.sps=a.slice(b,b+d)};c.prototype.onAppendAVCNALU=function(a,b,d){this.m_owner.onAppendAVCNALU(a,b,d)};c.prototype.onAVCAccessUnitComplete=function(a,b){this.m_owner.onAVCAccessUnitComplete(a,b)};c.prototype.dispatchAVCNALUFlush=function(a,b){this.m_accessUnitStarted=this.m_vcl=!1;this.onAVCAccessUnitComplete(a,b)};c.prototype.dispatchAVCNALU=
function(a,b,d,c,e){c+=3;e-=3;var g=d.valueAt(c)&31;switch(g){case 6:case 7:case 8:case 9:case 13:case 14:case 15:case 16:case 17:case 18:this.m_vcl&&this.dispatchAVCNALUFlush(this.m_pts,this.m_dts);this.m_accessUnitStarted||(this.m_accessUnitStarted=!0,this.m_pts=a,this.m_dts=b);break;case 1:case 2:case 3:case 4:case 5:this.m_accessUnitStarted||(this.m_accessUnitStarted=!0,this.m_pts=a,this.m_dts=b),this.m_vcl=!0}switch(g){case 7:this.setAVCSPS(d,c,e);break;case 8:this.setAVCPPS(d,c,e);break;case 6:this.onAppendAVCNALU(d,
c,e);break;case 9:switch(d.valueAt(c+1)>>5&7){case 0:case 3:case 5:this.keyFrame=!0;break;default:this.keyFrame=!1;break}default:5==g?this.seenKeyFrame=this.keyFrame=!0:1==g&&(this.keyFrame=!1),this.onAppendAVCNALU(d,c,e)}};M2TSDecoder.AVCDispatcher=c;var k=[96E3,88200,64E3,48E3,44100,32E3,24E3,22050,16E3,12E3,11025,8E3,7350];b.prototype.dispatchAACPacket=function(a,b,d){a=0;var c=d.length;0<=b&&(0>this.m_timestamp||!this.m_remainder?(this.m_timestamp=b,this.m_nextTimestamp=-1):this.m_nextTimestamp=
b);if(0==c)return a;for(;a<c;){var e=c-a;if(7>e)break;if(255!=d.valueAt(a)||240!=(d.valueAt(a+1)&240))a++;else if(b=(d.valueAt(a+3)&3)<<11,b+=d.valueAt(a+4)<<3,b+=d.valueAt(a+5)>>5&7,7>b)a++;else{if(b>e)break;var e=d.valueAt(a+2)>>6&3,g=((d.valueAt(a+2)&1)<<2)+(d.valueAt(a+3)>>6&3),f=d.valueAt(a+2)>>2&15,h=k[f];if(void 0!=h&&3>e){var l=9216E4/h;0<=this.m_timestamp&&(this.aacConfig=[(e+1<<3&248)+(f>>1&7),(f<<7&128)+(g<<3&120)],this.sampleRate=h,0<g&&(this.channels=g),this.type=e+1,this.m_owner.onAppendAACAccessUnit(Math.round(this.m_timestamp),
d,a+7,b-7));0<=this.m_nextTimestamp?(this.m_timestamp=this.m_nextTimestamp,this.m_nextTimestamp=-1):this.m_timestamp+=l}a+=b}}this.m_remainder=a<c;return a};M2TSDecoder.ADTSAACDispatcher=b;d.prototype.shift=function(){this.mediaData.shift(this.accessUnitStart);this.accessUnitStart=0;this.accessUnits=[]};d.prototype.clear=function(){this.mediaData.length=0;this.shift()};d.prototype.appendSampleData=function(a,b,d,c){c&&this.mediaData.setUint32ValueAt(d,this.mediaData.length);this.mediaData.append(a.buffer.subarray(b,
b+d))};d.prototype.accessUnitComplete=function(a,b){this.accessUnits.push({timestamp:b,compositionTimeOffset:a-b,length:this.mediaData.length-this.accessUnitStart});this.accessUnitStart=this.mediaData.length;var d=this.accessUnits.length-1;0<d&&(this.accessUnits[d-1].duration=this.accessUnits[d].timestamp-this.accessUnits[d-1].timestamp)};d.prototype.appendTRAFBoxToMOOF=function(a){var b=ByteBuffer.MP4Box;a=new b("traf",a);(new b("tfhd",a,0,131072)).appendUint32(this.trackID);0<this.accessUnits.length&&
(new b("tfdt",a,1,0)).appendUint64(this.accessUnits[0].timestamp);b=new b("trun",a,1,2817);b.appendUint32(this.accessUnits.length,!0);this.m_trunOffsetField=b.buffer.length;b.appendUint32(0,!0);for(var d=a=0;d<this.accessUnits.length;d++){var c=this.accessUnits[d],e=c.duration;a=void 0!=e?e:a;b.appendUint32(a,!0);b.appendUint32(c.length,!0);c=c.compositionTimeOffset;c=Math.min(2147483647,c);c=Math.max(-2147483648,c);0>c&&(c=4294967295+(c+1));b.appendUint32(c,!0)}b.updateLengths()};d.prototype.appendAccessUnitsToMDAT=
function(a,b){a.buffer.setUint32ValueAt(a.buffer.length-b.start,this.m_trunOffsetField);a.append(this.mediaData.buffer.subarray(0,this.accessUnitStart))};M2TSDecoder.TRAFBuilder=d;e.prototype=Object.create(M2TSDecoder.prototype);e.prototype.constructor=e;e.prototype.videoEnabled=!0;e.prototype.audioEnabled=!0;e.prototype.hasVideo=!1;e.prototype.hasAudio=!1;e.prototype.makeMP4InitSegment=function(a,b,d){var c={};d=d||new ByteBuffer;a&&this.m_avcDispatcher&&this.m_avcDispatcher.sps&&this.m_avcDispatcher.pps&&
(c.video={sps:this.m_avcDispatcher.sps,pps:this.m_avcDispatcher.pps});b&&this.m_aacDispatcher&&this.m_aacDispatcher.aacConfig&&(c.audio={sampleRate:this.m_aacDispatcher.sampleRate,channels:this.m_aacDispatcher.channels,aacConfig:this.m_aacDispatcher.aacConfig,mp4aProfile:this.m_aacDispatcher.profile,mp4aType:this.m_aacDispatcher.type});M2TSDecoder.basicMakeMP4InitSegment(c,d);return d};e.prototype.convertSegment=function(a){var b=ByteBuffer.MP4Box,d=new ByteBuffer;this.appendBytes(a);this.m_iframesOnly&&
this.flush();if(!this.m_sentInitSegment){if(!this.hasVideo&&!this.hasAudio)return;this.makeMP4InitSegment(this.videoEnabled,this.audioEnabled,d);if(0==d.length)return;this.m_sentInitSegment=!0;if(0==this.m_videoBuilder.accessUnits.length&&0==this.m_audioBuilder.accessUnits.length)return d.buffer.subarray(0,d.length)}this.m_iframesOnly&&this.m_videoBuilder.accessUnits.length&&(this.m_videoBuilder.accessUnits=[this.m_videoBuilder.accessUnits[0]],this.m_videoBuilder.accessUnits[0].duration=9E3);a=new b("moof",
d);(new b("mfhd",a,0,0)).appendUint32(this.m_nextSegmentNumber++);this.videoEnabled&&this.hasVideo&&this.m_videoBuilder.appendTRAFBoxToMOOF(a);this.audioEnabled&&this.hasAudio&&this.m_audioBuilder.appendTRAFBoxToMOOF(a);b=new b("mdat",d);this.videoEnabled&&this.hasVideo&&this.m_videoBuilder.appendAccessUnitsToMDAT(b,a);this.audioEnabled&&this.hasAudio&&this.m_audioBuilder.appendAccessUnitsToMDAT(b,a);this.m_videoBuilder.shift();this.m_audioBuilder.shift();return d.buffer.subarray(0,d.length)};e.prototype.onAppendAVCNALU=
function(a,b,d){this.videoEnabled&&this.m_videoBuilder.appendSampleData(a,b,d,!0);this.hasVideo=!0};e.prototype.onAVCAccessUnitComplete=function(a,b){this.m_avcDispatcher.seenKeyFrame?this.videoEnabled&&this.m_videoBuilder.accessUnitComplete(a,b):this.m_videoBuilder.clear()};e.prototype.onAppendAACAccessUnit=function(a,b,d,c){this.audioEnabled&&(this.m_audioBuilder.appendSampleData(b,d,c),this.m_audioBuilder.accessUnitComplete(a,a));this.hasAudio=!0};M2TSDecoder.M2TSToMP4=e;g.prototype=Object.create(M2TSDecoder.M2TSToMP4.prototype);
g.prototype.constructor=g;g.prototype.videoEnabled=!1;g.prototype.ID3_HEADER_LENGTH=10;g.prototype.ID3_FOOTER_LENGTH=10;g.prototype.ID3_FRAME_HEADER_LENGTH=10;var l=new Uint8Array([80,82,73,86]),m=new Uint8Array([99,111,109,46,97,112,112,108,101,46,115,116,114,101,97,109,105,110,103,46,116,114,97,110,115,112,111,114,116,83,116,114,101,97,109,84,105,109,101,115,116,97,109,112,0]);g.prototype.appendBytes=function(a){a=new Uint8Array(a);var b=a.length,d=-1;if(!(a.length<this.ID3_HEADER_LENGTH)&&73==
a[0]&&68==a[1]&&51==a[2]){var c=f(a,6,4)+this.ID3_HEADER_LENGTH,e=c+(a[5]&16?this.ID3_FOOTER_LENGTH:0);if(!(b<e)){var g=this.ID3_HEADER_LENGTH,k;if(a[5]&64){if(6>c-g)return;k=f(a,g,4);g+=k;if(g>c)return}for(;g+this.ID3_FRAME_HEADER_LENGTH<c;){var w=f(a,g+4,4);k=g+this.ID3_FRAME_HEADER_LENGTH+w;if(k>c)return;if(w==m.length+8&&h(a,g,l,l.length)&&h(a,g+this.ID3_FRAME_HEADER_LENGTH,m,m.length)){g+=this.ID3_FRAME_HEADER_LENGTH+m.length;if(g+8>c)return;d=g;g=8;for(w=0;0<g--;)w*=256,w+=a[d],d++;d=w}g=k}0>
d?StreamEngine.verbose&&console.log("ADTSToMP4.appendBytes: timestamp ID3 tag not found"):(this.m_buffer.length=0,this.m_buffer.append(a.subarray(e,b)),this.onAACPacket(d,d,this.m_buffer,!0))}}};M2TSDecoder.ADTSToMP4=g})();function HLSStreamSource(a){HTTPStreamSource.call(this);if("string"!=typeof a)throw new TypeError("URL is not a string");this.m_url=a;this.m_seekTarget=void 0;this.m_masterM3U8=new this.M3U8(this.m_url);this.m_masterM3U8.onloadend=this.onInitialLoadEnd.bind(this);this.m_mediaM3U8s={};this.m_lastMediaM3U8=void 0;this.m_selectedM3U8s=[];this.m_selectedVariant=void 0;this.m_segmentTargets={0:0};this.m_nextSegmentTargets={};this.m_discontinuitySequences={};this.m_segmentDurationCache={};this.m_segmentTransferAccumulator=
0;this.m_initSegmentXHRCache={};this.m_ready=this.error=!1;this.rateManager=new DefaultDynamicRateManager;this.m_rate=0;this.m_converters={};this.m_savedMark=void 0;this.m_savedBuffers={};this.m_decryptedBuffers={};this.m_cryptoKeys={};this.m_cryptoInfoForChannelCache={};this.stopped=this.ended=!1;this.iframesOnlyRate=void 0;this.m_fullSplice=!1;this.onmanifestloaded=function(a){StreamEngine.verbose&&console.log("HLSStreamSource master M3U8 loaded: "+(a.ready?"ready":a.error?"error":"unknown"))}}
HLSStreamSource.prototype=Object.create(HTTPStreamSource.prototype);HLSStreamSource.prototype.constructor=HLSStreamSource;
Object.defineProperties(HLSStreamSource.prototype,{ready:{get:function(){return!this.error&&this.m_ready},enumerable:!0},iframesOnlyAvailable:{get:function(){return this.ready&&0<this.m_masterM3U8.iframeVariants.length},enumerable:!0},earliestSeekableTime:{get:function(){if(this._preferredM3U8())return this._preferredM3U8().getEarliestSeekableTime()},enumerable:!0},latestSeekableTime:{get:function(){if(this._preferredM3U8())return this._preferredM3U8().getLatestSeekableTime()},enumerable:!0},isLive:{get:function(){if(this._preferredM3U8())return this._preferredM3U8().live},
enumerable:!0},rate:{get:function(){return this.m_rate},set:function(a){a!=this.m_rate&&(this.spliceNeeded=!0,this.m_rate=a)},enumerable:!0},videoEnabled:{get:function(){return this.m_videoEnabled},set:function(a){this.scheduleSplice(a,this.m_videoEnabled,!0);this.m_videoEnabled=a},enumerable:!0},audioEnabled:{get:function(){return this.m_audioEnabled},set:function(a){this.scheduleSplice(a,this.m_audioEnabled,!0);this.m_audioEnabled=a},enumerable:!0},lang:{get:function(){return this.m_lang},set:function(a){this.scheduleSplice(a,
this.m_lang);this.m_lang=a},enumerable:!0},textEnabled:{get:function(){return this.m_textEnabled},set:function(a){this.scheduleSplice(a,this.m_textEnabled,!0);this.m_textEnabled=a},enumerable:!0},textLang:{get:function(){return this.m_textLang},set:function(a){this.scheduleSplice(a,this.m_textLang);this.m_textLang=a},enumerable:!0},videoAlternativeName:{get:function(){return this.m_videoAlternativeName},set:function(a){this.scheduleSplice(a,this.m_videoAlternativeName);this.m_videoAlternativeName=
a},enumerable:!0},audioAlternativeName:{get:function(){return this.m_audioAlternativeName},set:function(a){this.scheduleSplice(a,this.m_audioAlternativeName);this.m_audioAlternativeName=a},enumerable:!0},textAlternativeName:{get:function(){return this.m_textAlternativeName},set:function(a){this.scheduleSplice(a,this.m_textAlternativeName);this.m_textAlternativeName=a},enumerable:!0},langs:{get:function(){return this.m_masterM3U8.languages.slice()},enumerable:!0},textLangs:{get:function(){return this.m_masterM3U8.subtitlesLanguages.slice()},
enumerable:!0},videoAlternativeNames:{get:function(){return this.getAlternativeNames("video")},enumerable:!0},audioAlternativeNames:{get:function(){return this.getAlternativeNames("audio")},enumerable:!0},textAlternativeNames:{get:function(){return this.getAlternativeNames("subtitles")},enumerable:!0}});HLSStreamSource.prototype.m_videoEnabled=!0;HLSStreamSource.prototype.m_audioEnabled=!0;HLSStreamSource.prototype.m_textEnabled=!1;HLSStreamSource.prototype.m_lang=void 0;
HLSStreamSource.prototype.m_textLang=void 0;HLSStreamSource.prototype.m_videoAlternativeName=void 0;HLSStreamSource.prototype.m_audioAlternativeName=void 0;HLSStreamSource.prototype.m_textAlternativeName=void 0;HLSStreamSource.prototype.preciseSeek=!0;HLSStreamSource.prototype.autoRateSwitch=!0;HLSStreamSource.prototype.overlapSplice=!1;HLSStreamSource.prototype.m_segmentFPFudge=.05;HLSStreamSource.prototype.resetOnMark=!1;HLSStreamSource.prototype._streamTimeIsTimestamp=!1;
HLSStreamSource.prototype.getAlternativeNames=function(a){return this.ready?this.m_masterM3U8.alternateNames[a]?Object.keys(this.m_masterM3U8.alternateNames[a]):[]:[]};HLSStreamSource.prototype.scheduleSplice=function(a,c,b){a!=c&&(this.spliceNeeded=!0,this.m_fullSplice=this.fullSplice||b)};HLSStreamSource.prototype.toString=function(){return"HLSStreamSource ("+this.m_url+")"};
HLSStreamSource.prototype.seek=function(a){this.m_converters={};this.m_savedMark=void 0;this.m_savedBuffers={};this.m_decryptedBuffers={};HTTPStreamSource.prototype.seek.call(this,a)};
HLSStreamSource.prototype.getAndCacheKeyInfo=function(a){var c;if(!a.identity)return{error:!0};a=a.identity;if(0>["NONE","AES-128"].indexOf(a.METHOD))return{error:!0};c=""+a.METHOD+";"+a.KEYFORMAT+";"+a.URI;if(this.m_cryptoKeys[c])return c=Object.create(this.m_cryptoKeys[c]),c.iv=a.IV,c;var b={method:a.METHOD,keyformat:a.KEYFORMAT,ready:!1,error:!1};if("AES-128"==a.METHOD){if(!a.URI)return{error:!0};var d=new XMLHttpRequest;d.open("GET",a.URI);d.responseType="arraybuffer";d.onloadend=function(){2!=
Math.floor(d.status/100)||!d.response||16>d.response.byteLength?b.error=!0:window.crypto.subtle.importKey("raw",(new Uint8Array(d.response)).subarray(0,16),{name:"AES-CBC",length:128},!1,["decrypt"]).then(function(a){b.key=a;b.ready=!0}).catch(function(){b.error=!0})};d.send()}else"NONE"==a.METHOD&&(b.ready=!0);this.m_cryptoKeys[c]=b;c=Object.create(b);c.iv=a.IV;return c};
HLSStreamSource.prototype.decryptProcessStreamTimeslice=function(a,c,b,d){function e(a){g=a}var g,f=this.m_decryptedBuffers[a];if(f){if(f.buffer)return c(f.buffer),delete this.m_decryptedBuffers[a],f.status}else{d=HTTPStreamSource.prototype.processStreamTimeslice.call(this,a,e,b,d)||StreamStatus.Continue();if(g){b=this.m_cryptoInfoForChannelCache[a];if(!b)return StreamStatus.Ended("decode");if("NONE"==b.keyInfo.method)c(g);else{if("AES-128"==b.keyInfo.method){f={status:d};this.m_decryptedBuffers[a]=
f;a=b.keyInfo.iv;a||(a=new Uint8Array(16),a[15]=b.sequence&255,a[14]=b.sequence/256&255,a[13]=b.sequence/65536&255,a[12]=b.sequence/16777216&255,a[11]=b.sequence/4294967296&255,a[10]=b.sequence/1099511627776&255,a[9]=b.sequence/281474976710656&255,a[8]=b.sequence/72057594037927936&255);window.crypto.subtle.decrypt({name:"AES-CBC",iv:a},b.keyInfo.key,g).then(function(a){f.buffer=a}).catch(function(){f.status=StreamStatus.Ended("decode");f.buffer=new Uint8Array(0)});return}return StreamStatus.Ended("decode")}}return d}};
HLSStreamSource.prototype.processStreamTimeslice=function(a,c,b,d){function e(a){g=a}var g;if(this.m_savedMark){if(0!=a)return;a=this.m_savedMark;c=!1;var f=a.config.types;d=void 0!=a.offset?a.offset:d;for(var h=0;h<f.length;h++){var k=f[h];if(!(0>k.indexOf("unknown/unknown")||this.m_savedBuffers[h])){g=void 0;b=this.decryptProcessStreamTimeslice(h,e,!1,d)||StreamStatus.Continue();if(StreamStatusKind.KIND_MARK==b.kind){this.m_converters={};this.m_savedMark=b;this.m_savedBuffers={};this.m_decryptedBuffers=
{};return}g?(f[h]=k=k.replace("unknown/unknown",this._determineMediaType(g)),this.m_savedBuffers[h]={status:b,appendBuf:g},0<=k.indexOf("mp2t")?(b=new M2TSDecoder.M2TSToMP4(this.m_selectedM3U8s[h].iframesOnly),this.m_converters[h]=b,b.audioEnabled=this.audioEnabled&&this.m_mediaM3U8s.audio&&this.m_mediaM3U8s.audio.channel==h,b.videoEnabled=this.videoEnabled&&this.m_mediaM3U8s.video&&this.m_mediaM3U8s.video.channel==h,f[h]=k=k.replace("mp2t","mp4")):0<=k.indexOf("audio/adts")&&(b=new M2TSDecoder.ADTSToMP4,
this.m_converters[h]=b,f[h]=k='audio/mp4; codecs="mp4a.40.2"')):StreamStatusKind.KIND_SYNC==b.kind||StreamStatusKind.KIND_ENDED==b.kind?(f[h]=k.replace("unknown/unknown","video/mp4"),this.m_savedBuffers[h]={status:b,appendBuf:g}):c=!0}}if(c)return;this.m_savedMark=void 0;return a}this.m_savedBuffers[a]?(b=this.m_savedBuffers[a].status,g=this.m_savedBuffers[a].appendBuf,delete this.m_savedBuffers[a]):b=this.decryptProcessStreamTimeslice(a,e,b,d);if(b&&StreamStatusKind.KIND_MARK==b.kind)this.m_savedMark=
b;else return g&&this.m_converters[a]&&(g=this.m_converters[a].convertSegment(g)),g&&c(g),b};
HLSStreamSource.prototype._determineMediaType=function(a){a=new Uint8Array(a);return 8<=a.length&&102==a[4]&&116==a[5]&&121==a[6]&&112==a[7]?"video/mp4":376<=a.length&&71==a[0]&&71==a[188]?"video/mp2t":6<=a.length&&87==a[0]&&69==a[1]&&66==a[2]&&86==a[3]&&84==a[4]&&84==a[5]?"text/vtt":9<=a.length&&239==a[0]&&187==a[1]&&191==a[2]&&87==a[3]&&69==a[4]&&66==a[5]&&86==a[6]&&84==a[7]&&84==a[8]?"text/vtt":10<=a.length&&73==a[0]&&68==a[1]&&51==a[2]?"audio/adts":"video/mp2t"};
HLSStreamSource.prototype._preferredM3U8=function(){return this.m_mediaM3U8s.video||this.m_mediaM3U8s.audio||this.m_lastMediaM3U8};
HLSStreamSource.prototype.makeMarkStatus=function(){var a,c={reset:this.resetOnMark},b=this.spliceNeeded&&!this.m_fullSplice&&this.preciseSeek&&this.overlapSplice;if(this.ready&&this.m_lastMediaM3U8&&(void 0!=this.leastBufferedThroughAtSync&&this.spliceNeeded?a=Math.max(this.m_segmentTargets[0],this.leastBufferedThroughAtSync):(a=this.m_seekTarget,b=!1),a=this.getSeekableTime(a),isFinite(a))){this.rateManager.setRates(0,this.m_masterM3U8.variants.map(function(a){return a.bandwidth}));var d=this.loadMediaPlaylists();
if(d&&d.ready&&d.types&&0!=this.m_selectedM3U8s.length){c.types=d.types;var e=this.m_selectedM3U8s[0],g=e.getMediaTime(a);if(g){b=b&&!this.m_masterM3U8.independentSegments&&!e.independentSegments;this.preciseSeek||(a=g.offset);e.iframesOnly&&(a=g.offset,this.stopAt(a+g.duration-this.m_segmentFPFudge));this.m_segmentTargets={0:0};this.m_nextSegmentTargets={};this.m_discontinuitySequences={};for(e=0;e<this.m_selectedM3U8s.length;e++){var f=this.m_selectedM3U8s[e],h=a,h=Math.max(h,f.getEarliestSeekableTime()),
h=Math.min(h,f.getLatestSeekableTime()),h=f.getMediaTime(h);b&&(h=f.getMediaSequence(h.sequence-1)||h);this.m_segmentTargets[e]=h.offset;this.m_nextSegmentTargets[e]=h.offset+h.duration+this.m_segmentFPFudge;this.m_discontinuitySequences[e]=h.discontinuitySequence}this.leastBufferedThroughAtSync=void 0;this.m_selectedVariant=d.variant;this.autoRateSwitch&&(this.m_rate=this.m_selectedVariant.bandwidth);e=g.timestamp;void 0==e&&this._streamTimeIsTimestamp&&(e=g.offset);b&&(e="continue");this.m_fullSplice=
!1;return StreamStatus.Mark({target:a,rate:d.rate,streamSource:this,channels:{video:this.m_mediaM3U8s.video&&this.m_mediaM3U8s.video.channel,audio:this.m_mediaM3U8s.audio&&this.m_mediaM3U8s.audio.channel,text:this.m_mediaM3U8s.subtitles&&this.m_mediaM3U8s.subtitles.channel}},c,a,a-g.offset,this.stopTarget,e)}}}};HLSStreamSource.prototype.moveToSeekPosition=function(a){this.m_seekTarget=a;this.stopped=this.ended=!1};HLSStreamSource.prototype.moveToNextSegment=function(a){this.m_segmentTargets[a]=this.m_nextSegmentTargets[a]};
HLSStreamSource.prototype.segmentStatus=function(a){var c=this.m_segmentTargets[a],b=this.m_selectedM3U8s[a],d=b.getMediaTime(c);this.refreshMediaPlaylists();if(!d){if(c<b.getEarliestSeekableTime())return this.m_seekTarget=c,this.SEGSTATUS_MARK_NEEDED;if(b.live)return this.SEGSTATUS_WAIT;this.ended=!0;return this.SEGSTATUS_ENDED}if(d.offset>=this.stopTarget)return this.stopped=!0,this.SEGSTATUS_ENDED;if(d.discontinuitySequence!=this.m_discontinuitySequences[a])return this.m_fullSplice=this.spliceNeeded=
!0,this.SEGSTATUS_MARK_NEEDED;if(this.spliceNeeded&&c>=this.m_segmentTargets[0])return this.SEGSTATUS_MARK_NEEDED;c=this.getAndCacheKeyInfo(d.keys);if(c.error)return this.errorType="decode",this.SEGSTATUS_ENDED;if(!c.ready)return this.SEGSTATUS_WAIT;this.m_cryptoInfoForChannelCache[a]={keyInfo:c,sequence:d.sequence};return this.SEGSTATUS_READY};
HLSStreamSource.prototype.xhrForCurrentSegmentURL=function(a,c,b,d){var e,g=(d||"-")+"|"+b;if(c&&(e=this.m_initSegmentXHRCache[g])){if(e.DONE==e.readyState&&2==Math.floor(e.status/100))return e;delete this.m_initSegmentXHRCache[g]}e=HTTPStreamSource.prototype.xhrForCurrentSegmentURL.call(this,a,c,b,d);c&&e&&(this.m_initSegmentXHRCache[g]=e);return e};
HLSStreamSource.prototype.urlForCurrentSegment=function(a,c){var b=this.m_selectedM3U8s[a].getMediaTime(this.m_segmentTargets[a]);if(b){if(c)return b.initSegment;this.m_segmentDurationCache[a]=b.duration;this.m_nextSegmentTargets[a]=b.offset+b.duration+this.m_segmentFPFudge;0==a&&(this.m_segmentTransferAccumulator=0);return b.url}};HLSStreamSource.prototype.hasSeparateInitSegment=function(a){if(a=this.m_selectedM3U8s[a].getMediaTime(this.m_segmentTargets[a]))return!!a.initSegment};
HLSStreamSource.prototype.onLoadMeasurement=function(a,c,b,d,e){if(!this.iframesOnlyRate)if(0!=a)this.m_segmentTransferAccumulator+=c;else{a=this.m_segmentDurationCache[a];var g=8*(c+this.m_segmentTransferAccumulator);c=g/e*2;if(a&&this.m_selectedVariant){d=Math.max(d,.001);e=Math.max(e,b+d);var f=g/a;b=b<a?g/d*((a-b)/a):g/e;b=Math.min(b,c);this.rateManager.onMeasurement(0,b,f,this.m_selectedVariant.bandwidth);b=this.autoRateSwitch?this.rateManager.recommendedRate(0):this.rate;b=this.getVariantForBandwidth(b);
b!=this.m_selectedVariant&&(StreamEngine.verbose&&console.log("splice needed for bandwidth change",this.m_selectedVariant.bandwidth," --\x3e ",b.bandwidth),this.spliceNeeded=!0)}}};
HLSStreamSource.prototype.getSeekableTime=function(a,c){"start"==a&&(a=this.isLive?"live":0);var b=this._preferredM3U8();if("live"==a)if(b)a=b.getLatestSeekableTime()-(b.targetDuration+1),b.live&&(a+=Math.max(b.m3u8Age+((new Date).getTime()/1E3-b.retrieved)-2,0),a=Math.min(a,b.getLatestSeekableTime()-1));else return;isFinite(a)||(a=0);this.isLive||(a=Math.min(a,this.latestSeekableTime));a=Math.max(a,this.earliestSeekableTime);c&&b&&(b=b.getMediaTime(a))&&(a=b.offset);return a};
HLSStreamSource.prototype._callOnmanifestloaded=function(){if(this.onmanifestloaded)try{this.onmanifestloaded(this)}catch(a){console.log("HLSStreamSource.onmanifestloaded: error "+a)}};HLSStreamSource.prototype.onInitialLoadEnd=function(){this.m_masterM3U8.ready&&this.m_masterM3U8.isMaster?(0==this.m_rate&&0<this.m_masterM3U8.variants.length&&(this.m_rate=this.m_masterM3U8.variants[0].bandwidth||0),this.loadMediaPlaylists()):(this.error=!0,this._callOnmanifestloaded())};
HLSStreamSource.prototype.getVariantForBandwidth=function(a){var c=void 0;0<this.iframesOnlyRate&&0<this.m_masterM3U8.iframeVariants.length&&(c=this.m_masterM3U8.iframeVariants,a/=this.iframesOnlyRate);return this.m_masterM3U8.getVariantForBandwidth(a,c)};
HLSStreamSource.prototype.loadMediaPlaylists=function(){function a(a,f,h,k){h=b.m_masterM3U8.getBestPlaylist(c,a,h,k);"audio"==a&&b.m_mediaM3U8s.video&&h==b.m_mediaM3U8s.video.url?f?(void 0!=d&&c.codecs&&(d[0]='unknown/unknown; codecs="'+c.codecs+'"'),b.m_mediaM3U8s.audio=b.m_mediaM3U8s.video):b.m_mediaM3U8s[a]=void 0:f&&h?(f=b.m_mediaM3U8s[a],f&&f.url==h||(f=new b.M3U8(h),f.type=a,b.m_mediaM3U8s[a]=f,f.onloadend=function(a){var d=b.ready;StreamEngine.verbose&&console.log("loaded M3U8 for",a.type,
a.error?"error":"ok",a.url);b.error=b.error||a.error;b.m_ready=b.m_ready||a.ready;a.ready&&b.ready&&b.m_lastMediaM3U8&&a.alignWithVariant(b.m_lastMediaM3U8);!b.error&&b.ready&&"subtitles"!=a.type&&(!b.m_lastMediaM3U8&&b.m_mediaM3U8s.subtitles&&b.m_mediaM3U8s.subtitles.ready&&b.m_mediaM3U8s.subtitles.alignWithVariant(a),b.m_lastMediaM3U8=a,d||b._callOnmanifestloaded())}),h="unknown/unknown","subtitles"==a?h="text/vtt":c.codecsByType[a]&&(h+='; codecs="'+c.codecsByType[a]+'"'),void 0!=d&&d.push(h),
f.channel=b.m_selectedM3U8s.length,b.m_selectedM3U8s.push(f),e=e&&f.ready):b.m_mediaM3U8s[a]=void 0}var c=this.getVariantForBandwidth(this.autoRateSwitch?this.rateManager.recommendedRate(0):this.rate),b=this,d=[],e=!0;if(c)return this.m_selectedM3U8s=[],a("video",this.videoEnabled,this.videoAlternativeName,this.lang),a("audio",this.audioEnabled,this.audioAlternativeName,this.lang),a("subtitles",this.textEnabled,this.textAlternativeName,this.textLang),{types:d,rate:c.bandwidth,ready:e,variant:c}};
HLSStreamSource.prototype.refreshMediaPlaylists=function(){var a=(new Date).getTime()/1E3,c;for(c in this.m_mediaM3U8s){var b=this.m_mediaM3U8s[c];if(b&&b.ready&&b.live&&!b.reloading&&a+b.m3u8Age-b.retrieved>Math.max(b.targetDuration,1)&&(!b.unchangedAfterReload||a-b.retrieved>Math.max(b.targetDuration/2,1))){var d=new this.M3U8(b.url);d.type=c;d.channel=b.channel;d.onloadend=function(a,b){a.reloading=!1;this.error=this.error||b.error;b.ready&&this.m_mediaM3U8s[b.type]==a&&(b.alignWithVariant(a),
this.m_mediaM3U8s[b.type]=b,this.m_selectedM3U8s[b.channel]=b,"subtitles"!=b.type&&(!this.m_lastMediaM3U8||b.retrieved>this.m_lastMediaM3U8)&&(this.m_lastMediaM3U8=b),StreamEngine.verbose&&console.log("reloaded M3U8 for",b.type,b.url),b.unchangedAfterReload&&StreamEngine.verbose&&console.log("M3U8 unchanged after reload"))}.bind(this,b);b.reloading=!0}}};
(function(){function a(a){this.url=(new URL(a,window.document.URL)).toString();this.m_xhr=new XMLHttpRequest;this.m_xhr.open("GET",this.url);this.m_xhr.responseType="text";this.m_xhr.onloadend=this.onM3U8LoadEnd.bind(this);this.m_xhr.send();this.m_baseOffset=this.m_baseMediaSequence=0;this.m_hasPDT=!1;this.retrieved=void 0;this.m_media=[];this.variants=[];this.iframeVariants=[];this.m_allIframeVariants=[];this.m_allVariants=[];this.m_alternatives={};this.alternateNames={};this.languages=[];this.subtitlesLanguages=
[];this.ready=this.error=!1;this.isMaster=this.independentSegments=this.live=void 0;this.iframesOnly=!1;this.onloadend=void 0}function c(a){a=a.split('"');for(var b=!1,c=[],f="",h=0;h<a.length;h++){var k=a[h];if(b)f=f+'"'+k+'"';else for(var k=k.split(","),l=!0,m=0;m<k.length;m++){var n=k[m];l||(c.push(f),f="");n=n.trimLeft();f+=n;l=!1}b=!b}c.push(f);return c}function b(a){for(var b={},c=0;c<a.length;c++){var f=a[c],h=f.indexOf("="),k;0>h?(k=f,f=!0):(k=f.slice(0,h),f=f.slice(h+1),'"'==f[0]&&(f=f.slice(1)),
'"'==f[f.length-1]&&(f=f.slice(0,f.length-1)));b[k]=f}return b}a.prototype._videoCodecs=[/^avc[13]\./i];a.prototype._audioCodecs=[/^mp4a\./i];a.prototype.targetDuration=10;a.prototype.unchangedAfterReload=void 0;a.prototype.getHighestSequenceNumber=function(){return this.m_baseMediaSequence+this.m_media.length-1};a.prototype.onM3U8LoadEnd=function(){if(2==Math.floor(this.m_xhr.status/100)&&this.m_xhr.responseText){var a=(new Date).getTime(),b=this.m_xhr.getResponseHeader("Date"),c=this.m_xhr.getResponseHeader("Last-Modified"),
f=this.m_xhr.getResponseHeader("Age");b&&c?(b=(new Date(b)).getTime(),c=(new Date(c)).getTime(),this.m3u8Age=Math.max((b-c)/1E3,0),f&&(this.m3u8Age+=Number(f))):this.m3u8Age=0;this.retrieved=a/1E3;this.ready=this.parseM3U8(this.m_xhr.responseText)}else this.error=!0;if(this.onloadend)this.onloadend(this)};a.prototype.alignWithVariant=function(a){var b;if(a.url==this.url){a.getHighestSequenceNumber()==this.getHighestSequenceNumber()&&(this.unchangedAfterReload=!0);if(a.m_baseMediaSequence==this.m_baseMediaSequence){this.m_baseOffset=
a.m_baseOffset;return}if(b=a.getMediaSequence(this.m_baseMediaSequence)){this.m_baseOffset=b.offset;return}}if(a.m_hasPDT&&this.m_hasPDT){var c=this.m_media[0];if(b=a.getMediaPDT(c.pdt,c.duration))this.m_baseOffset=b.offset+(c.pdt-b.pdt)}};a.prototype.getEarliestSeekableTime=function(){if(0!=this.m_media.length)return this.m_media[0].runningOffset+this.m_baseOffset};a.prototype.getLatestSeekableTime=function(){if(0!=this.m_media.length)return this.getEarliestSeekableTime()+this.getWindowDuration()};
a.prototype.getWindowDuration=function(){return 0==this.m_media.length?0:this.m_media[this.m_media.length-1].duration+this.m_media[this.m_media.length-1].runningOffset-this.m_media[0].runningOffset};a.prototype.getMediaPDT=function(a,b){for(var c=0;c<this.m_media.length;c++){var f=this.m_media[c];if(a<=f.pdt+f.duration&&a+b<=f.pdt)return this.getMediaIndex(c)}};a.prototype.getMediaSequence=function(a){return this.getMediaIndex(a-this.m_baseMediaSequence)};a.prototype.getMediaIndex=function(a){if(!(0>
a||a>=this.m_media.length))return a=this.m_media[a],a.offset=a.runningOffset+this.m_baseOffset,a};a.prototype.getRates=function(){return this.variants.map(function(a){return a.bandwidth}).sort()};a.prototype.getVariantForBandwidth=function(a,b){b=b||this.variants;if(0!=b.length){0<=a||(a=b[0].bandwidth);for(var c=b[0],f=void 0,h=0;h<b.length;h++){var k=b[h];k.bandwidth<c.bandwidth&&(c=k);k.bandwidth<=a&&(!f||k.bandwidth>f.bandwidth)&&(f=k)}return f?f:c}};a.prototype.getBestPlaylist=function(a,b,c,
f){if("subtitles"!=b||a.subtitles)if("subtitles"==b||a.codecsByType[b]){if(!a[b])return a.url;if(this.m_alternatives[b]&&this.m_alternatives[b][a[b]]){b=this.m_alternatives[b][a[b]];for(var h=void 0,k=void 0,l=void 0,m=void 0,n=0;n<b.length;n++){var q=b[n],p=q.url||a.url;"YES"==q.attributes.DEFAULT&&(h=p);c&&q.attributes.NAME==c&&(m=p);f&&q.attributes.LANGUAGE==f&&("YES"==q.attributes.AUTOSELECT&&(k=p),l=l||p)}return m||k||l||h||a.url}}};a.prototype.getMediaTime=function(a){var b;if(!(a>this.getLatestSeekableTime())){a-=
this.m_baseOffset;for(var c=this.m_media.length-1;0<=c;c--)if(b=this.m_media[c],b.runningOffset<=a)return b.offset=b.runningOffset+this.m_baseOffset,b.sequence=c+this.m_baseMediaSequence,b}};a.prototype.parseM3U8=function(a){try{var e=function(a){a=a.toLowerCase();"0x"==a.slice(0,2)&&(a=a.slice(2));if(!(a.length%2)){for(var b=new Uint8Array(a.length/2),d=0,c=0;c<b.byteLength;c++,d+=2){var e="0123456789abcdef".indexOf(a[d]),f="0123456789abcdef".indexOf(a[d+1]);if(0>e||0>f)return;b[c]=16*e+f}return b}},
g=function(a){a=a.split("@");t=Number(a[0])||0;1<a.length&&(p=Number(a[1])||0)};a=a.replace(/\r\n/g,"\n");a=a.replace(/\r/g,"\n");var f=a.split("\n");if("#EXTM3U"!=f[0])throw Error("bad magic");a=void 0;for(var h=0,k=0,l=0,m=void 0,n=void 0,q=void 0,p=0,t=0,z=void 0,v={identity:{KEYFORMAT:"identity",METHOD:"NONE"}},B=void 0,w=function(a,b){var d={url:b,bandwidth:Number(a.BANDWIDTH),averageBandwidth:Number(a["AVERAGE-BANDWIDTH"]),codecs:a.CODECS,resolution:a.RESOLUTION,audio:a.AUDIO,video:a.VIDEO,
subtitles:a.SUBTITLES,closedCaptions:a["CLOSED-CAPTIONS"]};d.codecs||(d.codecs="avc1.64081f,mp4a.40.2");if(d.codecs){var c=function(a){var b=d.codecs.split(",").filter(function(b){return a.some(function(a){return a.exec(b.trim())})}),b=b.map(function(a){return a.trim()});return b.join(",")};d.codecsSupported=StreamEngine.isTypeSupported('video/mp4; codecs="'+d.codecs+'"');d.codecsByType={video:c(this._videoCodecs),audio:c(this._audioCodecs)}}return d}.bind(this),C=0;C<f.length;C++){var x=f[C];if(""!=
x)if("#"==x[0]){var u,A,y=void 0,r=void 0,D,G=x.indexOf(":");0>G?(u=x,A=""):(u=x.slice(0,G),A=x.slice(G+1),y=c(A));switch(u){case "#EXTM3U":case "#EXT-X-VERSION":break;case "#EXTINF":a=Number(y[0]);break;case "#EXT-X-BYTERANGE":g(A);break;case "#EXT-X-DISCONTINUITY":l++;B=void 0;break;case "#EXT-X-KEY":r=b(y);D=r.KEYFORMAT||"identity";z=z||{};z=function(){var a={},b;for(b in z)a[b]=z[b];return a}();r.IV&&(r.IV=e(r.IV));r.URI&&(r.URI=(new URL(r.URI,this.url)).toString());z[D]=r;break;case "#EXT-X-MAP":r=
b(y);m=(new URL(r.URI,this.url)).toString();r.BYTERANGE&&(g(r.BYTERANGE),t&&(m={url:m,range:"bytes="+p+"-"+(p+t-1)},p+=t,t=0));break;case "#EXT-X-PROGRAM-DATE-TIME":h=(new Date(A)).getTime()/1E3;this.m_hasPDT||function(a,b){for(var d=a.length-1;0<=d;d--){var c=a[d];b-=c.duration;c.pdt=b}}(this.m_media,h);this.m_hasPDT=!0;break;case "#EXT-X-TARGETDURATION":this.targetDuration=Number(A);break;case "#EXT-X-MEDIA-SEQUENCE":this.m_baseMediaSequence=Number(A);break;case "#EXT-X-DISCONTINUITY-SEQUENCE":l=
Number(A);break;case "#EXT-X-ENDLIST":this.live=!1;break;case "#EXT-X-PLAYLIST-TYPE":break;case "#EXT-X-I-FRAMES-ONLY":this.iframesOnly=!0;break;case "#EXT-X-MEDIA":r=b(y);if(r.TYPE&&r["GROUP-ID"]&&r.NAME){var E=r.TYPE.toLowerCase();this.m_alternatives[E]||(this.m_alternatives[E]={});this.m_alternatives[E][r["GROUP-ID"]]||(this.m_alternatives[E][r["GROUP-ID"]]=[]);y={attributes:r};r.URI&&(y.url=(new URL(r.URI,this.url)).toString());this.m_alternatives[E][r["GROUP-ID"]].push(y);this.alternateNames[E]||
(this.alternateNames[E]={});this.alternateNames[E][r.NAME]={default:"YES"==r.DEFAULT,autoselect:"YES"==r.AUTOSELECT,forced:"YES"==r.FORCED,lang:r.LANGUAGE,associatedLang:r["ASSOC-LANGUAGE"]};if(r.LANGUAGE){var I="subtitles"==E?this.subtitlesLanguages:this.languages;0>I.indexOf(r.LANGUAGE)&&I.push(r.LANGUAGE)}}break;case "#EXT-X-STREAM-INF":n=b(y);break;case "#EXT-X-I-FRAME-STREAM-INF":q=b(y);if(q.URI&&q.BANDWIDTH){q.AUDIO=void 0;q.SUBTITLES=void 0;q["CLOSED-CAPTIONS"]=void 0;var F=w(q,(new URL(q.URI,
this.url)).toString());F.codecsSupported&&this.iframeVariants.push(F);this.m_allIframeVariants.push(F)}break;case "#EXT-X-SESSION-DATA":break;case "#EXT-X-INDEPENDENT-SEGMENTS":this.independentSegments=!0;break;case "#EXT-X-START":break;default:StreamEngine.verbose&&console.log("other M3U8 tag: "+x)}}else{var H=(new URL(x,this.url)).toString();isFinite(a)?(t&&(!this.iframesOnly||B&&B.url==H||(B={url:H,range:"bytes=0-"+Math.max(0,p-1)}),H={url:H,range:"bytes="+p+"-"+(p+t-1)},p+=t,t=0),r={url:H,duration:a,
runningOffset:k,pdt:h,discontinuitySequence:l,keys:z||v},k+=a,h+=a,m?r.initSegment=m:B&&(r.initSegment=B),this.m_media.push(r),a=void 0,this.live=!0,this.isMaster=!1):n&&(F=w(n,H),F.codecsSupported&&this.variants.push(F),this.m_allVariants.push(F),n=void 0,this.isMaster=!0)}}}catch(J){return console.log("parseM3U8:",J),this.error=!0,!1}return!0};HLSStreamSource.prototype.M3U8=a})();function EmsgStreamSource(a){this.streamSource=a;this.m_myChannel=void 0;this.m_lastVirtualTimes={};this.m_convertChannels={};this.m_messages=[];this.m_lastTag=void 0;this.m_seenMessages={};this._reset()}EmsgStreamSource.prototype=Object.create(IStreamSource.prototype);EmsgStreamSource.prototype.constructor=EmsgStreamSource;EmsgStreamSource.prototype.processStreamTimeslice=function(a,c,b,d){return a==this.m_myChannel?this.processMyChannelTimeslice(c):this.filterStreamTimeslice(a,c,b,d)};
EmsgStreamSource.prototype.seek=function(a){this._reset();this.m_myChannel=void 0;this.streamSource&&this.streamSource.seek(a)};EmsgStreamSource.prototype.sync=function(a){this._reset();this.streamSource&&this.streamSource.sync(a)};EmsgStreamSource.prototype._reset=function(){this.m_syncing=[];this.m_ending=[];this.m_messages=[]};
EmsgStreamSource.prototype.processMyChannelTimeslice=function(a){if(this.m_messages.length)a(this.m_messages),this.m_messages=[];else{if(this.m_syncing.length==this.m_myChannel)return StreamStatus.Sync();if(this.m_ending.length==this.m_myChannel)return StreamStatus.Ended()}};
EmsgStreamSource.prototype.filterStreamTimeslice=function(a,c,b,d){function e(a){g=a}var g=void 0;if(this.streamSource)return this.m_lastVirtualTimes[a]=d,b=this.streamSource.processStreamTimeslice(a,e,b,d)||StreamStatus.Continue(),b.kind==StreamStatusKind.KIND_MARK?b=this.processMark(b):b.kind==StreamStatusKind.KIND_SYNC?this.m_syncing[a]=!0:b.kind==StreamStatusKind.KIND_ENDED&&(this.m_ending[a]=!0),g&&(this.m_convertChannels[a]&&this.processChannelData(a,g),c(g)),b};
EmsgStreamSource.prototype.processMark=function(a){var c=a.config.types;this.m_lastTag=a.tag;this.m_myChannel=c.length;this.m_convertChannels={};this.m_seenMessages={};for(var b=0;b<c.length;b++)/(video|audio)\/mp4/.exec(c[b])&&(this.m_convertChannels[b]=!0);c.push("streamengine/event; time=virtual");return a};
EmsgStreamSource.prototype.processChannelData=function(a,c){function b(a,b,d){if(b+4>d)throw Error();return 16777216*a[b]+65536*a[b+1]+256*a[b+2]+a[b+3]}function d(a,b,d){for(;b<d;){if(0==a[b])return b;b++}throw Error();}if(c){c=new Uint8Array(c);var e=0,g;try{for(;e+30<c.byteLength;){var f=e+b(c,e,e+4);if(f<e+8)break;e+=4;if(101==c[e]&&109==c[e+1]&&115==c[e+2]&&103==c[e+3]){e+=4;e+=4;g=d(c,e,f);var h=StreamEngine.util.decodeUTF8(c.subarray(e,g)),e=g+1;g=d(c,e,f);var k=StreamEngine.util.decodeUTF8(c.subarray(e,
g)),e=g+1,l=b(c,e,f),e=e+4,m=b(c,e,f),e=e+4,n=b(c,e,f),e=e+4,q=b(c,e,f),e=e+4,p=c.subarray(e,f),t=this.newEmsg(a,h,k,l,m/l,n/l,q,p);this.handleEventParse(t,!!this.m_seenMessages[t.key]);this.m_seenMessages[t.key]||(this.m_messages.push(t),this.m_seenMessages[t.key]=!0)}e=f}}catch(z){console.log("error parsing MP4 boxes",z)}}};EmsgStreamSource.prototype.newEmsg=function(a,c,b,d,e,g,f,h){e=this.m_lastVirtualTimes[a]+e;return new this.EmsgEvent(this,this.m_lastTag,d,e,e+g,a,c,b,f,h)};
EmsgStreamSource.prototype.handleEventEnter=function(a){StreamEngine.verbose&&console.log("EmsgStreamSource.onEventEnter",a);if(this.onmessageenter)this.onmessageenter(a.eventMessage)};EmsgStreamSource.prototype.handleEventExit=function(a){StreamEngine.verbose&&console.log("EmsgStreamSource.onEventExit",a);delete this.m_seenMessages[a.key];if(this.onmessageexit)this.onmessageexit(a.eventMessage)};
EmsgStreamSource.prototype.handleEventParse=function(a,c){StreamEngine.verbose&&console.log("EmsgStreamSource.onEventParse"+(c?" duplicate":""),a);if(this.onmessageparse)try{this.onmessageparse(a.eventMessage,c)}catch(b){console.log("EmsgStreamSource exception in onmessageparse:",b)}};EmsgStreamSource.prototype.onmessageenter=function(a){};EmsgStreamSource.prototype.onmessageexit=function(a){};EmsgStreamSource.prototype.onmessageparse=function(a,c){};
(function(){function a(a,b,d,e,g,f,h,k,l,m){this.m_owner=a;this.startTime=e;this.endTime=g;this.key=""+l+"|"+f+"|"+h+"|"+k;this.eventMessage={startTime:e,endTime:g,tag:b,timescale:d,channel:f,schemeUri:h,value:k,id:l,data:new Uint8Array(m)}}a.prototype.onenter=function(){this.m_owner.handleEventEnter(this)};a.prototype.onexit=function(){this.m_owner.handleEventExit(this)};EmsgStreamSource.prototype.EmsgEvent=a})();(function(){Primetime.streamengine={modules:{},dependencies:{protection:{}},vo:{},di:{},models:{}}})();(function(){function a(a){this.streamSource=a;this.prebuffer=new PrebufferStreamSource(a);this.emsg=new EmsgStreamSource(this.prebuffer);this.head=this.typeMapper=TypeMapperStreamSource.Primetime(this.emsg)}function c(){StreamEngine.call(this);this._currentCSSText=this._customCSS=""}function b(){StreamEngine.verbose=!0;console.log("new SE MPI",this);this._streamEngine=new c;console.log("StreamEngine instance",this._streamEngine);this._trickModeController=new TrickModeController;this._isAdOnly=this._delegate=
this._currentItem=this._view=this._textTrackElement=this._streamSourcePipeline=this._streamSource=void 0;this._sentStop=this._playbackStarted=!1;this._onPlaybackTimeUpdatedCallback=this.onPlaybackTimeUpdated.bind(this);this._protectionController=this._drmManager=this._timeUpdateInterval=void 0;this.protectionDataConst={};this.notifier=this.system=this.playbackMetrics=void 0;var a=new dijon.System;a.autoMapOutlets=!0;a.mapValue("system",a);a.mapValue("mediaPlayer",this);a.mapOutlet("system");a.mapSingleton("notifier",
MediaPlayer.dependencies.Notifier);a.mapValue("log",console.log.bind(console));a.mapClass("eventBusCl",MediaPlayer.utils.EventBus);a.mapClass("drmManagerImpl",Primetime.dependencies.DRMManagerImpl);a.mapClass("protectionController",Primetime.dependencies.ProtectionController);a.mapClass("protectionExt",Primetime.dependencies.ProtectionExtensions);a.mapSingleton("ksPlayReady",MediaPlayer.dependencies.protection.KeySystem_PlayReady);a.mapSingleton("ksWidevine",MediaPlayer.dependencies.protection.KeySystem_Widevine);
a.mapSingleton("ksClearKey",MediaPlayer.dependencies.protection.KeySystem_ClearKey);a.mapSingleton("ksAccess",Primetime.dependencies.protection.KeySystem_Access);a.mapSingleton("serverPlayReady",MediaPlayer.dependencies.protection.servers.PlayReady);a.mapSingleton("serverWidevine",MediaPlayer.dependencies.protection.servers.Widevine);a.mapSingleton("serverClearKey",MediaPlayer.dependencies.protection.servers.ClearKey);a.mapSingleton("serverDRMToday",MediaPlayer.dependencies.protection.servers.DRMToday);
a.mapSingleton("serverAccess",Primetime.dependencies.protection.servers.Access);var b=document.createElement("video");MediaPlayer.models.ProtectionModel_21Jan2015.detect(b)?a.mapClass("protectionModel",MediaPlayer.models.ProtectionModel_21Jan2015):MediaPlayer.models.ProtectionModel_3Feb2014.detect(b)?a.mapClass("protectionModel",MediaPlayer.models.ProtectionModel_3Feb2014):MediaPlayer.models.ProtectionModel_01b.detect(b)&&a.mapClass("protectionModel",MediaPlayer.models.ProtectionModel_01b);a.injectInto(this);
this._streamEngine.bufferLowWaterMark=10;this._streamEngine.bufferHighWaterMargin=30;this._streamEngine.onbufferstate=this.onStreamEngineBufferState.bind(this)}a.prototype.close=function(){this.prebuffer.close()};c.prototype=Object.create(StreamEngine.prototype);c.prototype.constructor=c;c.prototype.setCSS=function(a){this._customCSS=a||"";this.onCaptionStyleSheet(this._currentCSSText)};c.prototype.onCaptionStyleSheet=function(a){this._currentCSSText=a||"";StreamEngine.prototype.onCaptionStyleSheet.call(this,
this._customCSS+" "+a);StreamEngine.verbose&&console.log("set Caption CSS to",this._customCSS+" "+a)};b.prototype.startup=function(a,b){console.log("SE MPI startup");this._delegate=a;this._isAdOnly=b};b.prototype.setStreamController=function(a){console.log("SE MPI setStreamController",arguments)};b.prototype.getStreamController=function(){console.log("SE MPI getStreamController")};b.prototype.getProgressTime=function(){console.log("SE MPI getProgressTime");return this.time()};b.prototype.getProtectionController=
function(){console.log("SE MPI getProtectionController");this._protectionController||(this._protectionController=this.system.getObject("protectionController"),this._protectionController.initListeners(),this._protectionController.setProtectionData(this.protectionDataConst),this._view&&this._protectionController.setMediaElement(this._view));return this._protectionController};b.prototype.prepareToPlay=function(a){console.log("SE MPI prepareToPlay",arguments);this._delegate&&this._delegate._nativeNotification("preparing");
this._view.play();this.seek(a);this._view.pause();this._delegate&&(this._delegate._nativeNotification("prepared"),this._delegate._nativeNotification("timelineUpdated"));return!0};b.prototype.play=function(){console.log("SE MPI play");this._view.play();this._sentStop=!1;this._delegate&&(this._delegate._nativeNotification("playing"),this._delegate._nativeNotification("playStart"));return!0};b.prototype.playStream=function(a){console.log("SE MPI playStream",arguments)};b.prototype.activateStream=function(a){console.log("SE MPI activateStream",
arguments)};b.prototype.createTransition=function(a,b){console.log("SE MPI createTransition",arguments)};b.prototype.pause=function(){console.log("SE MPI pause");this._view.pause();return!0};b.prototype.pauseStream=function(){console.log("SE MPI pauseStream");return!0};b.prototype.getLiveStartTime=function(){console.log("SE MPI getLiveStartTime");return"live"};b.prototype.createOrUpdateVirtualTimelineItems=function(){console.log("SE MPI createOrUpdateVirtualTimelineItems")};b.prototype.isMainContentPlayer=
function(){console.log("SE MPI isMainContentPlayer");return!this._isAdOnly};b.prototype.getVirtualTimeline=function(){console.log("SE MPI getVirtualTimeline")};b.prototype.setVirtualTimeline=function(a){console.log("SE MPI setVirtualTimeline",arguments)};b.prototype.seekStream=function(a){console.log("SE seekStream",a)};b.prototype.liveSeek=function(a){console.log("SE liveSeek",a)};b.prototype.seekToLivePoint=function(){console.log("SE seekToLivePoint");this.seek(AdobePSDK.MediaPlayer.LIVE_POINT)};
b.prototype.time=function(){return this._streamEngine.currentTime};b.prototype.haveCurrentStreamTime=function(){console.log("SE MPI haveCurrentStreamTime");return!1};b.prototype.duration=function(){console.log("SE MPI duration",arguments)};b.prototype.addSource=function(a,b,c){console.log("SE addSource",a,b,c)};b.prototype.attachSource=function(b,c,g,f,h){var k;console.log("SE MPI attachSource",arguments);switch(f){case AdobePSDK.MediaResourceType.DASH:k=DASHStreamSource;break;case AdobePSDK.MediaResourceType.HLS:k=
HLSStreamSource;break;default:return console.log("SE attachSource: unknown resource type "+f),!1}this._streamSource=new k(b);this._streamSource.preciseSeek=!/Firefox/.exec(navigator.userAgent);this._streamSource.textEnabled=!0;this._streamSource.onmanifestloaded=this.onManifestUpdated.bind(this);this._streamSourcePipeline=new a(this._streamSource);this._streamEngine.streamSource=this._streamSourcePipeline.head;this._delegate&&this._delegate._nativeNotification("initializing");return!0};b.prototype.replaceCurrentResource=
function(a,b){console.log("SE MPI replaceCurrentResource",arguments);var c=this.getProtectionController(),f=c?c.getProtectionData():null;return this.attachSource(a.url,c,f,a.type,!1)};b.prototype.getCurrentTime=function(){console.log("SE MPI getCurrentTime");return this.time()};b.prototype.getLocalTime=function(){console.log("SE MPI getLocalTime");return this.time()};b.prototype.haveLocalTime=function(){console.log("SE MPI haveLocalTime");return!0};b.prototype.getPlaybackRange=function(){var a={start:this._streamSource.earliestSeekableTime,
end:this._streamSource.latestSeekableTime};a.begin=a.start;a.duration=a.end-a.start;return a};b.prototype.getCurrentStreamTime=function(){return this.time()};b.prototype.getLocalStreamTime=function(){return this.time()};b.prototype.getVirtualTimeForLocalTime=function(a){return a};b.prototype.getStreamPlaybackRange=function(){console.log("SE MPI getStreamPlaybackRange")};b.prototype.getSeekableRange=function(){console.log("SE MPI getSeekableRange");return this.getPlaybackRange()};b.prototype.doReset=
function(){console.log("SE MPI doReset")};b.prototype.attachView=function(a){console.log("SE MPI attachView",a);this._view=a;this._streamEngine.close();this._streamEngine.attachMediaElement(this._view);this._view.addEventListener("timeupdate",this._onPlaybackTimeUpdatedCallback);this._view.addEventListener("ended",this._onPlaybackTimeUpdatedCallback);void 0==this._timeUpdateInterval&&(this._timeUpdateInterval=setInterval(this._onPlaybackTimeUpdatedCallback,1E3));this._textTrackElement||(this._textTrackElement=
a.ownerDocument.createElement("track"),a.appendChild(this._textTrackElement),this._textTrackElement.kind="captions",this._textTrackElement.track.mode="showing",this._streamEngine.textTrack=this._textTrackElement.track);this._protectionController&&this._protectionController.setMediaElement(a);this._view.addEventListener("encrypted",function(){console.log("encrypted event!",arguments)})};b.prototype.setView=function(a){console.log("SE MPI setView",arguments);this.attachView(a)};b.prototype.getView=
function(){console.log("SE MPI getView");return this._view};b.prototype.getBufferControlParameters=function(){console.log("SE MPI getBufferControlParameters")};b.prototype.setBufferControlParameters=function(a){console.log("SE MPI setBufferControlParameters",arguments)};b.prototype.getABRControlParameters=function(){console.log("SE MPI getABRControlParamters")};b.prototype.setABRControlParameters=function(a){console.log("SE MPI setABRControlParamters",arguments)};b.prototype.getVolume=function(){console.log("SE MPI getVolume");
return this._view?this._view.volume:1};b.prototype.setVolume=function(a){console.log("SE MPI setVolume",arguments);this._view&&(this._view.volume=a)};b.prototype.setRate=function(a){console.log("SE MPI setRate",arguments)};b.prototype.setStreamRate=function(a){console.log("SE MPI setStreamRate",arguments)};b.prototype.getRate=function(){return 1};b.prototype.getStreamRate=function(){console.log("SE MPI getStreamRate");return 1};b.prototype.isTrickPlayMode=function(){console.log("SE MPI isTrickPlayMode",
arguments);return!1};b.prototype.playbackRateSelected=function(a){console.log("SE MPI playbackRateSelected",arguments)};b.prototype.playbackRateChanged=function(){console.log("SE MPI playbackRateChanged")};b.prototype.hasActiveStream=function(){console.log("SE MPI hasActiveStream");return!1};b.prototype.onPlaybackTimeUpdated=function(){this._delegate&&(this._delegate._nativeNotification("timeUpdated",this.time()),this._view&&this._view.ended&&this._streamEngine.halted&&!this._sentStop&&(this._delegate._nativeNotification("stop"),
this._sentStop=!0))};b.prototype.hasPlaybackStarted=function(){console.log("SE MPI hasPlaybackStarted");return this._playbackStarted};b.prototype.onPlaybackStarted=function(){console.log("SE MPI onPlaybackStarted");this._playbackStarted=!0};b.prototype.onPlaybackStopped=function(){console.log("SE MPI onPlaybackStopped")};b.prototype.onPlaybackPaused=function(){console.log("SE MPI onPlaybackPaused")};b.prototype.onPlaybackSeeking=function(){console.log("SE MPI onPlaybackSeeking")};b.prototype.onPlaybackSeeked=
function(){console.log("SE MPI onPlaybackSeeked")};b.prototype.onDRMMetadataAvailable=function(a,b){console.log("SE MPI onDRMMetadataAvailable",arguments);if(void 0!=a&&null!=a&&void 0!=b&&null!=b&&0!=b.length&&this._delegate){var c=this.getProtectionController(),c=(c=c?c.getProtectionData():null)?c[a.systemString]||null:null,c={drmMetadata:new AdobePSDK.DRMMetadata(c?c.laURL:null,null,null,a.systemString,b)};this.getCurrentItem()&&this.getCurrentItem().addDRMMetadataInfo(c);this._delegate._nativeNotification("drmMetadataInfoAvailable",
{drmMetadataInfo:c})}};b.prototype.getTimeline=function(){console.log("SE MPI getTimeline")};b.prototype.getCurrentItem=function(){console.log("SE MPI getCurrentItem");this._currentItem||(this._currentItem=new Primetime.streamengine.dependencies.MediaPlayerItemImpl(this));return this._currentItem};b.prototype.getDRMManager=function(){console.log("SE MPI getDRMManager");this._drmManager||(this._drmManager=this.system.getObject("drmManagerImpl"),this._drmManager.initialize(this,this.getProtectionController()));
return this._drmManager};b.prototype.addEventListener=function(){console.log("SE MPI addEventListener called",arguments)};b.prototype.removeEventListener=function(){console.log("SE MPI removeEventListener called",arguments)};b.prototype.onStreamUpdated=function(){console.log("SE MPI onStreamUpdated called",arguments)};b.prototype.onStreamsComposed=function(){console.log("SE MPI onStreamsComposed called",arguments)};b.prototype.onPlaybackTrackUpdated=function(){console.log("SE MPI onPlaybackTrackUpdated called",
arguments)};b.prototype.onBufferLevelStateChanged=function(a,b){console.log("SE MPI onBufferLevelStateChanged called",arguments)};b.prototype.onStreamEngineBufferState=function(a,b){this._delegate&&this._delegate._nativeNotification(b?"bufferEnd":"bufferBegin")};b.prototype.onManifestUpdated=function(a){console.log("SE MPI onManifestUpdated called",arguments);a.error||this._initializeDRM();this._delegate&&(a.error?this._delegate._nativeError():(this._delegate._nativeNotification("streamCreated"),
this._delegate._nativeNotification("initialized")))};b.prototype._initializeDRM=function(){var a=this.getProtectionController();if(a){var b=new MediaPlayer.vo.MediaInfo,c=new MediaPlayer.vo.MediaInfo;c.type="audio";c.codec='audio/mp4; codecs="mp4a.40.2"';c.mimeType="audio/mp4";b.type="video";b.codec='video/mp4; codecs=avc1.64001f"';b.mimeType="video/mp4";a.init(null,c,b,null)}};b.prototype.onQualityChanged=function(a,b){console.log("SE MPI onQualityChanged",arguments)};b.prototype.reset=function(){console.log("SE MPI reset");
this._view&&(this._view.removeEventListener("timeupdate",this._onPlaybackTimeUpdatedCallback),this._view.removeEventListener("ended",this._onPlaybackTimeUpdatedCallback),this._textTrackElement&&this._view.removeChild(this._textTrackElement),this._textTrackElement=void 0,this._streamEngine.textTrack=void 0);0<=this._timeUpdateInterval&&(clearInterval(this._timeUpdateInterval),this._timeUpdateInterval=void 0);this._protectionController&&(this._protectionController.setMediaElement(null),this._protectionController=
void 0);this._trickModeController.close();this._streamSourcePipeline&&this._streamSourcePipeline.close();this._streamEngine.close();this.notifier.notify("resetCompleted");return!0};b.prototype.resetCurrentItem=function(){console.log("SE MPI resetCurrentItem");this._currentItem=void 0;return!0};b.prototype.resetDRMManager=function(){console.log("SE MPI resetDRMManager")};b.prototype.getBufferedRange=function(a){var b,c=this._streamEngine.tag&&this._streamEngine.tag.channels;"muxed"!=a&&c?(a=c[a],isFinite(a)&&
(b=this._streamEngine.bufferedThrough[a])):b=this._streamEngine.leastBufferedThrough;b={start:this._streamEngine.currentTime,end:b};b.begin=b.start;b.duration=b.end-b.start;return b};b.prototype.getStreamBufferedRange=function(){console.log("SE MPI getStreamBufferedRange")};b.prototype.getPlaybackMetrics=function(){this.playbackMetrics||(this.playbackMetrics=new AdobePSDK.PlaybackMetrics(this));return this.playbackMetrics};b.prototype.getCribbedMetrics=function(){return{bandwidthValue:0,bitrateIndexValue:1,
pendingIndex:"",numBitratesValue:1,bufferLengthValue:Math.floor(1E3*this._streamEngine.bufferLength),droppedFramesValue:0,movingLatency:0,movingDownload:0,movingRatio:0}};b.prototype.getAdditionalPlaybackInformationMetrics=function(){};b.prototype.onFirstVirtualTimelineItemActivating=function(a){console.log("SE MPI onFirstVirtualTimelineItemActivating")};b.prototype.sampleFps=function(){console.log("SE MPI sampleFps")};b.prototype.getFps=function(){console.log("SE MPI getFps");return 0};b.prototype.getCORSConfig=
function(){console.log("SE MPI getCORSConfig")};b.prototype.getNetworkConfig=function(){console.log("SE MPI getNetworkConfig")};b.prototype.timelineUpdating=function(){console.log("SE MPI timelineUpdating")};b.prototype.timelineUpdated=function(){console.log("SE MPI timelineUpdated")};b.prototype.addVirtualTimelineItem=function(a){console.log("SE MPI addVirtualTimelineItem",arguments)};b.prototype.pauseAtPeriodEnd=function(a){console.log("SE MPI pauseAtPeriodEnd",arguments)};b.prototype.onPauseAtPeriodEnd=
function(a){console.log("SE MPI onPauseAtPeriodEnd",arguments)};b.prototype.addEventListeners=function(){console.log("SE MPI addEventListeners")};b.prototype.removeEventListeners=function(){console.log("SE MPI removeEventListeners")};b.prototype.getSSAIController=function(){console.log("SE MPI getSSAIController")};b.prototype.handlePlaybackComplete=function(){console.log("SE MPI handlePlaybackComplete",arguments)};b.prototype.timedMetadataUpdated=function(a){console.log("SE MPI timedMetadataUpdated",
arguments)};b.prototype.playStream=function(a,b){console.log("SE playStream",a,b)};b.prototype.deactivate=function(){console.log("SE deactivate")};b.prototype.setCCVisibility=function(a){console.log("SE MPI setCCVisibility",arguments);this._streamEngine.textTrack&&(this._streamEngine.textTrack.mode=a==AdobePSDK.MediaPlayer.VISIBLE?"showing":"hidden")};b.prototype.setCCStyle=function(a){function b(a,c){var d;AdobePSDK.TextFormat.DEFAULT_OPACITY==c&&(c=100);c=Number(c);switch(a){case AdobePSDK.TextFormat.BLACK:d=
"0, 0, 0";break;case AdobePSDK.TextFormat.GRAY:d="128, 128, 128";break;case AdobePSDK.TextFormat.DARK_RED:case AdobePSDK.TextFormat.RED:case AdobePSDK.TextFormat.BRIGHT_RED:d="255, 0, 0";break;case AdobePSDK.TextFormat.DARK_GREEN:case AdobePSDK.TextFormat.GREEN:case AdobePSDK.TextFormat.BRIGHT_GREEN:d="0, 255, 0";break;case AdobePSDK.TextFormat.DARK_BLUE:case AdobePSDK.TextFormat.BLUE:case AdobePSDK.TextFormat.BRIGHT_BLUE:d="0, 0, 255";break;case AdobePSDK.TextFormat.DARK_YELLOW:case AdobePSDK.TextFormat.YELLOW:case AdobePSDK.TextFormat.BRIGHT_YELLOW:d=
"255, 255, 0";break;case AdobePSDK.TextFormat.DARK_MAGENTA:case AdobePSDK.TextFormat.MAGENTA:case AdobePSDK.TextFormat.BRIGHT_MAGENTA:d="255, 0, 255";break;case AdobePSDK.TextFormat.DARK_CYAN:case AdobePSDK.TextFormat.CYAN:case AdobePSDK.TextFormat.BRIGHT_CYAN:d="0, 255, 255";break;default:d="255, 255, 255"}return"rgba("+d+", "+c/100+")"}console.log("SE MPI setCCStyle",arguments);var c='"Courier", monospace',f="1em",h="normal",k,l;if(a){switch(a.font){case AdobePSDK.TextFormat.PROPORTIONAL_WITH_SERIFS:c=
"serif";break;case AdobePSDK.TextFormat.CASUAL:c='"Comic Sans MS", "Comic Sans", fantasy';break;case AdobePSDK.TextFormat.CURSIVE:c="cursive";break;case AdobePSDK.TextFormat.SMALL_CAPITALS:c="monospace";h="small-caps";break;case AdobePSDK.TextFormat.MONOSPACED_WITHOUT_SERIFS:c='"Andale Mono", "Monaco", monospace'}k=b(a.fontColor,a.fontOpacity);l=b(a.backgroundColor,a.backgroundOpacity);switch(a.size){case AdobePSDK.TextFormat.SMALL:f="0.75em";break;case AdobePSDK.TextFormat.LARGE:f="1.25em"}this._streamEngine.setCSS("::cue { line-height: normal; font-style: normal; font-weight: normal; font-size: "+
f+"; font-family: "+c+"; font-variant-caps: "+h+"; color: "+k+"; background: "+l+"; }");return!0}};b.prototype.seek=function(a){console.log("SE MPI seek",arguments);0>a?a="start":(a/=1E3,this._streamSource&&(a+=this._streamSource.earliestSeekableTime));var b=this._view.buffered;if(isFinite(a)&&0<b.length&&this._streamSource&&this._streamSource.preciseSeek){var c=b.start(0),b=b.end(b.length-1),f=a+this._view.currentTime-this._streamEngine.currentTime;if(c<=f&&f<b)return this._view.currentTime=f,!0}this._streamEngine.seek(a);
this._sentStop=!1;return!0};b.prototype.seekToLocal=function(a){return this.seek(a)};b.prototype.subscribe=function(a,b,c,f){console.log("SE MPI subscribe",arguments);this.notifier.subscribe(a,b,c,f)};b.prototype.unsubscribe=function(a,b,c){console.log("SE MPI unsubscribe",arguments);this.notifier.unsubscribe(a,b,c)};b.prototype.isLive=function(){return this._streamSource?this._streamSource.isLive:!1};b.prototype.getClosedCaptionsTracks=function(){if(this._streamSource)return this._streamSource.textAlternativeNames.map(function(a){return new AdobePSDK.ClosedCaptionsTrack(0,
0,a,a,!0,!0,"vtt",!1)})};b.prototype.selectClosedCaptionsTrack=function(a){this._streamSource&&a&&(this._streamSource.textAlternativeName=a.name,this._streamEngine.seek(this._streamEngine.currentTime));return!0};Primetime.streamengine.MediaPlayerImpl=b})();(function(){function a(a){console.log("new SE MPII",this);this.owner=a;this._delegate=void 0}a.prototype.getHasTimedMetadata=function(){console.log("SE MPII getHasTimedMetadata");return!1};a.prototype.getTimedMetadata=function(){console.log("SE MPII getTimedMetadata",arguments)};a.prototype.updateTimedMetadata=function(a,b){console.log("SE MPII updateTimedMetadata",arguments)};a.prototype.updateID3Metadata=function(a,b){console.log("SE MPII updateID3Metadata",arguments)};a.prototype.deleteOldTimedMetadata=
function(a){console.log("SE MPII deleteOldTimedMetadata",arguments)};a.prototype.appendNewTimedMetadata=function(a){console.log("SE MPII appendNewTimedMetadata",arguments)};a.prototype.id3AlreadyProcessed=function(a,b){console.log("SE MPII id3AlreadyProcessed",arguments);return!1};a.prototype.tagIsAlreadyProcessed=function(a,b,d){console.log("SE MPII tagIsAlreadyProcessed",arguments);return!1};a.prototype.getStreamController=function(){console.log("SE MPII getStreamController",arguments)};a.prototype.setNativePlayer=
function(a){console.log("SE MPII setNativePlayer",arguments)};a.prototype.setDelegate=function(a){console.log("SE MPII setDelegate",arguments);this._delegate=a};a.prototype.getResource=function(){console.log("SE MPII getResource",arguments)};a.prototype.update=function(a){console.log("SE MPII update",arguments)};a.prototype.getAudioTracks=function(){console.log("SE MPII getAudioTracks",arguments)};a.prototype.getClosedCaptionsTracks=function(){console.log("SE MPII getClosedCaptionsTracks",arguments);
return this.owner.getClosedCaptionsTracks()};a.prototype.getSelectedAudioTrack=function(){console.log("SE MPII getSelectedAudioTrack",arguments)};a.prototype.getSelectedClosedCaptionsTrack=function(){console.log("SE MPII getSelectedClosedCaptionsTrack",arguments)};a.prototype.selectAudioTrack=function(a){console.log("SE MPII selectAudioTrack",arguments)};a.prototype.selectClosedCaptionsTrack=function(a){console.log("SE MPII selectClosedCaptionsTrack",arguments);return this.owner.selectClosedCaptionsTrack(a)};
a.prototype.getProfiles=function(){console.log("SE MPII getProfiles",arguments)};a.prototype.getSelectedProfile=function(){console.log("SE MPII getSelectedProfile",arguments)};a.prototype.getProfileForQuality=function(a,b){console.log("SE MPII getProfileForQuality",arguments)};a.prototype.isLive=function(){return this.owner.isLive()};a.prototype.isProtected=function(){console.log("SE MPII isProtected",arguments);return!1};a.prototype.isDynamic=function(){console.log("SE MPII isDynamic",arguments);
return!1};a.prototype.addDRMMetadataInfo=function(a){console.log("SE MPII addDRMMetadataInfo",arguments)};a.prototype.getDRMMetadataInfos=function(){console.log("SE MPII getDRMMetadataInfos",arguments)};a.prototype.isTrickPlaySupported=function(){console.log("SE MPII isTrickPlaySupported",arguments);return!1};a.prototype.setClosedCaptionsTracks=function(a){console.log("SE MPII setClosedCaptionsTracks",arguments)};a.prototype.setCCVisibility=function(a){console.log("SE MPII setCCVisibility",arguments)};
a.prototype.getAvailablePlaybackRates=function(){console.log("SE MPII getAvailablePlaybackRates",arguments);return[1]};Primetime.streamengine.dependencies.MediaPlayerItemImpl=a})();(function(){Primetime.bindings.streamengine={createMediaPlayer:function(a,c,b){var d=null;if("undefined"===typeof c||null===c||"undefined"===typeof a||null===a)return null;"undefined"==typeof b&&(b=!1);Primetime.BindingsFactory.setHtmlAPIBindings();d=new Primetime.streamengine.MediaPlayerImpl;if(b)return d.startup(a,b),d;a._nativePlayer&&a._resetDelegates();c=new Primetime.html.MediaPlayerImplDelegate(a,d);c.getViewDelegate(a.view);a.view&&a.view.getDelegate()&&a.view.getDelegate().showNativeView();
d.startup(c,b);return c}}})();
